<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Impala: impala::CgroupsMgr Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Impala
   </div>
   <div id="projectbrief">Impalaistheopensource,nativeanalyticdatabaseforApacheHadoop.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classimpala_1_1CgroupsMgr.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classimpala_1_1CgroupsMgr-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">impala::CgroupsMgr Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="cgroups-mgr_8h_source.html">cgroups-mgr.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for impala::CgroupsMgr:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="classimpala_1_1CgroupsMgr__coll__graph.svg" width="659" height="438"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a76bafa2f7e4db349ada393e99557a26f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1CgroupsMgr.html#a76bafa2f7e4db349ada393e99557a26f">CgroupsMgr</a> (<a class="el" href="classimpala_1_1MetricGroup.html">MetricGroup</a> *metrics)</td></tr>
<tr class="separator:a76bafa2f7e4db349ada393e99557a26f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7f292a7b25e885d5e13fc6159b37637"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classimpala_1_1Status.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1CgroupsMgr.html#ae7f292a7b25e885d5e13fc6159b37637">Init</a> (const std::string &amp;cgroups_hierarchy_path, const std::string &amp;staging_cgroup)</td></tr>
<tr class="separator:ae7f292a7b25e885d5e13fc6159b37637"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5701489ab164cd3b884a9224642e20b5"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1CgroupsMgr.html#a5701489ab164cd3b884a9224642e20b5">UniqueIdToCgroup</a> (const std::string &amp;unique_id) const </td></tr>
<tr class="separator:a5701489ab164cd3b884a9224642e20b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adfeeb00cc7ae88cd90c7119046c268dd"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1CgroupsMgr.html#adfeeb00cc7ae88cd90c7119046c268dd">VirtualCoresToCpuShares</a> (int16_t v_cpu_cores)</td></tr>
<tr class="separator:adfeeb00cc7ae88cd90c7119046c268dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa612e0baa88df7d2bb4aa5af5db0b62f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classimpala_1_1Status.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1CgroupsMgr.html#aa612e0baa88df7d2bb4aa5af5db0b62f">RegisterFragment</a> (const TUniqueId &amp;fragment_instance_id, const std::string &amp;cgroup, <a class="el" href="classbool.html">bool</a> *is_first)</td></tr>
<tr class="separator:aa612e0baa88df7d2bb4aa5af5db0b62f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d81298b8894a4ab784c995369403203"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classimpala_1_1Status.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1CgroupsMgr.html#a3d81298b8894a4ab784c995369403203">UnregisterFragment</a> (const TUniqueId &amp;fragment_instance_id, const std::string &amp;cgroup)</td></tr>
<tr class="separator:a3d81298b8894a4ab784c995369403203"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5fe21740d7ea25f2894575b8cec47418"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classimpala_1_1Status.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1CgroupsMgr.html#a5fe21740d7ea25f2894575b8cec47418">CreateCgroup</a> (const std::string &amp;cgroup, <a class="el" href="classbool.html">bool</a> if_not_exists) const </td></tr>
<tr class="separator:a5fe21740d7ea25f2894575b8cec47418"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c78d5da4945085810668f3f3d0430c6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classimpala_1_1Status.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1CgroupsMgr.html#a9c78d5da4945085810668f3f3d0430c6">DropCgroup</a> (const std::string &amp;cgroup, <a class="el" href="classbool.html">bool</a> if_exists) const </td></tr>
<tr class="separator:a9c78d5da4945085810668f3f3d0430c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0dcf5e114e1bc41a8762f001c0388b49"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classimpala_1_1Status.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1CgroupsMgr.html#a0dcf5e114e1bc41a8762f001c0388b49">SetCpuShares</a> (const std::string &amp;cgroup, int32_t num_shares)</td></tr>
<tr class="separator:a0dcf5e114e1bc41a8762f001c0388b49"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d5b07b5f1664af832e68d55421c0c68"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classimpala_1_1Status.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1CgroupsMgr.html#a7d5b07b5f1664af832e68d55421c0c68">AssignThreadToCgroup</a> (const <a class="el" href="classimpala_1_1Thread.html">Thread</a> &amp;thread, const std::string &amp;cgroup) const </td></tr>
<tr class="separator:a7d5b07b5f1664af832e68d55421c0c68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbcb30741982fdce210204faf0c8b3f0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classimpala_1_1Status.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1CgroupsMgr.html#adbcb30741982fdce210204faf0c8b3f0">RelocateThreads</a> (const std::string &amp;src_cgroup, const std::string &amp;dst_cgroup) const </td></tr>
<tr class="separator:adbcb30741982fdce210204faf0c8b3f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a69160a27aa61240f447e5154ce169128"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classimpala_1_1Status.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1CgroupsMgr.html#a69160a27aa61240f447e5154ce169128">GetCgroupPaths</a> (const std::string &amp;cgroup, std::string *cgroup_path, std::string *tasks_path) const </td></tr>
<tr class="separator:a69160a27aa61240f447e5154ce169128"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a42cb51d644e4c37a6ea2d1edefc8337c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceimpala.html#ae72a16e1b3afb603ff4b5b4d78f0f0d0">IntCounter</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1CgroupsMgr.html#a42cb51d644e4c37a6ea2d1edefc8337c">active_cgroups_metric_</a></td></tr>
<tr class="memdesc:a42cb51d644e4c37a6ea2d1edefc8337c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of currently active Impala-managed cgroups.  <a href="#a42cb51d644e4c37a6ea2d1edefc8337c">More...</a><br/></td></tr>
<tr class="separator:a42cb51d644e4c37a6ea2d1edefc8337c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad2932bed0a557776d58c2ff5f74f2e3a"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1CgroupsMgr.html#ad2932bed0a557776d58c2ff5f74f2e3a">cgroups_hierarchy_path_</a></td></tr>
<tr class="memdesc:ad2932bed0a557776d58c2ff5f74f2e3a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Root of the CPU cgroup hierarchy. Created cgroups are placed directly under it.  <a href="#ad2932bed0a557776d58c2ff5f74f2e3a">More...</a><br/></td></tr>
<tr class="separator:ad2932bed0a557776d58c2ff5f74f2e3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6e150fadbb826360d3cfe02f9988d78"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1CgroupsMgr.html#ad6e150fadbb826360d3cfe02f9988d78">staging_cgroup_</a></td></tr>
<tr class="separator:ad6e150fadbb826360d3cfe02f9988d78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f3d4cb6f64fe78198d082db8d703c93"><td class="memItemLeft" align="right" valign="top">boost::mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1CgroupsMgr.html#a4f3d4cb6f64fe78198d082db8d703c93">active_cgroups_lock_</a></td></tr>
<tr class="memdesc:a4f3d4cb6f64fe78198d082db8d703c93"><td class="mdescLeft">&#160;</td><td class="mdescRight">Protects active_cgroups_.  <a href="#a4f3d4cb6f64fe78198d082db8d703c93">More...</a><br/></td></tr>
<tr class="separator:a4f3d4cb6f64fe78198d082db8d703c93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af83c5dbc1e3d81d441cbca9579c866b9"><td class="memItemLeft" align="right" valign="top">boost::unordered_map<br class="typebreak"/>
&lt; std::string, int32_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1CgroupsMgr.html#af83c5dbc1e3d81d441cbca9579c866b9">active_cgroups_</a></td></tr>
<tr class="separator:af83c5dbc1e3d81d441cbca9579c866b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Control Groups, or 'cgroups', are a Linux-specific mechanism for arbitrating resources amongst threads. CGroups are organised in a forest of 'hierarchies', each of which are mounted at a path in the filesystem. Each hierarchy contains one or more cgroups, arranged hierarchically. Each hierarchy has one or more 'subsystems' attached. Each subsystem represents a resource to manage, so for example there is a CPU subsystem and a MEMORY subsystem. There are rules about when subsystems may be attached to more than one hierarchy, which are out of scope of this description. Each thread running on a kernel with cgroups enabled belongs to exactly one cgroup in every hierarchy at once. Impala is only concerned with a single hierarchy that assigns CPU resources in the first instance. Threads are assigned to cgroups by writing their thread ID to a file in the special cgroup filesystem. For more information: access.redhat.com/site/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Resource_Management_Guide/ www.kernel.org/doc/Documentation/cgroups/cgroups.txt Manages the lifecycle of Impala-internal cgroups as well as the assignment of execution threads into cgroups. To execute queries Impala requests resources from Yarn via the Llama. Yarn returns granted resources via the Llama in the form or "RM resource ids" that conventionally correspond to a CGroups that the Yarn NM creates. Instead of directly using the NM-provided CGroups, Impala creates and manages its own CGroups for the following reasons:</p>
<ol type="1">
<li>In typical CM/Yarn setups, Impala would not have permissions to write to the tasks file of NM-provided CGroups. It is arguably not even desirable (e.g., for security reasons) for external process to be able to manipulate the permissions of NM-generated CGroups either directly or indirectly.</li>
<li>Yarn-granted CGroups are created asynchronously (the AM calls to create the CGroups are non-blocking). From Impala's perspective that means that once Impala receives notice from the Llama that resources have been granted, it cannot assume that the corresponding containers have been created (although the Yarn NMs eventually will). While each of Impala's plan fragments could wait for the CGroups to be created, it seems unnecessarily complicated and slow to do so.</li>
<li>Impala will probably want to manage its own CGroups eventually, e.g., for optimistic query scheduling. In summary, the typical CGroups-related flow of an Impala query is as follows:</li>
</ol>
<ol type="1">
<li>Impala receives granted resources from Llama and sends out plan fragments</li>
<li>On each node execution such a fragment, convert the Yarn resource id into a CGroup that Impala should create and assign the query's threads to</li>
<li>Register the fragment(s) and the CGroup for the query with the node-local CGroup manager. The registration creates the CGroup maintains a count of all fragments using that CGroup.</li>
<li>Execute the fragments, assigning threads into the Impala-managed CGroup.</li>
<li>Complete the fragments by unregistering them with the CGroup from the node-local CGroups manager. When the last fragment for a CGroup is unregistered, all threads from that CGroup are relocated into a special staging CGroup, so that the now unused CGroup can safely be deleted (otherwise, we'd have to wait for the OS to drain all entries from the CGroup's tasks file) </li>
</ol>

<p>Definition at line <a class="el" href="cgroups-mgr_8h_source.html#l00079">79</a> of file <a class="el" href="cgroups-mgr_8h_source.html">cgroups-mgr.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a76bafa2f7e4db349ada393e99557a26f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">impala::CgroupsMgr::CgroupsMgr </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classimpala_1_1MetricGroup.html">MetricGroup</a> *&#160;</td>
          <td class="paramname"><em>metrics</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cgroups-mgr_8cc_source.html#l00040">40</a> of file <a class="el" href="cgroups-mgr_8cc_source.html">cgroups-mgr.cc</a>.</p>

<p>References <a class="el" href="metrics_8h_source.html#l00239">impala::MetricGroup::AddCounter()</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a7d5b07b5f1664af832e68d55421c0c68"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classimpala_1_1Status.html">Status</a> impala::CgroupsMgr::AssignThreadToCgroup </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classimpala_1_1Thread.html">Thread</a> &amp;&#160;</td>
          <td class="paramname"><em>thread</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>cgroup</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Assigns a given thread to a cgroup, by writing its thread id to &lt;cgroups_hierarchy_path_&gt;/&lt;cgroup&gt;/tasks. If there is no file at that location, returns an error. Otherwise no attempt is made to check that the target belongs to a cgroup hierarchy due to the cost of reading and parsing cgroup information from the filesystem. </p>

<p>Definition at line <a class="el" href="cgroups-mgr_8cc_source.html#l00142">142</a> of file <a class="el" href="cgroups-mgr_8cc_source.html">cgroups-mgr.cc</a>.</p>

<p>References <a class="el" href="status_8h_source.html#l00087">impala::Status::OK</a>, <a class="el" href="status_8h_source.html#l00242">RETURN_IF_ERROR</a>, <a class="el" href="thread_8h_source.html#l00106">impala::Thread::tid()</a>, and <a class="el" href="logging_8h_source.html#l00059">VLOG_ROW</a>.</p>

<p>Referenced by <a class="el" href="blocking-join-node_8cc_source.html#l00156">impala::BlockingJoinNode::Open()</a>.</p>

</div>
</div>
<a class="anchor" id="a5fe21740d7ea25f2894575b8cec47418"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classimpala_1_1Status.html">Status</a> impala::CgroupsMgr::CreateCgroup </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>cgroup</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>if_not_exists</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Creates a cgroup at &lt;cgroups_hierarchy_path_&gt;/&lt;cgroup&gt;. Returns a non-OK status if the cgroup creation failed, e.g., because of insufficient privileges. If is_not_exists is true then no error is returned if the cgroup already exists. </p>

<p>Definition at line <a class="el" href="cgroups-mgr_8cc_source.html#l00064">64</a> of file <a class="el" href="cgroups-mgr_8cc_source.html">cgroups-mgr.cc</a>.</p>

<p>References <a class="el" href="status_8h_source.html#l00087">impala::Status::OK</a>.</p>

</div>
</div>
<a class="anchor" id="a9c78d5da4945085810668f3f3d0430c6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classimpala_1_1Status.html">Status</a> impala::CgroupsMgr::DropCgroup </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>cgroup</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>if_exists</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Drops the cgroup at &lt;cgroups_hierarchy_path_&gt;/&lt;cgroup&gt;. Returns a non-OK status if the cgroup deletion failed, e.g., because of insufficient privileges. If if_exists is true then no error is returned if the cgroup does not exist. </p>

<p>Definition at line <a class="el" href="cgroups-mgr_8cc_source.html#l00083">83</a> of file <a class="el" href="cgroups-mgr_8cc_source.html">cgroups-mgr.cc</a>.</p>

<p>References <a class="el" href="status_8h_source.html#l00087">impala::Status::OK</a>.</p>

</div>
</div>
<a class="anchor" id="a69160a27aa61240f447e5154ce169128"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classimpala_1_1Status.html">Status</a> impala::CgroupsMgr::GetCgroupPaths </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>cgroup</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string *&#160;</td>
          <td class="paramname"><em>cgroup_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string *&#160;</td>
          <td class="paramname"><em>tasks_path</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Checks that the cgroups_hierarchy_path_ and the given cgroup under it exists. Returns an error if either of them do not exist. Returns the absolute cgroup path and the absolute path to its tasks file. </p>

<p>Definition at line <a class="el" href="cgroups-mgr_8cc_source.html#l00120">120</a> of file <a class="el" href="cgroups-mgr_8cc_source.html">cgroups-mgr.cc</a>.</p>

<p>References <a class="el" href="status_8h_source.html#l00087">impala::Status::OK</a>.</p>

</div>
</div>
<a class="anchor" id="ae7f292a7b25e885d5e13fc6159b37637"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classimpala_1_1Status.html">Status</a> impala::CgroupsMgr::Init </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>cgroups_hierarchy_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>staging_cgroup</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Sets the cgroups mgr's corresponding members and creates the staging cgroup under &lt;cgroups_hierarchy_path&gt;/&lt;staging_cgroup&gt;. Returns a non-OK status if creation of the staging cgroup failed, e.g., because of insufficient privileges. </p>

<p>Definition at line <a class="el" href="cgroups-mgr_8cc_source.html#l00045">45</a> of file <a class="el" href="cgroups-mgr_8cc_source.html">cgroups-mgr.cc</a>.</p>

<p>References <a class="el" href="status_8h_source.html#l00087">impala::Status::OK</a>, and <a class="el" href="status_8h_source.html#l00242">RETURN_IF_ERROR</a>.</p>

</div>
</div>
<a class="anchor" id="aa612e0baa88df7d2bb4aa5af5db0b62f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classimpala_1_1Status.html">Status</a> impala::CgroupsMgr::RegisterFragment </td>
          <td>(</td>
          <td class="paramtype">const TUniqueId &amp;&#160;</td>
          <td class="paramname"><em>fragment_instance_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>cgroup</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a> *&#160;</td>
          <td class="paramname"><em>is_first</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Informs the cgroups mgr that a plan fragment intends to use the given cgroup. If this is the first fragment requesting use of cgroup, then the cgroup will be created and *is_first will be set to true (otherwise to false). In any case the reference count active_cgroups_[cgroup] is incremented. Returns a non-OK status if there was an error creating the cgroup. </p>

<p>Definition at line <a class="el" href="cgroups-mgr_8cc_source.html#l00198">198</a> of file <a class="el" href="cgroups-mgr_8cc_source.html">cgroups-mgr.cc</a>.</p>

<p>References <a class="el" href="status_8h_source.html#l00087">impala::Status::OK</a>, <a class="el" href="debug-util_8cc_source.html#l00097">impala::PrintId()</a>, and <a class="el" href="status_8h_source.html#l00242">RETURN_IF_ERROR</a>.</p>

<p>Referenced by <a class="el" href="plan-fragment-executor_8cc_source.html#l00080">impala::PlanFragmentExecutor::Prepare()</a>.</p>

</div>
</div>
<a class="anchor" id="adbcb30741982fdce210204faf0c8b3f0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classimpala_1_1Status.html">Status</a> impala::CgroupsMgr::RelocateThreads </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>src_cgroup</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>dst_cgroup</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Reads the &lt;cgroups_hierarchy_path_&gt;/&lt;src_cgroup&gt;/tasks file and writing all the contained thread ids to &lt;cgroups_hierarchy_path_&gt;/&lt;dst_cgroup&gt;/tasks. Assumes that the destination cgroup has already been created. Returns a non-OK status if there was an error reading src_cgroup and/or writing dst_cgroup. </p>

<p>Definition at line <a class="el" href="cgroups-mgr_8cc_source.html#l00161">161</a> of file <a class="el" href="cgroups-mgr_8cc_source.html">cgroups-mgr.cc</a>.</p>

<p>References <a class="el" href="status_8h_source.html#l00087">impala::Status::OK</a>, <a class="el" href="status_8h_source.html#l00242">RETURN_IF_ERROR</a>, and <a class="el" href="logging_8h_source.html#l00059">VLOG_ROW</a>.</p>

</div>
</div>
<a class="anchor" id="a0dcf5e114e1bc41a8762f001c0388b49"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classimpala_1_1Status.html">Status</a> impala::CgroupsMgr::SetCpuShares </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>cgroup</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>num_shares</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Sets the number of CPU shares for the given cgroup by writing num_shares into the cgroup's cpu.shares file. Returns a non-OK status if there was an error writing to the file, e.g., because of insufficient privileges. </p>

<p>Definition at line <a class="el" href="cgroups-mgr_8cc_source.html#l00101">101</a> of file <a class="el" href="cgroups-mgr_8cc_source.html">cgroups-mgr.cc</a>.</p>

<p>References <a class="el" href="status_8h_source.html#l00087">impala::Status::OK</a>, and <a class="el" href="status_8h_source.html#l00242">RETURN_IF_ERROR</a>.</p>

<p>Referenced by <a class="el" href="query-resource-mgr_8cc_source.html#l00162">impala::QueryResourceMgr::AcquireVcoreResources()</a>, and <a class="el" href="plan-fragment-executor_8cc_source.html#l00080">impala::PlanFragmentExecutor::Prepare()</a>.</p>

</div>
</div>
<a class="anchor" id="a5701489ab164cd3b884a9224642e20b5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">string impala::CgroupsMgr::UniqueIdToCgroup </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>unique_id</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns the cgroup Impala should create and use for enforcing granted resources identified by the given unique ID (which usually corresponds to a query ID). Returns an empty string if unique_id is empty. </p>

<p>Definition at line <a class="el" href="cgroups-mgr_8cc_source.html#l00054">54</a> of file <a class="el" href="cgroups-mgr_8cc_source.html">cgroups-mgr.cc</a>.</p>

<p>References <a class="el" href="cgroups-mgr_8cc_source.html#l00034">impala::IMPALA_CGROUP_SUFFIX</a>.</p>

<p>Referenced by <a class="el" href="query-resource-mgr_8cc_source.html#l00162">impala::QueryResourceMgr::AcquireVcoreResources()</a>, and <a class="el" href="plan-fragment-executor_8cc_source.html#l00080">impala::PlanFragmentExecutor::Prepare()</a>.</p>

</div>
</div>
<a class="anchor" id="a3d81298b8894a4ab784c995369403203"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classimpala_1_1Status.html">Status</a> impala::CgroupsMgr::UnregisterFragment </td>
          <td>(</td>
          <td class="paramtype">const TUniqueId &amp;&#160;</td>
          <td class="paramname"><em>fragment_instance_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>cgroup</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Informs the cgroups mgr that a plan fragment using the given cgroup is complete. Decrements the corresponding reference count active_cgroups_[cgroup]. If the reference count reaches zero this function relocates all thread ids from the cgroup to the staging_cgroup_ and drops cgroup (a cgroup with active thread ids cannot be dropped, so we relocate the thread ids first). Returns a non-OK status there was an error creating the cgroup. </p>

<p>Definition at line <a class="el" href="cgroups-mgr_8cc_source.html#l00215">215</a> of file <a class="el" href="cgroups-mgr_8cc_source.html">cgroups-mgr.cc</a>.</p>

<p>References <a class="el" href="status_8h_source.html#l00087">impala::Status::OK</a>, <a class="el" href="debug-util_8cc_source.html#l00097">impala::PrintId()</a>, and <a class="el" href="status_8h_source.html#l00242">RETURN_IF_ERROR</a>.</p>

<p>Referenced by <a class="el" href="plan-fragment-executor_8cc_source.html#l00564">impala::PlanFragmentExecutor::Close()</a>.</p>

</div>
</div>
<a class="anchor" id="adfeeb00cc7ae88cd90c7119046c268dd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t impala::CgroupsMgr::VirtualCoresToCpuShares </td>
          <td>(</td>
          <td class="paramtype">int16_t&#160;</td>
          <td class="paramname"><em>v_cpu_cores</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns the cgroup CPU shares corresponding to the given number of virtual cores. Returns -1 if v_cpu_cores is &lt;= 0 (which is invalid). </p>

<p>Definition at line <a class="el" href="cgroups-mgr_8cc_source.html#l00059">59</a> of file <a class="el" href="cgroups-mgr_8cc_source.html">cgroups-mgr.cc</a>.</p>

<p>References <a class="el" href="cgroups-mgr_8cc_source.html#l00038">impala::CPU_DEFAULT_WEIGHT</a>.</p>

<p>Referenced by <a class="el" href="query-resource-mgr_8cc_source.html#l00162">impala::QueryResourceMgr::AcquireVcoreResources()</a>, and <a class="el" href="plan-fragment-executor_8cc_source.html#l00080">impala::PlanFragmentExecutor::Prepare()</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="af83c5dbc1e3d81d441cbca9579c866b9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::unordered_map&lt;std::string, int32_t&gt; impala::CgroupsMgr::active_cgroups_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Process-wide map from cgroup to number of fragments using the cgroup. A cgroup can be safely dropped once the number of fragments in the cgroup, according to this map, reaches zero. </p>

<p>Definition at line <a class="el" href="cgroups-mgr_8h_source.html#l00167">167</a> of file <a class="el" href="cgroups-mgr_8h_source.html">cgroups-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="a4f3d4cb6f64fe78198d082db8d703c93"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::mutex impala::CgroupsMgr::active_cgroups_lock_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Protects active_cgroups_. </p>

<p>Definition at line <a class="el" href="cgroups-mgr_8h_source.html#l00162">162</a> of file <a class="el" href="cgroups-mgr_8h_source.html">cgroups-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="a42cb51d644e4c37a6ea2d1edefc8337c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceimpala.html#ae72a16e1b3afb603ff4b5b4d78f0f0d0">IntCounter</a>* impala::CgroupsMgr::active_cgroups_metric_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Number of currently active Impala-managed cgroups. </p>

<p>Definition at line <a class="el" href="cgroups-mgr_8h_source.html#l00152">152</a> of file <a class="el" href="cgroups-mgr_8h_source.html">cgroups-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad2932bed0a557776d58c2ff5f74f2e3a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string impala::CgroupsMgr::cgroups_hierarchy_path_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Root of the CPU cgroup hierarchy. Created cgroups are placed directly under it. </p>

<p>Definition at line <a class="el" href="cgroups-mgr_8h_source.html#l00155">155</a> of file <a class="el" href="cgroups-mgr_8h_source.html">cgroups-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad6e150fadbb826360d3cfe02f9988d78"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string impala::CgroupsMgr::staging_cgroup_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Cgroup that threads from completed queries are relocated into such that the query's cgroup can be dropped. </p>

<p>Definition at line <a class="el" href="cgroups-mgr_8h_source.html#l00159">159</a> of file <a class="el" href="cgroups-mgr_8h_source.html">cgroups-mgr.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>be/src/util/<a class="el" href="cgroups-mgr_8h_source.html">cgroups-mgr.h</a></li>
<li>be/src/util/<a class="el" href="cgroups-mgr_8cc_source.html">cgroups-mgr.cc</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceimpala.html">impala</a></li><li class="navelem"><a class="el" href="classimpala_1_1CgroupsMgr.html">CgroupsMgr</a></li>
    <li class="footer">Generated on Thu May 7 2015 16:10:50 for Impala by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
