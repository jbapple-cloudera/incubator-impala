<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Impala: be/src/runtime/sorter.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Impala
   </div>
   <div id="projectbrief">Impalaistheopensource,nativeanalyticdatabaseforApacheHadoop.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('sorter_8cc_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">sorter.cc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="sorter_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright 2013 Cloudera Inc.</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// you may not use this file except in compliance with the License.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// You may obtain a copy of the License at</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// See the License for the specific language governing permissions and</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// limitations under the License.</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="sorter_8h.html">runtime/sorter.h</a>&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;gutil/strings/substitute.h&gt;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="buffered-block-mgr_8h.html">runtime/buffered-block-mgr.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="row-batch_8h.html">runtime/row-batch.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="runtime-state_8h.html">runtime/runtime-state.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="sorted-run-merger_8h.html">runtime/sorted-run-merger.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="runtime-profile_8h.html">util/runtime-profile.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="names_8h.html">common/names.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="keyword">using namespace </span>strings;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">namespace </span>impala {</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">// Number of pinned blocks required for a merge.</span></div>
<div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="namespaceimpala.html#a758037b3ef56a0451dd6c75469a2b952">   31</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespaceimpala.html#a758037b3ef56a0451dd6c75469a2b952">BLOCKS_REQUIRED_FOR_MERGE</a> = 3;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">// Error message when pinning fixed or variable length blocks failed.</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">// TODO: Add the node id that iniated the sort</span></div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="namespaceimpala.html#aae5f77d8dade6610fa8be807018e9095">   35</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">string</span> <a class="code" href="namespaceimpala.html#aae5f77d8dade6610fa8be807018e9095">PIN_FAILED_ERROR_MSG</a> = <span class="stringliteral">&quot;Failed to pin block for $0-length data needed &quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="stringliteral">&quot;for sorting. Reducing query concurrency or increasing the memory available to &quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="stringliteral">&quot;Impala may help running this query.&quot;</span>;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">// A run is a sequence of blocks containing tuples that are or will eventually be in</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">// sorted order.</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">// A run may maintain two sequences of blocks - one containing the tuples themselves,</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">// (i.e. fixed-len slots and ptrs to var-len data), and the other for the var-length</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">// column data pointed to by those tuples.</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">// Tuples in a run may be sorted in place (in-memory) and merged using a merger.</span></div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html">   45</a></span>&#160;<span class="keyword">class </span><a class="code" href="classimpala_1_1Sorter_1_1Run.html">Sorter::Run</a> {</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; <span class="keyword">public</span>:</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="comment">// materialize_slots is true for runs constructed from input rows. The input rows are</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="comment">// materialized into single sort tuples using the expressions in</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="comment">// sort_tuple_slot_expr_ctxs_. For intermediate merges, the tuples are already</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="comment">// materialized so materialize_slots is false.</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <a class="code" href="classimpala_1_1Sorter_1_1Run.html">Run</a>(<a class="code" href="classimpala_1_1Sorter.html">Sorter</a>* parent, <a class="code" href="classimpala_1_1TupleDescriptor.html">TupleDescriptor</a>* sort_tuple_desc, <span class="keywordtype">bool</span> materialize_slots);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="comment">// Initialize the run for input rows by allocating the minimum number of required</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="comment">// blocks - one block for fixed-len data added to fixed_len_blocks_, one for the</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="comment">// initially unsorted var-len data added to var_len_blocks_, and one to copy sorted</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="comment">// var-len data into (var_len_copy_block_).</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <a class="code" href="classimpala_1_1Status.html">Status</a> Init();</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="comment">// Add a batch of input rows to the current run. Returns the number</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="comment">// of rows actually added in num_processed. If the run is full (no more blocks can</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="comment">// be allocated), num_processed may be less than the number of rows in the batch.</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="comment">// If materialize_slots_ is true, materializes the input rows using the expressions</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="comment">// in sorter_-&gt;sort_tuple_slot_expr_ctxs_, else just copies the input rows.</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keyword">template</span> &lt;<span class="keywordtype">bool</span> has_var_len_data&gt;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <a class="code" href="classimpala_1_1Status.html">Status</a> AddBatch(<a class="code" href="classimpala_1_1RowBatch.html">RowBatch</a>* batch, <span class="keywordtype">int</span> start_index, <span class="keywordtype">int</span>* num_processed);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="comment">// Unpins all the blocks in a sorted run. Var-length column data is copied into new</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="comment">// blocks in sorted order. Pointers in the original tuples are converted to offsets</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="comment">// from the beginning of the sequence of var-len data blocks.</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <a class="code" href="classimpala_1_1Status.html">Status</a> UnpinAllBlocks();</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="comment">// Deletes all blocks.</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keywordtype">void</span> DeleteAllBlocks();</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="comment">// Interface for merger - get the next batch of rows from this run. The callee (Run)</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <span class="comment">// still owns the returned batch. Calls GetNext(RowBatch*, bool*).</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <a class="code" href="classimpala_1_1Status.html">Status</a> GetNextBatch(<a class="code" href="classimpala_1_1RowBatch.html">RowBatch</a>** sorted_batch);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160; <span class="keyword">private</span>:</div>
<div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#a1ff0e7ff2caebdb3fa36106ebc726ab3">   80</a></span>&#160;  <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classimpala_1_1Sorter.html">Sorter</a>;</div>
<div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#af992e2867942a24049c8e474e5705e4c">   81</a></span>&#160;  <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html">TupleSorter</a>;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="comment">// Fill output_batch with rows from this run. If convert_offset_to_ptr is true, offsets</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="comment">// in var-length slots are converted back to pointers. Only row pointers are copied</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="comment">// into output_batch.</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="comment">// If this run was unpinned, one block (2 if there are var-len slots) is pinned while</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="comment">// rows are filled into output_batch. The block is unpinned before the next block is</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="comment">// pinned. Atmost 1 (2) block(s) will be pinned at any time.</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="comment">// If the run was pinned, the blocks are not unpinned (Sorter holds on to the memory).</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="comment">// In either case, all rows in output_batch will have their fixed and var-len data from</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="comment">// the same block.</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="comment">// TODO: If we leave the last run to be merged in memory, the fixed-len blocks can be</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="comment">// unpinned as they are consumed.</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="keyword">template</span> &lt;<span class="keywordtype">bool</span> convert_offset_to_ptr&gt;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="namespaceimpala.html#af279911558f793413306452d5b16e6d6">GetNext</a>(<a class="code" href="classimpala_1_1RowBatch.html">RowBatch</a>* output_batch, <span class="keywordtype">bool</span>* eos);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="comment">// Check if a run can be extended by allocating additional blocks from the block</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="comment">// manager. Always true when building a sorted run in an intermediate merge, because</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="comment">// the current block(s) can be unpinned before getting the next free block (so a block</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="comment">// is always available)</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="keywordtype">bool</span> CanExtendRun() <span class="keyword">const</span>;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="comment">// Collect the non-null var-len (e.g. STRING) slots from &#39;src&#39; in var_slots and return</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="comment">// the total length of all var_len slots in total_var_len.</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="keywordtype">void</span> CollectNonNullVarSlots(<a class="code" href="classimpala_1_1Tuple.html">Tuple</a>* src, vector&lt;StringValue*&gt;* var_len_values,</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      <span class="keywordtype">int</span>* total_var_len);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="comment">// Check if the current run can be extended by a block. Add the newly allocated block</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="comment">// to block_sequence, or set added to false if the run could not be extended.</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="comment">// If the run is sorted (produced by an intermediate merge), unpin the last block in</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="comment">// block_sequence before allocating and adding a new block - the run can always be</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="comment">// extended in this case. If the run is unsorted, check max_blocks_in_unsorted_run_</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="comment">// to see if a block can be added to the run. Also updates the sort bytes counter.</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <a class="code" href="classimpala_1_1Status.html">Status</a> TryAddBlock(vector&lt;BufferedBlockMgr::Block*&gt;* block_sequence, <span class="keywordtype">bool</span>* added);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="comment">// Prepare to read a sorted run. Pins the first block(s) in the run if the run was</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="comment">// previously unpinned.</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <a class="code" href="classimpala_1_1Status.html">Status</a> PrepareRead();</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="comment">// Copy the StringValue data in var_values to dest in order and update the StringValue</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="comment">// ptrs to point to the copied data.</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="keywordtype">void</span> CopyVarLenData(<span class="keywordtype">char</span>* dest, <span class="keyword">const</span> vector&lt;StringValue*&gt;&amp; var_values);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="comment">// Copy the StringValue in var_values to dest in order. Update the StringValue ptrs to</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="comment">// contain an offset to the copied data. Parameter &#39;offset&#39; is the offset for the first</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="comment">// StringValue.</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keywordtype">void</span> CopyVarLenDataConvertOffset(<span class="keywordtype">char</span>* dest, int64_t <a class="code" href="partitioning-throughput-test_8cc.html#ad172ecfd5c31c5df6282c2b4bc322bf7">offset</a>,</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <span class="keyword">const</span> vector&lt;StringValue*&gt;&amp; var_values);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="comment">// Parent sorter object.</span></div>
<div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#a4a0a03a8e16546212fc555f45fc9f5ba">  131</a></span>&#160;  <span class="keyword">const</span> <a class="code" href="classimpala_1_1Sorter.html">Sorter</a>* <a class="code" href="classimpala_1_1Sorter_1_1Run.html#a4a0a03a8e16546212fc555f45fc9f5ba">sorter_</a>;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="comment">// Materialized sort tuple. Input rows are materialized into 1 tuple (with descriptor</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="comment">// sort_tuple_desc_) before sorting.</span></div>
<div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#a0af077de5092ee027abffd250e1814e6">  135</a></span>&#160;  <span class="keyword">const</span> <a class="code" href="classimpala_1_1TupleDescriptor.html">TupleDescriptor</a>* <a class="code" href="classimpala_1_1Sorter_1_1Run.html#a0af077de5092ee027abffd250e1814e6">sort_tuple_desc_</a>;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="comment">// Sizes of sort tuple and block.</span></div>
<div class="line"><a name="l00138"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#a86cd4137fe23f09969b7a4fd87aeb350">  138</a></span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classimpala_1_1Sorter_1_1Run.html#a86cd4137fe23f09969b7a4fd87aeb350">sort_tuple_size_</a>;</div>
<div class="line"><a name="l00139"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#a236edaac7e96521cb4923da22ad46fce">  139</a></span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classimpala_1_1Sorter_1_1Run.html#a236edaac7e96521cb4923da22ad46fce">block_size_</a>;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div>
<div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#a8885817936a353154cd7640b869a4673">  141</a></span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classimpala_1_1Sorter_1_1Run.html#a8885817936a353154cd7640b869a4673">has_var_len_slots_</a>;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="comment">// True if the sort tuple must be materialized from the input batch in AddBatch().</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="comment">// materialize_slots_ is true for runs being constructed from input batches, and</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="comment">// is false for runs being constructed from intermediate merges.</span></div>
<div class="line"><a name="l00146"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#a193690e24869c767627bc6189a3465ee">  146</a></span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classimpala_1_1Sorter_1_1Run.html#a193690e24869c767627bc6189a3465ee">materialize_slots_</a>;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="comment">// True if the run is sorted. Set to true after an in-memory sort, and initialized to</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="comment">// true for runs resulting from merges.</span></div>
<div class="line"><a name="l00150"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#a2f13416935af8ccd190fdb7b47a8ba01">  150</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classimpala_1_1Sorter_1_1Run.html#a2f13416935af8ccd190fdb7b47a8ba01">is_sorted_</a>;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="comment">// True if all blocks in the run are pinned.</span></div>
<div class="line"><a name="l00153"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#aa693ee58386bc2761923575c602b429c">  153</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classimpala_1_1Sorter_1_1Run.html#aa693ee58386bc2761923575c602b429c">is_pinned_</a>;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="comment">// Sequence of blocks in this run containing the fixed-length portion of the sort tuples</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="comment">// comprising this run. The data pointed to by the var-len slots are in var_len_blocks_.</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="comment">// If is_sorted_ is true, the tuples in fixed_len_blocks_ will be in sorted order.</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="comment">// fixed_len_blocks_[i] is NULL iff it has been deleted.</span></div>
<div class="line"><a name="l00159"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#a99701fe331f35142a50a41bedf770a0f">  159</a></span>&#160;  vector&lt;BufferedBlockMgr::Block*&gt; <a class="code" href="classimpala_1_1Sorter_1_1Run.html#a99701fe331f35142a50a41bedf770a0f">fixed_len_blocks_</a>;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="comment">// Sequence of blocks in this run containing the var-length data corresponding to the</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="comment">// var-length columns from fixed_len_blocks_. These are reconstructed to be in sorted</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="comment">// order in UnpinAllBlocks().</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="comment">// var_len_blocks_[i] is NULL iff it has been deleted.</span></div>
<div class="line"><a name="l00165"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#a309791248f89a09fa0c99ed0381a566a">  165</a></span>&#160;  vector&lt;BufferedBlockMgr::Block*&gt; <a class="code" href="classimpala_1_1Sorter_1_1Run.html#a309791248f89a09fa0c99ed0381a566a">var_len_blocks_</a>;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="comment">// If there are var-len slots, an extra pinned block is used to copy out var-len data</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="comment">// into a new sequence of blocks in sorted order. var_len_copy_block_ stores this</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="comment">// extra allocated block.</span></div>
<div class="line"><a name="l00170"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#abd0c14711ca1962d3f5bed688691b8e5">  170</a></span>&#160;  <a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html">BufferedBlockMgr::Block</a>* <a class="code" href="classimpala_1_1Sorter_1_1Run.html#abd0c14711ca1962d3f5bed688691b8e5">var_len_copy_block_</a>;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="comment">// Number of tuples so far in this run.</span></div>
<div class="line"><a name="l00173"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#a416818832109c6726e726494fb823c78">  173</a></span>&#160;  int64_t <a class="code" href="classimpala_1_1Sorter_1_1Run.html#a416818832109c6726e726494fb823c78">num_tuples_</a>;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="comment">// Number of tuples returned via GetNext(), maintained for debug purposes.</span></div>
<div class="line"><a name="l00176"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#aa2ccb86b80fd30f968483de4c353d9f4">  176</a></span>&#160;  int64_t <a class="code" href="classimpala_1_1Sorter_1_1Run.html#aa2ccb86b80fd30f968483de4c353d9f4">num_tuples_returned_</a>;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="comment">// buffered_batch_ is used to return TupleRows to the merger when this run is being</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="comment">// merged. buffered_batch_ is returned in calls to GetNextBatch().</span></div>
<div class="line"><a name="l00180"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#a35a797d936b1cc2a1f3d07059b471f2e">  180</a></span>&#160;  scoped_ptr&lt;RowBatch&gt; <a class="code" href="classimpala_1_1Sorter_1_1Run.html#a35a797d936b1cc2a1f3d07059b471f2e">buffered_batch_</a>;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="comment">// Members used when a run is read in GetNext()</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="comment">// The index into the fixed_ and var_len_blocks_ vectors of the current blocks being</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="comment">// processed in GetNext().</span></div>
<div class="line"><a name="l00185"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#ae578146e1ec730d2b5e3da2af24dbce9">  185</a></span>&#160;  <span class="keywordtype">int</span> <a class="code" href="classimpala_1_1Sorter_1_1Run.html#ae578146e1ec730d2b5e3da2af24dbce9">fixed_len_blocks_index_</a>;</div>
<div class="line"><a name="l00186"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#a998435ec408b8350be2adccb24ec840f">  186</a></span>&#160;  <span class="keywordtype">int</span> <a class="code" href="classimpala_1_1Sorter_1_1Run.html#a998435ec408b8350be2adccb24ec840f">var_len_blocks_index_</a>;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="comment">// If true, pin the next fixed and var-len blocks and delete the previous ones</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="comment">// during in the next call to GetNext(). Set during the previous call to GetNext().</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="comment">// Not used if a run is already pinned.</span></div>
<div class="line"><a name="l00191"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#ae23d3b7e1e829fdda77ea666ebc444a7">  191</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classimpala_1_1Sorter_1_1Run.html#ae23d3b7e1e829fdda77ea666ebc444a7">pin_next_fixed_len_block_</a>;</div>
<div class="line"><a name="l00192"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#a8e85aff2ab4019388c75c2c70c1bc8f9">  192</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classimpala_1_1Sorter_1_1Run.html#a8e85aff2ab4019388c75c2c70c1bc8f9">pin_next_var_len_block_</a>;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="comment">// Offset into the current fixed length data block being processed.</span></div>
<div class="line"><a name="l00195"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#a53f55396a077477ec8a4b1f9695983f4">  195</a></span>&#160;  <span class="keywordtype">int</span> <a class="code" href="classimpala_1_1Sorter_1_1Run.html#a53f55396a077477ec8a4b1f9695983f4">fixed_len_block_offset_</a>;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;}; <span class="comment">// class Sorter::Run</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">// Sorts a sequence of tuples from a run in place using a provided tuple comparator.</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">// Quick sort is used for sequences of tuples larger that 16 elements, and insertion sort</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">// is used for smaller sequences. The TupleSorter is initialized with a RuntimeState</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">// instance to check for cancellation during an in-memory sort.</span></div>
<div class="line"><a name="l00202"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter.html">  202</a></span>&#160;<span class="keyword">class </span><a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html">Sorter::TupleSorter</a> {</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160; <span class="keyword">public</span>:</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html">TupleSorter</a>(<span class="keyword">const</span> <a class="code" href="classimpala_1_1TupleRowComparator.html">TupleRowComparator</a>&amp; less_than_comp, int64_t block_size,</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      <span class="keywordtype">int</span> tuple_size, <a class="code" href="classimpala_1_1RuntimeState.html">RuntimeState</a>* state);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  ~<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html">TupleSorter</a>();</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="comment">// Performs a quicksort for tuples in &#39;run&#39; followed by an insertion sort to</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="comment">// finish smaller blocks.</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="comment">// Returns early if stste_-&gt;is_cancelled() is true. No status</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="comment">// is returned - the caller must check for cancellation.</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="keywordtype">void</span> Sort(<a class="code" href="classimpala_1_1Sorter_1_1Run.html">Run</a>* run);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160; <span class="keyword">private</span>:</div>
<div class="line"><a name="l00216"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter.html#ad67a9222931ab51dccae9816a7fec1d9">  216</a></span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> INSERTION_THRESHOLD = 16;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="comment">// Helper class used to iterate over tuples in a run during quick sort and insertion</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="comment">// sort.</span></div>
<div class="line"><a name="l00220"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html">  220</a></span>&#160;  <span class="keyword">class </span><a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html">TupleIterator</a> {</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;   <span class="keyword">public</span>:</div>
<div class="line"><a name="l00222"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a3901126aef15419a6bfeaad6e05d1921">  222</a></span>&#160;    <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a3901126aef15419a6bfeaad6e05d1921">TupleIterator</a>(<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html">TupleSorter</a>* parent, int64_t index)</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      : parent_(parent),</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        index_(index),</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        current_tuple_(NULL) {</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      DCHECK_GE(index, 0);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      DCHECK_LE(index, parent_-&gt;run_-&gt;num_tuples_);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      <span class="comment">// If the run is empty, only index_ and current_tuple_ are initialized.</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      <span class="keywordflow">if</span> (parent_-&gt;run_-&gt;num_tuples_ == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      <span class="comment">// If the iterator is initialized to past the end, set up buffer_start_ and</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      <span class="comment">// block_index_ as if it pointing to the last tuple. Add tuple_size_ bytes to</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      <span class="comment">// current_tuple_, so everything is correct when Prev() is invoked.</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      <span class="keywordtype">int</span> past_end_bytes = 0;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="compiler-util_8h.html#a9acc330d508b9a3b775cfdf7ce405e7d">UNLIKELY</a>(index &gt;= parent_-&gt;run_-&gt;num_tuples_)) {</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        past_end_bytes = parent-&gt;<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html#af14c401a99735706af0b5a72923292fc">tuple_size_</a>;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        index_ = parent_-&gt;run_-&gt;num_tuples_;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        index = index_ - 1;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      }</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      block_index_ = index / parent-&gt;<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html#aac273c50f0390987fa7eeca6a9a34094">block_capacity_</a>;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      buffer_start_ = parent-&gt;<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html#a45dbeb43165481bac59cd6ef9fab8377">run_</a>-&gt;<a class="code" href="classimpala_1_1Sorter_1_1Run.html#a99701fe331f35142a50a41bedf770a0f">fixed_len_blocks_</a>[block_index_]-&gt;buffer();</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      <span class="keywordtype">int</span> block_offset = (index % parent-&gt;<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html#aac273c50f0390987fa7eeca6a9a34094">block_capacity_</a>) * parent-&gt;<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html#af14c401a99735706af0b5a72923292fc">tuple_size_</a>;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      current_tuple_ = buffer_start_ + block_offset + past_end_bytes;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    }</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="comment">// Sets current_tuple_ to point to the next tuple in the run. Increments</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="comment">// block_index and resets buffer if the next tuple is in the next block.</span></div>
<div class="line"><a name="l00247"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a582aa8dffdb75ecf1573c488527fd211">  247</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a582aa8dffdb75ecf1573c488527fd211">Next</a>() {</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      current_tuple_ += parent_-&gt;tuple_size_;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      ++index_;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="compiler-util_8h.html#a9acc330d508b9a3b775cfdf7ce405e7d">UNLIKELY</a>(current_tuple_ &gt; buffer_start_ + parent_-&gt;last_tuple_block_offset_ &amp;&amp;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;          index_ &lt; parent_-&gt;run_-&gt;num_tuples_)) {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;       <span class="comment">// Don&#39;t increment block index, etc. past the end.</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;       ++block_index_;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;       DCHECK_LT(block_index_, parent_-&gt;run_-&gt;fixed_len_blocks_.size());</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;       buffer_start_ = parent_-&gt;run_-&gt;fixed_len_blocks_[block_index_]-&gt;buffer();</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;       current_tuple_ = buffer_start_;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      }</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    }</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="comment">// Sets current_tuple to point to the previous tuple in the run. Decrements</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="comment">// block_index and resets buffer if the new tuple is in the previous block.</span></div>
<div class="line"><a name="l00262"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#aba0ddfa521d88a8a7e1c0b8d21d5962f">  262</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#aba0ddfa521d88a8a7e1c0b8d21d5962f">Prev</a>() {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      current_tuple_ -= parent_-&gt;tuple_size_;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      --index_;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="compiler-util_8h.html#a9acc330d508b9a3b775cfdf7ce405e7d">UNLIKELY</a>(current_tuple_ &lt; buffer_start_ &amp;&amp; index_ &gt;= 0)) {</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;       --block_index_;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;       DCHECK_GE(block_index_, 0);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;       buffer_start_ = parent_-&gt;run_-&gt;fixed_len_blocks_[block_index_]-&gt;buffer();</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;       current_tuple_ = buffer_start_ + parent_-&gt;last_tuple_block_offset_;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      }</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    }</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;   <span class="keyword">private</span>:</div>
<div class="line"><a name="l00274"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#af992e2867942a24049c8e474e5705e4c">  274</a></span>&#160;    <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html">TupleSorter</a>;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="comment">// Pointer to the tuple sorter.</span></div>
<div class="line"><a name="l00277"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#ab5503e7bd9cad32161be13423f5c9c9a">  277</a></span>&#160;    <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html">TupleSorter</a>* <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#ab5503e7bd9cad32161be13423f5c9c9a">parent_</a>;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="comment">// Index of the current tuple in the run.</span></div>
<div class="line"><a name="l00280"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#aa912143e3ae57c3f466d45a3c346b669">  280</a></span>&#160;    int64_t <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#aa912143e3ae57c3f466d45a3c346b669">index_</a>;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="comment">// Pointer to the current tuple.</span></div>
<div class="line"><a name="l00283"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a16a5717b83b6721fc2f6e90ed3eb39cf">  283</a></span>&#160;    uint8_t* <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a16a5717b83b6721fc2f6e90ed3eb39cf">current_tuple_</a>;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="comment">// Start of the buffer containing current tuple.</span></div>
<div class="line"><a name="l00286"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#ac0da3c6a8fcacacaa526edeac074a74c">  286</a></span>&#160;    uint8_t* <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#ac0da3c6a8fcacacaa526edeac074a74c">buffer_start_</a>;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="comment">// Index into run_.fixed_len_blocks_ of the block containing the current tuple.</span></div>
<div class="line"><a name="l00289"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a5bf21651816fc3301d27b20d3f9b6e62">  289</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a5bf21651816fc3301d27b20d3f9b6e62">block_index_</a>;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  };</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="comment">// Size of the tuples in memory.</span></div>
<div class="line"><a name="l00293"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter.html#af14c401a99735706af0b5a72923292fc">  293</a></span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html#af14c401a99735706af0b5a72923292fc">tuple_size_</a>;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="comment">// Number of tuples per block in a run.</span></div>
<div class="line"><a name="l00296"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter.html#aac273c50f0390987fa7eeca6a9a34094">  296</a></span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html#aac273c50f0390987fa7eeca6a9a34094">block_capacity_</a>;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="comment">// Offset in bytes of the last tuple in a block, calculated from block and tuple sizes.</span></div>
<div class="line"><a name="l00299"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter.html#a71346bdd9acd3bf22ce9491284831ccb">  299</a></span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html#a71346bdd9acd3bf22ce9491284831ccb">last_tuple_block_offset_</a>;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="comment">// Tuple comparator that returns true if lhs &lt; rhs.</span></div>
<div class="line"><a name="l00302"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter.html#a4632ef08e6ca2331792939df4245bd20">  302</a></span>&#160;  <span class="keyword">const</span> <a class="code" href="classimpala_1_1TupleRowComparator.html">TupleRowComparator</a> <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html#a4632ef08e6ca2331792939df4245bd20">less_than_comp_</a>;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <span class="comment">// Runtime state instance to check for cancellation. Not owned.</span></div>
<div class="line"><a name="l00305"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter.html#a17ea44609575e99b2a2b8d4c335950c7">  305</a></span>&#160;  <a class="code" href="classimpala_1_1RuntimeState.html">RuntimeState</a>* <span class="keyword">const</span> <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html#a17ea44609575e99b2a2b8d4c335950c7">state_</a>;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="comment">// The run to be sorted.</span></div>
<div class="line"><a name="l00308"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter.html#a45dbeb43165481bac59cd6ef9fab8377">  308</a></span>&#160;  <a class="code" href="classimpala_1_1Sorter_1_1Run.html">Run</a>* <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html#a45dbeb43165481bac59cd6ef9fab8377">run_</a>;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="comment">// Temporarily allocated space to copy and swap tuples (Both are used in Partition()).</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="comment">// temp_tuple_ points to temp_tuple_buffer_. Owned by this TupleSorter instance.</span></div>
<div class="line"><a name="l00312"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter.html#ae6f8f18465c4c78d9a8a1c9fd3df2447">  312</a></span>&#160;  <a class="code" href="classimpala_1_1TupleRow.html">TupleRow</a>* <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html#ae6f8f18465c4c78d9a8a1c9fd3df2447">temp_tuple_row_</a>;</div>
<div class="line"><a name="l00313"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter.html#abb3219c82e1f23c4e413a7aeaadbd6f8">  313</a></span>&#160;  uint8_t* <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html#abb3219c82e1f23c4e413a7aeaadbd6f8">temp_tuple_buffer_</a>;</div>
<div class="line"><a name="l00314"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter.html#ad814592f27d4630df7d841f36352fcce">  314</a></span>&#160;  uint8_t* <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html#ad814592f27d4630df7d841f36352fcce">swap_buffer_</a>;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="comment">// Perform an insertion sort for rows in the range [first, last) in a run.</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="keywordtype">void</span> InsertionSort(<span class="keyword">const</span> <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html">TupleIterator</a>&amp; first, <span class="keyword">const</span> <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html">TupleIterator</a>&amp; last);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="comment">// Partitions the sequence of tuples in the range [first, last) in a run into two groups</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <span class="comment">// around the pivot tuple - i.e. tuples in first group are &lt;= the pivot, and tuples in</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="comment">// the second group are &gt;= pivot. Tuples are swapped in place to create the groups and</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="comment">// the index to the first element in the second group is returned.</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  <span class="comment">// Checks state_-&gt;is_cancelled() and returns early with an invalid result if true.</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html">TupleIterator</a> Partition(<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html">TupleIterator</a> first, <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html">TupleIterator</a> last, <a class="code" href="classimpala_1_1Tuple.html">Tuple</a>* pivot);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="comment">// Performs a quicksort of rows in the range [first, last) followed by insertion sort</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="comment">// for smaller groups of elements.</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="comment">// Checks state_-&gt;is_cancelled() and returns early if true.</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <span class="keywordtype">void</span> SortHelper(<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html">TupleIterator</a> first, <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html">TupleIterator</a> last);</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="comment">// Swaps tuples pointed to by left and right using the swap buffer.</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <span class="keywordtype">void</span> Swap(uint8_t* left, uint8_t* right);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;}; <span class="comment">// class TupleSorter</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">// Sorter::Run methods</span></div>
<div class="line"><a name="l00336"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#a4b0300ba04e4fd43dc5647f48d37bc4e">  336</a></span>&#160;Sorter::Run::Run(<a class="code" href="classimpala_1_1Sorter.html">Sorter</a>* parent, <a class="code" href="classimpala_1_1TupleDescriptor.html">TupleDescriptor</a>* sort_tuple_desc,</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keywordtype">bool</span> materialize_slots)</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  : sorter_(parent),</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    sort_tuple_desc_(sort_tuple_desc),</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    sort_tuple_size_(sort_tuple_desc-&gt;byte_size()),</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    block_size_(parent-&gt;block_mgr_-&gt;max_block_size()),</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    has_var_len_slots_(sort_tuple_desc-&gt;string_slots().size() &gt; 0),</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    materialize_slots_(materialize_slots),</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    is_sorted_(!materialize_slots),</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    is_pinned_(true),</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    var_len_copy_block_(NULL),</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    num_tuples_(0) {</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;}</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div>
<div class="line"><a name="l00350"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#abb6adf28dcfe2c3a52bdb24281a247e1">  350</a></span>&#160;<a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1Sorter_1_1Run.html#abb6adf28dcfe2c3a52bdb24281a247e1">Sorter::Run::Init</a>() {</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html">BufferedBlockMgr::Block</a>* block = NULL;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      sorter_-&gt;block_mgr_-&gt;GetNewBlock(sorter_-&gt;block_mgr_client_, NULL, &amp;block));</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  DCHECK_NOTNULL(block);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  fixed_len_blocks_.push_back(block);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1Sorter.html#a5c234f39858a4d91d8e8f13bff456d01">has_var_len_slots_</a>) {</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        sorter_-&gt;block_mgr_-&gt;GetNewBlock(sorter_-&gt;block_mgr_client_, NULL, &amp;block));</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    DCHECK_NOTNULL(block);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    var_len_blocks_.push_back(block);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keywordflow">if</span> (!is_sorted_) {</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(sorter_-&gt;block_mgr_-&gt;GetNewBlock(</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;          sorter_-&gt;block_mgr_client_, NULL, &amp;var_len_copy_block_));</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      DCHECK_NOTNULL(var_len_copy_block_);</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    }</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  }</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="keywordflow">if</span> (!is_sorted_) sorter_-&gt;initial_runs_counter_-&gt;Add(1);</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;}</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="keyword">template</span> &lt;<span class="keywordtype">bool</span> has_var_len_data&gt;</div>
<div class="line"><a name="l00372"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#a9a588e06196dbe4a8866bf37b1a518e8">  372</a></span>&#160;<a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1Sorter_1_1Run.html#a9a588e06196dbe4a8866bf37b1a518e8">Sorter::Run::AddBatch</a>(<a class="code" href="classimpala_1_1RowBatch.html">RowBatch</a>* batch, <span class="keywordtype">int</span> start_index, <span class="keywordtype">int</span>* num_processed) {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  DCHECK(!fixed_len_blocks_.empty());</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  *num_processed = 0;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  <a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html">BufferedBlockMgr::Block</a>* cur_fixed_len_block = fixed_len_blocks_.back();</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  DCHECK_EQ(materialize_slots_, !is_sorted_);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <span class="keywordflow">if</span> (!materialize_slots_) {</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="comment">// If materialize slots is false the run is being constructed for an</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="comment">// intermediate merge and the sort tuples have already been materialized.</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="comment">// The input row should have the same schema as the sort tuples.</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    DCHECK_EQ(batch-&gt;<a class="code" href="classimpala_1_1RowBatch.html#a1879b7b9b72142d7a56d4846ad307bd9">row_desc</a>().<a class="code" href="classimpala_1_1RowDescriptor.html#a3d57439c68d08fe374c33370529a855c">tuple_descriptors</a>().size(), 1);</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    DCHECK_EQ(batch-&gt;<a class="code" href="classimpala_1_1RowBatch.html#a1879b7b9b72142d7a56d4846ad307bd9">row_desc</a>().<a class="code" href="classimpala_1_1RowDescriptor.html#a3d57439c68d08fe374c33370529a855c">tuple_descriptors</a>()[0], sort_tuple_desc_);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  }</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="comment">// Input rows are copied/materialized into tuples allocated in fixed_len_blocks_.</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="comment">// The variable length column data are copied into blocks stored in var_len_blocks_.</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="comment">// Input row processing is split into two loops.</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="comment">// The inner loop processes as many input rows as will fit in cur_fixed_len_block.</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="comment">// The outer loop allocates a new block for fixed-len data if the input batch is</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="comment">// not exhausted.</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="comment">// cur_input_index is the index into the input &#39;batch&#39; of the current input row being</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <span class="comment">// processed.</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="keywordtype">int</span> cur_input_index = start_index;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  vector&lt;StringValue*&gt; var_values;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  var_values.reserve(sort_tuple_desc_-&gt;string_slots().size());</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <span class="keywordflow">while</span> (cur_input_index &lt; batch-&gt;num_rows()) {</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="comment">// tuples_remaining is the number of tuples to copy/materialize into</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="comment">// cur_fixed_len_block.</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordtype">int</span> tuples_remaining = cur_fixed_len_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a05732338103987ffd309abee740d56a8">BytesRemaining</a>() / sort_tuple_size_;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    tuples_remaining = min(batch-&gt;<a class="code" href="classimpala_1_1RowBatch.html#ac695df3b85ee416b3d99844813ae813d">num_rows</a>() - cur_input_index, tuples_remaining);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; tuples_remaining; ++i) {</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      <span class="keywordtype">int</span> total_var_len = 0;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      <a class="code" href="classimpala_1_1TupleRow.html">TupleRow</a>* input_row = batch-&gt;<a class="code" href="classimpala_1_1RowBatch.html#a9320ed986b0717ef26d73d871f3b3a42">GetRow</a>(cur_input_index);</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      <a class="code" href="classimpala_1_1Tuple.html">Tuple</a>* new_tuple = cur_fixed_len_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#ae9e943bc0fae320e955500d0cd74a293">Allocate</a>&lt;<a class="code" href="classimpala_1_1Tuple.html">Tuple</a>&gt;(sort_tuple_size_);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      <span class="keywordflow">if</span> (materialize_slots_) {</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        new_tuple-&gt;<a class="code" href="classimpala_1_1Tuple.html#a9986fe7443a1614ed80c2693a723ee25">MaterializeExprs</a>&lt;has_var_len_data&gt;(input_row, *sort_tuple_desc_,</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            sorter_-&gt;sort_tuple_slot_expr_ctxs_, NULL, &amp;var_values, &amp;total_var_len);</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="keywordflow">if</span> (total_var_len &gt; sorter_-&gt;block_mgr_-&gt;max_block_size()) {</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html">Status</a>(<a class="code" href="classimpala_1_1ErrorMsg.html">ErrorMsg</a>(TErrorCode::INTERNAL_ERROR, Substitute(</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;              <span class="stringliteral">&quot;Variable length data in a single tuple larger than block size $0 &gt; $1&quot;</span>,</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;              total_var_len, sorter_-&gt;block_mgr_-&gt;max_block_size())));</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        }</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        memcpy(new_tuple, input_row-&gt;<a class="code" href="classimpala_1_1TupleRow.html#aed3092e531291470b27fc48afa901600">GetTuple</a>(0), sort_tuple_size_);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="keywordflow">if</span> (has_var_len_data) {</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;          CollectNonNullVarSlots(new_tuple, &amp;var_values, &amp;total_var_len);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        }</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      }</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;      <span class="keywordflow">if</span> (has_var_len_data) {</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        DCHECK_GT(var_len_blocks_.size(), 0);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        <a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html">BufferedBlockMgr::Block</a>* cur_var_len_block = var_len_blocks_.back();</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        <span class="keywordflow">if</span> (cur_var_len_block-&gt;BytesRemaining() &lt; total_var_len) {</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;          <span class="keywordtype">bool</span> added;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;          <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(TryAddBlock(&amp;var_len_blocks_, &amp;added));</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;          <span class="keywordflow">if</span> (added) {</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            cur_var_len_block = var_len_blocks_.back();</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;            <span class="comment">// There was not enough space in the last var-len block for this tuple, and</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;            <span class="comment">// the run could not be extended. Return the fixed-len allocation and exit.</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            cur_fixed_len_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a471d38f75ad1ef978ea60f31e391d47e">ReturnAllocation</a>(sort_tuple_size_);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;          }</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        }</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <span class="keywordtype">char</span>* var_data_ptr = cur_var_len_block-&gt;Allocate&lt;<span class="keywordtype">char</span>&gt;(total_var_len);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        <span class="keywordflow">if</span> (materialize_slots_) {</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;          CopyVarLenData(var_data_ptr, var_values);</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;          int64_t <a class="code" href="partitioning-throughput-test_8cc.html#ad172ecfd5c31c5df6282c2b4bc322bf7">offset</a> = (var_len_blocks_.size() - 1) * block_size_;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;          offset += var_data_ptr - <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(cur_var_len_block-&gt;buffer());</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;          CopyVarLenDataConvertOffset(var_data_ptr, offset, var_values);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        }</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      }</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      ++num_tuples_;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      ++*num_processed;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      ++cur_input_index;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    }</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="comment">// If there are still rows left to process, get a new block for the fixed-length</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="comment">// tuples. If the run is already too long, return.</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keywordflow">if</span> (cur_input_index &lt; batch-&gt;num_rows()) {</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;      <span class="keywordtype">bool</span> added;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(TryAddBlock(&amp;fixed_len_blocks_, &amp;added));</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      <span class="keywordflow">if</span> (added) {</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        cur_fixed_len_block = fixed_len_blocks_.back();</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      }</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    }</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  }</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;}</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div>
<div class="line"><a name="l00468"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#a10e19f5568d47e4280221d8f994f426b">  468</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classimpala_1_1Sorter_1_1Run.html#a10e19f5568d47e4280221d8f994f426b">Sorter::Run::DeleteAllBlocks</a>() {</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  BOOST_FOREACH(<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html">BufferedBlockMgr::Block</a>* block, fixed_len_blocks_) {</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordflow">if</span> (block != NULL) block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a98ac414f60e71a25c45ec2526c5bcf87">Delete</a>();</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  }</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  BOOST_FOREACH(<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html">BufferedBlockMgr::Block</a>* block, var_len_blocks_) {</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="keywordflow">if</span> (block != NULL) block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a98ac414f60e71a25c45ec2526c5bcf87">Delete</a>();</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  }</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="keywordflow">if</span> (var_len_copy_block_ != NULL) var_len_copy_block_-&gt;Delete();</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;}</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div>
<div class="line"><a name="l00478"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#a5cb279750ba595089768f7c864687e69">  478</a></span>&#160;<a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1Sorter_1_1Run.html#a5cb279750ba595089768f7c864687e69">Sorter::Run::UnpinAllBlocks</a>() {</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  vector&lt;BufferedBlockMgr::Block*&gt; sorted_var_len_blocks;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  sorted_var_len_blocks.reserve(var_len_blocks_.size());</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  vector&lt;StringValue*&gt; var_values;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  int64_t var_data_offset = 0;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <span class="keywordtype">int</span> total_var_len;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  var_values.reserve(sort_tuple_desc_-&gt;string_slots().size());</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html">BufferedBlockMgr::Block</a>* cur_sorted_var_len_block = NULL;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1Sorter.html#a5c234f39858a4d91d8e8f13bff456d01">has_var_len_slots_</a> &amp;&amp; var_len_blocks_.size() &gt; 0) {</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    DCHECK_NOTNULL(var_len_copy_block_);</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    sorted_var_len_blocks.push_back(var_len_copy_block_);</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    cur_sorted_var_len_block = sorted_var_len_blocks.back();</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    DCHECK(var_len_copy_block_ == NULL);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  }</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; fixed_len_blocks_.size(); ++i) {</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html">BufferedBlockMgr::Block</a>* cur_fixed_block = fixed_len_blocks_[i];</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1Sorter.html#a5c234f39858a4d91d8e8f13bff456d01">has_var_len_slots_</a>) {</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> block_offset = 0; block_offset &lt; cur_fixed_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a9e27fd2bf12a0f46eaea29de635b231a">valid_data_len</a>();</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;          block_offset += sort_tuple_size_) {</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        <a class="code" href="classimpala_1_1Tuple.html">Tuple</a>* cur_tuple =</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classimpala_1_1Tuple.html">Tuple</a>*<span class="keyword">&gt;</span>(cur_fixed_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a3beba257e3649515dd06d31a42667d5e">buffer</a>() + block_offset);</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        CollectNonNullVarSlots(cur_tuple, &amp;var_values, &amp;total_var_len);</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <span class="keywordflow">if</span> (cur_sorted_var_len_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a05732338103987ffd309abee740d56a8">BytesRemaining</a>() &lt; total_var_len) {</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;          <span class="keywordtype">bool</span> added;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;          <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(TryAddBlock(&amp;sorted_var_len_blocks, &amp;added));</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;          DCHECK(added);</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;          cur_sorted_var_len_block = sorted_var_len_blocks.back();</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        }</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="keywordtype">char</span>* var_data_ptr = cur_sorted_var_len_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#ae9e943bc0fae320e955500d0cd74a293">Allocate</a>&lt;<span class="keywordtype">char</span>&gt;(total_var_len);</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        var_data_offset = block_size_ * (sorted_var_len_blocks.size() - 1) +</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;            (var_data_ptr - reinterpret_cast&lt;char*&gt;(cur_sorted_var_len_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a3beba257e3649515dd06d31a42667d5e">buffer</a>()));</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        CopyVarLenDataConvertOffset(var_data_ptr, var_data_offset, var_values);</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      }</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    }</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(cur_fixed_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a03ad00fa7c792f4fc85ba5e573a30369">Unpin</a>());</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1Sorter.html#a5c234f39858a4d91d8e8f13bff456d01">has_var_len_slots_</a> &amp;&amp; var_len_blocks_.size() &gt; 0) {</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    DCHECK_GT(sorted_var_len_blocks.back()-&gt;valid_data_len(), 0);</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(sorted_var_len_blocks.back()-&gt;Unpin());</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  }</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  <span class="comment">// Clear var_len_blocks_ and replace with it with the contents of sorted_var_len_blocks</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  BOOST_FOREACH(<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html">BufferedBlockMgr::Block</a>* var_block, var_len_blocks_) {</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(var_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a98ac414f60e71a25c45ec2526c5bcf87">Delete</a>());</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  }</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  var_len_blocks_.clear();</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  sorted_var_len_blocks.swap(var_len_blocks_);</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="comment">// Set var_len_copy_block_ to NULL since it&#39;s now in var_len_blocks_ and is no longer</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <span class="comment">// needed.</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  var_len_copy_block_ = NULL;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  is_pinned_ = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;}</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div>
<div class="line"><a name="l00535"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#a9817c6c945f1241e6181f943923dd528">  535</a></span>&#160;<a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1Sorter_1_1Run.html#a9817c6c945f1241e6181f943923dd528">Sorter::Run::PrepareRead</a>() {</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  fixed_len_blocks_index_ = 0;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  fixed_len_block_offset_ = 0;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  var_len_blocks_index_ = 0;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  pin_next_fixed_len_block_ = pin_next_var_len_block_ = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  num_tuples_returned_ = 0;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  buffered_batch_.reset(<span class="keyword">new</span> <a class="code" href="classimpala_1_1RowBatch.html">RowBatch</a>(*sorter_-&gt;output_row_desc_,</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      sorter_-&gt;state_-&gt;batch_size(), sorter_-&gt;mem_tracker_));</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <span class="comment">// If the run is pinned, merge is not invoked, so buffered_batch_ is not needed</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <span class="comment">// and the individual blocks do not need to be pinned.</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="keywordflow">if</span> (is_pinned_) <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="comment">// Attempt to pin the first fixed and var-length blocks. In either case, pinning may</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <span class="comment">// fail if the number of reserved blocks is oversubscribed, see IMPALA-1590.</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  <span class="keywordflow">if</span> (fixed_len_blocks_.size() &gt; 0) {</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordtype">bool</span> pinned = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(fixed_len_blocks_[0]-&gt;Pin(&amp;pinned));</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keywordflow">if</span> (!pinned) {</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      <a class="code" href="classimpala_1_1Status.html">Status</a> status = <a class="code" href="classimpala_1_1Status.html#ab9e27b58a24e93ade3d526311872afc9">Status::MEM_LIMIT_EXCEEDED</a>;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      status.<a class="code" href="classimpala_1_1Status.html#a0c66107b58aeb0dacad65bd2a432f79a">AddDetail</a>(Substitute(<a class="code" href="namespaceimpala.html#aae5f77d8dade6610fa8be807018e9095">PIN_FAILED_ERROR_MSG</a>, <span class="stringliteral">&quot;fixed&quot;</span>));</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      <span class="keywordflow">return</span> status;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    }</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  }</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1Sorter.html#a5c234f39858a4d91d8e8f13bff456d01">has_var_len_slots_</a> &amp;&amp; var_len_blocks_.size() &gt; 0) {</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="keywordtype">bool</span> pinned = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(var_len_blocks_[0]-&gt;Pin(&amp;pinned));</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="keywordflow">if</span> (!pinned) {</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;      <a class="code" href="classimpala_1_1Status.html">Status</a> status = <a class="code" href="classimpala_1_1Status.html#ab9e27b58a24e93ade3d526311872afc9">Status::MEM_LIMIT_EXCEEDED</a>;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;      status.<a class="code" href="classimpala_1_1Status.html#a0c66107b58aeb0dacad65bd2a432f79a">AddDetail</a>(Substitute(<a class="code" href="namespaceimpala.html#aae5f77d8dade6610fa8be807018e9095">PIN_FAILED_ERROR_MSG</a>, <span class="stringliteral">&quot;variable&quot;</span>));</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      <span class="keywordflow">return</span> status;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    }</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  }</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;}</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div>
<div class="line"><a name="l00573"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#a8225512f3684dfa841551b76108ab60c">  573</a></span>&#160;<a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1Sorter_1_1Run.html#a8225512f3684dfa841551b76108ab60c">Sorter::Run::GetNextBatch</a>(<a class="code" href="classimpala_1_1RowBatch.html">RowBatch</a>** output_batch) {</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  <span class="keywordflow">if</span> (buffered_batch_.get() != NULL) {</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    buffered_batch_-&gt;Reset();</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="comment">// Fill more rows into buffered_batch_.</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordtype">bool</span> eos;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1Sorter.html#a5c234f39858a4d91d8e8f13bff456d01">has_var_len_slots_</a> &amp;&amp; !is_pinned_) {</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(GetNext&lt;true&gt;(buffered_batch_.get(), &amp;eos));</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      <span class="keywordflow">if</span> (buffered_batch_-&gt;num_rows() == 0 &amp;&amp; !eos) {</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        <span class="comment">// No rows were filled because GetNext() had to read the next var-len block</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <span class="comment">// Call GetNext() again.</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(GetNext&lt;true&gt;(buffered_batch_.get(), &amp;eos));</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      }</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(GetNext&lt;false&gt;(buffered_batch_.get(), &amp;eos));</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    }</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    DCHECK(eos || buffered_batch_-&gt;num_rows() &gt; 0);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordflow">if</span> (eos) {</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      <span class="comment">// No rows are filled in GetNext() on eos, so this is safe.</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      DCHECK_EQ(buffered_batch_-&gt;num_rows(), 0);</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      buffered_batch_.reset();</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      <span class="comment">// The merge is complete. Delete the last blocks in the run.</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(fixed_len_blocks_.back()-&gt;Delete());</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;      fixed_len_blocks_[fixed_len_blocks_.size() - 1] = NULL;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1Sorter.html#a5c234f39858a4d91d8e8f13bff456d01">has_var_len_slots_</a>) {</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(var_len_blocks_.back()-&gt;Delete());</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        var_len_blocks_[var_len_blocks_.size() - 1] = NULL;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      }</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    }</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  }</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  <span class="comment">// *output_batch == NULL indicates eos.</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  *output_batch = buffered_batch_.get();</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;}</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="keyword">template</span> &lt;<span class="keywordtype">bool</span> convert_offset_to_ptr&gt;</div>
<div class="line"><a name="l00609"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#a8e00b3999ef01244981eea851b1bbc50">  609</a></span>&#160;<a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1Sorter_1_1Run.html#a8e00b3999ef01244981eea851b1bbc50">Sorter::Run::GetNext</a>(<a class="code" href="classimpala_1_1RowBatch.html">RowBatch</a>* output_batch, <span class="keywordtype">bool</span>* eos) {</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  <span class="keywordflow">if</span> (fixed_len_blocks_index_ == fixed_len_blocks_.size()) {</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    *eos = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    DCHECK_EQ(num_tuples_returned_, num_tuples_);</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    *eos = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  }</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html">BufferedBlockMgr::Block</a>* fixed_len_block = fixed_len_blocks_[fixed_len_blocks_index_];</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <span class="keywordflow">if</span> (!is_pinned_) {</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="comment">// Pin the next block and delete the previous if set in the previous call to</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="comment">// GetNext().</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keywordflow">if</span> (pin_next_fixed_len_block_) {</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(fixed_len_blocks_[fixed_len_blocks_index_ - 1]-&gt;Delete());</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      fixed_len_blocks_[fixed_len_blocks_index_ - 1] = NULL;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      <span class="keywordtype">bool</span> pinned;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(fixed_len_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a1d46ffe7b416a949b6fdb6e7828c3301">Pin</a>(&amp;pinned));</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      DCHECK(pinned);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      pin_next_fixed_len_block_ = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    }</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="keywordflow">if</span> (pin_next_var_len_block_) {</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(var_len_blocks_[var_len_blocks_index_ - 1]-&gt;Delete());</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      var_len_blocks_[var_len_blocks_index_ - 1] = NULL;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      <span class="keywordtype">bool</span> pinned;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(var_len_blocks_[var_len_blocks_index_]-&gt;Pin(&amp;pinned));</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      DCHECK(pinned);</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      pin_next_var_len_block_ = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    }</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  }</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  <span class="comment">// GetNext fills rows into the output batch until a block boundary is reached.</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  <span class="keywordflow">while</span> (!output_batch-&gt;<a class="code" href="classimpala_1_1RowBatch.html#a040ced48537a518bd45a89e64f2e8281">AtCapacity</a>() &amp;&amp;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      fixed_len_block_offset_ &lt; fixed_len_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a9e27fd2bf12a0f46eaea29de635b231a">valid_data_len</a>()) {</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <a class="code" href="classimpala_1_1Tuple.html">Tuple</a>* input_tuple = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classimpala_1_1Tuple.html">Tuple</a>*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        fixed_len_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a3beba257e3649515dd06d31a42667d5e">buffer</a>() + fixed_len_block_offset_);</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="keywordflow">if</span> (convert_offset_to_ptr) {</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      <span class="comment">// Convert the offsets in the var-len slots in input_tuple back to pointers.</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      <span class="keyword">const</span> vector&lt;SlotDescriptor*&gt;&amp; var_slots = sort_tuple_desc_-&gt;string_slots();</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; var_slots.size(); ++i) {</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        <a class="code" href="classimpala_1_1SlotDescriptor.html">SlotDescriptor</a>* slot_desc = var_slots[i];</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <span class="keywordflow">if</span> (input_tuple-&gt;<a class="code" href="classimpala_1_1Tuple.html#ace4b7ea4cc159a2d2686e2a61c406413">IsNull</a>(slot_desc-&gt;<a class="code" href="classimpala_1_1SlotDescriptor.html#a1fe88c60d0d1fc04aa9569ee577d8cdd">null_indicator_offset</a>())) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        DCHECK_EQ(slot_desc-&gt;<a class="code" href="classimpala_1_1SlotDescriptor.html#abe913e989db629fdf535ef9c5b0a9e4c">type</a>().<a class="code" href="structimpala_1_1ColumnType.html#a519bee3e0fdcf790708be4b5caebbcf4">type</a>, <a class="code" href="namespaceimpala.html#aa5bce0d3309643287a67504146c2f871a81087da87fdc569ea9ad101e34391359">TYPE_STRING</a>);</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <a class="code" href="structimpala_1_1StringValue.html">StringValue</a>* value = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="structimpala_1_1StringValue.html">StringValue</a>*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;            input_tuple-&gt;<a class="code" href="classimpala_1_1Tuple.html#a5c9d7d0ca31caed74224c97bf55a1a5c">GetSlot</a>(slot_desc-&gt;<a class="code" href="classimpala_1_1SlotDescriptor.html#abd47b8777b6d94017e1e4dc6b8234fad">tuple_offset</a>()));</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        int64_t data_offset = <span class="keyword">reinterpret_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(value-&gt;ptr);</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        <span class="comment">// data_offset is an offset in bytes from the beginning of the first block</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        <span class="comment">// in var_len_blocks_. Convert it into an index into var_len_blocks_ and an</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        <span class="comment">// offset within that block.</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        <span class="keywordtype">int</span> block_index = data_offset / block_size_;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <span class="keywordtype">int</span> block_offset = data_offset % block_size_;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <span class="keywordflow">if</span> (block_index &gt; var_len_blocks_index_) {</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;          <span class="comment">// We&#39;ve reached the block boundary for the current var-len block.</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;          <span class="comment">// This tuple will be returned in the next call to GetNext().</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;          DCHECK_EQ(block_index, var_len_blocks_index_ + 1);</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;          DCHECK_EQ(block_offset, 0);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;          DCHECK_EQ(i, 0);</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;          var_len_blocks_index_ = block_index;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;          pin_next_var_len_block_ = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;          DCHECK_EQ(block_index, var_len_blocks_index_);</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;          <span class="comment">// Calculate the address implied by the offset and assign it.</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;          value-&gt;ptr = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;              var_len_blocks_[var_len_blocks_index_]-&gt;buffer() + block_offset);</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        } <span class="comment">// if (block_index &gt; var_len_blocks_index_)</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      } <span class="comment">// for (int i = 0; i &lt; var_slots.size(); ++i)</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      <span class="comment">// The var-len data is in the next block, so end this call to GetNext().</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      <span class="keywordflow">if</span> (pin_next_var_len_block_) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    } <span class="comment">// if (convert_offset_to_ptr)</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <span class="keywordtype">int</span> output_row_idx = output_batch-&gt;<a class="code" href="classimpala_1_1RowBatch.html#a34b82362d8ad1e89c433e04999a6a0cb">AddRow</a>();</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    output_batch-&gt;<a class="code" href="classimpala_1_1RowBatch.html#a9320ed986b0717ef26d73d871f3b3a42">GetRow</a>(output_row_idx)-&gt;<a class="code" href="classimpala_1_1TupleRow.html#aaf1d69b97c90eec7da3d07bdc40f5665">SetTuple</a>(0, input_tuple);</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    output_batch-&gt;<a class="code" href="classimpala_1_1RowBatch.html#aef978a61ab3f47c2b9e53e304eead853">CommitLastRow</a>();</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    fixed_len_block_offset_ += sort_tuple_size_;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    ++num_tuples_returned_;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  }</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  <span class="keywordflow">if</span> (fixed_len_block_offset_ &gt;= fixed_len_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a9e27fd2bf12a0f46eaea29de635b231a">valid_data_len</a>()) {</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    pin_next_fixed_len_block_ = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    ++fixed_len_blocks_index_;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    fixed_len_block_offset_ = 0;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  }</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;}</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;</div>
<div class="line"><a name="l00702"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#a1c8ae38633d81de1bf5048162735ac9b">  702</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classimpala_1_1Sorter_1_1Run.html#a1c8ae38633d81de1bf5048162735ac9b">Sorter::Run::CollectNonNullVarSlots</a>(<a class="code" href="classimpala_1_1Tuple.html">Tuple</a>* src,</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    vector&lt;StringValue*&gt;* var_len_values, <span class="keywordtype">int</span>* total_var_len) {</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  var_len_values-&gt;clear();</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  *total_var_len = 0;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  BOOST_FOREACH(<span class="keyword">const</span> <a class="code" href="classimpala_1_1SlotDescriptor.html">SlotDescriptor</a>* var_slot, sort_tuple_desc_-&gt;string_slots()) {</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="keywordflow">if</span> (!src-&gt;<a class="code" href="classimpala_1_1Tuple.html#ace4b7ea4cc159a2d2686e2a61c406413">IsNull</a>(var_slot-&gt;<a class="code" href="classimpala_1_1SlotDescriptor.html#a1fe88c60d0d1fc04aa9569ee577d8cdd">null_indicator_offset</a>())) {</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      <a class="code" href="structimpala_1_1StringValue.html">StringValue</a>* string_val =</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;          <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="structimpala_1_1StringValue.html">StringValue</a>*<span class="keyword">&gt;</span>(src-&gt;<a class="code" href="classimpala_1_1Tuple.html#a5c9d7d0ca31caed74224c97bf55a1a5c">GetSlot</a>(var_slot-&gt;<a class="code" href="classimpala_1_1SlotDescriptor.html#abd47b8777b6d94017e1e4dc6b8234fad">tuple_offset</a>()));</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      var_len_values-&gt;push_back(string_val);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      *total_var_len += string_val-&gt;<a class="code" href="structimpala_1_1StringValue.html#ab71e42890598d9b239cac64485db276d">len</a>;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    }</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  }</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;}</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;</div>
<div class="line"><a name="l00716"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#ad9a961f19d6e6c79ab10b1b5bcf4c0db">  716</a></span>&#160;<a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1Sorter_1_1Run.html#ad9a961f19d6e6c79ab10b1b5bcf4c0db">Sorter::Run::TryAddBlock</a>(vector&lt;BufferedBlockMgr::Block*&gt;* block_sequence,</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="keywordtype">bool</span>* added) {</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  DCHECK(!block_sequence-&gt;empty());</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  <a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html">BufferedBlockMgr::Block</a>* last_block = block_sequence-&gt;back();</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <span class="keywordflow">if</span> (!is_sorted_) {</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    sorter_-&gt;sorted_data_size_-&gt;Add(last_block-&gt;valid_data_len());</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    last_block = NULL;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="comment">// If the run is sorted, we will unpin the last block and extend the run.</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  }</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  <a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html">BufferedBlockMgr::Block</a>* new_block;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(sorter_-&gt;block_mgr_-&gt;GetNewBlock(</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      sorter_-&gt;block_mgr_client_, last_block, &amp;new_block));</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  <span class="keywordflow">if</span> (new_block != NULL) {</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    *added = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    block_sequence-&gt;push_back(new_block);</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    *added = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  }</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;}</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div>
<div class="line"><a name="l00739"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#a899126add02bd500846cc3cd2ddd9310">  739</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classimpala_1_1Sorter_1_1Run.html#a899126add02bd500846cc3cd2ddd9310">Sorter::Run::CopyVarLenData</a>(<span class="keywordtype">char</span>* dest, <span class="keyword">const</span> vector&lt;StringValue*&gt;&amp; var_values) {</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  BOOST_FOREACH(<a class="code" href="structimpala_1_1StringValue.html">StringValue</a>* var_val, var_values) {</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    memcpy(dest, var_val-&gt;<a class="code" href="structimpala_1_1StringValue.html#a17f088f03fd1f7b017df20f58f71fe13">ptr</a>, var_val-&gt;<a class="code" href="structimpala_1_1StringValue.html#ab71e42890598d9b239cac64485db276d">len</a>);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    var_val-&gt;<a class="code" href="structimpala_1_1StringValue.html#a17f088f03fd1f7b017df20f58f71fe13">ptr</a> = dest;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    dest += var_val-&gt;<a class="code" href="structimpala_1_1StringValue.html#ab71e42890598d9b239cac64485db276d">len</a>;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;  }</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;}</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div>
<div class="line"><a name="l00747"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1Run.html#afce0524facb4936d8e65243123b3cd80">  747</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classimpala_1_1Sorter_1_1Run.html#afce0524facb4936d8e65243123b3cd80">Sorter::Run::CopyVarLenDataConvertOffset</a>(<span class="keywordtype">char</span>* dest, int64_t <a class="code" href="partitioning-throughput-test_8cc.html#ad172ecfd5c31c5df6282c2b4bc322bf7">offset</a>,</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="keyword">const</span> vector&lt;StringValue*&gt;&amp; var_values) {</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  BOOST_FOREACH(<a class="code" href="structimpala_1_1StringValue.html">StringValue</a>* var_val, var_values) {</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    memcpy(dest, var_val-&gt;<a class="code" href="structimpala_1_1StringValue.html#a17f088f03fd1f7b017df20f58f71fe13">ptr</a>, var_val-&gt;<a class="code" href="structimpala_1_1StringValue.html#ab71e42890598d9b239cac64485db276d">len</a>);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    var_val-&gt;<a class="code" href="structimpala_1_1StringValue.html#a17f088f03fd1f7b017df20f58f71fe13">ptr</a> = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(<a class="code" href="partitioning-throughput-test_8cc.html#ad172ecfd5c31c5df6282c2b4bc322bf7">offset</a>);</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    dest += var_val-&gt;<a class="code" href="structimpala_1_1StringValue.html#ab71e42890598d9b239cac64485db276d">len</a>;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    offset += var_val-&gt;<a class="code" href="structimpala_1_1StringValue.html#ab71e42890598d9b239cac64485db276d">len</a>;</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  }</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;}</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="comment">// Sorter::TupleSorter methods.</span></div>
<div class="line"><a name="l00758"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter.html#a345eec72e74823a7c947560ac0907820">  758</a></span>&#160;<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html#a345eec72e74823a7c947560ac0907820">Sorter::TupleSorter::TupleSorter</a>(<span class="keyword">const</span> <a class="code" href="classimpala_1_1TupleRowComparator.html">TupleRowComparator</a>&amp; comp, int64_t block_size,</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="keywordtype">int</span> tuple_size, <a class="code" href="classimpala_1_1RuntimeState.html">RuntimeState</a>* state)</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  : tuple_size_(tuple_size),</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    block_capacity_(block_size / tuple_size),</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    last_tuple_block_offset_(tuple_size * ((block_size / tuple_size) - 1)),</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    less_than_comp_(comp),</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <a class="code" href="classimpala_1_1Sorter.html#a7753ec8417ae4ac163c435b00fad9219">state_</a>(state) {</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html#abb3219c82e1f23c4e413a7aeaadbd6f8">temp_tuple_buffer_</a> = <span class="keyword">new</span> uint8_t[tuple_size];</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html#ae6f8f18465c4c78d9a8a1c9fd3df2447">temp_tuple_row_</a> = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classimpala_1_1TupleRow.html">TupleRow</a>*<span class="keyword">&gt;</span>(&amp;<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html#abb3219c82e1f23c4e413a7aeaadbd6f8">temp_tuple_buffer_</a>);</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html#ad814592f27d4630df7d841f36352fcce">swap_buffer_</a> = <span class="keyword">new</span> uint8_t[tuple_size];</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;}</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;</div>
<div class="line"><a name="l00770"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter.html#a10ddae7f1e3a4c3ce015a1a6870d7d95">  770</a></span>&#160;<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html#a10ddae7f1e3a4c3ce015a1a6870d7d95">Sorter::TupleSorter::~TupleSorter</a>() {</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  <span class="keyword">delete</span>[] temp_tuple_buffer_;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  <span class="keyword">delete</span>[] swap_buffer_;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;}</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;</div>
<div class="line"><a name="l00775"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter.html#afa9c46f6bdf77240deb9a2c6eb6dcdb5">  775</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html#afa9c46f6bdf77240deb9a2c6eb6dcdb5">Sorter::TupleSorter::Sort</a>(<a class="code" href="classimpala_1_1Sorter_1_1Run.html">Run</a>* run) {</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  run_ = run;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  SortHelper(<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html">TupleIterator</a>(<span class="keyword">this</span>, 0), <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html">TupleIterator</a>(<span class="keyword">this</span>, run_-&gt;num_tuples_));</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  run-&gt;<a class="code" href="classimpala_1_1Sorter_1_1Run.html#a2f13416935af8ccd190fdb7b47a8ba01">is_sorted_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;}</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="comment">// Sort the sequence of tuples from [first, last).</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="comment">// Begin with a sorted sequence of size 1 [first, first+1).</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="comment">// During each pass of the outermost loop, add the next tuple (at position &#39;i&#39;) to</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="comment">// the sorted sequence by comparing it to each element of the sorted sequence</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="comment">// (reverse order) to find its correct place in the sorted sequence, copying tuples</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="comment">// along the way.</span></div>
<div class="line"><a name="l00787"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter.html#a153bbb796e7c3c151adde89e950ab326">  787</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html#a153bbb796e7c3c151adde89e950ab326">Sorter::TupleSorter::InsertionSort</a>(<span class="keyword">const</span> <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html">TupleIterator</a>&amp; first,</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keyword">const</span> <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html">TupleIterator</a>&amp; last) {</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;  <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html">TupleIterator</a> insert_iter = first;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;  insert_iter.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a582aa8dffdb75ecf1573c488527fd211">Next</a>();</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <span class="keywordflow">for</span> (; insert_iter.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#aa912143e3ae57c3f466d45a3c346b669">index_</a> &lt; last.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#aa912143e3ae57c3f466d45a3c346b669">index_</a>; insert_iter.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a582aa8dffdb75ecf1573c488527fd211">Next</a>()) {</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="comment">// insert_iter points to the tuple after the currently sorted sequence that must</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="comment">// be inserted into the sorted sequence. Copy to temp_tuple_row_ since it may be</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="comment">// overwritten by the one at position &#39;insert_iter - 1&#39;</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    memcpy(temp_tuple_buffer_, insert_iter.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a16a5717b83b6721fc2f6e90ed3eb39cf">current_tuple_</a>, tuple_size_);</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="comment">// &#39;iter&#39; points to the tuple that temp_tuple_row_ will be compared to.</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <span class="comment">// &#39;copy_to&#39; is the where iter should be copied to if it is &gt;= temp_tuple_row_.</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="comment">// copy_to always to the next row after &#39;iter&#39;</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html">TupleIterator</a> iter = insert_iter;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    iter.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#aba0ddfa521d88a8a7e1c0b8d21d5962f">Prev</a>();</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    uint8_t* copy_to = insert_iter.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a16a5717b83b6721fc2f6e90ed3eb39cf">current_tuple_</a>;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="keywordflow">while</span> (less_than_comp_(temp_tuple_row_,</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        reinterpret_cast&lt;TupleRow*&gt;(&amp;iter.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a16a5717b83b6721fc2f6e90ed3eb39cf">current_tuple_</a>))) {</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;      memcpy(copy_to, iter.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a16a5717b83b6721fc2f6e90ed3eb39cf">current_tuple_</a>, tuple_size_);</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;      copy_to = iter.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a16a5717b83b6721fc2f6e90ed3eb39cf">current_tuple_</a>;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;      <span class="comment">// Break if &#39;iter&#39; has reached the first row, meaning that temp_tuple_row_</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;      <span class="comment">// will be inserted in position &#39;first&#39;</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;      <span class="keywordflow">if</span> (iter.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#aa912143e3ae57c3f466d45a3c346b669">index_</a> &lt;= first.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#aa912143e3ae57c3f466d45a3c346b669">index_</a>) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      iter.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#aba0ddfa521d88a8a7e1c0b8d21d5962f">Prev</a>();</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    }</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    memcpy(copy_to, temp_tuple_buffer_, tuple_size_);</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  }</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;}</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div>
<div class="line"><a name="l00817"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter.html#a198d2b7248b71f59908d4d713f61fb62">  817</a></span>&#160;<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html">Sorter::TupleSorter::TupleIterator</a> <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html#a198d2b7248b71f59908d4d713f61fb62">Sorter::TupleSorter::Partition</a>(<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html">TupleIterator</a> first,</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html">TupleIterator</a> last, <a class="code" href="classimpala_1_1Tuple.html">Tuple</a>* pivot) {</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  <span class="comment">// Copy pivot into temp_tuple since it points to a tuple within [first, last).</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  memcpy(temp_tuple_buffer_, pivot, tuple_size_);</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  last.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#aba0ddfa521d88a8a7e1c0b8d21d5962f">Prev</a>();</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <span class="comment">// Search for the first and last out-of-place elements, and swap them.</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="keywordflow">while</span> (less_than_comp_(reinterpret_cast&lt;TupleRow*&gt;(&amp;first.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a16a5717b83b6721fc2f6e90ed3eb39cf">current_tuple_</a>),</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        temp_tuple_row_)) {</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;      first.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a582aa8dffdb75ecf1573c488527fd211">Next</a>();</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    }</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <span class="keywordflow">while</span> (less_than_comp_(temp_tuple_row_,</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        reinterpret_cast&lt;TupleRow*&gt;(&amp;last.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a16a5717b83b6721fc2f6e90ed3eb39cf">current_tuple_</a>))) {</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;      last.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#aba0ddfa521d88a8a7e1c0b8d21d5962f">Prev</a>();</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    }</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="keywordflow">if</span> (first.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#aa912143e3ae57c3f466d45a3c346b669">index_</a> &gt;= last.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#aa912143e3ae57c3f466d45a3c346b669">index_</a>) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="comment">// Swap first and last tuples.</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    Swap(first.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a16a5717b83b6721fc2f6e90ed3eb39cf">current_tuple_</a>, last.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a16a5717b83b6721fc2f6e90ed3eb39cf">current_tuple_</a>);</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    first.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a582aa8dffdb75ecf1573c488527fd211">Next</a>();</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    last.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#aba0ddfa521d88a8a7e1c0b8d21d5962f">Prev</a>();</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;  }</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  <span class="keywordflow">return</span> first;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;}</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;</div>
<div class="line"><a name="l00845"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter.html#ac02ec24138cf38ca7fb5d228c80679f7">  845</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html#ac02ec24138cf38ca7fb5d228c80679f7">Sorter::TupleSorter::SortHelper</a>(<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html">TupleIterator</a> first, <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html">TupleIterator</a> last) {</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="compiler-util_8h.html#a9acc330d508b9a3b775cfdf7ce405e7d">UNLIKELY</a>(<a class="code" href="classimpala_1_1Sorter.html#a7753ec8417ae4ac163c435b00fad9219">state_</a>-&gt;<a class="code" href="classimpala_1_1RuntimeState.html#a439489d4dd63b795572999677a966578">is_cancelled</a>())) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  <span class="comment">// Use insertion sort for smaller sequences.</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  <span class="keywordflow">while</span> (last.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#aa912143e3ae57c3f466d45a3c346b669">index_</a> - first.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#aa912143e3ae57c3f466d45a3c346b669">index_</a> &gt; INSERTION_THRESHOLD) {</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html">TupleIterator</a> iter(<span class="keyword">this</span>, first.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#aa912143e3ae57c3f466d45a3c346b669">index_</a> + (last.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#aa912143e3ae57c3f466d45a3c346b669">index_</a> - first.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#aa912143e3ae57c3f466d45a3c346b669">index_</a>)/2);</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    DCHECK_NOTNULL(iter.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a16a5717b83b6721fc2f6e90ed3eb39cf">current_tuple_</a>);</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <span class="comment">// Partition() splits the tuples in [first, last) into two groups (&lt;= pivot</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <span class="comment">// and &gt;= pivot) in-place. &#39;cut&#39; is the index of the first tuple in the second group.</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html">TupleIterator</a> cut = Partition(first, last,</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        reinterpret_cast&lt;Tuple*&gt;(iter.<a class="code" href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a16a5717b83b6721fc2f6e90ed3eb39cf">current_tuple_</a>));</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    SortHelper(cut, last);</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    last = cut;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="compiler-util_8h.html#a9acc330d508b9a3b775cfdf7ce405e7d">UNLIKELY</a>(<a class="code" href="classimpala_1_1Sorter.html#a7753ec8417ae4ac163c435b00fad9219">state_</a>-&gt;<a class="code" href="classimpala_1_1RuntimeState.html#a439489d4dd63b795572999677a966578">is_cancelled</a>())) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  }</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  InsertionSort(first, last);</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;}</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div>
<div class="line"><a name="l00863"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter_1_1TupleSorter.html#a0d12ffaa992ad140adaf2d264320c677">  863</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html#a0d12ffaa992ad140adaf2d264320c677">Sorter::TupleSorter::Swap</a>(uint8_t* left, uint8_t* right) {</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  memcpy(swap_buffer_, left, tuple_size_);</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  memcpy(left, right, tuple_size_);</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  memcpy(right, swap_buffer_, tuple_size_);</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;}</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="comment">// Sorter methods</span></div>
<div class="line"><a name="l00870"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter.html#aff8768ae068c4aca8f282268a81c4ed5">  870</a></span>&#160;<a class="code" href="classimpala_1_1Sorter.html#aff8768ae068c4aca8f282268a81c4ed5">Sorter::Sorter</a>(<span class="keyword">const</span> <a class="code" href="classimpala_1_1TupleRowComparator.html">TupleRowComparator</a>&amp; compare_less_than,</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="keyword">const</span> vector&lt;ExprContext*&gt;&amp; slot_materialize_expr_ctxs,</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <a class="code" href="classimpala_1_1RowDescriptor.html">RowDescriptor</a>* output_row_desc, <a class="code" href="classimpala_1_1MemTracker.html">MemTracker</a>* mem_tracker,</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <a class="code" href="classimpala_1_1RuntimeProfile.html">RuntimeProfile</a>* profile, <a class="code" href="classimpala_1_1RuntimeState.html">RuntimeState</a>* state)</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  : <a class="code" href="classimpala_1_1Sorter.html#a7753ec8417ae4ac163c435b00fad9219">state_</a>(state),</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <a class="code" href="classimpala_1_1Sorter.html#a0923783fedb01f5c6d21551b68f0ad92">compare_less_than_</a>(compare_less_than),</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <a class="code" href="classimpala_1_1Sorter.html#a0ec40c845d2b854211e31d687edbdbf7">block_mgr_</a>(state-&gt;block_mgr()),</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <a class="code" href="classimpala_1_1Sorter.html#a17d425e1c9f6fa64a2ca1704b10b4852">unsorted_run_</a>(NULL),</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <a class="code" href="classimpala_1_1Sorter.html#a676b4a57c812101dbaff6e71d37e520a">output_row_desc_</a>(output_row_desc),</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <a class="code" href="classimpala_1_1Sorter.html#ab71e620c579d4b511e6775189672c82f">sort_tuple_slot_expr_ctxs_</a>(slot_materialize_expr_ctxs),</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    <a class="code" href="classimpala_1_1Sorter.html#a59eeb3403f9889c1c4bd3bc622410206">mem_tracker_</a>(mem_tracker),</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <a class="code" href="classimpala_1_1Sorter.html#a5e3802c81805a01499604bdfdfe7e373">profile_</a>(profile) {</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;}</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div>
<div class="line"><a name="l00884"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter.html#ad745e2bcc3a9237ceeddb535e75484dd">  884</a></span>&#160;<a class="code" href="classimpala_1_1Sorter.html#ad745e2bcc3a9237ceeddb535e75484dd">Sorter::~Sorter</a>() {</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <span class="comment">// Delete all blocks from the block mgr.</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="keywordflow">for</span> (list&lt;Run*&gt;::iterator it = <a class="code" href="classimpala_1_1Sorter.html#a418d79e93c34f3d4acfefdc4bf12378c">sorted_runs_</a>.begin(); it != <a class="code" href="classimpala_1_1Sorter.html#a418d79e93c34f3d4acfefdc4bf12378c">sorted_runs_</a>.end(); ++it) {</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    (*it)-&gt;DeleteAllBlocks();</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  }</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  <span class="keywordflow">for</span> (list&lt;Run*&gt;::iterator it = <a class="code" href="classimpala_1_1Sorter.html#a0830f0e52c0161407c9baa5cc763c3df">merging_runs_</a>.begin(); it != <a class="code" href="classimpala_1_1Sorter.html#a0830f0e52c0161407c9baa5cc763c3df">merging_runs_</a>.end(); ++it) {</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    (*it)-&gt;DeleteAllBlocks();</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  }</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1Sorter.html#a17d425e1c9f6fa64a2ca1704b10b4852">unsorted_run_</a> != NULL) <a class="code" href="classimpala_1_1Sorter.html#a17d425e1c9f6fa64a2ca1704b10b4852">unsorted_run_</a>-&gt;<a class="code" href="classimpala_1_1Sorter_1_1Run.html#a10e19f5568d47e4280221d8f994f426b">DeleteAllBlocks</a>();</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  <a class="code" href="classimpala_1_1Sorter.html#a0ec40c845d2b854211e31d687edbdbf7">block_mgr_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr.html#a25a5078b6ff96b4bc78dd59ebe447919">ClearReservations</a>(<a class="code" href="classimpala_1_1Sorter.html#af872d2d8a0d3d2777b723841105f6662">block_mgr_client_</a>);</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;}</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;</div>
<div class="line"><a name="l00896"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter.html#a63dd233c91ab829e6fc702ce703f77bc">  896</a></span>&#160;<a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1Sorter.html#a63dd233c91ab829e6fc702ce703f77bc">Sorter::Init</a>() {</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  DCHECK(<a class="code" href="classimpala_1_1Sorter.html#a17d425e1c9f6fa64a2ca1704b10b4852">unsorted_run_</a> == NULL) &lt;&lt; <span class="stringliteral">&quot;Already initialized&quot;</span>;</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  <a class="code" href="classimpala_1_1TupleDescriptor.html">TupleDescriptor</a>* sort_tuple_desc = <a class="code" href="classimpala_1_1Sorter.html#a676b4a57c812101dbaff6e71d37e520a">output_row_desc_</a>-&gt;<a class="code" href="classimpala_1_1RowDescriptor.html#a3d57439c68d08fe374c33370529a855c">tuple_descriptors</a>()[0];</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  <a class="code" href="classimpala_1_1Sorter.html#a5c234f39858a4d91d8e8f13bff456d01">has_var_len_slots_</a> = sort_tuple_desc-&gt;<a class="code" href="classimpala_1_1TupleDescriptor.html#a3f0ffae3775bf65b21c0b74ab825d084">string_slots</a>().size() &gt; 0;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  <a class="code" href="classimpala_1_1Sorter.html#a7ff843ba1155cec7f8a65a320ff39a47">in_mem_tuple_sorter_</a>.reset(<span class="keyword">new</span> <a class="code" href="classimpala_1_1Sorter_1_1TupleSorter.html">TupleSorter</a>(<a class="code" href="classimpala_1_1Sorter.html#a0923783fedb01f5c6d21551b68f0ad92">compare_less_than_</a>,</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      <a class="code" href="classimpala_1_1Sorter.html#a0ec40c845d2b854211e31d687edbdbf7">block_mgr_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr.html#ac6e6d613d4ed039d310d789ead20e231">max_block_size</a>(), sort_tuple_desc-&gt;<a class="code" href="classimpala_1_1TupleDescriptor.html#a153205d9bf39422c853b5bd5f54a9485">byte_size</a>(), <a class="code" href="classimpala_1_1Sorter.html#a7753ec8417ae4ac163c435b00fad9219">state_</a>));</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  <a class="code" href="classimpala_1_1Sorter.html#a17d425e1c9f6fa64a2ca1704b10b4852">unsorted_run_</a> = <a class="code" href="classimpala_1_1Sorter.html#aee7c92c83c5efadd6d67c44d66e818f7">obj_pool_</a>.<a class="code" href="classimpala_1_1ObjectPool.html#ab191078c99825682a0a9915ca1e0c05c">Add</a>(<span class="keyword">new</span> <a class="code" href="classimpala_1_1Sorter_1_1Run.html">Run</a>(<span class="keyword">this</span>, sort_tuple_desc, <span class="keyword">true</span>));</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  <a class="code" href="classimpala_1_1Sorter.html#a04aa99293ce8b5d1b83f0ddb01434444">initial_runs_counter_</a> = <a class="code" href="runtime-profile_8h.html#aac035c52016117af399543521f069c51">ADD_COUNTER</a>(<a class="code" href="classimpala_1_1Sorter.html#a5e3802c81805a01499604bdfdfe7e373">profile_</a>, <span class="stringliteral">&quot;InitialRunsCreated&quot;</span>, TUnit::UNIT);</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  <a class="code" href="classimpala_1_1Sorter.html#ac54b4755ecada0aaa3c051393a760a17">num_merges_counter_</a> = <a class="code" href="runtime-profile_8h.html#aac035c52016117af399543521f069c51">ADD_COUNTER</a>(<a class="code" href="classimpala_1_1Sorter.html#a5e3802c81805a01499604bdfdfe7e373">profile_</a>, <span class="stringliteral">&quot;TotalMergesPerformed&quot;</span>, TUnit::UNIT);</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  <a class="code" href="classimpala_1_1Sorter.html#ac5fff98fd6fe2e7e1f090a87d97026de">in_mem_sort_timer_</a> = <a class="code" href="runtime-profile_8h.html#a8841ca205b2a05d608e82d443bad3a77">ADD_TIMER</a>(<a class="code" href="classimpala_1_1Sorter.html#a5e3802c81805a01499604bdfdfe7e373">profile_</a>, <span class="stringliteral">&quot;InMemorySortTime&quot;</span>);</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  <a class="code" href="classimpala_1_1Sorter.html#a5667044809a96f94849fbb1248891ccd">sorted_data_size_</a> = <a class="code" href="runtime-profile_8h.html#aac035c52016117af399543521f069c51">ADD_COUNTER</a>(<a class="code" href="classimpala_1_1Sorter.html#a5e3802c81805a01499604bdfdfe7e373">profile_</a>, <span class="stringliteral">&quot;SortDataSize&quot;</span>, TUnit::BYTES);</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  <span class="keywordtype">int</span> min_blocks_required = <a class="code" href="namespaceimpala.html#a758037b3ef56a0451dd6c75469a2b952">BLOCKS_REQUIRED_FOR_MERGE</a>;</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  <span class="comment">// Fixed and var-length blocks are separate, so we need BLOCKS_REQUIRED_FOR_MERGE</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  <span class="comment">// blocks for both if there is var-length data.</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1Sorter.html#a676b4a57c812101dbaff6e71d37e520a">output_row_desc_</a>-&gt;<a class="code" href="classimpala_1_1RowDescriptor.html#a3d57439c68d08fe374c33370529a855c">tuple_descriptors</a>()[0]-&gt;string_slots().size() &gt; 0) {</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    min_blocks_required *= 2;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  }</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1Sorter.html#a0ec40c845d2b854211e31d687edbdbf7">block_mgr_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr.html#a52bd5a104f158068d4627f8451dcde76">RegisterClient</a>(min_blocks_required, <a class="code" href="classimpala_1_1Sorter.html#a59eeb3403f9889c1c4bd3bc622410206">mem_tracker_</a>, <a class="code" href="classimpala_1_1Sorter.html#a7753ec8417ae4ac163c435b00fad9219">state_</a>,</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      &amp;<a class="code" href="classimpala_1_1Sorter.html#af872d2d8a0d3d2777b723841105f6662">block_mgr_client_</a>));</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  DCHECK_NOTNULL(<a class="code" href="classimpala_1_1Sorter.html#a17d425e1c9f6fa64a2ca1704b10b4852">unsorted_run_</a>);</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1Sorter.html#a17d425e1c9f6fa64a2ca1704b10b4852">unsorted_run_</a>-&gt;<a class="code" href="classimpala_1_1Sorter_1_1Run.html#abb6adf28dcfe2c3a52bdb24281a247e1">Init</a>());</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;}</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;</div>
<div class="line"><a name="l00923"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter.html#acdc857b66e4ebff74b0a7c0ea008bdb8">  923</a></span>&#160;<a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1Sorter.html#acdc857b66e4ebff74b0a7c0ea008bdb8">Sorter::AddBatch</a>(<a class="code" href="classimpala_1_1RowBatch.html">RowBatch</a>* batch) {</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  DCHECK_NOTNULL(<a class="code" href="classimpala_1_1Sorter.html#a17d425e1c9f6fa64a2ca1704b10b4852">unsorted_run_</a>);</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  DCHECK_NOTNULL(batch);</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  <span class="keywordtype">int</span> num_processed = 0;</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  <span class="keywordtype">int</span> cur_batch_index = 0;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  <span class="keywordflow">while</span> (cur_batch_index &lt; batch-&gt;num_rows()) {</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1Sorter.html#a5c234f39858a4d91d8e8f13bff456d01">has_var_len_slots_</a>) {</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;      <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1Sorter.html#a17d425e1c9f6fa64a2ca1704b10b4852">unsorted_run_</a>-&gt;<a class="code" href="classimpala_1_1Sorter_1_1Run.html#a9a588e06196dbe4a8866bf37b1a518e8">AddBatch</a>&lt;<span class="keyword">true</span>&gt;(</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;          batch, cur_batch_index, &amp;num_processed));</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1Sorter.html#a17d425e1c9f6fa64a2ca1704b10b4852">unsorted_run_</a>-&gt;<a class="code" href="classimpala_1_1Sorter_1_1Run.html#a9a588e06196dbe4a8866bf37b1a518e8">AddBatch</a>&lt;<span class="keyword">false</span>&gt;(</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;          batch, cur_batch_index, &amp;num_processed));</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    }</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    cur_batch_index += num_processed;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="keywordflow">if</span> (cur_batch_index &lt; batch-&gt;num_rows()) {</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;      <span class="comment">// The current run is full. Sort it and begin the next one.</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;      <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1Sorter.html#a9f7337219adb32331de00cd175519e60">SortRun</a>());</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;      <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1Sorter.html#a418d79e93c34f3d4acfefdc4bf12378c">sorted_runs_</a>.back()-&gt;UnpinAllBlocks());</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;      <a class="code" href="classimpala_1_1Sorter.html#a17d425e1c9f6fa64a2ca1704b10b4852">unsorted_run_</a> = <a class="code" href="classimpala_1_1Sorter.html#aee7c92c83c5efadd6d67c44d66e818f7">obj_pool_</a>.<a class="code" href="classimpala_1_1ObjectPool.html#ab191078c99825682a0a9915ca1e0c05c">Add</a>(</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;          <span class="keyword">new</span> <a class="code" href="classimpala_1_1Sorter_1_1Run.html">Run</a>(<span class="keyword">this</span>, <a class="code" href="classimpala_1_1Sorter.html#a676b4a57c812101dbaff6e71d37e520a">output_row_desc_</a>-&gt;<a class="code" href="classimpala_1_1RowDescriptor.html#a3d57439c68d08fe374c33370529a855c">tuple_descriptors</a>()[0], <span class="keyword">true</span>));</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      unsorted_run_-&gt;Init();</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    }</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  }</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;}</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;</div>
<div class="line"><a name="l00949"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter.html#a2f039c834b68505cde79399c7231b3c7">  949</a></span>&#160;<a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1Sorter.html#a2f039c834b68505cde79399c7231b3c7">Sorter::InputDone</a>() {</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  <span class="comment">// Sort the tuples accumulated so far in the current run.</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1Sorter.html#a9f7337219adb32331de00cd175519e60">SortRun</a>());</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1Sorter.html#a418d79e93c34f3d4acfefdc4bf12378c">sorted_runs_</a>.size() == 1) {</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <span class="comment">// The entire input fit in one run. Read sorted rows in GetNext() directly</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="comment">// from the sorted run.</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    <a class="code" href="classimpala_1_1Sorter.html#a418d79e93c34f3d4acfefdc4bf12378c">sorted_runs_</a>.back()-&gt;PrepareRead();</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <span class="comment">// At least one merge is necessary.</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="keywordtype">int</span> blocks_per_run = <a class="code" href="classimpala_1_1Sorter.html#a5c234f39858a4d91d8e8f13bff456d01">has_var_len_slots_</a> ? 2 : 1;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <span class="keywordtype">int</span> min_buffers_for_merge = <a class="code" href="classimpala_1_1Sorter.html#a418d79e93c34f3d4acfefdc4bf12378c">sorted_runs_</a>.size() * blocks_per_run;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <span class="comment">// Check if the final run needs to be unpinned.</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <span class="keywordtype">bool</span> unpinned_final = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1Sorter.html#a0ec40c845d2b854211e31d687edbdbf7">block_mgr_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr.html#a4cb1e195174c2f3fded3cdae639af303">num_free_buffers</a>() &lt; min_buffers_for_merge - blocks_per_run) {</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;      <span class="comment">// Number of available buffers is less than the size of the final run and</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;      <span class="comment">// the buffers needed to read the remainder of the runs in memory.</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;      <span class="comment">// Unpin the final run.</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;      <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1Sorter.html#a418d79e93c34f3d4acfefdc4bf12378c">sorted_runs_</a>.back()-&gt;UnpinAllBlocks());</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;      unpinned_final = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;      <span class="comment">// No need to unpin the current run. There is enough memory to stream the</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;      <span class="comment">// other runs.</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;      <span class="comment">// TODO: revisit. It might be better to unpin some from this run if it means</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      <span class="comment">// we can get double buffering in the other runs.</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    }</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    <span class="comment">// For an intermediate merge, intermediate_merge_batch contains deep-copied rows from</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="comment">// the input runs. If (unmerged_sorted_runs_.size() &gt; max_runs_per_final_merge),</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <span class="comment">// one or more intermediate merges are required.</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="comment">// TODO: Attempt to allocate more memory before doing intermediate merges. This may</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <span class="comment">// be possible if other operators have relinquished memory after the sort has built</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <span class="comment">// its runs.</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <span class="keywordflow">if</span> (min_buffers_for_merge &gt; <a class="code" href="classimpala_1_1Sorter.html#a0ec40c845d2b854211e31d687edbdbf7">block_mgr_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr.html#a3cd26d226927aebcabe057773793bcce">available_allocated_buffers</a>()) {</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      DCHECK(unpinned_final);</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;      <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1Sorter.html#ad4b86ce60d3cd4b790b37c1eb4aab459">MergeIntermediateRuns</a>());</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    }</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <span class="comment">// Create the final merger.</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <a class="code" href="classimpala_1_1Sorter.html#a1030c51f2ab6f4bf9573afd2e3e27d3b">CreateMerger</a>(<a class="code" href="classimpala_1_1Sorter.html#a418d79e93c34f3d4acfefdc4bf12378c">sorted_runs_</a>.size());</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  }</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;}</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;</div>
<div class="line"><a name="l00993"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter.html#a5009c6abc953b2d3c54611687e624b0b">  993</a></span>&#160;<a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1Sorter.html#a5009c6abc953b2d3c54611687e624b0b">Sorter::GetNext</a>(<a class="code" href="classimpala_1_1RowBatch.html">RowBatch</a>* output_batch, <span class="keywordtype">bool</span>* eos) {</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1Sorter.html#a418d79e93c34f3d4acfefdc4bf12378c">sorted_runs_</a>.size() == 1) {</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    DCHECK(<a class="code" href="classimpala_1_1Sorter.html#a418d79e93c34f3d4acfefdc4bf12378c">sorted_runs_</a>.back()-&gt;is_pinned_);</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    <span class="comment">// In this case, only TupleRows are copied into output_batch. Sorted tuples are left</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    <span class="comment">// in the pinned blocks in the single sorted run.</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1Sorter.html#a418d79e93c34f3d4acfefdc4bf12378c">sorted_runs_</a>.back()-&gt;GetNext&lt;<span class="keyword">false</span>&gt;(output_batch, eos));</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <span class="comment">// In this case, rows are deep copied into output_batch.</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1Sorter.html#a0f92256ce7e671e7b119fdc00d751944">merger_</a>-&gt;GetNext(output_batch, eos));</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  }</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;}</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;</div>
<div class="line"><a name="l01006"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter.html#a9f7337219adb32331de00cd175519e60"> 1006</a></span>&#160;<a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1Sorter.html#a9f7337219adb32331de00cd175519e60">Sorter::SortRun</a>() {</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html">BufferedBlockMgr::Block</a>* last_block = <a class="code" href="classimpala_1_1Sorter.html#a17d425e1c9f6fa64a2ca1704b10b4852">unsorted_run_</a>-&gt;<a class="code" href="classimpala_1_1Sorter_1_1Run.html#a99701fe331f35142a50a41bedf770a0f">fixed_len_blocks_</a>.back();</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  <span class="keywordflow">if</span> (last_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a9e27fd2bf12a0f46eaea29de635b231a">valid_data_len</a>() &gt; 0) {</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    <a class="code" href="classimpala_1_1Sorter.html#a5667044809a96f94849fbb1248891ccd">sorted_data_size_</a>-&gt;<a class="code" href="classimpala_1_1RuntimeProfile_1_1Counter.html#accee494361b71d610dea9b639e19a285">Add</a>(last_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a9e27fd2bf12a0f46eaea29de635b231a">valid_data_len</a>());</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(last_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a98ac414f60e71a25c45ec2526c5bcf87">Delete</a>());</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    <a class="code" href="classimpala_1_1Sorter.html#a17d425e1c9f6fa64a2ca1704b10b4852">unsorted_run_</a>-&gt;<a class="code" href="classimpala_1_1Sorter_1_1Run.html#a99701fe331f35142a50a41bedf770a0f">fixed_len_blocks_</a>.pop_back();</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  }</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1Sorter.html#a5c234f39858a4d91d8e8f13bff456d01">has_var_len_slots_</a>) {</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    DCHECK_NOTNULL(<a class="code" href="classimpala_1_1Sorter.html#a17d425e1c9f6fa64a2ca1704b10b4852">unsorted_run_</a>-&gt;<a class="code" href="classimpala_1_1Sorter_1_1Run.html#abd0c14711ca1962d3f5bed688691b8e5">var_len_copy_block_</a>);</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    last_block = <a class="code" href="classimpala_1_1Sorter.html#a17d425e1c9f6fa64a2ca1704b10b4852">unsorted_run_</a>-&gt;<a class="code" href="classimpala_1_1Sorter_1_1Run.html#a309791248f89a09fa0c99ed0381a566a">var_len_blocks_</a>.back();</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <span class="keywordflow">if</span> (last_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a9e27fd2bf12a0f46eaea29de635b231a">valid_data_len</a>() &gt; 0) {</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;      <a class="code" href="classimpala_1_1Sorter.html#a5667044809a96f94849fbb1248891ccd">sorted_data_size_</a>-&gt;<a class="code" href="classimpala_1_1RuntimeProfile_1_1Counter.html#accee494361b71d610dea9b639e19a285">Add</a>(last_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a9e27fd2bf12a0f46eaea29de635b231a">valid_data_len</a>());</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;      <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(last_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a98ac414f60e71a25c45ec2526c5bcf87">Delete</a>());</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      <a class="code" href="classimpala_1_1Sorter.html#a17d425e1c9f6fa64a2ca1704b10b4852">unsorted_run_</a>-&gt;<a class="code" href="classimpala_1_1Sorter_1_1Run.html#a309791248f89a09fa0c99ed0381a566a">var_len_blocks_</a>.pop_back();</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1Sorter.html#a17d425e1c9f6fa64a2ca1704b10b4852">unsorted_run_</a>-&gt;<a class="code" href="classimpala_1_1Sorter_1_1Run.html#a309791248f89a09fa0c99ed0381a566a">var_len_blocks_</a>.size() == 0) {</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1Sorter.html#a17d425e1c9f6fa64a2ca1704b10b4852">unsorted_run_</a>-&gt;<a class="code" href="classimpala_1_1Sorter_1_1Run.html#abd0c14711ca1962d3f5bed688691b8e5">var_len_copy_block_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a98ac414f60e71a25c45ec2526c5bcf87">Delete</a>());</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;        <a class="code" href="classimpala_1_1Sorter.html#a17d425e1c9f6fa64a2ca1704b10b4852">unsorted_run_</a>-&gt;<a class="code" href="classimpala_1_1Sorter_1_1Run.html#abd0c14711ca1962d3f5bed688691b8e5">var_len_copy_block_</a> = NULL;</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;      }</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    }</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  }</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  {</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    <a class="code" href="runtime-profile_8h.html#aaa9a2971c6368e3ddd3f5140a0295eb7">SCOPED_TIMER</a>(<a class="code" href="classimpala_1_1Sorter.html#ac5fff98fd6fe2e7e1f090a87d97026de">in_mem_sort_timer_</a>);</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    <a class="code" href="classimpala_1_1Sorter.html#a7ff843ba1155cec7f8a65a320ff39a47">in_mem_tuple_sorter_</a>-&gt;Sort(<a class="code" href="classimpala_1_1Sorter.html#a17d425e1c9f6fa64a2ca1704b10b4852">unsorted_run_</a>);</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    <a class="code" href="runtime-state_8h.html#a803877a2ce5ce5c0b4f311c9c7137ba1">RETURN_IF_CANCELLED</a>(<a class="code" href="classimpala_1_1Sorter.html#a7753ec8417ae4ac163c435b00fad9219">state_</a>);</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  }</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  <a class="code" href="classimpala_1_1Sorter.html#a418d79e93c34f3d4acfefdc4bf12378c">sorted_runs_</a>.push_back(<a class="code" href="classimpala_1_1Sorter.html#a17d425e1c9f6fa64a2ca1704b10b4852">unsorted_run_</a>);</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  <a class="code" href="classimpala_1_1Sorter.html#a17d425e1c9f6fa64a2ca1704b10b4852">unsorted_run_</a> = NULL;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;}</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;</div>
<div class="line"><a name="l01038"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter.html#a2125f77fa5dcff0861f7568673d49264"> 1038</a></span>&#160;<a class="code" href="classuint64__t.html">uint64_t</a> <a class="code" href="classimpala_1_1Sorter.html#a2125f77fa5dcff0861f7568673d49264">Sorter::EstimateMergeMem</a>(<a class="code" href="classuint64__t.html">uint64_t</a> available_blocks,</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    <a class="code" href="classimpala_1_1RowDescriptor.html">RowDescriptor</a>* <a class="code" href="namespaceimpala.html#aa98447566dd6700a2faaaaf3059f4d95">row_desc</a>, <span class="keywordtype">int</span> merge_batch_size) {</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;  <span class="keywordtype">bool</span> has_var_len_slots = row_desc-&gt;<a class="code" href="classimpala_1_1RowDescriptor.html#a3d57439c68d08fe374c33370529a855c">tuple_descriptors</a>()[0]-&gt;string_slots().size() &gt; 0;</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  <span class="keywordtype">int</span> blocks_per_run = has_var_len_slots ? 2 : 1;</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;  <span class="keywordtype">int</span> max_input_runs_per_merge = (available_blocks / blocks_per_run) - 1;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  <span class="comment">// During a merge, the batches corresponding to the input runs contain only TupleRows.</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  <span class="comment">// (The data itself is in pinned blocks held by the run)</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;  <a class="code" href="classuint64__t.html">uint64_t</a> input_batch_mem =</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      merge_batch_size * <span class="keyword">sizeof</span>(<a class="code" href="classimpala_1_1Tuple.html">Tuple</a>*) * max_input_runs_per_merge;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  <span class="comment">// Since rows are deep copied into the output batch for the merger, use a pessimistic</span></div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  <span class="comment">// estimate of the memory required.</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  <a class="code" href="classuint64__t.html">uint64_t</a> output_batch_mem = <a class="code" href="classimpala_1_1RowBatch.html#aa56ff8061d406e2414d5031e5a464b73">RowBatch::AT_CAPACITY_MEM_USAGE</a>;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;  <span class="keywordflow">return</span> input_batch_mem + output_batch_mem;</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;}</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;</div>
<div class="line"><a name="l01054"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter.html#ad4b86ce60d3cd4b790b37c1eb4aab459"> 1054</a></span>&#160;<a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1Sorter.html#ad4b86ce60d3cd4b790b37c1eb4aab459">Sorter::MergeIntermediateRuns</a>() {</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;  <span class="keywordtype">int</span> blocks_per_run = <a class="code" href="classimpala_1_1Sorter.html#a5c234f39858a4d91d8e8f13bff456d01">has_var_len_slots_</a> ? 2 : 1;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;  <span class="keywordtype">int</span> max_runs_per_final_merge =</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;      <a class="code" href="classimpala_1_1Sorter.html#a0ec40c845d2b854211e31d687edbdbf7">block_mgr_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr.html#a3cd26d226927aebcabe057773793bcce">available_allocated_buffers</a>() / blocks_per_run;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  <span class="comment">// During an intermediate merge, blocks from the output sorted run will have to be</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;  <span class="comment">// pinned.</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;  <span class="keywordtype">int</span> max_runs_per_intermediate_merge = max_runs_per_final_merge - 1;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  DCHECK_GT(max_runs_per_intermediate_merge, 1);</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  <span class="comment">// For an intermediate merge, intermediate_merge_batch contains deep-copied rows from</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  <span class="comment">// the input runs. If (sorted_runs_.size() &gt; max_runs_per_final_merge),</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  <span class="comment">// one or more intermediate merges are required.</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  scoped_ptr&lt;RowBatch&gt; intermediate_merge_batch;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="classimpala_1_1Sorter.html#a418d79e93c34f3d4acfefdc4bf12378c">sorted_runs_</a>.size() &gt; max_runs_per_final_merge) {</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <span class="comment">// An intermediate merge adds one merge to unmerged_sorted_runs_.</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="comment">// Merging &#39;runs - (max_runs_final_ - 1)&#39; number of runs is sifficient to guarantee</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <span class="comment">// that the final merge can be performed.</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    <span class="keywordtype">int</span> num_runs_to_merge = min&lt;int&gt;(max_runs_per_intermediate_merge,</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;        <a class="code" href="classimpala_1_1Sorter.html#a418d79e93c34f3d4acfefdc4bf12378c">sorted_runs_</a>.size() - max_runs_per_intermediate_merge);</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    <a class="code" href="classimpala_1_1Sorter.html#a1030c51f2ab6f4bf9573afd2e3e27d3b">CreateMerger</a>(num_runs_to_merge);</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <a class="code" href="classimpala_1_1RowBatch.html">RowBatch</a> intermediate_merge_batch(*<a class="code" href="classimpala_1_1Sorter.html#a676b4a57c812101dbaff6e71d37e520a">output_row_desc_</a>, <a class="code" href="classimpala_1_1Sorter.html#a7753ec8417ae4ac163c435b00fad9219">state_</a>-&gt;<a class="code" href="classimpala_1_1RuntimeState.html#a627cfaab95fa7f0ffb8cb78a8ca9ef50">batch_size</a>(),</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;        <a class="code" href="classimpala_1_1Sorter.html#a59eeb3403f9889c1c4bd3bc622410206">mem_tracker_</a>);</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <span class="comment">// merged_run is the new sorted run that is produced by the intermediate merge.</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    <a class="code" href="classimpala_1_1Sorter_1_1Run.html">Run</a>* merged_run = <a class="code" href="classimpala_1_1Sorter.html#aee7c92c83c5efadd6d67c44d66e818f7">obj_pool_</a>.<a class="code" href="classimpala_1_1ObjectPool.html#ab191078c99825682a0a9915ca1e0c05c">Add</a>(</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        <span class="keyword">new</span> <a class="code" href="classimpala_1_1Sorter_1_1Run.html">Run</a>(<span class="keyword">this</span>, <a class="code" href="classimpala_1_1Sorter.html#a676b4a57c812101dbaff6e71d37e520a">output_row_desc_</a>-&gt;<a class="code" href="classimpala_1_1RowDescriptor.html#a3d57439c68d08fe374c33370529a855c">tuple_descriptors</a>()[0], <span class="keyword">false</span>));</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(merged_run-&gt;Init());</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <span class="keywordtype">bool</span> eos = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <span class="keywordflow">while</span> (!eos) {</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;      <span class="comment">// Copy rows into the new run until done.</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;      <span class="keywordtype">int</span> num_copied;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;      <a class="code" href="runtime-state_8h.html#a803877a2ce5ce5c0b4f311c9c7137ba1">RETURN_IF_CANCELLED</a>(<a class="code" href="classimpala_1_1Sorter.html#a7753ec8417ae4ac163c435b00fad9219">state_</a>);</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;      <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1Sorter.html#a0f92256ce7e671e7b119fdc00d751944">merger_</a>-&gt;GetNext(&amp;intermediate_merge_batch, &amp;eos));</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;      <a class="code" href="classimpala_1_1Status.html">Status</a> ret_status;</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1Sorter.html#a5c234f39858a4d91d8e8f13bff456d01">has_var_len_slots_</a>) {</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;        ret_status = merged_run-&gt;AddBatch&lt;<span class="keyword">true</span>&gt;(&amp;intermediate_merge_batch,</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;            0, &amp;num_copied);</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        ret_status = merged_run-&gt;AddBatch&lt;<span class="keyword">false</span>&gt;(&amp;intermediate_merge_batch,</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;            0, &amp;num_copied);</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;      }</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;      <span class="keywordflow">if</span> (!ret_status.ok()) <span class="keywordflow">return</span> ret_status;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;      DCHECK_EQ(num_copied, intermediate_merge_batch.num_rows());</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;      intermediate_merge_batch.Reset();</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    }</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    <a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html">BufferedBlockMgr::Block</a>* last_block = merged_run-&gt;fixed_len_blocks_.back();</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    <span class="keywordflow">if</span> (last_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a9e27fd2bf12a0f46eaea29de635b231a">valid_data_len</a>() &gt; 0) {</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;      <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(last_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a03ad00fa7c792f4fc85ba5e573a30369">Unpin</a>());</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(last_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a98ac414f60e71a25c45ec2526c5bcf87">Delete</a>());</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      merged_run-&gt;fixed_len_blocks_.pop_back();</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    }</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1Sorter.html#a5c234f39858a4d91d8e8f13bff456d01">has_var_len_slots_</a>) {</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;      last_block = merged_run-&gt;var_len_blocks_.back();</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      <span class="keywordflow">if</span> (last_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a9e27fd2bf12a0f46eaea29de635b231a">valid_data_len</a>() &gt; 0) {</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(last_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a03ad00fa7c792f4fc85ba5e573a30369">Unpin</a>());</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;        <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(last_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a98ac414f60e71a25c45ec2526c5bcf87">Delete</a>());</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;        merged_run-&gt;var_len_blocks_.pop_back();</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      }</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    }</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    merged_run-&gt;is_pinned_ = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    <a class="code" href="classimpala_1_1Sorter.html#a418d79e93c34f3d4acfefdc4bf12378c">sorted_runs_</a>.push_back(merged_run);</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  }</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;}</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;</div>
<div class="line"><a name="l01123"></a><span class="lineno"><a class="line" href="classimpala_1_1Sorter.html#a1030c51f2ab6f4bf9573afd2e3e27d3b"> 1123</a></span>&#160;<a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1Sorter.html#a1030c51f2ab6f4bf9573afd2e3e27d3b">Sorter::CreateMerger</a>(<span class="keywordtype">int</span> num_runs) {</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;  DCHECK_GT(num_runs, 1);</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;  <span class="comment">// Clean up the runs from the previous merge.</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;  <span class="keywordflow">for</span> (list&lt;Run*&gt;::iterator it = <a class="code" href="classimpala_1_1Sorter.html#a0830f0e52c0161407c9baa5cc763c3df">merging_runs_</a>.begin(); it != <a class="code" href="classimpala_1_1Sorter.html#a0830f0e52c0161407c9baa5cc763c3df">merging_runs_</a>.end(); ++it) {</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    (*it)-&gt;DeleteAllBlocks();</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;  }</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;  <a class="code" href="classimpala_1_1Sorter.html#a0830f0e52c0161407c9baa5cc763c3df">merging_runs_</a>.clear();</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;  <a class="code" href="classimpala_1_1Sorter.html#a0f92256ce7e671e7b119fdc00d751944">merger_</a>.reset(</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;      <span class="keyword">new</span> <a class="code" href="classimpala_1_1SortedRunMerger.html">SortedRunMerger</a>(<a class="code" href="classimpala_1_1Sorter.html#a0923783fedb01f5c6d21551b68f0ad92">compare_less_than_</a>, <a class="code" href="classimpala_1_1Sorter.html#a676b4a57c812101dbaff6e71d37e520a">output_row_desc_</a>, <a class="code" href="classimpala_1_1Sorter.html#a5e3802c81805a01499604bdfdfe7e373">profile_</a>, <span class="keyword">true</span>));</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;  vector&lt;function&lt;Status (RowBatch**)&gt; &gt; merge_runs;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;  merge_runs.reserve(num_runs);</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; num_runs; ++i) {</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    <a class="code" href="classimpala_1_1Sorter_1_1Run.html">Run</a>* run = <a class="code" href="classimpala_1_1Sorter.html#a418d79e93c34f3d4acfefdc4bf12378c">sorted_runs_</a>.front();</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    run-&gt;<a class="code" href="classimpala_1_1Sorter_1_1Run.html#a9817c6c945f1241e6181f943923dd528">PrepareRead</a>();</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    <span class="comment">// Run::GetNextBatch() is used by the merger to retrieve a batch of rows to merge</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    <span class="comment">// from this run.</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    merge_runs.push_back(bind&lt;Status&gt;(mem_fn(&amp;<a class="code" href="classimpala_1_1Sorter_1_1Run.html#a8225512f3684dfa841551b76108ab60c">Run::GetNextBatch</a>), run, _1));</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    <a class="code" href="classimpala_1_1Sorter.html#a418d79e93c34f3d4acfefdc4bf12378c">sorted_runs_</a>.pop_front();</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    <a class="code" href="classimpala_1_1Sorter.html#a0830f0e52c0161407c9baa5cc763c3df">merging_runs_</a>.push_back(run);</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;  }</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;  <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1Sorter.html#a0f92256ce7e671e7b119fdc00d751944">merger_</a>-&gt;Prepare(merge_runs));</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;  <a class="code" href="classimpala_1_1Sorter.html#ac54b4755ecada0aaa3c051393a760a17">num_merges_counter_</a>-&gt;<a class="code" href="classimpala_1_1RuntimeProfile_1_1Counter.html#accee494361b71d610dea9b639e19a285">Add</a>(1);</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;}</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;} <span class="comment">// namespace impala</span></div>
<div class="ttc" id="row-batch_8h_html"><div class="ttname"><a href="row-batch_8h.html">row-batch.h</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_html_a153bbb796e7c3c151adde89e950ab326"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter.html#a153bbb796e7c3c151adde89e950ab326">impala::Sorter::TupleSorter::InsertionSort</a></div><div class="ttdeci">void InsertionSort(const TupleIterator &amp;first, const TupleIterator &amp;last)</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00787">sorter.cc:787</a></div></div>
<div class="ttc" id="classimpala_1_1TupleDescriptor_html"><div class="ttname"><a href="classimpala_1_1TupleDescriptor.html">impala::TupleDescriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="descriptors_8h_source.html#l00298">descriptors.h:298</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_ab71e620c579d4b511e6775189672c82f"><div class="ttname"><a href="classimpala_1_1Sorter.html#ab71e620c579d4b511e6775189672c82f">impala::Sorter::sort_tuple_slot_expr_ctxs_</a></div><div class="ttdeci">std::vector&lt; ExprContext * &gt; sort_tuple_slot_expr_ctxs_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8h_source.html#l00177">sorter.h:177</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_ac54b4755ecada0aaa3c051393a760a17"><div class="ttname"><a href="classimpala_1_1Sorter.html#ac54b4755ecada0aaa3c051393a760a17">impala::Sorter::num_merges_counter_</a></div><div class="ttdeci">RuntimeProfile::Counter * num_merges_counter_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8h_source.html#l00197">sorter.h:197</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_html_afa9c46f6bdf77240deb9a2c6eb6dcdb5"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter.html#afa9c46f6bdf77240deb9a2c6eb6dcdb5">impala::Sorter::TupleSorter::Sort</a></div><div class="ttdeci">void Sort(Run *run)</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00775">sorter.cc:775</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_html_a4632ef08e6ca2331792939df4245bd20"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter.html#a4632ef08e6ca2331792939df4245bd20">impala::Sorter::TupleSorter::less_than_comp_</a></div><div class="ttdeci">const TupleRowComparator less_than_comp_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00302">sorter.cc:302</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_a416818832109c6726e726494fb823c78"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#a416818832109c6726e726494fb823c78">impala::Sorter::Run::num_tuples_</a></div><div class="ttdeci">int64_t num_tuples_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00173">sorter.cc:173</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_a9a588e06196dbe4a8866bf37b1a518e8"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#a9a588e06196dbe4a8866bf37b1a518e8">impala::Sorter::Run::AddBatch</a></div><div class="ttdeci">Status AddBatch(RowBatch *batch, int start_index, int *num_processed)</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00372">sorter.cc:372</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_a899126add02bd500846cc3cd2ddd9310"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#a899126add02bd500846cc3cd2ddd9310">impala::Sorter::Run::CopyVarLenData</a></div><div class="ttdeci">void CopyVarLenData(char *dest, const vector&lt; StringValue * &gt; &amp;var_values)</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00739">sorter.cc:739</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_a8225512f3684dfa841551b76108ab60c"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#a8225512f3684dfa841551b76108ab60c">impala::Sorter::Run::GetNextBatch</a></div><div class="ttdeci">Status GetNextBatch(RowBatch **sorted_batch)</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00573">sorter.cc:573</a></div></div>
<div class="ttc" id="classimpala_1_1RowBatch_html_ac695df3b85ee416b3d99844813ae813d"><div class="ttname"><a href="classimpala_1_1RowBatch.html#ac695df3b85ee416b3d99844813ae813d">impala::RowBatch::num_rows</a></div><div class="ttdeci">int num_rows() const </div><div class="ttdef"><b>Definition:</b> <a href="row-batch_8h_source.html#l00215">row-batch.h:215</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_a9f7337219adb32331de00cd175519e60"><div class="ttname"><a href="classimpala_1_1Sorter.html#a9f7337219adb32331de00cd175519e60">impala::Sorter::SortRun</a></div><div class="ttdeci">Status SortRun()</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l01006">sorter.cc:1006</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_a2125f77fa5dcff0861f7568673d49264"><div class="ttname"><a href="classimpala_1_1Sorter.html#a2125f77fa5dcff0861f7568673d49264">impala::Sorter::EstimateMergeMem</a></div><div class="ttdeci">static uint64_t EstimateMergeMem(uint64_t available_blocks, RowDescriptor *row_desc, int merge_batch_size)</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l01038">sorter.cc:1038</a></div></div>
<div class="ttc" id="classimpala_1_1TupleRowComparator_html"><div class="ttname"><a href="classimpala_1_1TupleRowComparator.html">impala::TupleRowComparator</a></div><div class="ttdef"><b>Definition:</b> <a href="tuple-row-compare_8h_source.html#l00027">tuple-row-compare.h:27</a></div></div>
<div class="ttc" id="runtime-profile_8h_html"><div class="ttname"><a href="runtime-profile_8h.html">runtime-profile.h</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_html_a45dbeb43165481bac59cd6ef9fab8377"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter.html#a45dbeb43165481bac59cd6ef9fab8377">impala::Sorter::TupleSorter::run_</a></div><div class="ttdeci">Run * run_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00308">sorter.cc:308</a></div></div>
<div class="ttc" id="sorter_8h_html"><div class="ttname"><a href="sorter_8h.html">sorter.h</a></div></div>
<div class="ttc" id="structimpala_1_1StringValue_html"><div class="ttname"><a href="structimpala_1_1StringValue.html">impala::StringValue</a></div><div class="ttdef"><b>Definition:</b> <a href="string-value_8h_source.html#l00033">string-value.h:33</a></div></div>
<div class="ttc" id="classimpala_1_1TupleRow_html_aed3092e531291470b27fc48afa901600"><div class="ttname"><a href="classimpala_1_1TupleRow.html#aed3092e531291470b27fc48afa901600">impala::TupleRow::GetTuple</a></div><div class="ttdeci">Tuple * GetTuple(int tuple_idx)</div><div class="ttdef"><b>Definition:</b> <a href="tuple-row_8h_source.html#l00030">tuple-row.h:30</a></div></div>
<div class="ttc" id="namespaceimpala_html_af279911558f793413306452d5b16e6d6"><div class="ttname"><a href="namespaceimpala.html#af279911558f793413306452d5b16e6d6">impala::GetNext</a></div><div class="ttdeci">Status GetNext(RowBatch **batch, RuntimeState *state)</div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_a8885817936a353154cd7640b869a4673"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#a8885817936a353154cd7640b869a4673">impala::Sorter::Run::has_var_len_slots_</a></div><div class="ttdeci">const bool has_var_len_slots_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00141">sorter.cc:141</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_html_a10ddae7f1e3a4c3ce015a1a6870d7d95"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter.html#a10ddae7f1e3a4c3ce015a1a6870d7d95">impala::Sorter::TupleSorter::~TupleSorter</a></div><div class="ttdeci">~TupleSorter()</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00770">sorter.cc:770</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator_html_aba0ddfa521d88a8a7e1c0b8d21d5962f"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#aba0ddfa521d88a8a7e1c0b8d21d5962f">impala::Sorter::TupleSorter::TupleIterator::Prev</a></div><div class="ttdeci">void Prev()</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00262">sorter.cc:262</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_a998435ec408b8350be2adccb24ec840f"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#a998435ec408b8350be2adccb24ec840f">impala::Sorter::Run::var_len_blocks_index_</a></div><div class="ttdeci">int var_len_blocks_index_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00186">sorter.cc:186</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_1_1Block_html_a1d46ffe7b416a949b6fdb6e7828c3301"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a1d46ffe7b416a949b6fdb6e7828c3301">impala::BufferedBlockMgr::Block::Pin</a></div><div class="ttdeci">Status Pin(bool *pinned, Block *release_block=NULL, bool unpin=true)</div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8cc_source.html#l00122">buffered-block-mgr.cc:122</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_html_a3cd26d226927aebcabe057773793bcce"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr.html#a3cd26d226927aebcabe057773793bcce">impala::BufferedBlockMgr::available_allocated_buffers</a></div><div class="ttdeci">int available_allocated_buffers() const </div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8h_source.html#l00380">buffered-block-mgr.h:380</a></div></div>
<div class="ttc" id="classimpala_1_1Tuple_html"><div class="ttname"><a href="classimpala_1_1Tuple.html">impala::Tuple</a></div><div class="ttdoc">A tuple with 0 materialised slots is represented as NULL. </div><div class="ttdef"><b>Definition:</b> <a href="tuple_8h_source.html#l00048">tuple.h:48</a></div></div>
<div class="ttc" id="structimpala_1_1StringValue_html_ab71e42890598d9b239cac64485db276d"><div class="ttname"><a href="structimpala_1_1StringValue.html#ab71e42890598d9b239cac64485db276d">impala::StringValue::len</a></div><div class="ttdeci">int len</div><div class="ttdef"><b>Definition:</b> <a href="string-value_8h_source.html#l00038">string-value.h:38</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_1_1Block_html_ae9e943bc0fae320e955500d0cd74a293"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr_1_1Block.html#ae9e943bc0fae320e955500d0cd74a293">impala::BufferedBlockMgr::Block::Allocate</a></div><div class="ttdeci">T * Allocate(int size)</div><div class="ttdoc">Allocates the specified number of bytes from this block. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8h_source.html#l00160">buffered-block-mgr.h:160</a></div></div>
<div class="ttc" id="classimpala_1_1RowBatch_html_a1879b7b9b72142d7a56d4846ad307bd9"><div class="ttname"><a href="classimpala_1_1RowBatch.html#a1879b7b9b72142d7a56d4846ad307bd9">impala::RowBatch::row_desc</a></div><div class="ttdeci">const RowDescriptor &amp; row_desc() const </div><div class="ttdef"><b>Definition:</b> <a href="row-batch_8h_source.html#l00218">row-batch.h:218</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_a10e19f5568d47e4280221d8f994f426b"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#a10e19f5568d47e4280221d8f994f426b">impala::Sorter::Run::DeleteAllBlocks</a></div><div class="ttdeci">void DeleteAllBlocks()</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00468">sorter.cc:468</a></div></div>
<div class="ttc" id="status_8h_html_a85f7d0e774e15eb35b74f53264305e16"><div class="ttname"><a href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a></div><div class="ttdeci">#define RETURN_IF_ERROR(stmt)</div><div class="ttdoc">some generally useful macros </div><div class="ttdef"><b>Definition:</b> <a href="status_8h_source.html#l00242">status.h:242</a></div></div>
<div class="ttc" id="classimpala_1_1RowBatch_html_a9320ed986b0717ef26d73d871f3b3a42"><div class="ttname"><a href="classimpala_1_1RowBatch.html#a9320ed986b0717ef26d73d871f3b3a42">impala::RowBatch::GetRow</a></div><div class="ttdeci">TupleRow * GetRow(int row_idx)</div><div class="ttdef"><b>Definition:</b> <a href="row-batch_8h_source.html#l00140">row-batch.h:140</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_html_a17ea44609575e99b2a2b8d4c335950c7"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter.html#a17ea44609575e99b2a2b8d4c335950c7">impala::Sorter::TupleSorter::state_</a></div><div class="ttdeci">RuntimeState *const state_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00305">sorter.cc:305</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_html_af14c401a99735706af0b5a72923292fc"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter.html#af14c401a99735706af0b5a72923292fc">impala::Sorter::TupleSorter::tuple_size_</a></div><div class="ttdeci">const int tuple_size_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00293">sorter.cc:293</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_html_a345eec72e74823a7c947560ac0907820"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter.html#a345eec72e74823a7c947560ac0907820">impala::Sorter::TupleSorter::TupleSorter</a></div><div class="ttdeci">TupleSorter(const TupleRowComparator &amp;less_than_comp, int64_t block_size, int tuple_size, RuntimeState *state)</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00758">sorter.cc:758</a></div></div>
<div class="ttc" id="runtime-profile_8h_html_a8841ca205b2a05d608e82d443bad3a77"><div class="ttname"><a href="runtime-profile_8h.html#a8841ca205b2a05d608e82d443bad3a77">ADD_TIMER</a></div><div class="ttdeci">#define ADD_TIMER(profile, name)</div><div class="ttdef"><b>Definition:</b> <a href="runtime-profile_8h_source.html#l00050">runtime-profile.h:50</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_html_a52bd5a104f158068d4627f8451dcde76"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr.html#a52bd5a104f158068d4627f8451dcde76">impala::BufferedBlockMgr::RegisterClient</a></div><div class="ttdeci">Status RegisterClient(int num_reserved_buffers, MemTracker *tracker, RuntimeState *state, Client **client)</div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8cc_source.html#l00235">buffered-block-mgr.cc:235</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_a63dd233c91ab829e6fc702ce703f77bc"><div class="ttname"><a href="classimpala_1_1Sorter.html#a63dd233c91ab829e6fc702ce703f77bc">impala::Sorter::Init</a></div><div class="ttdeci">Status Init()</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00896">sorter.cc:896</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_a1030c51f2ab6f4bf9573afd2e3e27d3b"><div class="ttname"><a href="classimpala_1_1Sorter.html#a1030c51f2ab6f4bf9573afd2e3e27d3b">impala::Sorter::CreateMerger</a></div><div class="ttdeci">Status CreateMerger(int num_runs)</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l01123">sorter.cc:1123</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator_html_a582aa8dffdb75ecf1573c488527fd211"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a582aa8dffdb75ecf1573c488527fd211">impala::Sorter::TupleSorter::TupleIterator::Next</a></div><div class="ttdeci">void Next()</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00247">sorter.cc:247</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_html_ac6e6d613d4ed039d310d789ead20e231"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr.html#ac6e6d613d4ed039d310d789ead20e231">impala::BufferedBlockMgr::max_block_size</a></div><div class="ttdeci">int64_t max_block_size() const </div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8h_source.html#l00386">buffered-block-mgr.h:386</a></div></div>
<div class="ttc" id="classimpala_1_1RowBatch_html_a040ced48537a518bd45a89e64f2e8281"><div class="ttname"><a href="classimpala_1_1RowBatch.html#a040ced48537a518bd45a89e64f2e8281">impala::RowBatch::AtCapacity</a></div><div class="ttdeci">bool AtCapacity()</div><div class="ttdef"><b>Definition:</b> <a href="row-batch_8h_source.html#l00120">row-batch.h:120</a></div></div>
<div class="ttc" id="classimpala_1_1Tuple_html_a5c9d7d0ca31caed74224c97bf55a1a5c"><div class="ttname"><a href="classimpala_1_1Tuple.html#a5c9d7d0ca31caed74224c97bf55a1a5c">impala::Tuple::GetSlot</a></div><div class="ttdeci">void * GetSlot(int offset)</div><div class="ttdef"><b>Definition:</b> <a href="tuple_8h_source.html#l00118">tuple.h:118</a></div></div>
<div class="ttc" id="classimpala_1_1RowDescriptor_html"><div class="ttname"><a href="classimpala_1_1RowDescriptor.html">impala::RowDescriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="descriptors_8h_source.html#l00373">descriptors.h:373</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_a99701fe331f35142a50a41bedf770a0f"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#a99701fe331f35142a50a41bedf770a0f">impala::Sorter::Run::fixed_len_blocks_</a></div><div class="ttdeci">vector&lt; BufferedBlockMgr::Block * &gt; fixed_len_blocks_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00159">sorter.cc:159</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator_html_aa912143e3ae57c3f466d45a3c346b669"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#aa912143e3ae57c3f466d45a3c346b669">impala::Sorter::TupleSorter::TupleIterator::index_</a></div><div class="ttdeci">int64_t index_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00280">sorter.cc:280</a></div></div>
<div class="ttc" id="classimpala_1_1TupleDescriptor_html_a153205d9bf39422c853b5bd5f54a9485"><div class="ttname"><a href="classimpala_1_1TupleDescriptor.html#a153205d9bf39422c853b5bd5f54a9485">impala::TupleDescriptor::byte_size</a></div><div class="ttdeci">int byte_size() const </div><div class="ttdef"><b>Definition:</b> <a href="descriptors_8h_source.html#l00300">descriptors.h:300</a></div></div>
<div class="ttc" id="classimpala_1_1SlotDescriptor_html"><div class="ttname"><a href="classimpala_1_1SlotDescriptor.html">impala::SlotDescriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="descriptors_8h_source.html#l00075">descriptors.h:75</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator_html"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html">impala::Sorter::TupleSorter::TupleIterator</a></div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00220">sorter.cc:220</a></div></div>
<div class="ttc" id="classimpala_1_1Status_html_a0c66107b58aeb0dacad65bd2a432f79a"><div class="ttname"><a href="classimpala_1_1Status.html#a0c66107b58aeb0dacad65bd2a432f79a">impala::Status::AddDetail</a></div><div class="ttdeci">void AddDetail(const std::string &amp;msg)</div><div class="ttdoc">Add a detail string. Calling this method is only defined on a non-OK message. </div><div class="ttdef"><b>Definition:</b> <a href="status_8cc_source.html#l00166">status.cc:166</a></div></div>
<div class="ttc" id="namespaceimpala_html_a758037b3ef56a0451dd6c75469a2b952"><div class="ttname"><a href="namespaceimpala.html#a758037b3ef56a0451dd6c75469a2b952">impala::BLOCKS_REQUIRED_FOR_MERGE</a></div><div class="ttdeci">const int BLOCKS_REQUIRED_FOR_MERGE</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00031">sorter.cc:31</a></div></div>
<div class="ttc" id="classimpala_1_1TupleRow_html"><div class="ttname"><a href="classimpala_1_1TupleRow.html">impala::TupleRow</a></div><div class="ttdef"><b>Definition:</b> <a href="tuple-row_8h_source.html#l00028">tuple-row.h:28</a></div></div>
<div class="ttc" id="classimpala_1_1SlotDescriptor_html_a1fe88c60d0d1fc04aa9569ee577d8cdd"><div class="ttname"><a href="classimpala_1_1SlotDescriptor.html#a1fe88c60d0d1fc04aa9569ee577d8cdd">impala::SlotDescriptor::null_indicator_offset</a></div><div class="ttdeci">const NullIndicatorOffset &amp; null_indicator_offset() const </div><div class="ttdef"><b>Definition:</b> <a href="descriptors_8h_source.html#l00089">descriptors.h:89</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_a5e3802c81805a01499604bdfdfe7e373"><div class="ttname"><a href="classimpala_1_1Sorter.html#a5e3802c81805a01499604bdfdfe7e373">impala::Sorter::profile_</a></div><div class="ttdeci">RuntimeProfile * profile_</div><div class="ttdoc">Runtime profile and counters for this sorter instance. </div><div class="ttdef"><b>Definition:</b> <a href="sorter_8h_source.html#l00195">sorter.h:195</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_a7753ec8417ae4ac163c435b00fad9219"><div class="ttname"><a href="classimpala_1_1Sorter.html#a7753ec8417ae4ac163c435b00fad9219">impala::Sorter::state_</a></div><div class="ttdeci">RuntimeState *const state_</div><div class="ttdoc">Runtime state instance used to check for cancellation. Not owned. </div><div class="ttdef"><b>Definition:</b> <a href="sorter_8h_source.html#l00145">sorter.h:145</a></div></div>
<div class="ttc" id="runtime-profile_8h_html_aaa9a2971c6368e3ddd3f5140a0295eb7"><div class="ttname"><a href="runtime-profile_8h.html#aaa9a2971c6368e3ddd3f5140a0295eb7">SCOPED_TIMER</a></div><div class="ttdeci">#define SCOPED_TIMER(c)</div><div class="ttdef"><b>Definition:</b> <a href="runtime-profile_8h_source.html#l00053">runtime-profile.h:53</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_a0923783fedb01f5c6d21551b68f0ad92"><div class="ttname"><a href="classimpala_1_1Sorter.html#a0923783fedb01f5c6d21551b68f0ad92">impala::Sorter::compare_less_than_</a></div><div class="ttdeci">TupleRowComparator compare_less_than_</div><div class="ttdoc">In memory sorter and less-than comparator. </div><div class="ttdef"><b>Definition:</b> <a href="sorter_8h_source.html#l00148">sorter.h:148</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator_html_a3901126aef15419a6bfeaad6e05d1921"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a3901126aef15419a6bfeaad6e05d1921">impala::Sorter::TupleSorter::TupleIterator::TupleIterator</a></div><div class="ttdeci">TupleIterator(TupleSorter *parent, int64_t index)</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00222">sorter.cc:222</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_ac5fff98fd6fe2e7e1f090a87d97026de"><div class="ttname"><a href="classimpala_1_1Sorter.html#ac5fff98fd6fe2e7e1f090a87d97026de">impala::Sorter::in_mem_sort_timer_</a></div><div class="ttdeci">RuntimeProfile::Counter * in_mem_sort_timer_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8h_source.html#l00198">sorter.h:198</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_abd0c14711ca1962d3f5bed688691b8e5"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#abd0c14711ca1962d3f5bed688691b8e5">impala::Sorter::Run::var_len_copy_block_</a></div><div class="ttdeci">BufferedBlockMgr::Block * var_len_copy_block_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00170">sorter.cc:170</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_ae23d3b7e1e829fdda77ea666ebc444a7"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#ae23d3b7e1e829fdda77ea666ebc444a7">impala::Sorter::Run::pin_next_fixed_len_block_</a></div><div class="ttdeci">bool pin_next_fixed_len_block_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00191">sorter.cc:191</a></div></div>
<div class="ttc" id="classimpala_1_1Tuple_html_ace4b7ea4cc159a2d2686e2a61c406413"><div class="ttname"><a href="classimpala_1_1Tuple.html#ace4b7ea4cc159a2d2686e2a61c406413">impala::Tuple::IsNull</a></div><div class="ttdeci">bool IsNull(const NullIndicatorOffset &amp;offset) const </div><div class="ttdef"><b>Definition:</b> <a href="tuple_8h_source.html#l00112">tuple.h:112</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_1_1Block_html_a05732338103987ffd309abee740d56a8"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a05732338103987ffd309abee740d56a8">impala::BufferedBlockMgr::Block::BytesRemaining</a></div><div class="ttdeci">int BytesRemaining() const </div><div class="ttdoc">Return the number of remaining bytes that can be allocated in this block. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8h_source.html#l00168">buffered-block-mgr.h:168</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_1_1Block_html"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr_1_1Block.html">impala::BufferedBlockMgr::Block</a></div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8h_source.html#l00136">buffered-block-mgr.h:136</a></div></div>
<div class="ttc" id="classimpala_1_1TupleDescriptor_html_a3f0ffae3775bf65b21c0b74ab825d084"><div class="ttname"><a href="classimpala_1_1TupleDescriptor.html#a3f0ffae3775bf65b21c0b74ab825d084">impala::TupleDescriptor::string_slots</a></div><div class="ttdeci">const std::vector&lt; SlotDescriptor * &gt; &amp; string_slots() const </div><div class="ttdef"><b>Definition:</b> <a href="descriptors_8h_source.html#l00303">descriptors.h:303</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_a4a0a03a8e16546212fc555f45fc9f5ba"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#a4a0a03a8e16546212fc555f45fc9f5ba">impala::Sorter::Run::sorter_</a></div><div class="ttdeci">const Sorter * sorter_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00131">sorter.cc:131</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_a7ff843ba1155cec7f8a65a320ff39a47"><div class="ttname"><a href="classimpala_1_1Sorter.html#a7ff843ba1155cec7f8a65a320ff39a47">impala::Sorter::in_mem_tuple_sorter_</a></div><div class="ttdeci">boost::scoped_ptr&lt; TupleSorter &gt; in_mem_tuple_sorter_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8h_source.html#l00149">sorter.h:149</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_html_a25a5078b6ff96b4bc78dd59ebe447919"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr.html#a25a5078b6ff96b4bc78dd59ebe447919">impala::BufferedBlockMgr::ClearReservations</a></div><div class="ttdeci">void ClearReservations(Client *client)</div><div class="ttdoc">Clears all reservations for this client. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8cc_source.html#l00244">buffered-block-mgr.cc:244</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_1_1Block_html_a9e27fd2bf12a0f46eaea29de635b231a"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a9e27fd2bf12a0f46eaea29de635b231a">impala::BufferedBlockMgr::Block::valid_data_len</a></div><div class="ttdeci">int64_t valid_data_len() const </div><div class="ttdoc">Return the number of bytes allocated in this block. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8h_source.html#l00187">buffered-block-mgr.h:187</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_html_ad814592f27d4630df7d841f36352fcce"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter.html#ad814592f27d4630df7d841f36352fcce">impala::Sorter::TupleSorter::swap_buffer_</a></div><div class="ttdeci">uint8_t * swap_buffer_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00314">sorter.cc:314</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_a0af077de5092ee027abffd250e1814e6"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#a0af077de5092ee027abffd250e1814e6">impala::Sorter::Run::sort_tuple_desc_</a></div><div class="ttdeci">const TupleDescriptor * sort_tuple_desc_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00135">sorter.cc:135</a></div></div>
<div class="ttc" id="classimpala_1_1Status_html"><div class="ttname"><a href="classimpala_1_1Status.html">impala::Status</a></div><div class="ttdef"><b>Definition:</b> <a href="status_8h_source.html#l00081">status.h:81</a></div></div>
<div class="ttc" id="classimpala_1_1RowBatch_html_aa56ff8061d406e2414d5031e5a464b73"><div class="ttname"><a href="classimpala_1_1RowBatch.html#aa56ff8061d406e2414d5031e5a464b73">impala::RowBatch::AT_CAPACITY_MEM_USAGE</a></div><div class="ttdeci">static const int AT_CAPACITY_MEM_USAGE</div><div class="ttdef"><b>Definition:</b> <a href="row-batch_8h_source.html#l00222">row-batch.h:222</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_html_a0d12ffaa992ad140adaf2d264320c677"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter.html#a0d12ffaa992ad140adaf2d264320c677">impala::Sorter::TupleSorter::Swap</a></div><div class="ttdeci">void Swap(uint8_t *left, uint8_t *right)</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00863">sorter.cc:863</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_a5667044809a96f94849fbb1248891ccd"><div class="ttname"><a href="classimpala_1_1Sorter.html#a5667044809a96f94849fbb1248891ccd">impala::Sorter::sorted_data_size_</a></div><div class="ttdeci">RuntimeProfile::Counter * sorted_data_size_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8h_source.html#l00199">sorter.h:199</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_html_a71346bdd9acd3bf22ce9491284831ccb"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter.html#a71346bdd9acd3bf22ce9491284831ccb">impala::Sorter::TupleSorter::last_tuple_block_offset_</a></div><div class="ttdeci">const int last_tuple_block_offset_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00299">sorter.cc:299</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_html"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter.html">impala::Sorter::TupleSorter</a></div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00202">sorter.cc:202</a></div></div>
<div class="ttc" id="structimpala_1_1ColumnType_html_a519bee3e0fdcf790708be4b5caebbcf4"><div class="ttname"><a href="structimpala_1_1ColumnType.html#a519bee3e0fdcf790708be4b5caebbcf4">impala::ColumnType::type</a></div><div class="ttdeci">PrimitiveType type</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00060">types.h:60</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_a2f039c834b68505cde79399c7231b3c7"><div class="ttname"><a href="classimpala_1_1Sorter.html#a2f039c834b68505cde79399c7231b3c7">impala::Sorter::InputDone</a></div><div class="ttdeci">Status InputDone()</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00949">sorter.cc:949</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_a0f92256ce7e671e7b119fdc00d751944"><div class="ttname"><a href="classimpala_1_1Sorter.html#a0f92256ce7e671e7b119fdc00d751944">impala::Sorter::merger_</a></div><div class="ttdeci">boost::scoped_ptr&lt; SortedRunMerger &gt; merger_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8h_source.html#l00185">sorter.h:185</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_a59eeb3403f9889c1c4bd3bc622410206"><div class="ttname"><a href="classimpala_1_1Sorter.html#a59eeb3403f9889c1c4bd3bc622410206">impala::Sorter::mem_tracker_</a></div><div class="ttdeci">MemTracker * mem_tracker_</div><div class="ttdoc">Mem tracker for batches created during merge. Not owned by Sorter. </div><div class="ttdef"><b>Definition:</b> <a href="sorter_8h_source.html#l00180">sorter.h:180</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_html_ae6f8f18465c4c78d9a8a1c9fd3df2447"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter.html#ae6f8f18465c4c78d9a8a1c9fd3df2447">impala::Sorter::TupleSorter::temp_tuple_row_</a></div><div class="ttdeci">TupleRow * temp_tuple_row_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00312">sorter.cc:312</a></div></div>
<div class="ttc" id="classimpala_1_1RuntimeState_html"><div class="ttname"><a href="classimpala_1_1RuntimeState.html">impala::RuntimeState</a></div><div class="ttdef"><b>Definition:</b> <a href="runtime-state_8h_source.html#l00069">runtime-state.h:69</a></div></div>
<div class="ttc" id="classimpala_1_1SortedRunMerger_html"><div class="ttname"><a href="classimpala_1_1SortedRunMerger.html">impala::SortedRunMerger</a></div><div class="ttdef"><b>Definition:</b> <a href="sorted-run-merger_8h_source.html#l00042">sorted-run-merger.h:42</a></div></div>
<div class="ttc" id="classimpala_1_1SlotDescriptor_html_abe913e989db629fdf535ef9c5b0a9e4c"><div class="ttname"><a href="classimpala_1_1SlotDescriptor.html#abe913e989db629fdf535ef9c5b0a9e4c">impala::SlotDescriptor::type</a></div><div class="ttdeci">const ColumnType &amp; type() const </div><div class="ttdef"><b>Definition:</b> <a href="descriptors_8h_source.html#l00078">descriptors.h:78</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_a8e00b3999ef01244981eea851b1bbc50"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#a8e00b3999ef01244981eea851b1bbc50">impala::Sorter::Run::GetNext</a></div><div class="ttdeci">Status GetNext(RowBatch *output_batch, bool *eos)</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00609">sorter.cc:609</a></div></div>
<div class="ttc" id="runtime-state_8h_html_a803877a2ce5ce5c0b4f311c9c7137ba1"><div class="ttname"><a href="runtime-state_8h.html#a803877a2ce5ce5c0b4f311c9c7137ba1">RETURN_IF_CANCELLED</a></div><div class="ttdeci">#define RETURN_IF_CANCELLED(state)</div><div class="ttdef"><b>Definition:</b> <a href="runtime-state_8h_source.html#l00384">runtime-state.h:384</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_a35a797d936b1cc2a1f3d07059b471f2e"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#a35a797d936b1cc2a1f3d07059b471f2e">impala::Sorter::Run::buffered_batch_</a></div><div class="ttdeci">scoped_ptr&lt; RowBatch &gt; buffered_batch_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00180">sorter.cc:180</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_a309791248f89a09fa0c99ed0381a566a"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#a309791248f89a09fa0c99ed0381a566a">impala::Sorter::Run::var_len_blocks_</a></div><div class="ttdeci">vector&lt; BufferedBlockMgr::Block * &gt; var_len_blocks_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00165">sorter.cc:165</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_acdc857b66e4ebff74b0a7c0ea008bdb8"><div class="ttname"><a href="classimpala_1_1Sorter.html#acdc857b66e4ebff74b0a7c0ea008bdb8">impala::Sorter::AddBatch</a></div><div class="ttdeci">Status AddBatch(RowBatch *batch)</div><div class="ttdoc">Adds a batch of input rows to the current unsorted run. </div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00923">sorter.cc:923</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_a53f55396a077477ec8a4b1f9695983f4"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#a53f55396a077477ec8a4b1f9695983f4">impala::Sorter::Run::fixed_len_block_offset_</a></div><div class="ttdeci">int fixed_len_block_offset_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00195">sorter.cc:195</a></div></div>
<div class="ttc" id="runtime-profile_8h_html_aac035c52016117af399543521f069c51"><div class="ttname"><a href="runtime-profile_8h.html#aac035c52016117af399543521f069c51">ADD_COUNTER</a></div><div class="ttdeci">#define ADD_COUNTER(profile, name, unit)</div><div class="ttdef"><b>Definition:</b> <a href="runtime-profile_8h_source.html#l00047">runtime-profile.h:47</a></div></div>
<div class="ttc" id="classuint64__t_html"><div class="ttname"><a href="classuint64__t.html">uint64_t</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_a04aa99293ce8b5d1b83f0ddb01434444"><div class="ttname"><a href="classimpala_1_1Sorter.html#a04aa99293ce8b5d1b83f0ddb01434444">impala::Sorter::initial_runs_counter_</a></div><div class="ttdeci">RuntimeProfile::Counter * initial_runs_counter_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8h_source.html#l00196">sorter.h:196</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_a676b4a57c812101dbaff6e71d37e520a"><div class="ttname"><a href="classimpala_1_1Sorter.html#a676b4a57c812101dbaff6e71d37e520a">impala::Sorter::output_row_desc_</a></div><div class="ttdeci">RowDescriptor * output_row_desc_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8h_source.html#l00173">sorter.h:173</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_a86cd4137fe23f09969b7a4fd87aeb350"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#a86cd4137fe23f09969b7a4fd87aeb350">impala::Sorter::Run::sort_tuple_size_</a></div><div class="ttdeci">const int sort_tuple_size_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00138">sorter.cc:138</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_1_1Block_html_a98ac414f60e71a25c45ec2526c5bcf87"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a98ac414f60e71a25c45ec2526c5bcf87">impala::BufferedBlockMgr::Block::Delete</a></div><div class="ttdeci">Status Delete()</div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8cc_source.html#l00130">buffered-block-mgr.cc:130</a></div></div>
<div class="ttc" id="classimpala_1_1MemTracker_html"><div class="ttname"><a href="classimpala_1_1MemTracker.html">impala::MemTracker</a></div><div class="ttdoc">This class is thread-safe. </div><div class="ttdef"><b>Definition:</b> <a href="mem-tracker_8h_source.html#l00061">mem-tracker.h:61</a></div></div>
<div class="ttc" id="classimpala_1_1RowBatch_html_aef978a61ab3f47c2b9e53e304eead853"><div class="ttname"><a href="classimpala_1_1RowBatch.html#aef978a61ab3f47c2b9e53e304eead853">impala::RowBatch::CommitLastRow</a></div><div class="ttdeci">void CommitLastRow()</div><div class="ttdef"><b>Definition:</b> <a href="row-batch_8h_source.html#l00109">row-batch.h:109</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_html_a4cb1e195174c2f3fded3cdae639af303"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr.html#a4cb1e195174c2f3fded3cdae639af303">impala::BufferedBlockMgr::num_free_buffers</a></div><div class="ttdeci">int num_free_buffers() const </div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8h_source.html#l00381">buffered-block-mgr.h:381</a></div></div>
<div class="ttc" id="runtime-state_8h_html"><div class="ttname"><a href="runtime-state_8h.html">runtime-state.h</a></div></div>
<div class="ttc" id="classimpala_1_1RowBatch_html"><div class="ttname"><a href="classimpala_1_1RowBatch.html">impala::RowBatch</a></div><div class="ttdef"><b>Definition:</b> <a href="row-batch_8h_source.html#l00066">row-batch.h:66</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_afce0524facb4936d8e65243123b3cd80"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#afce0524facb4936d8e65243123b3cd80">impala::Sorter::Run::CopyVarLenDataConvertOffset</a></div><div class="ttdeci">void CopyVarLenDataConvertOffset(char *dest, int64_t offset, const vector&lt; StringValue * &gt; &amp;var_values)</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00747">sorter.cc:747</a></div></div>
<div class="ttc" id="namespaceimpala_html_aa98447566dd6700a2faaaaf3059f4d95"><div class="ttname"><a href="namespaceimpala.html#aa98447566dd6700a2faaaaf3059f4d95">impala::row_desc</a></div><div class="ttdeci">const RowDescriptor &amp; row_desc() const </div></div>
<div class="ttc" id="classimpala_1_1RuntimeState_html_a627cfaab95fa7f0ffb8cb78a8ca9ef50"><div class="ttname"><a href="classimpala_1_1RuntimeState.html#a627cfaab95fa7f0ffb8cb78a8ca9ef50">impala::RuntimeState::batch_size</a></div><div class="ttdeci">int batch_size() const </div><div class="ttdef"><b>Definition:</b> <a href="runtime-state_8h_source.html#l00098">runtime-state.h:98</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_a5009c6abc953b2d3c54611687e624b0b"><div class="ttname"><a href="classimpala_1_1Sorter.html#a5009c6abc953b2d3c54611687e624b0b">impala::Sorter::GetNext</a></div><div class="ttdeci">Status GetNext(RowBatch *batch, bool *eos)</div><div class="ttdoc">Get the next batch of sorted output rows from the sorter. </div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00993">sorter.cc:993</a></div></div>
<div class="ttc" id="sorted-run-merger_8h_html"><div class="ttname"><a href="sorted-run-merger_8h.html">sorted-run-merger.h</a></div></div>
<div class="ttc" id="classimpala_1_1Status_html_ab9e27b58a24e93ade3d526311872afc9"><div class="ttname"><a href="classimpala_1_1Status.html#ab9e27b58a24e93ade3d526311872afc9">impala::Status::MEM_LIMIT_EXCEEDED</a></div><div class="ttdeci">static const Status MEM_LIMIT_EXCEEDED</div><div class="ttdef"><b>Definition:</b> <a href="status_8h_source.html#l00089">status.h:89</a></div></div>
<div class="ttc" id="structimpala_1_1StringValue_html_a17f088f03fd1f7b017df20f58f71fe13"><div class="ttname"><a href="structimpala_1_1StringValue.html#a17f088f03fd1f7b017df20f58f71fe13">impala::StringValue::ptr</a></div><div class="ttdeci">char * ptr</div><div class="ttdef"><b>Definition:</b> <a href="string-value_8h_source.html#l00037">string-value.h:37</a></div></div>
<div class="ttc" id="classimpala_1_1RuntimeState_html_a439489d4dd63b795572999677a966578"><div class="ttname"><a href="classimpala_1_1RuntimeState.html#a439489d4dd63b795572999677a966578">impala::RuntimeState::is_cancelled</a></div><div class="ttdeci">bool is_cancelled() const </div><div class="ttdef"><b>Definition:</b> <a href="runtime-state_8h_source.html#l00235">runtime-state.h:235</a></div></div>
<div class="ttc" id="classimpala_1_1RowDescriptor_html_a3d57439c68d08fe374c33370529a855c"><div class="ttname"><a href="classimpala_1_1RowDescriptor.html#a3d57439c68d08fe374c33370529a855c">impala::RowDescriptor::tuple_descriptors</a></div><div class="ttdeci">const std::vector&lt; TupleDescriptor * &gt; &amp; tuple_descriptors() const </div><div class="ttdoc">Return descriptors for all tuples in this row, in order of appearance. </div><div class="ttdef"><b>Definition:</b> <a href="descriptors_8h_source.html#l00412">descriptors.h:412</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_aa2ccb86b80fd30f968483de4c353d9f4"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#aa2ccb86b80fd30f968483de4c353d9f4">impala::Sorter::Run::num_tuples_returned_</a></div><div class="ttdeci">int64_t num_tuples_returned_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00176">sorter.cc:176</a></div></div>
<div class="ttc" id="classimpala_1_1RuntimeProfile_html"><div class="ttname"><a href="classimpala_1_1RuntimeProfile.html">impala::RuntimeProfile</a></div><div class="ttdef"><b>Definition:</b> <a href="runtime-profile_8h_source.html#l00083">runtime-profile.h:83</a></div></div>
<div class="ttc" id="classimpala_1_1TupleRow_html_aaf1d69b97c90eec7da3d07bdc40f5665"><div class="ttname"><a href="classimpala_1_1TupleRow.html#aaf1d69b97c90eec7da3d07bdc40f5665">impala::TupleRow::SetTuple</a></div><div class="ttdeci">void SetTuple(int tuple_idx, Tuple *tuple)</div><div class="ttdef"><b>Definition:</b> <a href="tuple-row_8h_source.html#l00034">tuple-row.h:34</a></div></div>
<div class="ttc" id="namespaceimpala_html_aae5f77d8dade6610fa8be807018e9095"><div class="ttname"><a href="namespaceimpala.html#aae5f77d8dade6610fa8be807018e9095">impala::PIN_FAILED_ERROR_MSG</a></div><div class="ttdeci">const string PIN_FAILED_ERROR_MSG</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00035">sorter.cc:35</a></div></div>
<div class="ttc" id="classimpala_1_1ErrorMsg_html"><div class="ttname"><a href="classimpala_1_1ErrorMsg.html">impala::ErrorMsg</a></div><div class="ttdef"><b>Definition:</b> <a href="error-util_8h_source.html#l00047">error-util.h:47</a></div></div>
<div class="ttc" id="classimpala_1_1RowBatch_html_a34b82362d8ad1e89c433e04999a6a0cb"><div class="ttname"><a href="classimpala_1_1RowBatch.html#a34b82362d8ad1e89c433e04999a6a0cb">impala::RowBatch::AddRow</a></div><div class="ttdeci">int AddRow()</div><div class="ttdef"><b>Definition:</b> <a href="row-batch_8h_source.html#l00100">row-batch.h:100</a></div></div>
<div class="ttc" id="compiler-util_8h_html_a9acc330d508b9a3b775cfdf7ce405e7d"><div class="ttname"><a href="compiler-util_8h.html#a9acc330d508b9a3b775cfdf7ce405e7d">UNLIKELY</a></div><div class="ttdeci">#define UNLIKELY(expr)</div><div class="ttdef"><b>Definition:</b> <a href="compiler-util_8h_source.html#l00033">compiler-util.h:33</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_a418d79e93c34f3d4acfefdc4bf12378c"><div class="ttname"><a href="classimpala_1_1Sorter.html#a418d79e93c34f3d4acfefdc4bf12378c">impala::Sorter::sorted_runs_</a></div><div class="ttdeci">std::list&lt; Run * &gt; sorted_runs_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8h_source.html#l00169">sorter.h:169</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_html_aac273c50f0390987fa7eeca6a9a34094"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter.html#aac273c50f0390987fa7eeca6a9a34094">impala::Sorter::TupleSorter::block_capacity_</a></div><div class="ttdeci">const int block_capacity_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00296">sorter.cc:296</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_ae578146e1ec730d2b5e3da2af24dbce9"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#ae578146e1ec730d2b5e3da2af24dbce9">impala::Sorter::Run::fixed_len_blocks_index_</a></div><div class="ttdeci">int fixed_len_blocks_index_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00185">sorter.cc:185</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_ad9a961f19d6e6c79ab10b1b5bcf4c0db"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#ad9a961f19d6e6c79ab10b1b5bcf4c0db">impala::Sorter::Run::TryAddBlock</a></div><div class="ttdeci">Status TryAddBlock(vector&lt; BufferedBlockMgr::Block * &gt; *block_sequence, bool *added)</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00716">sorter.cc:716</a></div></div>
<div class="ttc" id="classimpala_1_1Status_html_a580565665ea944eb64f3f495b1bee1e0"><div class="ttname"><a href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">impala::Status::OK</a></div><div class="ttdeci">static const Status OK</div><div class="ttdef"><b>Definition:</b> <a href="status_8h_source.html#l00087">status.h:87</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_html_abb3219c82e1f23c4e413a7aeaadbd6f8"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter.html#abb3219c82e1f23c4e413a7aeaadbd6f8">impala::Sorter::TupleSorter::temp_tuple_buffer_</a></div><div class="ttdeci">uint8_t * temp_tuple_buffer_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00313">sorter.cc:313</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html">impala::Sorter::Run</a></div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00045">sorter.cc:45</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html"><div class="ttname"><a href="classimpala_1_1Sorter.html">impala::Sorter</a></div><div class="ttdoc">Note that Init() must be called right after the constructor. </div><div class="ttdef"><b>Definition:</b> <a href="sorter_8h_source.html#l00084">sorter.h:84</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_af872d2d8a0d3d2777b723841105f6662"><div class="ttname"><a href="classimpala_1_1Sorter.html#af872d2d8a0d3d2777b723841105f6662">impala::Sorter::block_mgr_client_</a></div><div class="ttdeci">BufferedBlockMgr::Client * block_mgr_client_</div><div class="ttdoc">Handle to block mgr to make allocations from. </div><div class="ttdef"><b>Definition:</b> <a href="sorter_8h_source.html#l00155">sorter.h:155</a></div></div>
<div class="ttc" id="partitioning-throughput-test_8cc_html_ad172ecfd5c31c5df6282c2b4bc322bf7"><div class="ttname"><a href="partitioning-throughput-test_8cc.html#ad172ecfd5c31c5df6282c2b4bc322bf7">offset</a></div><div class="ttdeci">uint8_t offset[7 *64-sizeof(uint64_t)]</div><div class="ttdef"><b>Definition:</b> <a href="partitioning-throughput-test_8cc_source.html#l00037">partitioning-throughput-test.cc:37</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_a2f13416935af8ccd190fdb7b47a8ba01"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#a2f13416935af8ccd190fdb7b47a8ba01">impala::Sorter::Run::is_sorted_</a></div><div class="ttdeci">bool is_sorted_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00150">sorter.cc:150</a></div></div>
<div class="ttc" id="classimpala_1_1SlotDescriptor_html_abd47b8777b6d94017e1e4dc6b8234fad"><div class="ttname"><a href="classimpala_1_1SlotDescriptor.html#abd47b8777b6d94017e1e4dc6b8234fad">impala::SlotDescriptor::tuple_offset</a></div><div class="ttdeci">int tuple_offset() const </div><div class="ttdef"><b>Definition:</b> <a href="descriptors_8h_source.html#l00088">descriptors.h:88</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_aff8768ae068c4aca8f282268a81c4ed5"><div class="ttname"><a href="classimpala_1_1Sorter.html#aff8768ae068c4aca8f282268a81c4ed5">impala::Sorter::Sorter</a></div><div class="ttdeci">Sorter(const TupleRowComparator &amp;compare_less_than, const std::vector&lt; ExprContext * &gt; &amp;sort_tuple_slot_expr_ctxs, RowDescriptor *output_row_desc, MemTracker *mem_tracker, RuntimeProfile *profile, RuntimeState *state)</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00870">sorter.cc:870</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator_html_ac0da3c6a8fcacacaa526edeac074a74c"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#ac0da3c6a8fcacacaa526edeac074a74c">impala::Sorter::TupleSorter::TupleIterator::buffer_start_</a></div><div class="ttdeci">uint8_t * buffer_start_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00286">sorter.cc:286</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_a0830f0e52c0161407c9baa5cc763c3df"><div class="ttname"><a href="classimpala_1_1Sorter.html#a0830f0e52c0161407c9baa5cc763c3df">impala::Sorter::merging_runs_</a></div><div class="ttdeci">std::list&lt; Run * &gt; merging_runs_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8h_source.html#l00189">sorter.h:189</a></div></div>
<div class="ttc" id="names_8h_html"><div class="ttname"><a href="names_8h.html">names.h</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_a5cb279750ba595089768f7c864687e69"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#a5cb279750ba595089768f7c864687e69">impala::Sorter::Run::UnpinAllBlocks</a></div><div class="ttdeci">Status UnpinAllBlocks()</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00478">sorter.cc:478</a></div></div>
<div class="ttc" id="classimpala_1_1ObjectPool_html_ab191078c99825682a0a9915ca1e0c05c"><div class="ttname"><a href="classimpala_1_1ObjectPool.html#ab191078c99825682a0a9915ca1e0c05c">impala::ObjectPool::Add</a></div><div class="ttdeci">T * Add(T *t)</div><div class="ttdef"><b>Definition:</b> <a href="object-pool_8h_source.html#l00042">object-pool.h:42</a></div></div>
<div class="ttc" id="classimpala_1_1Tuple_html_a9986fe7443a1614ed80c2693a723ee25"><div class="ttname"><a href="classimpala_1_1Tuple.html#a9986fe7443a1614ed80c2693a723ee25">impala::Tuple::MaterializeExprs</a></div><div class="ttdeci">void MaterializeExprs(TupleRow *row, const TupleDescriptor &amp;desc, const std::vector&lt; ExprContext * &gt; &amp;materialize_expr_ctxs, MemPool *pool, std::vector&lt; StringValue * &gt; *non_null_var_len_values=NULL, int *total_var_len=NULL)</div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_ad745e2bcc3a9237ceeddb535e75484dd"><div class="ttname"><a href="classimpala_1_1Sorter.html#ad745e2bcc3a9237ceeddb535e75484dd">impala::Sorter::~Sorter</a></div><div class="ttdeci">~Sorter()</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00884">sorter.cc:884</a></div></div>
<div class="ttc" id="namespaceimpala_html_aa5bce0d3309643287a67504146c2f871a81087da87fdc569ea9ad101e34391359"><div class="ttname"><a href="namespaceimpala.html#aa5bce0d3309643287a67504146c2f871a81087da87fdc569ea9ad101e34391359">impala::TYPE_STRING</a></div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00038">types.h:38</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_1_1Block_html_a3beba257e3649515dd06d31a42667d5e"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a3beba257e3649515dd06d31a42667d5e">impala::BufferedBlockMgr::Block::buffer</a></div><div class="ttdeci">uint8_t * buffer() const </div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8h_source.html#l00181">buffered-block-mgr.h:181</a></div></div>
<div class="ttc" id="classimpala_1_1RuntimeProfile_1_1Counter_html_accee494361b71d610dea9b639e19a285"><div class="ttname"><a href="classimpala_1_1RuntimeProfile_1_1Counter.html#accee494361b71d610dea9b639e19a285">impala::RuntimeProfile::Counter::Add</a></div><div class="ttdeci">virtual void Add(int64_t delta)</div><div class="ttdef"><b>Definition:</b> <a href="runtime-profile_8h_source.html#l00093">runtime-profile.h:93</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_abb6adf28dcfe2c3a52bdb24281a247e1"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#abb6adf28dcfe2c3a52bdb24281a247e1">impala::Sorter::Run::Init</a></div><div class="ttdeci">Status Init()</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00350">sorter.cc:350</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator_html_a16a5717b83b6721fc2f6e90ed3eb39cf"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a16a5717b83b6721fc2f6e90ed3eb39cf">impala::Sorter::TupleSorter::TupleIterator::current_tuple_</a></div><div class="ttdeci">uint8_t * current_tuple_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00283">sorter.cc:283</a></div></div>
<div class="ttc" id="buffered-block-mgr_8h_html"><div class="ttname"><a href="buffered-block-mgr_8h.html">buffered-block-mgr.h</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_a9817c6c945f1241e6181f943923dd528"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#a9817c6c945f1241e6181f943923dd528">impala::Sorter::Run::PrepareRead</a></div><div class="ttdeci">Status PrepareRead()</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00535">sorter.cc:535</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_aa693ee58386bc2761923575c602b429c"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#aa693ee58386bc2761923575c602b429c">impala::Sorter::Run::is_pinned_</a></div><div class="ttdeci">bool is_pinned_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00153">sorter.cc:153</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_ad4b86ce60d3cd4b790b37c1eb4aab459"><div class="ttname"><a href="classimpala_1_1Sorter.html#ad4b86ce60d3cd4b790b37c1eb4aab459">impala::Sorter::MergeIntermediateRuns</a></div><div class="ttdeci">Status MergeIntermediateRuns()</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l01054">sorter.cc:1054</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_1_1Block_html_a03ad00fa7c792f4fc85ba5e573a30369"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a03ad00fa7c792f4fc85ba5e573a30369">impala::BufferedBlockMgr::Block::Unpin</a></div><div class="ttdeci">Status Unpin()</div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8cc_source.html#l00126">buffered-block-mgr.cc:126</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_a236edaac7e96521cb4923da22ad46fce"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#a236edaac7e96521cb4923da22ad46fce">impala::Sorter::Run::block_size_</a></div><div class="ttdeci">const int block_size_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00139">sorter.cc:139</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_aee7c92c83c5efadd6d67c44d66e818f7"><div class="ttname"><a href="classimpala_1_1Sorter.html#aee7c92c83c5efadd6d67c44d66e818f7">impala::Sorter::obj_pool_</a></div><div class="ttdeci">ObjectPool obj_pool_</div><div class="ttdoc">Pool of owned Run objects. </div><div class="ttdef"><b>Definition:</b> <a href="sorter_8h_source.html#l00192">sorter.h:192</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_a17d425e1c9f6fa64a2ca1704b10b4852"><div class="ttname"><a href="classimpala_1_1Sorter.html#a17d425e1c9f6fa64a2ca1704b10b4852">impala::Sorter::unsorted_run_</a></div><div class="ttdeci">Run * unsorted_run_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8h_source.html#l00164">sorter.h:164</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_a5c234f39858a4d91d8e8f13bff456d01"><div class="ttname"><a href="classimpala_1_1Sorter.html#a5c234f39858a4d91d8e8f13bff456d01">impala::Sorter::has_var_len_slots_</a></div><div class="ttdeci">bool has_var_len_slots_</div><div class="ttdoc">True if the tuples to be sorted have var-length slots. </div><div class="ttdef"><b>Definition:</b> <a href="sorter_8h_source.html#l00158">sorter.h:158</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_html_a0ec40c845d2b854211e31d687edbdbf7"><div class="ttname"><a href="classimpala_1_1Sorter.html#a0ec40c845d2b854211e31d687edbdbf7">impala::Sorter::block_mgr_</a></div><div class="ttdeci">BufferedBlockMgr * block_mgr_</div><div class="ttdoc">Block manager object used to allocate, pin and release runs. Not owned by Sorter. ...</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8h_source.html#l00152">sorter.h:152</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator_html_a5bf21651816fc3301d27b20d3f9b6e62"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#a5bf21651816fc3301d27b20d3f9b6e62">impala::Sorter::TupleSorter::TupleIterator::block_index_</a></div><div class="ttdeci">int block_index_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00289">sorter.cc:289</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_a193690e24869c767627bc6189a3465ee"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#a193690e24869c767627bc6189a3465ee">impala::Sorter::Run::materialize_slots_</a></div><div class="ttdeci">const bool materialize_slots_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00146">sorter.cc:146</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_a1c8ae38633d81de1bf5048162735ac9b"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#a1c8ae38633d81de1bf5048162735ac9b">impala::Sorter::Run::CollectNonNullVarSlots</a></div><div class="ttdeci">void CollectNonNullVarSlots(Tuple *src, vector&lt; StringValue * &gt; *var_len_values, int *total_var_len)</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00702">sorter.cc:702</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_html_ac02ec24138cf38ca7fb5d228c80679f7"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter.html#ac02ec24138cf38ca7fb5d228c80679f7">impala::Sorter::TupleSorter::SortHelper</a></div><div class="ttdeci">void SortHelper(TupleIterator first, TupleIterator last)</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00845">sorter.cc:845</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_html_a198d2b7248b71f59908d4d713f61fb62"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter.html#a198d2b7248b71f59908d4d713f61fb62">impala::Sorter::TupleSorter::Partition</a></div><div class="ttdeci">TupleIterator Partition(TupleIterator first, TupleIterator last, Tuple *pivot)</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00817">sorter.cc:817</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_1_1Block_html_a471d38f75ad1ef978ea60f31e391d47e"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a471d38f75ad1ef978ea60f31e391d47e">impala::BufferedBlockMgr::Block::ReturnAllocation</a></div><div class="ttdeci">void ReturnAllocation(int size)</div><div class="ttdoc">Return size bytes from the most recent allocation. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8h_source.html#l00174">buffered-block-mgr.h:174</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1Run_html_a8e85aff2ab4019388c75c2c70c1bc8f9"><div class="ttname"><a href="classimpala_1_1Sorter_1_1Run.html#a8e85aff2ab4019388c75c2c70c1bc8f9">impala::Sorter::Run::pin_next_var_len_block_</a></div><div class="ttdeci">bool pin_next_var_len_block_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00192">sorter.cc:192</a></div></div>
<div class="ttc" id="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator_html_ab5503e7bd9cad32161be13423f5c9c9a"><div class="ttname"><a href="classimpala_1_1Sorter_1_1TupleSorter_1_1TupleIterator.html#ab5503e7bd9cad32161be13423f5c9c9a">impala::Sorter::TupleSorter::TupleIterator::parent_</a></div><div class="ttdeci">TupleSorter * parent_</div><div class="ttdef"><b>Definition:</b> <a href="sorter_8cc_source.html#l00277">sorter.cc:277</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_e5d120be6b5e8a44336cbfd013b25604.html">be</a></li><li class="navelem"><a class="el" href="dir_68cf7cafb51a962d5bc4848b83cab0de.html">src</a></li><li class="navelem"><a class="el" href="dir_1ef28ab5153adb64262182d038c65543.html">runtime</a></li><li class="navelem"><a class="el" href="sorter_8cc.html">sorter.cc</a></li>
    <li class="footer">Generated on Thu May 7 2015 16:10:37 for Impala by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
