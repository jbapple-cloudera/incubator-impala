<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Impala: impala::ThreadResourceMgr Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Impala
   </div>
   <div id="projectbrief">Impalaistheopensource,nativeanalyticdatabaseforApacheHadoop.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classimpala_1_1ThreadResourceMgr.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-types">Private Types</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classimpala_1_1ThreadResourceMgr-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">impala::ThreadResourceMgr Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="thread-resource-mgr_8h_source.html">thread-resource-mgr.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for impala::ThreadResourceMgr:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="classimpala_1_1ThreadResourceMgr__coll__graph.svg" width="626" height="334"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1ThreadResourceMgr_1_1ResourcePool.html">ResourcePool</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a448365c4a1b88ead12926859fd973dad"><td class="memItemLeft" align="right" valign="top">typedef boost::function&lt; void(<a class="el" href="classimpala_1_1ThreadResourceMgr_1_1ResourcePool.html">ResourcePool</a> *)&gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1ThreadResourceMgr.html#a448365c4a1b88ead12926859fd973dad">ThreadAvailableCb</a></td></tr>
<tr class="separator:a448365c4a1b88ead12926859fd973dad"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:abfb3c42333e373e9da37b7833459e813"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1ThreadResourceMgr.html#abfb3c42333e373e9da37b7833459e813">ThreadResourceMgr</a> (int threads_quota=0)</td></tr>
<tr class="separator:abfb3c42333e373e9da37b7833459e813"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99ef6e0338285debbb0091dac8c40968"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1ThreadResourceMgr.html#a99ef6e0338285debbb0091dac8c40968">system_threads_quota</a> () const </td></tr>
<tr class="separator:a99ef6e0338285debbb0091dac8c40968"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a97a8751675e2f6dcede14054c51146e6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classimpala_1_1ThreadResourceMgr_1_1ResourcePool.html">ResourcePool</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1ThreadResourceMgr.html#a97a8751675e2f6dcede14054c51146e6">RegisterPool</a> ()</td></tr>
<tr class="separator:a97a8751675e2f6dcede14054c51146e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39bd0e79fc3b0d227a6e5bbce565c98e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1ThreadResourceMgr.html#a39bd0e79fc3b0d227a6e5bbce565c98e">UnregisterPool</a> (<a class="el" href="classimpala_1_1ThreadResourceMgr_1_1ResourcePool.html">ResourcePool</a> *<a class="el" href="expr-benchmark_8cc.html#a3a5de7bd423fbc0afc4cf935c166ca6b">pool</a>)</td></tr>
<tr class="separator:a39bd0e79fc3b0d227a6e5bbce565c98e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-types"></a>
Private Types</h2></td></tr>
<tr class="memitem:a0037c6b020f7175a0ae4f0e55104515b"><td class="memItemLeft" align="right" valign="top">typedef std::set&lt; <a class="el" href="classimpala_1_1ThreadResourceMgr_1_1ResourcePool.html">ResourcePool</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1ThreadResourceMgr.html#a0037c6b020f7175a0ae4f0e55104515b">Pools</a></td></tr>
<tr class="memdesc:a0037c6b020f7175a0ae4f0e55104515b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pools currently being managed.  <a href="#a0037c6b020f7175a0ae4f0e55104515b">More...</a><br/></td></tr>
<tr class="separator:a0037c6b020f7175a0ae4f0e55104515b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:aa67f77beccc3a644c49d01240636b87c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1ThreadResourceMgr.html#aa67f77beccc3a644c49d01240636b87c">UpdatePoolQuotas</a> (<a class="el" href="classimpala_1_1ThreadResourceMgr_1_1ResourcePool.html">ResourcePool</a> *new_pool=NULL)</td></tr>
<tr class="separator:aa67f77beccc3a644c49d01240636b87c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:ad8b6b16941354ca88f3fc58ed6fe473b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1ThreadResourceMgr.html#ad8b6b16941354ca88f3fc58ed6fe473b">system_threads_quota_</a></td></tr>
<tr class="memdesc:ad8b6b16941354ca88f3fc58ed6fe473b"><td class="mdescLeft">&#160;</td><td class="mdescRight">'Optimal' number of threads for the entire process.  <a href="#ad8b6b16941354ca88f3fc58ed6fe473b">More...</a><br/></td></tr>
<tr class="separator:ad8b6b16941354ca88f3fc58ed6fe473b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8b7daa19517c5e95e4370c23ee7b99d"><td class="memItemLeft" align="right" valign="top">boost::mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1ThreadResourceMgr.html#ab8b7daa19517c5e95e4370c23ee7b99d">lock_</a></td></tr>
<tr class="memdesc:ab8b7daa19517c5e95e4370c23ee7b99d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Lock for the entire object. Protects all fields below.  <a href="#ab8b7daa19517c5e95e4370c23ee7b99d">More...</a><br/></td></tr>
<tr class="separator:ab8b7daa19517c5e95e4370c23ee7b99d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86daabcd6f56aa5da8b020fc6c8da05a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classimpala_1_1ThreadResourceMgr.html#a0037c6b020f7175a0ae4f0e55104515b">Pools</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1ThreadResourceMgr.html#a86daabcd6f56aa5da8b020fc6c8da05a">pools_</a></td></tr>
<tr class="separator:a86daabcd6f56aa5da8b020fc6c8da05a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43bb3d290d102de0bf7e8716a276c0cc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1ThreadResourceMgr.html#a43bb3d290d102de0bf7e8716a276c0cc">per_pool_quota_</a></td></tr>
<tr class="separator:a43bb3d290d102de0bf7e8716a276c0cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12f89368a86c2d81ba3bfc88dacd5ee5"><td class="memItemLeft" align="right" valign="top">std::list&lt; <a class="el" href="classimpala_1_1ThreadResourceMgr_1_1ResourcePool.html">ResourcePool</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1ThreadResourceMgr.html#a12f89368a86c2d81ba3bfc88dacd5ee5">free_pool_objs_</a></td></tr>
<tr class="memdesc:a12f89368a86c2d81ba3bfc88dacd5ee5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Recycled list of pool objects.  <a href="#a12f89368a86c2d81ba3bfc88dacd5ee5">More...</a><br/></td></tr>
<tr class="separator:a12f89368a86c2d81ba3bfc88dacd5ee5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Singleton object to manage CPU (aka thread) resources for the process. Conceptually, there is a fixed pool of threads that are shared between query fragments. If there is only one fragment running, it can use the entire pool, spinning up the maximum number of threads to saturate the hardware. If there are multiple fragments, the CPU pool must be shared between them. Currently, the total system pool is split evenly between all consumers. Each consumer gets ceil(total_system_threads / num_consumers). Each fragment must register with the <a class="el" href="classimpala_1_1ThreadResourceMgr.html">ThreadResourceMgr</a> to request threads (in the form of tokens). The fragment has required threads (it can't run with fewer threads) and optional threads. If the fragment is running on its own, it will be able to spin up more optional threads. When the system is under load, the <a class="el" href="classimpala_1_1ThreadResourceMgr.html">ThreadResourceMgr</a> will stop giving out tokens for optional threads. Pools should not use this for threads that are almost always idle (e.g. periodic reporting threads). Pools will temporarily go over the quota regularly and this is very much by design. For example, if a pool is running on its own with 4 required threads and 28 optional and another pool is added to the system, the first pool's quota is then cut by half (16 total) and will over time drop the optional threads. This class is thread safe. TODO: this is an initial simple version to improve the behavior with concurrency. This will need to be expanded post GA. These include:</p>
<ul>
<li>More places where threads are optional (e.g. hash table build side, data stream threads, etc).</li>
<li>Admission control</li>
<li>Integration with other nodes/statestore</li>
<li>Priorities for different pools If both the mgr and pool locks need to be taken, the mgr lock must be taken first. </li>
</ul>

<p>Definition at line <a class="el" href="thread-resource-mgr_8h_source.html#l00063">63</a> of file <a class="el" href="thread-resource-mgr_8h_source.html">thread-resource-mgr.h</a>.</p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a class="anchor" id="a0037c6b020f7175a0ae4f0e55104515b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::set&lt;<a class="el" href="classimpala_1_1ThreadResourceMgr_1_1ResourcePool.html">ResourcePool</a>*&gt; <a class="el" href="classimpala_1_1ThreadResourceMgr.html#a0037c6b020f7175a0ae4f0e55104515b">impala::ThreadResourceMgr::Pools</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Pools currently being managed. </p>

<p>Definition at line <a class="el" href="thread-resource-mgr_8h_source.html#l00215">215</a> of file <a class="el" href="thread-resource-mgr_8h_source.html">thread-resource-mgr.h</a>.</p>

</div>
</div>
<a class="anchor" id="a448365c4a1b88ead12926859fd973dad"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef boost::function&lt;void (<a class="el" href="classimpala_1_1ThreadResourceMgr_1_1ResourcePool.html">ResourcePool</a>*)&gt; <a class="el" href="classimpala_1_1ThreadResourceMgr.html#a448365c4a1b88ead12926859fd973dad">impala::ThreadResourceMgr::ThreadAvailableCb</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function will be called whenever the pool has more threads it can run on. This can happen on ReleaseThreadToken or if the quota for this pool increases. This is a good place, for example, to wake up anything blocked on available threads. This callback must not block. Note that this is not called once for each available thread or even guaranteed that when it is called, a thread is available (the quota could have changed again in between). It is simply that something might have happened (similar to condition variable semantics). TODO: this is manageable now since it just needs to call into the io mgr. What's the best model for something more general. </p>

<p>Definition at line <a class="el" href="thread-resource-mgr_8h_source.html#l00065">65</a> of file <a class="el" href="thread-resource-mgr_8h_source.html">thread-resource-mgr.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="abfb3c42333e373e9da37b7833459e813"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ThreadResourceMgr::ThreadResourceMgr </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>threads_quota</em> = <code>0</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create a thread mgr object. If threads_quota is non-zero, it will be the number of threads for the system, otherwise it will be determined based on the hardware. </p>

<p>Definition at line <a class="el" href="thread-resource-mgr_8cc_source.html#l00035">35</a> of file <a class="el" href="thread-resource-mgr_8cc_source.html">thread-resource-mgr.cc</a>.</p>

<p>References <a class="el" href="cpu-info_8h_source.html#l00080">impala::CpuInfo::num_cores()</a>, <a class="el" href="thread-resource-mgr_8h_source.html#l00220">per_pool_quota_</a>, and <a class="el" href="thread-resource-mgr_8h_source.html#l00209">system_threads_quota_</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a97a8751675e2f6dcede14054c51146e6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classimpala_1_1ThreadResourceMgr_1_1ResourcePool.html">ThreadResourceMgr::ResourcePool</a> * ThreadResourceMgr::RegisterPool </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Register a new pool with the thread mgr. Registering a pool will update the quotas for all existing pools. </p>

<p>Definition at line <a class="el" href="thread-resource-mgr_8cc_source.html#l00061">61</a> of file <a class="el" href="thread-resource-mgr_8cc_source.html">thread-resource-mgr.cc</a>.</p>

<p>References <a class="el" href="thread-resource-mgr_8h_source.html#l00223">free_pool_objs_</a>, <a class="el" href="thread-resource-mgr_8h_source.html#l00212">lock_</a>, <a class="el" href="expr-benchmark_8cc_source.html#l00089">pool</a>, <a class="el" href="thread-resource-mgr_8h_source.html#l00216">pools_</a>, <a class="el" href="thread-resource-mgr_8cc_source.html#l00049">impala::ThreadResourceMgr::ResourcePool::Reset()</a>, and <a class="el" href="thread-resource-mgr_8cc_source.html#l00096">UpdatePoolQuotas()</a>.</p>

<p>Referenced by <a class="el" href="runtime-state_8cc_source.html#l00120">impala::RuntimeState::Init()</a>, and <a class="el" href="thread-resource-mgr-test_8cc_source.html#l00043">impala::TEST()</a>.</p>

</div>
</div>
<a class="anchor" id="a99ef6e0338285debbb0091dac8c40968"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int impala::ThreadResourceMgr::system_threads_quota </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="thread-resource-mgr_8h_source.html#l00197">197</a> of file <a class="el" href="thread-resource-mgr_8h_source.html">thread-resource-mgr.h</a>.</p>

<p>References <a class="el" href="thread-resource-mgr_8h_source.html#l00209">system_threads_quota_</a>.</p>

</div>
</div>
<a class="anchor" id="a39bd0e79fc3b0d227a6e5bbce565c98e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ThreadResourceMgr::UnregisterPool </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classimpala_1_1ThreadResourceMgr_1_1ResourcePool.html">ResourcePool</a> *&#160;</td>
          <td class="paramname"><em>pool</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Unregisters the pool. 'pool' is no longer valid after this. This updates the quotas for the remaining pools. </p>

<p>Definition at line <a class="el" href="thread-resource-mgr_8cc_source.html#l00081">81</a> of file <a class="el" href="thread-resource-mgr_8cc_source.html">thread-resource-mgr.cc</a>.</p>

<p>References <a class="el" href="thread-resource-mgr_8h_source.html#l00223">free_pool_objs_</a>, <a class="el" href="thread-resource-mgr_8h_source.html#l00212">lock_</a>, <a class="el" href="thread-resource-mgr_8h_source.html#l00216">pools_</a>, and <a class="el" href="thread-resource-mgr_8cc_source.html#l00096">UpdatePoolQuotas()</a>.</p>

<p>Referenced by <a class="el" href="plan-fragment-executor_8cc_source.html#l00564">impala::PlanFragmentExecutor::Close()</a>, and <a class="el" href="thread-resource-mgr-test_8cc_source.html#l00043">impala::TEST()</a>.</p>

</div>
</div>
<a class="anchor" id="aa67f77beccc3a644c49d01240636b87c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ThreadResourceMgr::UpdatePoolQuotas </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classimpala_1_1ThreadResourceMgr_1_1ResourcePool.html">ResourcePool</a> *&#160;</td>
          <td class="paramname"><em>new_pool</em> = <code>NULL</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Updates the per pool quota and notifies any pools that now have more threads they can use. Must be called with lock_ taken. If new_pool is non-null, new_pool will <em>not</em> be notified. </p>

<p>Definition at line <a class="el" href="thread-resource-mgr_8cc_source.html#l00096">96</a> of file <a class="el" href="thread-resource-mgr_8cc_source.html">thread-resource-mgr.cc</a>.</p>

<p>References <a class="el" href="thread-resource-mgr_8h_source.html#l00187">impala::ThreadResourceMgr::ResourcePool::lock_</a>, <a class="el" href="thread-resource-mgr_8h_source.html#l00151">impala::ThreadResourceMgr::ResourcePool::num_available_threads()</a>, <a class="el" href="thread-resource-mgr_8h_source.html#l00220">per_pool_quota_</a>, <a class="el" href="expr-benchmark_8cc_source.html#l00089">pool</a>, <a class="el" href="thread-resource-mgr_8h_source.html#l00216">pools_</a>, <a class="el" href="thread-resource-mgr_8h_source.html#l00209">system_threads_quota_</a>, and <a class="el" href="thread-resource-mgr_8h_source.html#l00189">impala::ThreadResourceMgr::ResourcePool::thread_available_fn_</a>.</p>

<p>Referenced by <a class="el" href="thread-resource-mgr_8cc_source.html#l00061">RegisterPool()</a>, and <a class="el" href="thread-resource-mgr_8cc_source.html#l00081">UnregisterPool()</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a12f89368a86c2d81ba3bfc88dacd5ee5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::list&lt;<a class="el" href="classimpala_1_1ThreadResourceMgr_1_1ResourcePool.html">ResourcePool</a>*&gt; impala::ThreadResourceMgr::free_pool_objs_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Recycled list of pool objects. </p>

<p>Definition at line <a class="el" href="thread-resource-mgr_8h_source.html#l00223">223</a> of file <a class="el" href="thread-resource-mgr_8h_source.html">thread-resource-mgr.h</a>.</p>

<p>Referenced by <a class="el" href="thread-resource-mgr_8cc_source.html#l00061">RegisterPool()</a>, and <a class="el" href="thread-resource-mgr_8cc_source.html#l00081">UnregisterPool()</a>.</p>

</div>
</div>
<a class="anchor" id="ab8b7daa19517c5e95e4370c23ee7b99d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::mutex impala::ThreadResourceMgr::lock_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Lock for the entire object. Protects all fields below. </p>

<p>Definition at line <a class="el" href="thread-resource-mgr_8h_source.html#l00212">212</a> of file <a class="el" href="thread-resource-mgr_8h_source.html">thread-resource-mgr.h</a>.</p>

<p>Referenced by <a class="el" href="thread-resource-mgr_8cc_source.html#l00061">RegisterPool()</a>, <a class="el" href="thread-resource-mgr_8h_source.html#l00255">impala::ThreadResourceMgr::ResourcePool::ReleaseThreadToken()</a>, <a class="el" href="thread-resource-mgr_8cc_source.html#l00090">impala::ThreadResourceMgr::ResourcePool::SetThreadAvailableCb()</a>, and <a class="el" href="thread-resource-mgr_8cc_source.html#l00081">UnregisterPool()</a>.</p>

</div>
</div>
<a class="anchor" id="a43bb3d290d102de0bf7e8716a276c0cc"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int impala::ThreadResourceMgr::per_pool_quota_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Each pool currently gets the same share. This is the ceil of the system quota divided by the number of pools. </p>

<p>Definition at line <a class="el" href="thread-resource-mgr_8h_source.html#l00220">220</a> of file <a class="el" href="thread-resource-mgr_8h_source.html">thread-resource-mgr.h</a>.</p>

<p>Referenced by <a class="el" href="thread-resource-mgr_8h_source.html#l00159">impala::ThreadResourceMgr::ResourcePool::quota()</a>, <a class="el" href="thread-resource-mgr_8cc_source.html#l00035">ThreadResourceMgr()</a>, and <a class="el" href="thread-resource-mgr_8cc_source.html#l00096">UpdatePoolQuotas()</a>.</p>

</div>
</div>
<a class="anchor" id="a86daabcd6f56aa5da8b020fc6c8da05a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classimpala_1_1ThreadResourceMgr.html#a0037c6b020f7175a0ae4f0e55104515b">Pools</a> impala::ThreadResourceMgr::pools_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="thread-resource-mgr_8h_source.html#l00216">216</a> of file <a class="el" href="thread-resource-mgr_8h_source.html">thread-resource-mgr.h</a>.</p>

<p>Referenced by <a class="el" href="thread-resource-mgr_8cc_source.html#l00061">RegisterPool()</a>, <a class="el" href="thread-resource-mgr_8cc_source.html#l00081">UnregisterPool()</a>, and <a class="el" href="thread-resource-mgr_8cc_source.html#l00096">UpdatePoolQuotas()</a>.</p>

</div>
</div>
<a class="anchor" id="ad8b6b16941354ca88f3fc58ed6fe473b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int impala::ThreadResourceMgr::system_threads_quota_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>'Optimal' number of threads for the entire process. </p>

<p>Definition at line <a class="el" href="thread-resource-mgr_8h_source.html#l00209">209</a> of file <a class="el" href="thread-resource-mgr_8h_source.html">thread-resource-mgr.h</a>.</p>

<p>Referenced by <a class="el" href="thread-resource-mgr_8h_source.html#l00197">system_threads_quota()</a>, <a class="el" href="thread-resource-mgr_8cc_source.html#l00035">ThreadResourceMgr()</a>, and <a class="el" href="thread-resource-mgr_8cc_source.html#l00096">UpdatePoolQuotas()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>be/src/runtime/<a class="el" href="thread-resource-mgr_8h_source.html">thread-resource-mgr.h</a></li>
<li>be/src/runtime/<a class="el" href="thread-resource-mgr_8cc_source.html">thread-resource-mgr.cc</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceimpala.html">impala</a></li><li class="navelem"><a class="el" href="classimpala_1_1ThreadResourceMgr.html">ThreadResourceMgr</a></li>
    <li class="footer">Generated on Thu May 7 2015 16:10:49 for Impala by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
