<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Impala: be/src/runtime/client-cache.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Impala
   </div>
   <div id="projectbrief">Impalaistheopensource,nativeanalyticdatabaseforApacheHadoop.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('client-cache_8h_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">client-cache.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="client-cache_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright 2012 Cloudera Inc.</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// you may not use this file except in compliance with the License.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// You may obtain a copy of the License at</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// See the License for the specific language governing permissions and</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// limitations under the License.</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#ifndef IMPALA_RUNTIME_CLIENT_CACHE_H</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define IMPALA_RUNTIME_CLIENT_CACHE_H</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;list&gt;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &lt;boost/unordered_map.hpp&gt;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;boost/thread/mutex.hpp&gt;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;boost/bind.hpp&gt;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="metrics_8h.html">util/metrics.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="thrift-client_8h.html">rpc/thrift-client.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="thrift-util_8h.html">rpc/thrift-util.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="status_8h.html">common/status.h</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keyword">namespace </span>impala {</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="namespaceimpala.html#af882a84ad40478dc121a6bf6dc27f201">   35</a></span>&#160;<span class="keyword">typedef</span> <span class="keywordtype">void</span>* <a class="code" href="namespaceimpala.html#af882a84ad40478dc121a6bf6dc27f201">ClientKey</a>;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment"></span><span class="comment">//</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment"></span><span class="comment">//</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment"></span><span class="comment">//</span></div>
<div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCacheHelper.html">   63</a></span>&#160;<span class="comment"></span><span class="keyword">class </span><a class="code" href="classimpala_1_1ClientCacheHelper.html">ClientCacheHelper</a> {</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160; <span class="keyword">public</span>:</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keyword">typedef</span> boost::function&lt;<a class="code" href="classimpala_1_1ThriftClientImpl.html">ThriftClientImpl</a>* (<span class="keyword">const</span> TNetworkAddress&amp; address,</div>
<div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCacheHelper.html#a4da1ac222ceff2be3f798650fc4d48f9">   68</a></span>&#160;                                             <a class="code" href="namespaceimpala.html#af882a84ad40478dc121a6bf6dc27f201">ClientKey</a>* client_key)&gt; <a class="code" href="classimpala_1_1ClientCacheHelper.html#a4da1ac222ceff2be3f798650fc4d48f9">ClientFactory</a>;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment"></span>  <a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1ClientCacheHelper.html#a866e9a0ba17a9812cb2ceafbbef183d4">GetClient</a>(<span class="keyword">const</span> TNetworkAddress&amp; address, <a class="code" href="classimpala_1_1ClientCacheHelper.html#a4da1ac222ceff2be3f798650fc4d48f9">ClientFactory</a> factory_method,</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      <a class="code" href="namespaceimpala.html#af882a84ad40478dc121a6bf6dc27f201">ClientKey</a>* client_key);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment"></span>  <a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1ClientCacheHelper.html#ad0d2e8780d700174f9fa8e8cac83b4b2">ReopenClient</a>(<a class="code" href="classimpala_1_1ClientCacheHelper.html#a4da1ac222ceff2be3f798650fc4d48f9">ClientFactory</a> factory_method, <a class="code" href="namespaceimpala.html#af882a84ad40478dc121a6bf6dc27f201">ClientKey</a>* client_key);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classimpala_1_1ClientCacheHelper.html#a952813bed7ba0ad4d5ac212d6b412855">ReleaseClient</a>(<a class="code" href="namespaceimpala.html#af882a84ad40478dc121a6bf6dc27f201">ClientKey</a>* client_key);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classimpala_1_1ClientCacheHelper.html#a216d1682a3075523b67ecc506db12ba2">CloseConnections</a>(<span class="keyword">const</span> TNetworkAddress&amp; address);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  std::string <a class="code" href="classimpala_1_1ClientCacheHelper.html#a2ff1124846a1e27106bb2ad47dfc7c37">DebugString</a>();</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classimpala_1_1ClientCacheHelper.html#a0633abad539e0ed6881e31ed209967a1">TestShutdown</a>();</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classimpala_1_1ClientCacheHelper.html#a655a4878f988d44bb8f0e782d2b49b51">InitMetrics</a>(<a class="code" href="classimpala_1_1MetricGroup.html">MetricGroup</a>* metrics, <span class="keyword">const</span> std::string&amp; key_prefix);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; <span class="keyword">private</span>:</div>
<div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCacheHelper.html#a430dce1ab5a6f30a141b20e1da13ad6a">  105</a></span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classimpala_1_1ClientCache.html">ClientCache</a>;</div>
<div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCacheHelper.html#a1b814cc326129a5e182341f88833a2ee">  107</a></span>&#160;  <a class="code" href="classimpala_1_1ClientCacheHelper.html#a1b814cc326129a5e182341f88833a2ee">ClientCacheHelper</a>(uint32_t num_tries, <a class="code" href="classuint64__t.html">uint64_t</a> wait_ms, int32_t send_timeout_ms,</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      int32_t recv_timeout_ms)</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      : <a class="code" href="classimpala_1_1ClientCacheHelper.html#aea87a817f89cc03e6fd1177c4363d81b">num_tries_</a>(num_tries),</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <a class="code" href="classimpala_1_1ClientCacheHelper.html#aa6f05f2194e6acc7a1723ed1541ba677">wait_ms_</a>(wait_ms),</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <a class="code" href="classimpala_1_1ClientCacheHelper.html#aaa00024d1bc2bd1b114f917f7b067e8f">send_timeout_ms_</a>(send_timeout_ms),</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <a class="code" href="classimpala_1_1ClientCacheHelper.html#a8bed620b75773576dbb4ae5f76b23350">recv_timeout_ms_</a>(recv_timeout_ms),</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <a class="code" href="classimpala_1_1ClientCacheHelper.html#a72626f83388532e065e9f37b9e73e1e2">metrics_enabled_</a>(false) { }</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="structimpala_1_1ClientCacheHelper_1_1PerHostCache.html">  131</a></span>&#160;<span class="comment"></span>  <span class="keyword">struct </span><a class="code" href="structimpala_1_1ClientCacheHelper_1_1PerHostCache.html">PerHostCache</a> {</div>
<div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="structimpala_1_1ClientCacheHelper_1_1PerHostCache.html#af7a7d77f629823f29e9718e762d92ad4">  133</a></span>&#160;    boost::mutex <a class="code" href="structimpala_1_1ClientCacheHelper_1_1PerHostCache.html#af7a7d77f629823f29e9718e762d92ad4">lock</a>;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00136"></a><span class="lineno"><a class="line" href="structimpala_1_1ClientCacheHelper_1_1PerHostCache.html#adcf91f5299862d703e29fc232198306d">  136</a></span>&#160;    std::list&lt;ClientKey&gt; <a class="code" href="structimpala_1_1ClientCacheHelper_1_1PerHostCache.html#adcf91f5299862d703e29fc232198306d">clients</a>;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  };</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div>
<div class="line"><a name="l00140"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCacheHelper.html#a7f28c5c2ecae44c0e5d6f2d73b05e6f6">  140</a></span>&#160;  boost::mutex <a class="code" href="classimpala_1_1ClientCacheHelper.html#a7f28c5c2ecae44c0e5d6f2d73b05e6f6">cache_lock_</a>;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keyword">typedef</span> boost::unordered_map&lt;</div>
<div class="line"><a name="l00146"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCacheHelper.html#a2a7dba2cc619dce959168fb5521d7cf3">  146</a></span>&#160;      TNetworkAddress, boost::shared_ptr&lt;PerHostCache&gt; &gt; <a class="code" href="classimpala_1_1ClientCacheHelper.html#a2a7dba2cc619dce959168fb5521d7cf3">PerHostCacheMap</a>;</div>
<div class="line"><a name="l00147"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCacheHelper.html#aa2443d6ecc23ae8866afd0643b55a6b3">  147</a></span>&#160;  <a class="code" href="classimpala_1_1ClientCacheHelper.html#a2a7dba2cc619dce959168fb5521d7cf3">PerHostCacheMap</a> <a class="code" href="classimpala_1_1ClientCacheHelper.html#aa2443d6ecc23ae8866afd0643b55a6b3">per_host_caches_</a>;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div>
<div class="line"><a name="l00150"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCacheHelper.html#af32d280bf9948b02f2ae6f390ccc5277">  150</a></span>&#160;  boost::mutex <a class="code" href="classimpala_1_1ClientCacheHelper.html#af32d280bf9948b02f2ae6f390ccc5277">client_map_lock_</a>;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00156"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCacheHelper.html#aa5a49cf4968695cbf24f1b83ffbc61fc">  156</a></span>&#160;  <span class="keyword">typedef</span> std::map&lt;ClientKey, boost::shared_ptr&lt;ThriftClientImpl&gt; &gt; <a class="code" href="classimpala_1_1ClientCacheHelper.html#aa5a49cf4968695cbf24f1b83ffbc61fc">ClientMap</a>;</div>
<div class="line"><a name="l00157"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCacheHelper.html#a368c998c61f2e401c891358fa2474904">  157</a></span>&#160;  <a class="code" href="classimpala_1_1ClientCacheHelper.html#aa5a49cf4968695cbf24f1b83ffbc61fc">ClientMap</a> <a class="code" href="classimpala_1_1ClientCacheHelper.html#a368c998c61f2e401c891358fa2474904">client_map_</a>;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div>
<div class="line"><a name="l00160"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCacheHelper.html#aea87a817f89cc03e6fd1177c4363d81b">  160</a></span>&#160;  <span class="keyword">const</span> uint32_t <a class="code" href="classimpala_1_1ClientCacheHelper.html#aea87a817f89cc03e6fd1177c4363d81b">num_tries_</a>;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00163"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCacheHelper.html#aa6f05f2194e6acc7a1723ed1541ba677">  163</a></span>&#160;  <span class="keyword">const</span> <a class="code" href="classuint64__t.html">uint64_t</a> <a class="code" href="classimpala_1_1ClientCacheHelper.html#aa6f05f2194e6acc7a1723ed1541ba677">wait_ms_</a>;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00166"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCacheHelper.html#aaa00024d1bc2bd1b114f917f7b067e8f">  166</a></span>&#160;  <span class="keyword">const</span> int32_t <a class="code" href="classimpala_1_1ClientCacheHelper.html#aaa00024d1bc2bd1b114f917f7b067e8f">send_timeout_ms_</a>;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div>
<div class="line"><a name="l00169"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCacheHelper.html#a8bed620b75773576dbb4ae5f76b23350">  169</a></span>&#160;  <span class="keyword">const</span> int32_t <a class="code" href="classimpala_1_1ClientCacheHelper.html#a8bed620b75773576dbb4ae5f76b23350">recv_timeout_ms_</a>;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div>
<div class="line"><a name="l00173"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCacheHelper.html#a72626f83388532e065e9f37b9e73e1e2">  173</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classimpala_1_1ClientCacheHelper.html#a72626f83388532e065e9f37b9e73e1e2">metrics_enabled_</a>;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div>
<div class="line"><a name="l00176"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCacheHelper.html#a2cd7d0a889c3b3fa9dc6f9c6a4458e81">  176</a></span>&#160;  <a class="code" href="classIntGauge.html">IntGauge</a>* <a class="code" href="classimpala_1_1ClientCacheHelper.html#a2cd7d0a889c3b3fa9dc6f9c6a4458e81">clients_in_use_metric_</a>;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div>
<div class="line"><a name="l00179"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCacheHelper.html#ab76ef9db08fbe52cde5aa8e6850c6616">  179</a></span>&#160;  <a class="code" href="classIntGauge.html">IntGauge</a>* <a class="code" href="classimpala_1_1ClientCacheHelper.html#ab76ef9db08fbe52cde5aa8e6850c6616">total_clients_metric_</a>;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1ClientCacheHelper.html#a450ceb70e00125f966fb929b327aa4c9">CreateClient</a>(<span class="keyword">const</span> TNetworkAddress&amp; address, <a class="code" href="classimpala_1_1ClientCacheHelper.html#a4da1ac222ceff2be3f798650fc4d48f9">ClientFactory</a> factory_method,</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      <a class="code" href="namespaceimpala.html#af882a84ad40478dc121a6bf6dc27f201">ClientKey</a>* client_key);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;};</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div>
<div class="line"><a name="l00187"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCache.html">  187</a></span>&#160;<span class="keyword">class </span><a class="code" href="classimpala_1_1ClientCache.html">ClientCache</a>;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div>
<div class="line"><a name="l00192"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientConnection.html">  192</a></span>&#160;<span class="keyword">class </span><a class="code" href="classimpala_1_1ClientConnection.html">ClientConnection</a> {</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160; <span class="keyword">public</span>:</div>
<div class="line"><a name="l00194"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientConnection.html#a35b0edee652706214982dcee56cd8f9f">  194</a></span>&#160;  <a class="code" href="classimpala_1_1ClientConnection.html#a35b0edee652706214982dcee56cd8f9f">ClientConnection</a>(<a class="code" href="classimpala_1_1ClientCache.html">ClientCache&lt;T&gt;</a>* client_cache, TNetworkAddress address, <a class="code" href="classimpala_1_1Status.html">Status</a>* status)</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    : <a class="code" href="classimpala_1_1ClientConnection.html#a092a59746aadb928b3ccc26b66a7fd5f">client_cache_</a>(client_cache), <a class="code" href="classimpala_1_1ClientConnection.html#a88ea5f4750162d4b5ecb3755b7f2337c">client_</a>(NULL) {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    *status = <a class="code" href="classimpala_1_1ClientConnection.html#a092a59746aadb928b3ccc26b66a7fd5f">client_cache_</a>-&gt;GetClient(address, &amp;<a class="code" href="classimpala_1_1ClientConnection.html#a88ea5f4750162d4b5ecb3755b7f2337c">client_</a>);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordflow">if</span> (status-&gt;<a class="code" href="classimpala_1_1Status.html#a95ba859e42fe93445b340533220836ac">ok</a>()) DCHECK(<a class="code" href="classimpala_1_1ClientConnection.html#a88ea5f4750162d4b5ecb3755b7f2337c">client_</a> != NULL);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  }</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div>
<div class="line"><a name="l00200"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientConnection.html#afdf1b1792c5226ccf3fc65466bcb2b5d">  200</a></span>&#160;  <a class="code" href="classimpala_1_1ClientConnection.html#afdf1b1792c5226ccf3fc65466bcb2b5d">~ClientConnection</a>() {</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1ClientConnection.html#a88ea5f4750162d4b5ecb3755b7f2337c">client_</a> != NULL) {</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <a class="code" href="classimpala_1_1ClientConnection.html#a092a59746aadb928b3ccc26b66a7fd5f">client_cache_</a>-&gt;ReleaseClient(&amp;<a class="code" href="classimpala_1_1ClientConnection.html#a88ea5f4750162d4b5ecb3755b7f2337c">client_</a>);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    }</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div>
<div class="line"><a name="l00206"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientConnection.html#ab28477796aa06b51421e2a48c126a804">  206</a></span>&#160;  <a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1ClientConnection.html#ab28477796aa06b51421e2a48c126a804">Reopen</a>() {</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1ClientConnection.html#a092a59746aadb928b3ccc26b66a7fd5f">client_cache_</a>-&gt;ReopenClient(&amp;<a class="code" href="classimpala_1_1ClientConnection.html#a88ea5f4750162d4b5ecb3755b7f2337c">client_</a>);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  }</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientConnection.html#a69d7e6e3b8f61ffd562b979798af3af3">  210</a></span>&#160;  T* <a class="code" href="classimpala_1_1ClientConnection.html#a69d7e6e3b8f61ffd562b979798af3af3">operator-&gt;</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1ClientConnection.html#a88ea5f4750162d4b5ecb3755b7f2337c">client_</a>; }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment"></span>  <span class="comment">//</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment"></span>  <span class="keyword">template</span> &lt;<span class="keyword">class</span> F, <span class="keyword">class</span> Request, <span class="keyword">class</span> Response&gt;</div>
<div class="line"><a name="l00225"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientConnection.html#aadbbddffff691a67309e0e2f784134ce">  225</a></span>&#160;  <a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1ClientConnection.html#aadbbddffff691a67309e0e2f784134ce">DoRpc</a>(<span class="keyword">const</span> F&amp; f, <span class="keyword">const</span> Request&amp; request, Response* response) {</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    DCHECK(response != NULL);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      (<a class="code" href="classimpala_1_1ClientConnection.html#a88ea5f4750162d4b5ecb3755b7f2337c">client_</a>-&gt;*f)(*response, request);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> apache::thrift::TException&amp; e) {</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespaceimpala.html#acc5c54e3d87f8b4910b59dcc2bf24629">IsTimeoutTException</a>(e)) <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html">Status</a>(TErrorCode::RPC_TIMEOUT);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      <span class="comment">// Client may have unexpectedly been closed, so re-open and retry.</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      <span class="comment">// TODO: ThriftClient should return proper error codes.</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1ClientConnection.html#ab28477796aa06b51421e2a48c126a804">Reopen</a>());</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        (<a class="code" href="classimpala_1_1ClientConnection.html#a88ea5f4750162d4b5ecb3755b7f2337c">client_</a>-&gt;*f)(*response, request);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      } <span class="keywordflow">catch</span> (apache::thrift::TException&amp; e) {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="comment">// By this point the RPC really has failed.</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html">Status</a>(TErrorCode::RPC_GENERAL_ERROR, e.what());</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      }</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  }</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160; <span class="keyword">private</span>:</div>
<div class="line"><a name="l00246"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientConnection.html#a092a59746aadb928b3ccc26b66a7fd5f">  246</a></span>&#160;  <a class="code" href="classimpala_1_1ClientCache.html">ClientCache&lt;T&gt;</a>* <a class="code" href="classimpala_1_1ClientConnection.html#a092a59746aadb928b3ccc26b66a7fd5f">client_cache_</a>;</div>
<div class="line"><a name="l00247"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientConnection.html#a88ea5f4750162d4b5ecb3755b7f2337c">  247</a></span>&#160;  T* <a class="code" href="classimpala_1_1ClientConnection.html#a88ea5f4750162d4b5ecb3755b7f2337c">client_</a>;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;};</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="keyword">class </span><a class="code" href="classimpala_1_1ClientCache.html">ClientCache</a> {</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160; <span class="keyword">public</span>:</div>
<div class="line"><a name="l00255"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCache.html#adfa5270c52ca179fa3efdc4e834c0a8e">  255</a></span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classimpala_1_1ThriftClient.html">ThriftClient&lt;T&gt;</a> <a class="code" href="classimpala_1_1ClientCache.html#adfa5270c52ca179fa3efdc4e834c0a8e">Client</a>;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div>
<div class="line"><a name="l00257"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCache.html#ab08d932e3cab2f83c79cf1b1a9c58dbc">  257</a></span>&#160;  <a class="code" href="classimpala_1_1ClientCache.html#ab08d932e3cab2f83c79cf1b1a9c58dbc">ClientCache</a>(<span class="keyword">const</span> std::string&amp; service_name = <span class="stringliteral">&quot;&quot;</span>) : <a class="code" href="classimpala_1_1ClientCache.html#ac1210f0837d2383a9b0c86f39db53c13">client_cache_helper_</a>(1, 0, 0, 0) {</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <a class="code" href="classimpala_1_1ClientCache.html#a5ef195971ac28f5a53fb1d67310f0a74">client_factory_</a> = boost::bind&lt;ThriftClientImpl*&gt;(</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        boost::mem_fn(&amp;<a class="code" href="classimpala_1_1ClientCache.html#a47152dda080cb7493c714685b2bcf7bf">ClientCache::MakeClient</a>), <span class="keyword">this</span>, _1, _2, service_name);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div>
<div class="line"><a name="l00266"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCache.html#ab83f3198189d24071974acf294bea2af">  266</a></span>&#160;  <a class="code" href="classimpala_1_1ClientCache.html#ab83f3198189d24071974acf294bea2af">ClientCache</a>(uint32_t num_tries, <a class="code" href="classuint64__t.html">uint64_t</a> wait_ms, int32_t send_timeout_ms = 0,</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      int32_t recv_timeout_ms = 0, <span class="keyword">const</span> std::string&amp; service_name = <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      : <a class="code" href="classimpala_1_1ClientCache.html#ac1210f0837d2383a9b0c86f39db53c13">client_cache_helper_</a>(num_tries, wait_ms, send_timeout_ms, recv_timeout_ms) {</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <a class="code" href="classimpala_1_1ClientCache.html#a5ef195971ac28f5a53fb1d67310f0a74">client_factory_</a> =</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        boost::bind&lt;ThriftClientImpl*&gt;(</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            boost::mem_fn(&amp;<a class="code" href="classimpala_1_1ClientCache.html#a47152dda080cb7493c714685b2bcf7bf">ClientCache::MakeClient</a>), <span class="keyword">this</span>, _1, _2, service_name);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  }</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div>
<div class="line"><a name="l00277"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCache.html#af0f449c7985d09b5a0510d5e972cab3f">  277</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classimpala_1_1ClientCache.html#af0f449c7985d09b5a0510d5e972cab3f">CloseConnections</a>(<span class="keyword">const</span> TNetworkAddress&amp; address) {</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1ClientCache.html#ac1210f0837d2383a9b0c86f39db53c13">client_cache_helper_</a>.<a class="code" href="classimpala_1_1ClientCacheHelper.html#a216d1682a3075523b67ecc506db12ba2">CloseConnections</a>(address);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  }</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div>
<div class="line"><a name="l00282"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCache.html#a3ba5936d5d54e5cf4a4aca953d6dc50d">  282</a></span>&#160;  std::string <a class="code" href="classimpala_1_1ClientCache.html#a3ba5936d5d54e5cf4a4aca953d6dc50d">DebugString</a>() {</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1ClientCache.html#ac1210f0837d2383a9b0c86f39db53c13">client_cache_helper_</a>.<a class="code" href="classimpala_1_1ClientCacheHelper.html#a2ff1124846a1e27106bb2ad47dfc7c37">DebugString</a>();</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  }</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div>
<div class="line"><a name="l00287"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCache.html#a8f13cf7cc55cadae632ec2d7801731b5">  287</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classimpala_1_1ClientCache.html#a8f13cf7cc55cadae632ec2d7801731b5">TestShutdown</a>() {</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1ClientCache.html#ac1210f0837d2383a9b0c86f39db53c13">client_cache_helper_</a>.<a class="code" href="classimpala_1_1ClientCacheHelper.html#a0633abad539e0ed6881e31ed209967a1">TestShutdown</a>();</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div>
<div class="line"><a name="l00295"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCache.html#a25db141e8b489deccf75b4bce1d6d691">  295</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classimpala_1_1ClientCache.html#a25db141e8b489deccf75b4bce1d6d691">InitMetrics</a>(<a class="code" href="classimpala_1_1MetricGroup.html">MetricGroup</a>* metrics, <span class="keyword">const</span> std::string&amp; key_prefix) {</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <a class="code" href="classimpala_1_1ClientCache.html#ac1210f0837d2383a9b0c86f39db53c13">client_cache_helper_</a>.<a class="code" href="classimpala_1_1ClientCacheHelper.html#a655a4878f988d44bb8f0e782d2b49b51">InitMetrics</a>(metrics, key_prefix);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  }</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160; <span class="keyword">private</span>:</div>
<div class="line"><a name="l00300"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCache.html#af1a69f4f23afc0ec73a917f0c9161b8d">  300</a></span>&#160;  <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classimpala_1_1ClientConnection.html">ClientConnection</a>&lt;T&gt;;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div>
<div class="line"><a name="l00305"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCache.html#ac1210f0837d2383a9b0c86f39db53c13">  305</a></span>&#160;  <a class="code" href="classimpala_1_1ClientCacheHelper.html">ClientCacheHelper</a> <a class="code" href="classimpala_1_1ClientCache.html#ac1210f0837d2383a9b0c86f39db53c13">client_cache_helper_</a>;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div>
<div class="line"><a name="l00308"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCache.html#a5ef195971ac28f5a53fb1d67310f0a74">  308</a></span>&#160;  <a class="code" href="classimpala_1_1ClientCacheHelper.html#a4da1ac222ceff2be3f798650fc4d48f9">ClientCacheHelper::ClientFactory</a> <a class="code" href="classimpala_1_1ClientCache.html#a5ef195971ac28f5a53fb1d67310f0a74">client_factory_</a>;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div>
<div class="line"><a name="l00313"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCache.html#ad29c93a8e207484ad1b4de16146fcb09">  313</a></span>&#160;  <a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1ClientCache.html#ad29c93a8e207484ad1b4de16146fcb09">GetClient</a>(<span class="keyword">const</span> TNetworkAddress&amp; address, T** iface) {</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1ClientCache.html#ac1210f0837d2383a9b0c86f39db53c13">client_cache_helper_</a>.<a class="code" href="classimpala_1_1ClientCacheHelper.html#a866e9a0ba17a9812cb2ceafbbef183d4">GetClient</a>(address, <a class="code" href="classimpala_1_1ClientCache.html#a5ef195971ac28f5a53fb1d67310f0a74">client_factory_</a>,</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        reinterpret_cast&lt;ClientKey*&gt;(iface));</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  }</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div>
<div class="line"><a name="l00322"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCache.html#a8005c9935ea7f7a894a4e3cd57312905">  322</a></span>&#160;  <a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1ClientCache.html#a8005c9935ea7f7a894a4e3cd57312905">ReopenClient</a>(T** client) {</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1ClientCache.html#ac1210f0837d2383a9b0c86f39db53c13">client_cache_helper_</a>.<a class="code" href="classimpala_1_1ClientCacheHelper.html#ad0d2e8780d700174f9fa8e8cac83b4b2">ReopenClient</a>(<a class="code" href="classimpala_1_1ClientCache.html#a5ef195971ac28f5a53fb1d67310f0a74">client_factory_</a>,</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        reinterpret_cast&lt;ClientKey*&gt;(client));</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div>
<div class="line"><a name="l00328"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCache.html#aebe6a2f7a7403cbb32bc9a6d22823688">  328</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classimpala_1_1ClientCache.html#aebe6a2f7a7403cbb32bc9a6d22823688">ReleaseClient</a>(T** client) {</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1ClientCache.html#ac1210f0837d2383a9b0c86f39db53c13">client_cache_helper_</a>.<a class="code" href="classimpala_1_1ClientCacheHelper.html#a952813bed7ba0ad4d5ac212d6b412855">ReleaseClient</a>(reinterpret_cast&lt;ClientKey*&gt;(client));</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  }</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div>
<div class="line"><a name="l00333"></a><span class="lineno"><a class="line" href="classimpala_1_1ClientCache.html#a47152dda080cb7493c714685b2bcf7bf">  333</a></span>&#160;  <a class="code" href="classimpala_1_1ThriftClientImpl.html">ThriftClientImpl</a>* <a class="code" href="classimpala_1_1ClientCache.html#a47152dda080cb7493c714685b2bcf7bf">MakeClient</a>(<span class="keyword">const</span> TNetworkAddress&amp; address, <a class="code" href="namespaceimpala.html#af882a84ad40478dc121a6bf6dc27f201">ClientKey</a>* client_key,</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      <span class="keyword">const</span> std::string service_name) {</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <a class="code" href="classimpala_1_1ThriftClient.html">Client</a>* client = <span class="keyword">new</span> <a class="code" href="classimpala_1_1ClientCache.html#adfa5270c52ca179fa3efdc4e834c0a8e">Client</a>(address.hostname, address.port, service_name);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    *client_key = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="namespaceimpala.html#af882a84ad40478dc121a6bf6dc27f201">ClientKey</a><span class="keyword">&gt;</span>(client-&gt;<a class="code" href="classimpala_1_1ThriftClient.html#a58300f8e4bf4bc5e29d6cd2073a47d3a">iface</a>());</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keywordflow">return</span> client;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  }</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;};</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div>
<div class="line"><a name="l00344"></a><span class="lineno"><a class="line" href="namespaceimpala.html#a1fc5524825481c1a55604ebda19418c4">  344</a></span>&#160;<span class="keyword">class </span>ImpalaInternalServiceClient;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="keyword">typedef</span> <a class="code" href="classimpala_1_1ClientCache.html">ClientCache&lt;ImpalaInternalServiceClient&gt;</a> <a class="code" href="namespaceimpala.html#a1fc5524825481c1a55604ebda19418c4">ImpalaInternalServiceClientCache</a>;</div>
<div class="line"><a name="l00346"></a><span class="lineno"><a class="line" href="namespaceimpala.html#a5d79ffeb06ab02bf3083bfa1eb45d878">  346</a></span>&#160;<span class="keyword">typedef</span> <a class="code" href="classimpala_1_1ClientConnection.html">ClientConnection&lt;ImpalaInternalServiceClient&gt;</a> <a class="code" href="namespaceimpala.html#a5d79ffeb06ab02bf3083bfa1eb45d878">ImpalaInternalServiceConnection</a>;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div>
<div class="line"><a name="l00348"></a><span class="lineno"><a class="line" href="namespaceimpala.html#ad5ddfbe9470db806dfc4db1d10c8c81d">  348</a></span>&#160;<span class="keyword">class </span>CatalogServiceClient;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="keyword">typedef</span> <a class="code" href="classimpala_1_1ClientCache.html">ClientCache&lt;CatalogServiceClient&gt;</a> <a class="code" href="namespaceimpala.html#ad5ddfbe9470db806dfc4db1d10c8c81d">CatalogServiceClientCache</a>;</div>
<div class="line"><a name="l00350"></a><span class="lineno"><a class="line" href="namespaceimpala.html#aa1258356aa2b9ecc06f7ed195ea3afb3">  350</a></span>&#160;<span class="keyword">typedef</span> <a class="code" href="classimpala_1_1ClientConnection.html">ClientConnection&lt;CatalogServiceClient&gt;</a> <a class="code" href="namespaceimpala.html#aa1258356aa2b9ecc06f7ed195ea3afb3">CatalogServiceConnection</a>;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;}</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="ttc" id="classimpala_1_1ClientCacheHelper_html_aa6f05f2194e6acc7a1723ed1541ba677"><div class="ttname"><a href="classimpala_1_1ClientCacheHelper.html#aa6f05f2194e6acc7a1723ed1541ba677">impala::ClientCacheHelper::wait_ms_</a></div><div class="ttdeci">const uint64_t wait_ms_</div><div class="ttdoc">Time to wait between failed connection attempts. </div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00163">client-cache.h:163</a></div></div>
<div class="ttc" id="classimpala_1_1ClientConnection_html_ab28477796aa06b51421e2a48c126a804"><div class="ttname"><a href="classimpala_1_1ClientConnection.html#ab28477796aa06b51421e2a48c126a804">impala::ClientConnection::Reopen</a></div><div class="ttdeci">Status Reopen()</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00206">client-cache.h:206</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCacheHelper_html_ad0d2e8780d700174f9fa8e8cac83b4b2"><div class="ttname"><a href="classimpala_1_1ClientCacheHelper.html#ad0d2e8780d700174f9fa8e8cac83b4b2">impala::ClientCacheHelper::ReopenClient</a></div><div class="ttdeci">Status ReopenClient(ClientFactory factory_method, ClientKey *client_key)</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8cc_source.html#l00068">client-cache.cc:68</a></div></div>
<div class="ttc" id="namespaceimpala_html_af882a84ad40478dc121a6bf6dc27f201"><div class="ttname"><a href="namespaceimpala.html#af882a84ad40478dc121a6bf6dc27f201">impala::ClientKey</a></div><div class="ttdeci">void * ClientKey</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00035">client-cache.h:35</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCacheHelper_html_a4da1ac222ceff2be3f798650fc4d48f9"><div class="ttname"><a href="classimpala_1_1ClientCacheHelper.html#a4da1ac222ceff2be3f798650fc4d48f9">impala::ClientCacheHelper::ClientFactory</a></div><div class="ttdeci">boost::function&lt; ThriftClientImpl *(const TNetworkAddress &amp;address, ClientKey *client_key)&gt; ClientFactory</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00068">client-cache.h:68</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCache_html_ad29c93a8e207484ad1b4de16146fcb09"><div class="ttname"><a href="classimpala_1_1ClientCache.html#ad29c93a8e207484ad1b4de16146fcb09">impala::ClientCache::GetClient</a></div><div class="ttdeci">Status GetClient(const TNetworkAddress &amp;address, T **iface)</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00313">client-cache.h:313</a></div></div>
<div class="ttc" id="structimpala_1_1ClientCacheHelper_1_1PerHostCache_html_af7a7d77f629823f29e9718e762d92ad4"><div class="ttname"><a href="structimpala_1_1ClientCacheHelper_1_1PerHostCache.html#af7a7d77f629823f29e9718e762d92ad4">impala::ClientCacheHelper::PerHostCache::lock</a></div><div class="ttdeci">boost::mutex lock</div><div class="ttdoc">Protects clients. </div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00133">client-cache.h:133</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCache_html_a8f13cf7cc55cadae632ec2d7801731b5"><div class="ttname"><a href="classimpala_1_1ClientCache.html#a8f13cf7cc55cadae632ec2d7801731b5">impala::ClientCache::TestShutdown</a></div><div class="ttdeci">void TestShutdown()</div><div class="ttdoc">For testing only: shutdown all clients. </div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00287">client-cache.h:287</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCacheHelper_html_aa5a49cf4968695cbf24f1b83ffbc61fc"><div class="ttname"><a href="classimpala_1_1ClientCacheHelper.html#aa5a49cf4968695cbf24f1b83ffbc61fc">impala::ClientCacheHelper::ClientMap</a></div><div class="ttdeci">std::map&lt; ClientKey, boost::shared_ptr&lt; ThriftClientImpl &gt; &gt; ClientMap</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00156">client-cache.h:156</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCache_html_a25db141e8b489deccf75b4bce1d6d691"><div class="ttname"><a href="classimpala_1_1ClientCache.html#a25db141e8b489deccf75b4bce1d6d691">impala::ClientCache::InitMetrics</a></div><div class="ttdeci">void InitMetrics(MetricGroup *metrics, const std::string &amp;key_prefix)</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00295">client-cache.h:295</a></div></div>
<div class="ttc" id="classIntGauge_html"><div class="ttname"><a href="classIntGauge.html">IntGauge</a></div></div>
<div class="ttc" id="namespaceimpala_html_aa1258356aa2b9ecc06f7ed195ea3afb3"><div class="ttname"><a href="namespaceimpala.html#aa1258356aa2b9ecc06f7ed195ea3afb3">impala::CatalogServiceConnection</a></div><div class="ttdeci">ClientConnection&lt; CatalogServiceClient &gt; CatalogServiceConnection</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00350">client-cache.h:350</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCacheHelper_html_a368c998c61f2e401c891358fa2474904"><div class="ttname"><a href="classimpala_1_1ClientCacheHelper.html#a368c998c61f2e401c891358fa2474904">impala::ClientCacheHelper::client_map_</a></div><div class="ttdeci">ClientMap client_map_</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00157">client-cache.h:157</a></div></div>
<div class="ttc" id="classimpala_1_1ClientConnection_html"><div class="ttname"><a href="classimpala_1_1ClientConnection.html">impala::ClientConnection</a></div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00192">client-cache.h:192</a></div></div>
<div class="ttc" id="classimpala_1_1ThriftClient_html"><div class="ttname"><a href="classimpala_1_1ThriftClient.html">impala::ThriftClient</a></div><div class="ttdef"><b>Definition:</b> <a href="thrift-client_8h_source.html#l00100">thrift-client.h:100</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCacheHelper_html_a952813bed7ba0ad4d5ac212d6b412855"><div class="ttname"><a href="classimpala_1_1ClientCacheHelper.html#a952813bed7ba0ad4d5ac212d6b412855">impala::ClientCacheHelper::ReleaseClient</a></div><div class="ttdeci">void ReleaseClient(ClientKey *client_key)</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8cc_source.html#l00127">client-cache.cc:127</a></div></div>
<div class="ttc" id="status_8h_html_a85f7d0e774e15eb35b74f53264305e16"><div class="ttname"><a href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a></div><div class="ttdeci">#define RETURN_IF_ERROR(stmt)</div><div class="ttdoc">some generally useful macros </div><div class="ttdef"><b>Definition:</b> <a href="status_8h_source.html#l00242">status.h:242</a></div></div>
<div class="ttc" id="classimpala_1_1ThriftClient_html_a58300f8e4bf4bc5e29d6cd2073a47d3a"><div class="ttname"><a href="classimpala_1_1ThriftClient.html#a58300f8e4bf4bc5e29d6cd2073a47d3a">impala::ThriftClient::iface</a></div><div class="ttdeci">InterfaceType * iface()</div><div class="ttdoc">Returns the object used to actually make RPCs against the remote server. </div><div class="ttdef"><b>Definition:</b> <a href="thrift-client_8h_source.html#l00114">thrift-client.h:114</a></div></div>
<div class="ttc" id="classimpala_1_1MetricGroup_html"><div class="ttname"><a href="classimpala_1_1MetricGroup.html">impala::MetricGroup</a></div><div class="ttdoc">MetricGroups may be organised hierarchically as a tree. </div><div class="ttdef"><b>Definition:</b> <a href="metrics_8h_source.html#l00200">metrics.h:200</a></div></div>
<div class="ttc" id="classimpala_1_1ClientConnection_html_afdf1b1792c5226ccf3fc65466bcb2b5d"><div class="ttname"><a href="classimpala_1_1ClientConnection.html#afdf1b1792c5226ccf3fc65466bcb2b5d">impala::ClientConnection::~ClientConnection</a></div><div class="ttdeci">~ClientConnection()</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00200">client-cache.h:200</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCacheHelper_html_aea87a817f89cc03e6fd1177c4363d81b"><div class="ttname"><a href="classimpala_1_1ClientCacheHelper.html#aea87a817f89cc03e6fd1177c4363d81b">impala::ClientCacheHelper::num_tries_</a></div><div class="ttdeci">const uint32_t num_tries_</div><div class="ttdoc">Number of attempts to make to open a connection. 0 means retry indefinitely. </div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00160">client-cache.h:160</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCache_html_a47152dda080cb7493c714685b2bcf7bf"><div class="ttname"><a href="classimpala_1_1ClientCache.html#a47152dda080cb7493c714685b2bcf7bf">impala::ClientCache::MakeClient</a></div><div class="ttdeci">ThriftClientImpl * MakeClient(const TNetworkAddress &amp;address, ClientKey *client_key, const std::string service_name)</div><div class="ttdoc">Factory method to produce a new ThriftClient&lt;T&gt; for the wrapped cache. </div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00333">client-cache.h:333</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCacheHelper_html_af32d280bf9948b02f2ae6f390ccc5277"><div class="ttname"><a href="classimpala_1_1ClientCacheHelper.html#af32d280bf9948b02f2ae6f390ccc5277">impala::ClientCacheHelper::client_map_lock_</a></div><div class="ttdeci">boost::mutex client_map_lock_</div><div class="ttdoc">Protects client_map_. </div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00150">client-cache.h:150</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCacheHelper_html_ab76ef9db08fbe52cde5aa8e6850c6616"><div class="ttname"><a href="classimpala_1_1ClientCacheHelper.html#ab76ef9db08fbe52cde5aa8e6850c6616">impala::ClientCacheHelper::total_clients_metric_</a></div><div class="ttdeci">IntGauge * total_clients_metric_</div><div class="ttdoc">Total clients in the cache, including those in use. </div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00179">client-cache.h:179</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCache_html_ac1210f0837d2383a9b0c86f39db53c13"><div class="ttname"><a href="classimpala_1_1ClientCache.html#ac1210f0837d2383a9b0c86f39db53c13">impala::ClientCache::client_cache_helper_</a></div><div class="ttdeci">ClientCacheHelper client_cache_helper_</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00305">client-cache.h:305</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCacheHelper_html_a866e9a0ba17a9812cb2ceafbbef183d4"><div class="ttname"><a href="classimpala_1_1ClientCacheHelper.html#a866e9a0ba17a9812cb2ceafbbef183d4">impala::ClientCacheHelper::GetClient</a></div><div class="ttdeci">Status GetClient(const TNetworkAddress &amp;address, ClientFactory factory_method, ClientKey *client_key)</div><div class="ttdoc">If there is an error creating the new client, *client_key will be NULL. </div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8cc_source.html#l00040">client-cache.cc:40</a></div></div>
<div class="ttc" id="classimpala_1_1Status_html"><div class="ttname"><a href="classimpala_1_1Status.html">impala::Status</a></div><div class="ttdef"><b>Definition:</b> <a href="status_8h_source.html#l00081">status.h:81</a></div></div>
<div class="ttc" id="namespaceimpala_html_ad5ddfbe9470db806dfc4db1d10c8c81d"><div class="ttname"><a href="namespaceimpala.html#ad5ddfbe9470db806dfc4db1d10c8c81d">impala::CatalogServiceClientCache</a></div><div class="ttdeci">ClientCache&lt; CatalogServiceClient &gt; CatalogServiceClientCache</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00348">client-cache.h:348</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCache_html_a3ba5936d5d54e5cf4a4aca953d6dc50d"><div class="ttname"><a href="classimpala_1_1ClientCache.html#a3ba5936d5d54e5cf4a4aca953d6dc50d">impala::ClientCache::DebugString</a></div><div class="ttdeci">std::string DebugString()</div><div class="ttdoc">Helper method which returns a debug string. </div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00282">client-cache.h:282</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCacheHelper_html_a2cd7d0a889c3b3fa9dc6f9c6a4458e81"><div class="ttname"><a href="classimpala_1_1ClientCacheHelper.html#a2cd7d0a889c3b3fa9dc6f9c6a4458e81">impala::ClientCacheHelper::clients_in_use_metric_</a></div><div class="ttdeci">IntGauge * clients_in_use_metric_</div><div class="ttdoc">Number of clients &#39;checked-out&#39; from the cache. </div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00176">client-cache.h:176</a></div></div>
<div class="ttc" id="classimpala_1_1ClientConnection_html_aadbbddffff691a67309e0e2f784134ce"><div class="ttname"><a href="classimpala_1_1ClientConnection.html#aadbbddffff691a67309e0e2f784134ce">impala::ClientConnection::DoRpc</a></div><div class="ttdeci">Status DoRpc(const F &amp;f, const Request &amp;request, Response *response)</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00225">client-cache.h:225</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCache_html_ab08d932e3cab2f83c79cf1b1a9c58dbc"><div class="ttname"><a href="classimpala_1_1ClientCache.html#ab08d932e3cab2f83c79cf1b1a9c58dbc">impala::ClientCache::ClientCache</a></div><div class="ttdeci">ClientCache(const std::string &amp;service_name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00257">client-cache.h:257</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCache_html_a5ef195971ac28f5a53fb1d67310f0a74"><div class="ttname"><a href="classimpala_1_1ClientCache.html#a5ef195971ac28f5a53fb1d67310f0a74">impala::ClientCache::client_factory_</a></div><div class="ttdeci">ClientCacheHelper::ClientFactory client_factory_</div><div class="ttdoc">Function pointer, bound to MakeClient, which produces clients when the cache is empty. </div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00308">client-cache.h:308</a></div></div>
<div class="ttc" id="namespaceimpala_html_acc5c54e3d87f8b4910b59dcc2bf24629"><div class="ttname"><a href="namespaceimpala.html#acc5c54e3d87f8b4910b59dcc2bf24629">impala::IsTimeoutTException</a></div><div class="ttdeci">bool IsTimeoutTException(const TException &amp;e)</div><div class="ttdef"><b>Definition:</b> <a href="thrift-util_8cc_source.html#l00175">thrift-util.cc:175</a></div></div>
<div class="ttc" id="thrift-util_8h_html"><div class="ttname"><a href="thrift-util_8h.html">thrift-util.h</a></div></div>
<div class="ttc" id="classuint64__t_html"><div class="ttname"><a href="classuint64__t.html">uint64_t</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCache_html_adfa5270c52ca179fa3efdc4e834c0a8e"><div class="ttname"><a href="classimpala_1_1ClientCache.html#adfa5270c52ca179fa3efdc4e834c0a8e">impala::ClientCache::Client</a></div><div class="ttdeci">ThriftClient&lt; T &gt; Client</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00255">client-cache.h:255</a></div></div>
<div class="ttc" id="classimpala_1_1ThriftClientImpl_html"><div class="ttname"><a href="classimpala_1_1ThriftClientImpl.html">impala::ThriftClientImpl</a></div><div class="ttdoc">Super class for templatized thrift clients. </div><div class="ttdef"><b>Definition:</b> <a href="thrift-client_8h_source.html#l00042">thrift-client.h:42</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCacheHelper_html_aa2443d6ecc23ae8866afd0643b55a6b3"><div class="ttname"><a href="classimpala_1_1ClientCacheHelper.html#aa2443d6ecc23ae8866afd0643b55a6b3">impala::ClientCacheHelper::per_host_caches_</a></div><div class="ttdeci">PerHostCacheMap per_host_caches_</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00147">client-cache.h:147</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCache_html_ab83f3198189d24071974acf294bea2af"><div class="ttname"><a href="classimpala_1_1ClientCache.html#ab83f3198189d24071974acf294bea2af">impala::ClientCache::ClientCache</a></div><div class="ttdeci">ClientCache(uint32_t num_tries, uint64_t wait_ms, int32_t send_timeout_ms=0, int32_t recv_timeout_ms=0, const std::string &amp;service_name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00266">client-cache.h:266</a></div></div>
<div class="ttc" id="status_8h_html"><div class="ttname"><a href="status_8h.html">status.h</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCache_html_aebe6a2f7a7403cbb32bc9a6d22823688"><div class="ttname"><a href="classimpala_1_1ClientCache.html#aebe6a2f7a7403cbb32bc9a6d22823688">impala::ClientCache::ReleaseClient</a></div><div class="ttdeci">void ReleaseClient(T **client)</div><div class="ttdoc">Return the client to the cache and set *client to NULL. </div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00328">client-cache.h:328</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCacheHelper_html_aaa00024d1bc2bd1b114f917f7b067e8f"><div class="ttname"><a href="classimpala_1_1ClientCacheHelper.html#aaa00024d1bc2bd1b114f917f7b067e8f">impala::ClientCacheHelper::send_timeout_ms_</a></div><div class="ttdeci">const int32_t send_timeout_ms_</div><div class="ttdoc">Time to wait for the underlying socket to send data, e.g., for an RPC. </div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00166">client-cache.h:166</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCacheHelper_html_a2ff1124846a1e27106bb2ad47dfc7c37"><div class="ttname"><a href="classimpala_1_1ClientCacheHelper.html#a2ff1124846a1e27106bb2ad47dfc7c37">impala::ClientCacheHelper::DebugString</a></div><div class="ttdeci">std::string DebugString()</div><div class="ttdoc">Return a debug representation of the contents of this cache. </div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8cc_source.html#l00170">client-cache.cc:170</a></div></div>
<div class="ttc" id="classimpala_1_1Status_html_a580565665ea944eb64f3f495b1bee1e0"><div class="ttname"><a href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">impala::Status::OK</a></div><div class="ttdeci">static const Status OK</div><div class="ttdef"><b>Definition:</b> <a href="status_8h_source.html#l00087">status.h:87</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCacheHelper_html_a0633abad539e0ed6881e31ed209967a1"><div class="ttname"><a href="classimpala_1_1ClientCacheHelper.html#a0633abad539e0ed6881e31ed209967a1">impala::ClientCacheHelper::TestShutdown</a></div><div class="ttdeci">void TestShutdown()</div><div class="ttdoc">Closes every connection in the cache. Used only for testing. </div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8cc_source.html#l00186">client-cache.cc:186</a></div></div>
<div class="ttc" id="structimpala_1_1ClientCacheHelper_1_1PerHostCache_html_adcf91f5299862d703e29fc232198306d"><div class="ttname"><a href="structimpala_1_1ClientCacheHelper_1_1PerHostCache.html#adcf91f5299862d703e29fc232198306d">impala::ClientCacheHelper::PerHostCache::clients</a></div><div class="ttdeci">std::list&lt; ClientKey &gt; clients</div><div class="ttdoc">List of client keys for this entry&#39;s host. </div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00136">client-cache.h:136</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCacheHelper_html_a216d1682a3075523b67ecc506db12ba2"><div class="ttname"><a href="classimpala_1_1ClientCacheHelper.html#a216d1682a3075523b67ecc506db12ba2">impala::ClientCacheHelper::CloseConnections</a></div><div class="ttdeci">void CloseConnections(const TNetworkAddress &amp;address)</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8cc_source.html#l00148">client-cache.cc:148</a></div></div>
<div class="ttc" id="classimpala_1_1ClientConnection_html_a88ea5f4750162d4b5ecb3755b7f2337c"><div class="ttname"><a href="classimpala_1_1ClientConnection.html#a88ea5f4750162d4b5ecb3755b7f2337c">impala::ClientConnection::client_</a></div><div class="ttdeci">T * client_</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00247">client-cache.h:247</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCacheHelper_html_a450ceb70e00125f966fb929b327aa4c9"><div class="ttname"><a href="classimpala_1_1ClientCacheHelper.html#a450ceb70e00125f966fb929b327aa4c9">impala::ClientCacheHelper::CreateClient</a></div><div class="ttdeci">Status CreateClient(const TNetworkAddress &amp;address, ClientFactory factory_method, ClientKey *client_key)</div><div class="ttdoc">Create a new client for specific address in &#39;client&#39; and put it in client_map_. </div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8cc_source.html#l00104">client-cache.cc:104</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCache_html_af0f449c7985d09b5a0510d5e972cab3f"><div class="ttname"><a href="classimpala_1_1ClientCache.html#af0f449c7985d09b5a0510d5e972cab3f">impala::ClientCache::CloseConnections</a></div><div class="ttdeci">void CloseConnections(const TNetworkAddress &amp;address)</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00277">client-cache.h:277</a></div></div>
<div class="ttc" id="namespaceimpala_html_a5d79ffeb06ab02bf3083bfa1eb45d878"><div class="ttname"><a href="namespaceimpala.html#a5d79ffeb06ab02bf3083bfa1eb45d878">impala::ImpalaInternalServiceConnection</a></div><div class="ttdeci">ClientConnection&lt; ImpalaInternalServiceClient &gt; ImpalaInternalServiceConnection</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00346">client-cache.h:346</a></div></div>
<div class="ttc" id="thrift-client_8h_html"><div class="ttname"><a href="thrift-client_8h.html">thrift-client.h</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCache_html"><div class="ttname"><a href="classimpala_1_1ClientCache.html">impala::ClientCache</a></div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00187">client-cache.h:187</a></div></div>
<div class="ttc" id="classimpala_1_1Status_html_a95ba859e42fe93445b340533220836ac"><div class="ttname"><a href="classimpala_1_1Status.html#a95ba859e42fe93445b340533220836ac">impala::Status::ok</a></div><div class="ttdeci">bool ok() const </div><div class="ttdef"><b>Definition:</b> <a href="status_8h_source.html#l00172">status.h:172</a></div></div>
<div class="ttc" id="classimpala_1_1ClientConnection_html_a69d7e6e3b8f61ffd562b979798af3af3"><div class="ttname"><a href="classimpala_1_1ClientConnection.html#a69d7e6e3b8f61ffd562b979798af3af3">impala::ClientConnection::operator-&gt;</a></div><div class="ttdeci">T * operator-&gt;() const </div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00210">client-cache.h:210</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCacheHelper_html_a7f28c5c2ecae44c0e5d6f2d73b05e6f6"><div class="ttname"><a href="classimpala_1_1ClientCacheHelper.html#a7f28c5c2ecae44c0e5d6f2d73b05e6f6">impala::ClientCacheHelper::cache_lock_</a></div><div class="ttdeci">boost::mutex cache_lock_</div><div class="ttdoc">Protects per_host_caches_. </div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00140">client-cache.h:140</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCache_html_a8005c9935ea7f7a894a4e3cd57312905"><div class="ttname"><a href="classimpala_1_1ClientCache.html#a8005c9935ea7f7a894a4e3cd57312905">impala::ClientCache::ReopenClient</a></div><div class="ttdeci">Status ReopenClient(T **client)</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00322">client-cache.h:322</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCacheHelper_html"><div class="ttname"><a href="classimpala_1_1ClientCacheHelper.html">impala::ClientCacheHelper</a></div><div class="ttdoc">This class is thread-safe. </div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00063">client-cache.h:63</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCacheHelper_html_a1b814cc326129a5e182341f88833a2ee"><div class="ttname"><a href="classimpala_1_1ClientCacheHelper.html#a1b814cc326129a5e182341f88833a2ee">impala::ClientCacheHelper::ClientCacheHelper</a></div><div class="ttdeci">ClientCacheHelper(uint32_t num_tries, uint64_t wait_ms, int32_t send_timeout_ms, int32_t recv_timeout_ms)</div><div class="ttdoc">Private constructor so that only ClientCache can instantiate this class. </div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00107">client-cache.h:107</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCacheHelper_html_a655a4878f988d44bb8f0e782d2b49b51"><div class="ttname"><a href="classimpala_1_1ClientCacheHelper.html#a655a4878f988d44bb8f0e782d2b49b51">impala::ClientCacheHelper::InitMetrics</a></div><div class="ttdeci">void InitMetrics(MetricGroup *metrics, const std::string &amp;key_prefix)</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8cc_source.html#l00199">client-cache.cc:199</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCacheHelper_html_a2a7dba2cc619dce959168fb5521d7cf3"><div class="ttname"><a href="classimpala_1_1ClientCacheHelper.html#a2a7dba2cc619dce959168fb5521d7cf3">impala::ClientCacheHelper::PerHostCacheMap</a></div><div class="ttdeci">boost::unordered_map&lt; TNetworkAddress, boost::shared_ptr&lt; PerHostCache &gt; &gt; PerHostCacheMap</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00146">client-cache.h:146</a></div></div>
<div class="ttc" id="structimpala_1_1ClientCacheHelper_1_1PerHostCache_html"><div class="ttname"><a href="structimpala_1_1ClientCacheHelper_1_1PerHostCache.html">impala::ClientCacheHelper::PerHostCache</a></div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00131">client-cache.h:131</a></div></div>
<div class="ttc" id="classimpala_1_1ClientConnection_html_a092a59746aadb928b3ccc26b66a7fd5f"><div class="ttname"><a href="classimpala_1_1ClientConnection.html#a092a59746aadb928b3ccc26b66a7fd5f">impala::ClientConnection::client_cache_</a></div><div class="ttdeci">ClientCache&lt; T &gt; * client_cache_</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00246">client-cache.h:246</a></div></div>
<div class="ttc" id="classimpala_1_1ClientConnection_html_a35b0edee652706214982dcee56cd8f9f"><div class="ttname"><a href="classimpala_1_1ClientConnection.html#a35b0edee652706214982dcee56cd8f9f">impala::ClientConnection::ClientConnection</a></div><div class="ttdeci">ClientConnection(ClientCache&lt; T &gt; *client_cache, TNetworkAddress address, Status *status)</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00194">client-cache.h:194</a></div></div>
<div class="ttc" id="namespaceimpala_html_a1fc5524825481c1a55604ebda19418c4"><div class="ttname"><a href="namespaceimpala.html#a1fc5524825481c1a55604ebda19418c4">impala::ImpalaInternalServiceClientCache</a></div><div class="ttdeci">ClientCache&lt; ImpalaInternalServiceClient &gt; ImpalaInternalServiceClientCache</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00344">client-cache.h:344</a></div></div>
<div class="ttc" id="metrics_8h_html"><div class="ttname"><a href="metrics_8h.html">metrics.h</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCacheHelper_html_a72626f83388532e065e9f37b9e73e1e2"><div class="ttname"><a href="classimpala_1_1ClientCacheHelper.html#a72626f83388532e065e9f37b9e73e1e2">impala::ClientCacheHelper::metrics_enabled_</a></div><div class="ttdeci">bool metrics_enabled_</div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00173">client-cache.h:173</a></div></div>
<div class="ttc" id="classimpala_1_1ClientCacheHelper_html_a8bed620b75773576dbb4ae5f76b23350"><div class="ttname"><a href="classimpala_1_1ClientCacheHelper.html#a8bed620b75773576dbb4ae5f76b23350">impala::ClientCacheHelper::recv_timeout_ms_</a></div><div class="ttdeci">const int32_t recv_timeout_ms_</div><div class="ttdoc">Time to wait for the underlying socket to receive data, e.g., for an RPC response. </div><div class="ttdef"><b>Definition:</b> <a href="client-cache_8h_source.html#l00169">client-cache.h:169</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_e5d120be6b5e8a44336cbfd013b25604.html">be</a></li><li class="navelem"><a class="el" href="dir_68cf7cafb51a962d5bc4848b83cab0de.html">src</a></li><li class="navelem"><a class="el" href="dir_1ef28ab5153adb64262182d038c65543.html">runtime</a></li><li class="navelem"><a class="el" href="client-cache_8h.html">client-cache.h</a></li>
    <li class="footer">Generated on Thu May 7 2015 16:10:36 for Impala by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
