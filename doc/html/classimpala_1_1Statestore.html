<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Impala: impala::Statestore Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Impala
   </div>
   <div id="projectbrief">Impalaistheopensource,nativeanalyticdatabaseforApacheHadoop.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classimpala_1_1Statestore.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-types">Private Types</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classimpala_1_1Statestore-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">impala::Statestore Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="statestore_8h_source.html">statestore.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for impala::Statestore:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="classimpala_1_1Statestore__coll__graph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore_1_1Subscriber.html">Subscriber</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore_1_1Topic.html">Topic</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore_1_1TopicEntry.html">TopicEntry</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:ad31bb2437024c9e3c13704fa92d58173"><td class="memItemLeft" align="right" valign="top">typedef std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#ad31bb2437024c9e3c13704fa92d58173">SubscriberId</a></td></tr>
<tr class="separator:ad31bb2437024c9e3c13704fa92d58173"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0a261a02804c62cb4b204a498e2e3ed"><td class="memItemLeft" align="right" valign="top">typedef std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#aa0a261a02804c62cb4b204a498e2e3ed">TopicId</a></td></tr>
<tr class="memdesc:aa0a261a02804c62cb4b204a498e2e3ed"><td class="mdescLeft">&#160;</td><td class="mdescRight">A TopicId uniquely identifies a single topic.  <a href="#aa0a261a02804c62cb4b204a498e2e3ed">More...</a><br/></td></tr>
<tr class="separator:aa0a261a02804c62cb4b204a498e2e3ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a148294b3de37014d88d0758da0b39f9e"><td class="memItemLeft" align="right" valign="top">typedef std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#a148294b3de37014d88d0758da0b39f9e">TopicEntryKey</a></td></tr>
<tr class="memdesc:a148294b3de37014d88d0758da0b39f9e"><td class="mdescLeft">&#160;</td><td class="mdescRight">A TopicEntryKey uniquely identifies a single entry in a topic.  <a href="#a148294b3de37014d88d0758da0b39f9e">More...</a><br/></td></tr>
<tr class="separator:a148294b3de37014d88d0758da0b39f9e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a38ad9ed600af18f86ff873b7306d84a6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#a38ad9ed600af18f86ff873b7306d84a6">Statestore</a> (<a class="el" href="classimpala_1_1MetricGroup.html">MetricGroup</a> *metrics)</td></tr>
<tr class="memdesc:a38ad9ed600af18f86ff873b7306d84a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">The only constructor; initialises member variables only.  <a href="#a38ad9ed600af18f86ff873b7306d84a6">More...</a><br/></td></tr>
<tr class="separator:a38ad9ed600af18f86ff873b7306d84a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca13dce0412db31ab857ee45bf92ca46"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classimpala_1_1Status.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#aca13dce0412db31ab857ee45bf92ca46">RegisterSubscriber</a> (const <a class="el" href="classimpala_1_1Statestore.html#ad31bb2437024c9e3c13704fa92d58173">SubscriberId</a> &amp;subscriber_id, const TNetworkAddress &amp;location, const std::vector&lt; TTopicRegistration &gt; &amp;topic_registrations, TUniqueId *registration_id)</td></tr>
<tr class="separator:aca13dce0412db31ab857ee45bf92ca46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af33307e14226476bb11ef2566e16da4c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#af33307e14226476bb11ef2566e16da4c">RegisterWebpages</a> (<a class="el" href="classimpala_1_1Webserver.html">Webserver</a> *webserver)</td></tr>
<tr class="separator:af33307e14226476bb11ef2566e16da4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8c7b9c8f5214eae08e18ff77e40b173"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classimpala_1_1Status.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#ac8c7b9c8f5214eae08e18ff77e40b173">MainLoop</a> ()</td></tr>
<tr class="memdesc:ac8c7b9c8f5214eae08e18ff77e40b173"><td class="mdescLeft">&#160;</td><td class="mdescRight">The main processing loop. Blocks until the exit flag is set.  <a href="#ac8c7b9c8f5214eae08e18ff77e40b173">More...</a><br/></td></tr>
<tr class="separator:ac8c7b9c8f5214eae08e18ff77e40b173"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed82da8a591119a7b25fa61da1274073"><td class="memItemLeft" align="right" valign="top">const boost::shared_ptr<br class="typebreak"/>
&lt; <a class="el" href="classStatestoreServiceIf.html">StatestoreServiceIf</a> &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#aed82da8a591119a7b25fa61da1274073">thrift_iface</a> () const </td></tr>
<tr class="memdesc:aed82da8a591119a7b25fa61da1274073"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the Thrift API interface that proxies requests onto the local <a class="el" href="classimpala_1_1Statestore.html">Statestore</a>.  <a href="#aed82da8a591119a7b25fa61da1274073">More...</a><br/></td></tr>
<tr class="separator:aed82da8a591119a7b25fa61da1274073"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a602378fd065152e44e7c3c1e61e6dfc9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#a602378fd065152e44e7c3c1e61e6dfc9">SetExitFlag</a> ()</td></tr>
<tr class="separator:a602378fd065152e44e7c3c1e61e6dfc9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-types"></a>
Private Types</h2></td></tr>
<tr class="memitem:a50e27d3eb1638a93dc67f0eb3c469604"><td class="memItemLeft" align="right" valign="top">typedef boost::unordered_map<br class="typebreak"/>
&lt; <a class="el" href="classimpala_1_1Statestore.html#a148294b3de37014d88d0758da0b39f9e">TopicEntryKey</a>, <a class="el" href="classimpala_1_1Statestore_1_1TopicEntry.html">TopicEntry</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#a50e27d3eb1638a93dc67f0eb3c469604">TopicEntryMap</a></td></tr>
<tr class="memdesc:a50e27d3eb1638a93dc67f0eb3c469604"><td class="mdescLeft">&#160;</td><td class="mdescRight">Map from TopicEntryKey to <a class="el" href="classimpala_1_1Statestore_1_1TopicEntry.html">TopicEntry</a>, maintained by a <a class="el" href="classimpala_1_1Statestore_1_1Topic.html">Topic</a> object.  <a href="#a50e27d3eb1638a93dc67f0eb3c469604">More...</a><br/></td></tr>
<tr class="separator:a50e27d3eb1638a93dc67f0eb3c469604"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeca08620cc2431de3037a8d9c56d4491"><td class="memItemLeft" align="right" valign="top">typedef std::map<br class="typebreak"/>
&lt; <a class="el" href="classimpala_1_1Statestore_1_1TopicEntry.html#a4bc848a4229fb6a8e906a8788e386d0a">TopicEntry::Version</a>, <br class="typebreak"/>
<a class="el" href="classimpala_1_1Statestore.html#a148294b3de37014d88d0758da0b39f9e">TopicEntryKey</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#aeca08620cc2431de3037a8d9c56d4491">TopicUpdateLog</a></td></tr>
<tr class="separator:aeca08620cc2431de3037a8d9c56d4491"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21ea7c1cd68b125380849b98eb2de389"><td class="memItemLeft" align="right" valign="top">typedef boost::unordered_map<br class="typebreak"/>
&lt; <a class="el" href="classimpala_1_1Statestore.html#aa0a261a02804c62cb4b204a498e2e3ed">TopicId</a>, <a class="el" href="classimpala_1_1Statestore_1_1Topic.html">Topic</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#a21ea7c1cd68b125380849b98eb2de389">TopicMap</a></td></tr>
<tr class="memdesc:a21ea7c1cd68b125380849b98eb2de389"><td class="mdescLeft">&#160;</td><td class="mdescRight">The entire set of topics tracked by the statestore.  <a href="#a21ea7c1cd68b125380849b98eb2de389">More...</a><br/></td></tr>
<tr class="separator:a21ea7c1cd68b125380849b98eb2de389"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa2fb145d5973e7c5096b3a41b5b873d4"><td class="memItemLeft" align="right" valign="top">typedef boost::unordered_map<br class="typebreak"/>
&lt; <a class="el" href="classimpala_1_1Statestore.html#ad31bb2437024c9e3c13704fa92d58173">SubscriberId</a>, <br class="typebreak"/>
boost::shared_ptr&lt; <a class="el" href="classimpala_1_1Statestore_1_1Subscriber.html">Subscriber</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#aa2fb145d5973e7c5096b3a41b5b873d4">SubscriberMap</a></td></tr>
<tr class="separator:aa2fb145d5973e7c5096b3a41b5b873d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93e019fa9dd70a1d3e8517fa23bb521f"><td class="memItemLeft" align="right" valign="top">typedef std::pair&lt; int64_t, <br class="typebreak"/>
<a class="el" href="classimpala_1_1Statestore.html#ad31bb2437024c9e3c13704fa92d58173">SubscriberId</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#a93e019fa9dd70a1d3e8517fa23bb521f">ScheduledSubscriberUpdate</a></td></tr>
<tr class="separator:a93e019fa9dd70a1d3e8517fa23bb521f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a27168a236615a91d33362d6f657cc610"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classimpala_1_1Status.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#a27168a236615a91d33362d6f657cc610">OfferUpdate</a> (const <a class="el" href="classimpala_1_1Statestore.html#a93e019fa9dd70a1d3e8517fa23bb521f">ScheduledSubscriberUpdate</a> &amp;update, <a class="el" href="classimpala_1_1ThreadPool.html">ThreadPool</a>&lt; <a class="el" href="classimpala_1_1Statestore.html#a93e019fa9dd70a1d3e8517fa23bb521f">ScheduledSubscriberUpdate</a> &gt; *thread_pool)</td></tr>
<tr class="separator:a27168a236615a91d33362d6f657cc610"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf6d3f87b43bd8a527f8a968808794fb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#acf6d3f87b43bd8a527f8a968808794fb">DoSubscriberUpdate</a> (<a class="el" href="classbool.html">bool</a> is_heartbeat, int thread_id, const <a class="el" href="classimpala_1_1Statestore.html#a93e019fa9dd70a1d3e8517fa23bb521f">ScheduledSubscriberUpdate</a> &amp;update)</td></tr>
<tr class="separator:acf6d3f87b43bd8a527f8a968808794fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32ab690647d68de4d7da639f6f92d668"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classimpala_1_1Status.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#a32ab690647d68de4d7da639f6f92d668">SendTopicUpdate</a> (<a class="el" href="classimpala_1_1Statestore_1_1Subscriber.html">Subscriber</a> *subscriber, <a class="el" href="classbool.html">bool</a> *update_skipped)</td></tr>
<tr class="separator:a32ab690647d68de4d7da639f6f92d668"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ca03deee167183704d862b9a7fb1440"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classimpala_1_1Status.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#a7ca03deee167183704d862b9a7fb1440">SendHeartbeat</a> (<a class="el" href="classimpala_1_1Statestore_1_1Subscriber.html">Subscriber</a> *subscriber)</td></tr>
<tr class="separator:a7ca03deee167183704d862b9a7fb1440"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6ce3b7b1219800b19cbd1dacb8d3834"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#af6ce3b7b1219800b19cbd1dacb8d3834">UnregisterSubscriber</a> (<a class="el" href="classimpala_1_1Statestore_1_1Subscriber.html">Subscriber</a> *subscriber)</td></tr>
<tr class="separator:af6ce3b7b1219800b19cbd1dacb8d3834"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ff294c750e884a2a516b8649315935c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#a0ff294c750e884a2a516b8649315935c">GatherTopicUpdates</a> (const <a class="el" href="classimpala_1_1Statestore_1_1Subscriber.html">Subscriber</a> &amp;subscriber, TUpdateStateRequest *update_state_request)</td></tr>
<tr class="separator:a0ff294c750e884a2a516b8649315935c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae385c0cea6fd82a43e84c6d230cd3bb4"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="classimpala_1_1Statestore_1_1TopicEntry.html#a4bc848a4229fb6a8e906a8788e386d0a">TopicEntry::Version</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#ae385c0cea6fd82a43e84c6d230cd3bb4">GetMinSubscriberTopicVersion</a> (const <a class="el" href="classimpala_1_1Statestore.html#aa0a261a02804c62cb4b204a498e2e3ed">TopicId</a> &amp;topic_id, <a class="el" href="classimpala_1_1Statestore.html#ad31bb2437024c9e3c13704fa92d58173">SubscriberId</a> *subscriber_id=NULL)</td></tr>
<tr class="memdesc:ae385c0cea6fd82a43e84c6d230cd3bb4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Must be called holding the subscribers_ lock.  <a href="#ae385c0cea6fd82a43e84c6d230cd3bb4">More...</a><br/></td></tr>
<tr class="separator:ae385c0cea6fd82a43e84c6d230cd3bb4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f91f4babf7e39aecf1cea18e335a7fb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#a1f91f4babf7e39aecf1cea18e335a7fb">ShouldExit</a> ()</td></tr>
<tr class="memdesc:a1f91f4babf7e39aecf1cea18e335a7fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">True if the shutdown flag has been set true, false otherwise.  <a href="#a1f91f4babf7e39aecf1cea18e335a7fb">More...</a><br/></td></tr>
<tr class="separator:a1f91f4babf7e39aecf1cea18e335a7fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8bee97c2c9e7fef3fb9be1fc8467bfff"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#a8bee97c2c9e7fef3fb9be1fc8467bfff">TopicsHandler</a> (const <a class="el" href="classimpala_1_1Webserver.html#ac9f7aacffabb53e5c203ea7a3652802b">Webserver::ArgumentMap</a> &amp;args, rapidjson::Document *document)</td></tr>
<tr class="separator:a8bee97c2c9e7fef3fb9be1fc8467bfff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8eb2be0de4d199162fda8de274021e1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#ad8eb2be0de4d199162fda8de274021e1">SubscribersHandler</a> (const <a class="el" href="classimpala_1_1Webserver.html#ac9f7aacffabb53e5c203ea7a3652802b">Webserver::ArgumentMap</a> &amp;args, rapidjson::Document *document)</td></tr>
<tr class="separator:ad8eb2be0de4d199162fda8de274021e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:ae33572cf95140e8ef59a5a7f2bfd4999"><td class="memItemLeft" align="right" valign="top">boost::mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#ae33572cf95140e8ef59a5a7f2bfd4999">exit_flag_lock_</a></td></tr>
<tr class="separator:ae33572cf95140e8ef59a5a7f2bfd4999"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c0f18f5abc8e262d4de71dbf5ecdc75"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#a6c0f18f5abc8e262d4de71dbf5ecdc75">exit_flag_</a></td></tr>
<tr class="separator:a6c0f18f5abc8e262d4de71dbf5ecdc75"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aec2c7648de96ffa7bc49ac188510df59"><td class="memItemLeft" align="right" valign="top">boost::mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#aec2c7648de96ffa7bc49ac188510df59">topic_lock_</a></td></tr>
<tr class="memdesc:aec2c7648de96ffa7bc49ac188510df59"><td class="mdescLeft">&#160;</td><td class="mdescRight">Controls access to topics_. Cannot take subscribers_lock_ after acquiring this lock.  <a href="#aec2c7648de96ffa7bc49ac188510df59">More...</a><br/></td></tr>
<tr class="separator:aec2c7648de96ffa7bc49ac188510df59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a900beb10e6d07c001db91a8c21242351"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classimpala_1_1Statestore.html#a21ea7c1cd68b125380849b98eb2de389">TopicMap</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#a900beb10e6d07c001db91a8c21242351">topics_</a></td></tr>
<tr class="separator:a900beb10e6d07c001db91a8c21242351"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84545877ccf8c2285ce33a64a68c34b9"><td class="memItemLeft" align="right" valign="top">boost::mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#a84545877ccf8c2285ce33a64a68c34b9">subscribers_lock_</a></td></tr>
<tr class="separator:a84545877ccf8c2285ce33a64a68c34b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a681905c390a9acfd52155714197ecde7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classimpala_1_1Statestore.html#aa2fb145d5973e7c5096b3a41b5b873d4">SubscriberMap</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#a681905c390a9acfd52155714197ecde7">subscribers_</a></td></tr>
<tr class="separator:a681905c390a9acfd52155714197ecde7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae79f6a7fdeb4ad70eeac07ebdaca4d8"><td class="memItemLeft" align="right" valign="top">boost::uuids::random_generator&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#aae79f6a7fdeb4ad70eeac07ebdaca4d8">subscriber_uuid_generator_</a></td></tr>
<tr class="memdesc:aae79f6a7fdeb4ad70eeac07ebdaca4d8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used to generated unique IDs for each new registration.  <a href="#aae79f6a7fdeb4ad70eeac07ebdaca4d8">More...</a><br/></td></tr>
<tr class="separator:aae79f6a7fdeb4ad70eeac07ebdaca4d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab6839fcfaa01c7156e154ec6f7b2a85"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classimpala_1_1ThreadPool.html">ThreadPool</a><br class="typebreak"/>
&lt; <a class="el" href="classimpala_1_1Statestore.html#a93e019fa9dd70a1d3e8517fa23bb521f">ScheduledSubscriberUpdate</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#aab6839fcfaa01c7156e154ec6f7b2a85">subscriber_topic_update_threadpool_</a></td></tr>
<tr class="separator:aab6839fcfaa01c7156e154ec6f7b2a85"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac3eeb1ecc61e47036502c831264d6bb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classimpala_1_1ThreadPool.html">ThreadPool</a><br class="typebreak"/>
&lt; <a class="el" href="classimpala_1_1Statestore.html#a93e019fa9dd70a1d3e8517fa23bb521f">ScheduledSubscriberUpdate</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#aac3eeb1ecc61e47036502c831264d6bb">subscriber_heartbeat_threadpool_</a></td></tr>
<tr class="separator:aac3eeb1ecc61e47036502c831264d6bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a1567067c591f833904ba168d8d1e6b"><td class="memItemLeft" align="right" valign="top">boost::scoped_ptr&lt; <a class="el" href="classimpala_1_1ClientCache.html">ClientCache</a><br class="typebreak"/>
&lt; StatestoreSubscriberClient &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#a8a1567067c591f833904ba168d8d1e6b">update_state_client_cache_</a></td></tr>
<tr class="separator:a8a1567067c591f833904ba168d8d1e6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70703b29f5be5305b1500d0db65b65eb"><td class="memItemLeft" align="right" valign="top">boost::scoped_ptr&lt; <a class="el" href="classimpala_1_1ClientCache.html">ClientCache</a><br class="typebreak"/>
&lt; StatestoreSubscriberClient &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#a70703b29f5be5305b1500d0db65b65eb">heartbeat_client_cache_</a></td></tr>
<tr class="separator:a70703b29f5be5305b1500d0db65b65eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a974f0500b5ff6e3a1dd5756539ceb1d0"><td class="memItemLeft" align="right" valign="top">boost::shared_ptr<br class="typebreak"/>
&lt; <a class="el" href="classStatestoreServiceIf.html">StatestoreServiceIf</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#a974f0500b5ff6e3a1dd5756539ceb1d0">thrift_iface_</a></td></tr>
<tr class="memdesc:a974f0500b5ff6e3a1dd5756539ceb1d0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Thrift API implementation which proxies requests onto this <a class="el" href="classimpala_1_1Statestore.html">Statestore</a>.  <a href="#a974f0500b5ff6e3a1dd5756539ceb1d0">More...</a><br/></td></tr>
<tr class="separator:a974f0500b5ff6e3a1dd5756539ceb1d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6bccbe9bdaa6909f46114243deb94f0b"><td class="memItemLeft" align="right" valign="top">boost::scoped_ptr<br class="typebreak"/>
&lt; <a class="el" href="classimpala_1_1MissedHeartbeatFailureDetector.html">MissedHeartbeatFailureDetector</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#a6bccbe9bdaa6909f46114243deb94f0b">failure_detector_</a></td></tr>
<tr class="separator:a6bccbe9bdaa6909f46114243deb94f0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45098f334ca982ec32e9c7ddb1692ace"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceimpala.html#aa5fe574b057692843a420853cf325bbe">IntGauge</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#a45098f334ca982ec32e9c7ddb1692ace">num_subscribers_metric_</a></td></tr>
<tr class="memdesc:a45098f334ca982ec32e9c7ddb1692ace"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classimpala_1_1Metric.html" title="TODO: Add ToThrift() for conversion to an RPC-friendly format. ">Metric</a> that track the registered, non-failed subscribers.  <a href="#a45098f334ca982ec32e9c7ddb1692ace">More...</a><br/></td></tr>
<tr class="separator:a45098f334ca982ec32e9c7ddb1692ace"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a903ebd333a892ed83912003bd07469c6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classimpala_1_1SetMetric.html">SetMetric</a>&lt; std::string &gt; *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#a903ebd333a892ed83912003bd07469c6">subscriber_set_metric_</a></td></tr>
<tr class="separator:a903ebd333a892ed83912003bd07469c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aecea628085eb81d21827b65779daa459"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceimpala.html#aa5fe574b057692843a420853cf325bbe">IntGauge</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#aecea628085eb81d21827b65779daa459">key_size_metric_</a></td></tr>
<tr class="memdesc:aecea628085eb81d21827b65779daa459"><td class="mdescLeft">&#160;</td><td class="mdescRight">Metrics shared across all topics to sum the size in bytes of keys, values and both.  <a href="#aecea628085eb81d21827b65779daa459">More...</a><br/></td></tr>
<tr class="separator:aecea628085eb81d21827b65779daa459"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48e3c83af13b7c3734c03222318511a6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceimpala.html#aa5fe574b057692843a420853cf325bbe">IntGauge</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#a48e3c83af13b7c3734c03222318511a6">value_size_metric_</a></td></tr>
<tr class="separator:a48e3c83af13b7c3734c03222318511a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf97192502cea5d98512db2234003cf2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceimpala.html#aa5fe574b057692843a420853cf325bbe">IntGauge</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#aaf97192502cea5d98512db2234003cf2">topic_size_metric_</a></td></tr>
<tr class="separator:aaf97192502cea5d98512db2234003cf2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a217253fcf08452141617566fea00b7c5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classimpala_1_1StatsMetric.html">StatsMetric</a>&lt; double &gt; *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#a217253fcf08452141617566fea00b7c5">topic_update_duration_metric_</a></td></tr>
<tr class="separator:a217253fcf08452141617566fea00b7c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43b8c8909398fbaa656cf21a0c562845"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classimpala_1_1StatsMetric.html">StatsMetric</a>&lt; double &gt; *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classimpala_1_1Statestore.html#a43b8c8909398fbaa656cf21a0c562845">heartbeat_duration_metric_</a></td></tr>
<tr class="memdesc:a43b8c8909398fbaa656cf21a0c562845"><td class="mdescLeft">&#160;</td><td class="mdescRight">Same as above, but for <a class="el" href="classimpala_1_1Statestore.html#a7ca03deee167183704d862b9a7fb1440">SendHeartbeat()</a> RPCs.  <a href="#a43b8c8909398fbaa656cf21a0c562845">More...</a><br/></td></tr>
<tr class="separator:a43b8c8909398fbaa656cf21a0c562845"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The <a class="el" href="classimpala_1_1Statestore.html">Statestore</a> is a soft-state key-value store that maintains a set of Topics, which are maps from string keys to byte array values. Topics are subscribed to by subscribers, which are remote clients of the statestore which express an interest in some set of Topics. The statestore sends topic updates to subscribers via periodic 'update' messages, and also sends periodic 'heartbeat' messages, which are used to detect the liveness of a subscriber. In response to 'update' messages, subscribers, send topic updates to the statestore to merge with the current topic. These updates are then sent to all other subscribers in their next update message. The next message is scheduled for FLAGS_statestore_update_frequency_ms in the future, unless the subscriber indicated that it skipped processing an update, in which case the statestore will back off slightly before re-sending the same update. <a class="el" href="classimpala_1_1Statestore_1_1Topic.html">Topic</a> entries usually have human-readable keys, and values which are some serialised representation of a data structure, e.g. a Thrift struct. The contents of a value's byte string is opaque to the statestore, which maintains no information about how to deserialise it. Subscribers must use convention to interpret each other's updates. A subscriber may have marked some updates that it made as 'transient', which implies that those entries should be deleted once the subscriber is no longer connected (this is judged by the statestore's failure-detector, which will mark a subscriber as failed when it has not responded to a number of successive heartbeat messages). Transience is tracked per-topic-per-subscriber, so two different subscribers may treat the same topic differently wrt to the transience of their updates. The statestore tracks the history of updates to each topic, with each topic update getting a sequentially increasing version number that is unique across the topic. Subscribers also track the max version of each topic which they have have successfully processed. The statestore can use this information to send a delta of updates to a subscriber, rather than all items in the topic. For non-delta updates, the statestore will send an update that includes all values in the topic. </p>

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00079">79</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a class="anchor" id="a93e019fa9dd70a1d3e8517fa23bb521f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::pair&lt;int64_t, <a class="el" href="classimpala_1_1Statestore.html#ad31bb2437024c9e3c13704fa92d58173">SubscriberId</a>&gt; <a class="el" href="classimpala_1_1Statestore.html#a93e019fa9dd70a1d3e8517fa23bb521f">impala::Statestore::ScheduledSubscriberUpdate</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Work item passed to both kinds of subscriber update threads. First entry is the <em>earliest</em> time (in microseconds since epoch) that the next message should be sent, the second entry is the subscriber to send it to. </p>

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00363">363</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad31bb2437024c9e3c13704fa92d58173"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::string <a class="el" href="classimpala_1_1Statestore.html#ad31bb2437024c9e3c13704fa92d58173">impala::Statestore::SubscriberId</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>A SubscriberId uniquely identifies a single subscriber, and is provided by the subscriber at registration time. </p>

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00083">83</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

</div>
</div>
<a class="anchor" id="aa2fb145d5973e7c5096b3a41b5b873d4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">typedef boost::unordered_map&lt;<a class="el" href="classimpala_1_1Statestore.html#ad31bb2437024c9e3c13704fa92d58173">SubscriberId</a>, boost::shared_ptr&lt;<a class="el" href="classimpala_1_1Statestore_1_1Subscriber.html">Subscriber</a>&gt; &gt; <a class="el" href="classimpala_1_1Statestore.html#aa2fb145d5973e7c5096b3a41b5b873d4">impala::Statestore::SubscriberMap</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Map of subscribers currently connected; upon failure their entry is removed from this map. Subscribers must only be removed by <a class="el" href="classimpala_1_1Statestore.html#af6ce3b7b1219800b19cbd1dacb8d3834">UnregisterSubscriber()</a> which ensures that the correct cleanup is done. If a subscriber re-registers, it must be unregistered prior to re-entry into this map. Subscribers are held in shared_ptrs so that <a class="el" href="classimpala_1_1Statestore.html#aca13dce0412db31ab857ee45bf92ca46">RegisterSubscriber()</a> may overwrite their entry in this map while UpdateSubscriber() tries to update an existing registration without risk of use-after-free. </p>

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00354">354</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

</div>
</div>
<a class="anchor" id="a148294b3de37014d88d0758da0b39f9e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::string <a class="el" href="classimpala_1_1Statestore.html#a148294b3de37014d88d0758da0b39f9e">impala::Statestore::TopicEntryKey</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>A TopicEntryKey uniquely identifies a single entry in a topic. </p>

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00089">89</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

</div>
</div>
<a class="anchor" id="a50e27d3eb1638a93dc67f0eb3c469604"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">typedef boost::unordered_map&lt;<a class="el" href="classimpala_1_1Statestore.html#a148294b3de37014d88d0758da0b39f9e">TopicEntryKey</a>, <a class="el" href="classimpala_1_1Statestore_1_1TopicEntry.html">TopicEntry</a>&gt; <a class="el" href="classimpala_1_1Statestore.html#a50e27d3eb1638a93dc67f0eb3c469604">impala::Statestore::TopicEntryMap</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Map from TopicEntryKey to <a class="el" href="classimpala_1_1Statestore_1_1TopicEntry.html">TopicEntry</a>, maintained by a <a class="el" href="classimpala_1_1Statestore_1_1Topic.html">Topic</a> object. </p>

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00167">167</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

</div>
</div>
<a class="anchor" id="aa0a261a02804c62cb4b204a498e2e3ed"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::string <a class="el" href="classimpala_1_1Statestore.html#aa0a261a02804c62cb4b204a498e2e3ed">impala::Statestore::TopicId</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>A TopicId uniquely identifies a single topic. </p>

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00086">86</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

</div>
</div>
<a class="anchor" id="a21ea7c1cd68b125380849b98eb2de389"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">typedef boost::unordered_map&lt;<a class="el" href="classimpala_1_1Statestore.html#aa0a261a02804c62cb4b204a498e2e3ed">TopicId</a>, <a class="el" href="classimpala_1_1Statestore_1_1Topic.html">Topic</a>&gt; <a class="el" href="classimpala_1_1Statestore.html#a21ea7c1cd68b125380849b98eb2de389">impala::Statestore::TopicMap</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The entire set of topics tracked by the statestore. </p>

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00257">257</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

</div>
</div>
<a class="anchor" id="aeca08620cc2431de3037a8d9c56d4491"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::map&lt;<a class="el" href="classimpala_1_1Statestore_1_1TopicEntry.html#a4bc848a4229fb6a8e906a8788e386d0a">TopicEntry::Version</a>, <a class="el" href="classimpala_1_1Statestore.html#a148294b3de37014d88d0758da0b39f9e">TopicEntryKey</a>&gt; <a class="el" href="classimpala_1_1Statestore.html#aeca08620cc2431de3037a8d9c56d4491">impala::Statestore::TopicUpdateLog</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Map from Version to TopicEntryKey, maintained by a <a class="el" href="classimpala_1_1Statestore_1_1Topic.html">Topic</a> object. Effectively a log of the updates made to a <a class="el" href="classimpala_1_1Statestore_1_1Topic.html">Topic</a>, ordered by version. </p>

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00171">171</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a38ad9ed600af18f86ff873b7306d84a6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Statestore::Statestore </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classimpala_1_1MetricGroup.html">MetricGroup</a> *&#160;</td>
          <td class="paramname"><em>metrics</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The only constructor; initialises member variables only. </p>

<p>Definition at line <a class="el" href="statestore_8cc_source.html#l00211">211</a> of file <a class="el" href="statestore_8cc_source.html">statestore.cc</a>.</p>

<p>References <a class="el" href="metrics_8h_source.html#l00223">impala::MetricGroup::AddGauge()</a>, <a class="el" href="statestore_8h_source.html#l00405">heartbeat_client_cache_</a>, <a class="el" href="statestore_8h_source.html#l00430">heartbeat_duration_metric_</a>, <a class="el" href="statestore_8h_source.html#l00420">key_size_metric_</a>, <a class="el" href="statestore_8h_source.html#l00416">num_subscribers_metric_</a>, <a class="el" href="metrics_8h_source.html#l00211">impala::MetricGroup::RegisterMetric()</a>, <a class="el" href="statestore_8cc_source.html#l00081">STATESTORE_HEARTBEAT_DURATION</a>, <a class="el" href="statestore_8cc_source.html#l00075">STATESTORE_LIVE_SUBSCRIBERS</a>, <a class="el" href="statestore_8cc_source.html#l00076">STATESTORE_LIVE_SUBSCRIBERS_LIST</a>, <a class="el" href="statestore_8cc_source.html#l00077">STATESTORE_TOTAL_KEY_SIZE_BYTES</a>, <a class="el" href="statestore_8cc_source.html#l00079">STATESTORE_TOTAL_TOPIC_SIZE_BYTES</a>, <a class="el" href="statestore_8cc_source.html#l00078">STATESTORE_TOTAL_VALUE_SIZE_BYTES</a>, <a class="el" href="statestore_8cc_source.html#l00080">STATESTORE_UPDATE_DURATION</a>, <a class="el" href="statestore_8h_source.html#l00417">subscriber_set_metric_</a>, <a class="el" href="statestore_8h_source.html#l00422">topic_size_metric_</a>, <a class="el" href="statestore_8h_source.html#l00427">topic_update_duration_metric_</a>, <a class="el" href="statestore_8h_source.html#l00399">update_state_client_cache_</a>, and <a class="el" href="statestore_8h_source.html#l00421">value_size_metric_</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="acf6d3f87b43bd8a527f8a968808794fb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Statestore::DoSubscriberUpdate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>is_heartbeat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>thread_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classimpala_1_1Statestore.html#a93e019fa9dd70a1d3e8517fa23bb521f">ScheduledSubscriberUpdate</a> &amp;&#160;</td>
          <td class="paramname"><em>update</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Sends either a heartbeat or topic update message to the subscriber in 'update' at the closest possible time to the first member of 'update'. If is_heartbeat is true, sends a heartbeat update, otherwise the set of pending topic updates is sent. Once complete, the next update is scheduled and added to the appropriate queue. </p>

<p>Definition at line <a class="el" href="statestore_8cc_source.html#l00606">606</a> of file <a class="el" href="statestore_8cc_source.html">statestore.cc</a>.</p>

<p>References <a class="el" href="multi-precision_8h_source.html#l00113">impala::abs()</a>, <a class="el" href="status_8h_source.html#l00226">impala::Status::code()</a>, <a class="el" href="statestore_8cc_source.html#l00097">DEADLINE_MISS_THRESHOLD_MS</a>, <a class="el" href="failure-detector_8h_source.html#l00036">impala::FailureDetector::FAILED</a>, <a class="el" href="statestore_8h_source.html#l00413">failure_detector_</a>, <a class="el" href="status_8cc_source.html#l00184">impala::Status::GetDetail()</a>, <a class="el" href="statestore_8cc_source.html#l00335">OfferUpdate()</a>, <a class="el" href="status_8h_source.html#l00172">impala::Status::ok()</a>, <a class="el" href="debug-util_8cc_source.html#l00097">impala::PrintId()</a>, <a class="el" href="statestore_8cc_source.html#l00587">SendHeartbeat()</a>, <a class="el" href="statestore_8cc_source.html#l00399">SendTopicUpdate()</a>, <a class="el" href="status_8h_source.html#l00197">impala::Status::SetErrorMsg()</a>, <a class="el" href="time_8cc_source.html#l00021">impala::SleepForMs()</a>, <a class="el" href="statestore_8h_source.html#l00395">subscriber_heartbeat_threadpool_</a>, <a class="el" href="statestore_8h_source.html#l00393">subscriber_topic_update_threadpool_</a>, <a class="el" href="statestore_8h_source.html#l00355">subscribers_</a>, <a class="el" href="statestore_8h_source.html#l00343">subscribers_lock_</a>, <a class="el" href="time_8h_source.html#l00051">impala::UnixMillis()</a>, <a class="el" href="statestore_8cc_source.html#l00714">UnregisterSubscriber()</a>, and <a class="el" href="logging_8h_source.html#l00057">VLOG_QUERY</a>.</p>

</div>
</div>
<a class="anchor" id="a0ff294c750e884a2a516b8649315935c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Statestore::GatherTopicUpdates </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classimpala_1_1Statestore_1_1Subscriber.html">Subscriber</a> &amp;&#160;</td>
          <td class="paramname"><em>subscriber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TUpdateStateRequest *&#160;</td>
          <td class="paramname"><em>update_state_request</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Populates a TUpdateStateRequest with the update state for this subscriber. Iterates over all updates in all subscribed topics, populating the given TUpdateStateRequest object. Takes the topic_lock_ and subscribers_lock_. </p>

<p>Definition at line <a class="el" href="statestore_8cc_source.html#l00484">484</a> of file <a class="el" href="statestore_8cc_source.html">statestore.cc</a>.</p>

<p>References <a class="el" href="statestore_8h_source.html#l00205">impala::Statestore::Topic::entries()</a>, <a class="el" href="statestore_8cc_source.html#l00556">GetMinSubscriberTopicVersion()</a>, <a class="el" href="statestore_8h_source.html#l00288">impala::Statestore::Subscriber::id()</a>, <a class="el" href="statestore_8h_source.html#l00206">impala::Statestore::Topic::last_version()</a>, <a class="el" href="statestore_8cc_source.html#l00199">impala::Statestore::Subscriber::LastTopicVersionProcessed()</a>, <a class="el" href="statestore_8h_source.html#l00141">impala::Statestore::TopicEntry::NULL_VALUE</a>, <a class="el" href="pretty-printer_8h_source.html#l00033">impala::PrettyPrinter::Print()</a>, <a class="el" href="statestore_8h_source.html#l00286">impala::Statestore::Subscriber::subscribed_topics()</a>, <a class="el" href="statestore_8h_source.html#l00343">subscribers_lock_</a>, <a class="el" href="statestore_8h_source.html#l00284">impala::Statestore::Subscriber::TOPIC_INITIAL_VERSION</a>, <a class="el" href="statestore_8h_source.html#l00254">topic_lock_</a>, <a class="el" href="statestore_8h_source.html#l00207">impala::Statestore::Topic::topic_update_log()</a>, <a class="el" href="statestore_8h_source.html#l00258">topics_</a>, <a class="el" href="statestore_8h_source.html#l00208">impala::Statestore::Topic::total_key_size_bytes()</a>, <a class="el" href="statestore_8h_source.html#l00209">impala::Statestore::Topic::total_value_size_bytes()</a>, <a class="el" href="statestore_8h_source.html#l00151">impala::Statestore::TopicEntry::value()</a>, and <a class="el" href="logging_8h_source.html#l00057">VLOG_QUERY</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00399">SendTopicUpdate()</a>.</p>

</div>
</div>
<a class="anchor" id="ae385c0cea6fd82a43e84c6d230cd3bb4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classimpala_1_1Statestore_1_1TopicEntry.html#a4bc848a4229fb6a8e906a8788e386d0a">Statestore::TopicEntry::Version</a> Statestore::GetMinSubscriberTopicVersion </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classimpala_1_1Statestore.html#aa0a261a02804c62cb4b204a498e2e3ed">TopicId</a> &amp;&#160;</td>
          <td class="paramname"><em>topic_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classimpala_1_1Statestore.html#ad31bb2437024c9e3c13704fa92d58173">SubscriberId</a> *&#160;</td>
          <td class="paramname"><em>subscriber_id</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Must be called holding the subscribers_ lock. </p>
<p>Returns the minimum last processed topic version across all subscribers for the given topic ID. Calculated by enumerating all subscribers and looking at their LastTopicVersionProcessed() for this topic. The value returned will always be &lt;= topics_[topic_id].last_version_. Returns TOPIC_INITIAL_VERSION if no subscribers are registered to the topic. The subscriber ID to whom the min version belongs can also be retrieved using the optional subscriber_id output parameter. If multiple subscribers have the same min version, the subscriber_id may be set to any one of the matching subscribers.TODO: Update the min subscriber version only when a topic is updated, rather than each time a subscriber is updated. One way to do this would be to keep a priority queue in <a class="el" href="classimpala_1_1Statestore_1_1Topic.html">Topic</a> of each subscriber's last processed version of the topic. </p>

<p>Definition at line <a class="el" href="statestore_8cc_source.html#l00556">556</a> of file <a class="el" href="statestore_8cc_source.html">statestore.cc</a>.</p>

<p>References <a class="el" href="statestore_8h_source.html#l00355">subscribers_</a>, and <a class="el" href="statestore_8h_source.html#l00284">impala::Statestore::Subscriber::TOPIC_INITIAL_VERSION</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00484">GatherTopicUpdates()</a>, and <a class="el" href="statestore_8cc_source.html#l00265">TopicsHandler()</a>.</p>

</div>
</div>
<a class="anchor" id="ac8c7b9c8f5214eae08e18ff77e40b173"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classimpala_1_1Status.html">Status</a> Statestore::MainLoop </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The main processing loop. Blocks until the exit flag is set. </p>
<p>Returns OK unless there is an unrecoverable error. </p>

<p>Definition at line <a class="el" href="statestore_8cc_source.html#l00743">743</a> of file <a class="el" href="statestore_8cc_source.html">statestore.cc</a>.</p>

<p>References <a class="el" href="thread-pool_8h_source.html#l00092">impala::ThreadPool&lt; T &gt;::Join()</a>, <a class="el" href="status_8h_source.html#l00087">impala::Status::OK</a>, and <a class="el" href="statestore_8h_source.html#l00393">subscriber_topic_update_threadpool_</a>.</p>

<p>Referenced by <a class="el" href="in-process-servers_8cc_source.html#l00093">impala::InProcessStatestore::Start()</a>.</p>

</div>
</div>
<a class="anchor" id="a27168a236615a91d33362d6f657cc610"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classimpala_1_1Status.html">Status</a> Statestore::OfferUpdate </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classimpala_1_1Statestore.html#a93e019fa9dd70a1d3e8517fa23bb521f">ScheduledSubscriberUpdate</a> &amp;&#160;</td>
          <td class="paramname"><em>update</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classimpala_1_1ThreadPool.html">ThreadPool</a>&lt; <a class="el" href="classimpala_1_1Statestore.html#a93e019fa9dd70a1d3e8517fa23bb521f">ScheduledSubscriberUpdate</a> &gt; *&#160;</td>
          <td class="paramname"><em>thread_pool</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Utility method to add an update to the given thread pool, and to fail if the thread pool is already at capacity. </p>

<p>Definition at line <a class="el" href="statestore_8cc_source.html#l00335">335</a> of file <a class="el" href="statestore_8cc_source.html">statestore.cc</a>.</p>

<p>References <a class="el" href="thread-pool_8h_source.html#l00096">impala::ThreadPool&lt; T &gt;::GetQueueSize()</a>, <a class="el" href="thread-pool_8h_source.html#l00074">impala::ThreadPool&lt; T &gt;::Offer()</a>, <a class="el" href="status_8h_source.html#l00087">impala::Status::OK</a>, <a class="el" href="statestore_8cc_source.html#l00094">STATESTORE_MAX_SUBSCRIBERS</a>, <a class="el" href="statestore_8h_source.html#l00355">subscribers_</a>, and <a class="el" href="statestore_8h_source.html#l00343">subscribers_lock_</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00606">DoSubscriberUpdate()</a>, and <a class="el" href="statestore_8cc_source.html#l00352">RegisterSubscriber()</a>.</p>

</div>
</div>
<a class="anchor" id="aca13dce0412db31ab857ee45bf92ca46"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classimpala_1_1Status.html">Status</a> Statestore::RegisterSubscriber </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classimpala_1_1Statestore.html#ad31bb2437024c9e3c13704fa92d58173">SubscriberId</a> &amp;&#160;</td>
          <td class="paramname"><em>subscriber_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const TNetworkAddress &amp;&#160;</td>
          <td class="paramname"><em>location</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; TTopicRegistration &gt; &amp;&#160;</td>
          <td class="paramname"><em>topic_registrations</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TUniqueId *&#160;</td>
          <td class="paramname"><em>registration_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Registers a new subscriber with the given unique subscriber ID, running a subscriber service at the given location, with the provided list of topic subscriptions. The registration_id output parameter is the unique ID for this registration, used to distinguish old registrations from new ones for the same subscriber. If a registration already exists for this subscriber, the old registration is removed and a new one is created. Subscribers may receive an update intended for the old registration, since one may be in flight when a new <a class="el" href="classimpala_1_1Statestore.html#aca13dce0412db31ab857ee45bf92ca46">RegisterSubscriber()</a> is received. </p>

<p>Definition at line <a class="el" href="statestore_8cc_source.html#l00352">352</a> of file <a class="el" href="statestore_8cc_source.html">statestore.cc</a>.</p>

<p>References <a class="el" href="collection-metrics_8h_source.html#l00049">impala::SetMetric&lt; T &gt;::Add()</a>, <a class="el" href="statestore_8h_source.html#l00413">failure_detector_</a>, <a class="el" href="statestore_8h_source.html#l00420">key_size_metric_</a>, <a class="el" href="statestore_8h_source.html#l00416">num_subscribers_metric_</a>, <a class="el" href="statestore_8cc_source.html#l00335">OfferUpdate()</a>, <a class="el" href="status_8h_source.html#l00087">impala::Status::OK</a>, <a class="el" href="debug-util_8cc_source.html#l00097">impala::PrintId()</a>, <a class="el" href="status_8h_source.html#l00242">RETURN_IF_ERROR</a>, <a class="el" href="statestore_8h_source.html#l00395">subscriber_heartbeat_threadpool_</a>, <a class="el" href="statestore_8h_source.html#l00417">subscriber_set_metric_</a>, <a class="el" href="statestore_8h_source.html#l00393">subscriber_topic_update_threadpool_</a>, <a class="el" href="statestore_8h_source.html#l00358">subscriber_uuid_generator_</a>, <a class="el" href="statestore_8h_source.html#l00355">subscribers_</a>, <a class="el" href="statestore_8h_source.html#l00343">subscribers_lock_</a>, <a class="el" href="statestore_8h_source.html#l00254">topic_lock_</a>, <a class="el" href="statestore_8h_source.html#l00422">topic_size_metric_</a>, <a class="el" href="statestore_8h_source.html#l00258">topics_</a>, <a class="el" href="statestore_8cc_source.html#l00714">UnregisterSubscriber()</a>, <a class="el" href="uid-util_8h_source.html#l00038">impala::UUIDToTUniqueId()</a>, and <a class="el" href="statestore_8h_source.html#l00421">value_size_metric_</a>.</p>

</div>
</div>
<a class="anchor" id="af33307e14226476bb11ef2566e16da4c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Statestore::RegisterWebpages </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classimpala_1_1Webserver.html">Webserver</a> *&#160;</td>
          <td class="paramname"><em>webserver</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="statestore_8cc_source.html#l00253">253</a> of file <a class="el" href="statestore_8cc_source.html">statestore.cc</a>.</p>

<p>References <a class="el" href="webserver_8cc_source.html#l00412">impala::Webserver::RegisterUrlCallback()</a>, <a class="el" href="statestore_8cc_source.html#l00307">SubscribersHandler()</a>, and <a class="el" href="statestore_8cc_source.html#l00265">TopicsHandler()</a>.</p>

<p>Referenced by <a class="el" href="statestored-main_8cc_source.html#l00044">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a7ca03deee167183704d862b9a7fb1440"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classimpala_1_1Status.html">Status</a> Statestore::SendHeartbeat </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classimpala_1_1Statestore_1_1Subscriber.html">Subscriber</a> *&#160;</td>
          <td class="paramname"><em>subscriber</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Sends a heartbeat message to subscriber. Returns false if there was some error performing the RPC. </p>

<p>Definition at line <a class="el" href="statestore_8cc_source.html#l00587">587</a> of file <a class="el" href="statestore_8cc_source.html">statestore.cc</a>.</p>

<p>References <a class="el" href="stopwatch_8h_source.html#l00105">impala::MonotonicStopWatch::ElapsedTime()</a>, <a class="el" href="statestore_8h_source.html#l00405">heartbeat_client_cache_</a>, <a class="el" href="statestore_8h_source.html#l00430">heartbeat_duration_metric_</a>, <a class="el" href="statestore_8h_source.html#l00287">impala::Statestore::Subscriber::network_address()</a>, <a class="el" href="status_8h_source.html#l00087">impala::Status::OK</a>, <a class="el" href="statestore_8h_source.html#l00289">impala::Statestore::Subscriber::registration_id()</a>, <a class="el" href="status_8h_source.html#l00242">RETURN_IF_ERROR</a>, <a class="el" href="stopwatch_8h_source.html#l00081">impala::MonotonicStopWatch::Start()</a>, and <a class="el" href="collection-metrics_8h_source.html#l00112">impala::StatsMetric&lt; T &gt;::Update()</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00606">DoSubscriberUpdate()</a>.</p>

</div>
</div>
<a class="anchor" id="a32ab690647d68de4d7da639f6f92d668"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classimpala_1_1Status.html">Status</a> Statestore::SendTopicUpdate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classimpala_1_1Statestore_1_1Subscriber.html">Subscriber</a> *&#160;</td>
          <td class="paramname"><em>subscriber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a> *&#160;</td>
          <td class="paramname"><em>update_skipped</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Does the work of updating a single subscriber, by calling UpdateState() on the client to send a list of topic deltas to the subscriber. If that call fails (either because the RPC could not be completed, or the subscriber indicated an error), this method returns a non-OK status immediately without further processing. The subscriber may indicated that it skipped processing the message, either because it was not ready to do so or because it was busy. In that case, the UpdateState() RPC will return OK (since there was no error) and the output parameter update_skipped is set to true. Otherwise, any updates returned by the subscriber are applied to their target topics. </p>

<p>Definition at line <a class="el" href="statestore_8cc_source.html#l00399">399</a> of file <a class="el" href="statestore_8cc_source.html">statestore.cc</a>.</p>

<p>References <a class="el" href="statestore_8cc_source.html#l00189">impala::Statestore::Subscriber::AddTransientUpdate()</a>, <a class="el" href="stopwatch_8h_source.html#l00105">impala::MonotonicStopWatch::ElapsedTime()</a>, <a class="el" href="statestore_8cc_source.html#l00484">GatherTopicUpdates()</a>, <a class="el" href="statestore_8h_source.html#l00288">impala::Statestore::Subscriber::id()</a>, <a class="el" href="statestore_8h_source.html#l00287">impala::Statestore::Subscriber::network_address()</a>, <a class="el" href="statestore_8h_source.html#l00141">impala::Statestore::TopicEntry::NULL_VALUE</a>, <a class="el" href="status_8h_source.html#l00087">impala::Status::OK</a>, <a class="el" href="statestore_8cc_source.html#l00127">impala::Statestore::Topic::Put()</a>, <a class="el" href="statestore_8h_source.html#l00289">impala::Statestore::Subscriber::registration_id()</a>, <a class="el" href="status_8h_source.html#l00242">RETURN_IF_ERROR</a>, <a class="el" href="statestore_8cc_source.html#l00206">impala::Statestore::Subscriber::SetLastTopicVersionProcessed()</a>, <a class="el" href="stopwatch_8h_source.html#l00081">impala::MonotonicStopWatch::Start()</a>, <a class="el" href="statestore_8h_source.html#l00254">topic_lock_</a>, <a class="el" href="statestore_8h_source.html#l00427">topic_update_duration_metric_</a>, <a class="el" href="statestore_8h_source.html#l00258">topics_</a>, <a class="el" href="collection-metrics_8h_source.html#l00112">impala::StatsMetric&lt; T &gt;::Update()</a>, and <a class="el" href="statestore_8h_source.html#l00399">update_state_client_cache_</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00606">DoSubscriberUpdate()</a>.</p>

</div>
</div>
<a class="anchor" id="a602378fd065152e44e7c3c1e61e6dfc9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Statestore::SetExitFlag </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Tells the <a class="el" href="classimpala_1_1Statestore.html">Statestore</a> to shut down. Does not wait for the processing loop to exit before returning. </p>

<p>Definition at line <a class="el" href="statestore_8cc_source.html#l00581">581</a> of file <a class="el" href="statestore_8cc_source.html">statestore.cc</a>.</p>

<p>References <a class="el" href="statestore_8h_source.html#l00251">exit_flag_</a>, <a class="el" href="statestore_8h_source.html#l00250">exit_flag_lock_</a>, <a class="el" href="thread-pool_8h_source.html#l00082">impala::ThreadPool&lt; T &gt;::Shutdown()</a>, and <a class="el" href="statestore_8h_source.html#l00393">subscriber_topic_update_threadpool_</a>.</p>

</div>
</div>
<a class="anchor" id="a1f91f4babf7e39aecf1cea18e335a7fb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> Statestore::ShouldExit </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>True if the shutdown flag has been set true, false otherwise. </p>

<p>Definition at line <a class="el" href="statestore_8cc_source.html#l00576">576</a> of file <a class="el" href="statestore_8cc_source.html">statestore.cc</a>.</p>

<p>References <a class="el" href="statestore_8h_source.html#l00251">exit_flag_</a>, and <a class="el" href="statestore_8h_source.html#l00250">exit_flag_lock_</a>.</p>

</div>
</div>
<a class="anchor" id="ad8eb2be0de4d199162fda8de274021e1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Statestore::SubscribersHandler </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classimpala_1_1Webserver.html#ac9f7aacffabb53e5c203ea7a3652802b">Webserver::ArgumentMap</a> &amp;&#160;</td>
          <td class="paramname"><em>args</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">rapidjson::Document *&#160;</td>
          <td class="paramname"><em>document</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Webpage handler: upon return 'document' will contain a list of subscribers as follows: "subscribers": [ { "id": "henry-impala:26000", "address": "henry-impala:23020", "num_topics": 1, "num_transient": 0, "registration_id": "414d28c84930d987:abcffd70b3346fb7" } ] </p>

<p>Definition at line <a class="el" href="statestore_8cc_source.html#l00307">307</a> of file <a class="el" href="statestore_8cc_source.html">statestore.cc</a>.</p>

<p>References <a class="el" href="debug-util_8cc_source.html#l00097">impala::PrintId()</a>, <a class="el" href="statestore_8h_source.html#l00355">subscribers_</a>, and <a class="el" href="statestore_8h_source.html#l00343">subscribers_lock_</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00253">RegisterWebpages()</a>.</p>

</div>
</div>
<a class="anchor" id="aed82da8a591119a7b25fa61da1274073"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const boost::shared_ptr&lt;<a class="el" href="classStatestoreServiceIf.html">StatestoreServiceIf</a>&gt;&amp; impala::Statestore::thrift_iface </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the Thrift API interface that proxies requests onto the local <a class="el" href="classimpala_1_1Statestore.html">Statestore</a>. </p>

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00115">115</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

<p>References <a class="el" href="statestore_8h_source.html#l00408">thrift_iface_</a>.</p>

</div>
</div>
<a class="anchor" id="a8bee97c2c9e7fef3fb9be1fc8467bfff"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Statestore::TopicsHandler </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classimpala_1_1Webserver.html#ac9f7aacffabb53e5c203ea7a3652802b">Webserver::ArgumentMap</a> &amp;&#160;</td>
          <td class="paramname"><em>args</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">rapidjson::Document *&#160;</td>
          <td class="paramname"><em>document</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Webpage handler: upon return, 'document' will contain a list of topics as follows: "topics": [ { "topic_id": "catalog-update", "num_entries": 1165, "version": 2476, "oldest_version": 2476, "oldest_id": "henry-impala:26000", "key_size": "42.94 KB", "value_size": "9.54 MB", "total_size": "9.58 MB" }, ] </p>

<p>Definition at line <a class="el" href="statestore_8cc_source.html#l00265">265</a> of file <a class="el" href="statestore_8cc_source.html">statestore.cc</a>.</p>

<p>References <a class="el" href="statestore_8cc_source.html#l00556">GetMinSubscriberTopicVersion()</a>, <a class="el" href="pretty-printer_8h_source.html#l00033">impala::PrettyPrinter::Print()</a>, <a class="el" href="statestore_8h_source.html#l00343">subscribers_lock_</a>, <a class="el" href="statestore_8h_source.html#l00254">topic_lock_</a>, and <a class="el" href="statestore_8h_source.html#l00258">topics_</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00253">RegisterWebpages()</a>.</p>

</div>
</div>
<a class="anchor" id="af6ce3b7b1219800b19cbd1dacb8d3834"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Statestore::UnregisterSubscriber </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classimpala_1_1Statestore_1_1Subscriber.html">Subscriber</a> *&#160;</td>
          <td class="paramname"><em>subscriber</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Unregister a subscriber, removing all of its transient entries and evicting it from the subscriber map. Callers must hold subscribers_lock_ prior to calling this method. </p>

<p>Definition at line <a class="el" href="statestore_8cc_source.html#l00714">714</a> of file <a class="el" href="statestore_8cc_source.html">statestore.cc</a>.</p>

<p>References <a class="el" href="statestore_8h_source.html#l00413">failure_detector_</a>, <a class="el" href="statestore_8h_source.html#l00405">heartbeat_client_cache_</a>, <a class="el" href="statestore_8h_source.html#l00288">impala::Statestore::Subscriber::id()</a>, <a class="el" href="statestore_8h_source.html#l00287">impala::Statestore::Subscriber::network_address()</a>, <a class="el" href="statestore_8h_source.html#l00416">num_subscribers_metric_</a>, <a class="el" href="debug-util_8cc_source.html#l00097">impala::PrintId()</a>, <a class="el" href="statestore_8h_source.html#l00289">impala::Statestore::Subscriber::registration_id()</a>, <a class="el" href="collection-metrics_8h_source.html#l00055">impala::SetMetric&lt; T &gt;::Remove()</a>, <a class="el" href="statestore_8h_source.html#l00417">subscriber_set_metric_</a>, <a class="el" href="statestore_8h_source.html#l00355">subscribers_</a>, <a class="el" href="statestore_8h_source.html#l00254">topic_lock_</a>, <a class="el" href="statestore_8h_source.html#l00258">topics_</a>, <a class="el" href="statestore_8h_source.html#l00304">impala::Statestore::Subscriber::transient_entries()</a>, and <a class="el" href="statestore_8h_source.html#l00399">update_state_client_cache_</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00606">DoSubscriberUpdate()</a>, and <a class="el" href="statestore_8cc_source.html#l00352">RegisterSubscriber()</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a6c0f18f5abc8e262d4de71dbf5ecdc75"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> impala::Statestore::exit_flag_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00251">251</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00581">SetExitFlag()</a>, and <a class="el" href="statestore_8cc_source.html#l00576">ShouldExit()</a>.</p>

</div>
</div>
<a class="anchor" id="ae33572cf95140e8ef59a5a7f2bfd4999"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::mutex impala::Statestore::exit_flag_lock_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Note on locking: Subscribers and Topics should be accessed under their own coarse locks, and worker threads will use worker_lock_ to ensure safe access to the subscriber work queue. Protects access to exit_flag_, but is used mostly to ensure visibility of updates between threads.. </p>

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00250">250</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00581">SetExitFlag()</a>, and <a class="el" href="statestore_8cc_source.html#l00576">ShouldExit()</a>.</p>

</div>
</div>
<a class="anchor" id="a6bccbe9bdaa6909f46114243deb94f0b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::scoped_ptr&lt;<a class="el" href="classimpala_1_1MissedHeartbeatFailureDetector.html">MissedHeartbeatFailureDetector</a>&gt; impala::Statestore::failure_detector_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Failure detector for subscribers. If a subscriber misses a configurable number of consecutive heartbeat messages, it is considered failed and a) its transient topic entries are removed and b) its entry in the subscriber map is erased. </p>

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00413">413</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00606">DoSubscriberUpdate()</a>, <a class="el" href="statestore_8cc_source.html#l00352">RegisterSubscriber()</a>, and <a class="el" href="statestore_8cc_source.html#l00714">UnregisterSubscriber()</a>.</p>

</div>
</div>
<a class="anchor" id="a70703b29f5be5305b1500d0db65b65eb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::scoped_ptr&lt;<a class="el" href="classimpala_1_1ClientCache.html">ClientCache</a>&lt;StatestoreSubscriberClient&gt; &gt; impala::Statestore::heartbeat_client_cache_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Cache of subscriber clients used for Heartbeat() RPCs. Separate from update_state_client_cache_ because we enable TCP-level timeouts for these calls, whereas they are not safe for UpdateState() RPCs which can take an unbounded amount of time. </p>

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00405">405</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00587">SendHeartbeat()</a>, <a class="el" href="statestore_8cc_source.html#l00211">Statestore()</a>, and <a class="el" href="statestore_8cc_source.html#l00714">UnregisterSubscriber()</a>.</p>

</div>
</div>
<a class="anchor" id="a43b8c8909398fbaa656cf21a0c562845"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classimpala_1_1StatsMetric.html">StatsMetric</a>&lt;double&gt;* impala::Statestore::heartbeat_duration_metric_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Same as above, but for <a class="el" href="classimpala_1_1Statestore.html#a7ca03deee167183704d862b9a7fb1440">SendHeartbeat()</a> RPCs. </p>

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00430">430</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00587">SendHeartbeat()</a>, and <a class="el" href="statestore_8cc_source.html#l00211">Statestore()</a>.</p>

</div>
</div>
<a class="anchor" id="aecea628085eb81d21827b65779daa459"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceimpala.html#aa5fe574b057692843a420853cf325bbe">IntGauge</a>* impala::Statestore::key_size_metric_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Metrics shared across all topics to sum the size in bytes of keys, values and both. </p>

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00420">420</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00352">RegisterSubscriber()</a>, and <a class="el" href="statestore_8cc_source.html#l00211">Statestore()</a>.</p>

</div>
</div>
<a class="anchor" id="a45098f334ca982ec32e9c7ddb1692ace"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceimpala.html#aa5fe574b057692843a420853cf325bbe">IntGauge</a>* impala::Statestore::num_subscribers_metric_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p><a class="el" href="classimpala_1_1Metric.html" title="TODO: Add ToThrift() for conversion to an RPC-friendly format. ">Metric</a> that track the registered, non-failed subscribers. </p>

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00416">416</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00352">RegisterSubscriber()</a>, <a class="el" href="statestore_8cc_source.html#l00211">Statestore()</a>, and <a class="el" href="statestore_8cc_source.html#l00714">UnregisterSubscriber()</a>.</p>

</div>
</div>
<a class="anchor" id="aac3eeb1ecc61e47036502c831264d6bb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classimpala_1_1ThreadPool.html">ThreadPool</a>&lt;<a class="el" href="classimpala_1_1Statestore.html#a93e019fa9dd70a1d3e8517fa23bb521f">ScheduledSubscriberUpdate</a>&gt; impala::Statestore::subscriber_heartbeat_threadpool_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00395">395</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00606">DoSubscriberUpdate()</a>, and <a class="el" href="statestore_8cc_source.html#l00352">RegisterSubscriber()</a>.</p>

</div>
</div>
<a class="anchor" id="a903ebd333a892ed83912003bd07469c6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classimpala_1_1SetMetric.html">SetMetric</a>&lt;std::string&gt;* impala::Statestore::subscriber_set_metric_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00417">417</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00352">RegisterSubscriber()</a>, <a class="el" href="statestore_8cc_source.html#l00211">Statestore()</a>, and <a class="el" href="statestore_8cc_source.html#l00714">UnregisterSubscriber()</a>.</p>

</div>
</div>
<a class="anchor" id="aab6839fcfaa01c7156e154ec6f7b2a85"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classimpala_1_1ThreadPool.html">ThreadPool</a>&lt;<a class="el" href="classimpala_1_1Statestore.html#a93e019fa9dd70a1d3e8517fa23bb521f">ScheduledSubscriberUpdate</a>&gt; impala::Statestore::subscriber_topic_update_threadpool_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>The statestore has two pools of threads that send messages to subscribers one-by-one. One pool deals with 'heartbeat' messages that update failure detection state, and the other pool sends 'topic update' messages which contain the actual topic data that a subscriber does not yet have. Each message is scheduled for some time in the future and each worker thread will sleep until that time has passed to rate-limit messages. Subscribers are placed back into the queue once they have been processed. A subscriber may have many entries in a queue, but no more than one for each registration associated with that subscriber. Since at most one registration is considered 'live' per subscriber, this guarantees that subscribers_.size() - 1 'live' subscribers ahead of any subscriber in the queue. Messages may be delayed for any number of reasons, including scheduler interference, lock unfairness when submitting to the thread pool and head-of-line blocking when threads are occupied sending messages to slow subscribers (subscribers are not guaranteed to be in the queue in next-update order). Delays for heartbeat messages can result in the subscriber that is kept waiting assuming that the statestore has failed. Correct configuration of heartbeat message frequency and subscriber timeout is therefore very important, and depends upon the cluster size. See &ndash;statestore_heartbeat_frequency_ms and &ndash;statestore_subscriber_timeout_seconds. We expect that the provided defaults will work up to clusters of several hundred nodes. Subscribers are therefore not processed in lock-step, and one subscriber may have seen many more messages than another during the same interval (if the second subscriber runs slow for any reason). </p>

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00393">393</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00606">DoSubscriberUpdate()</a>, <a class="el" href="statestore_8cc_source.html#l00743">MainLoop()</a>, <a class="el" href="statestore_8cc_source.html#l00352">RegisterSubscriber()</a>, and <a class="el" href="statestore_8cc_source.html#l00581">SetExitFlag()</a>.</p>

</div>
</div>
<a class="anchor" id="aae79f6a7fdeb4ad70eeac07ebdaca4d8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::uuids::random_generator impala::Statestore::subscriber_uuid_generator_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Used to generated unique IDs for each new registration. </p>

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00358">358</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00352">RegisterSubscriber()</a>.</p>

</div>
</div>
<a class="anchor" id="a681905c390a9acfd52155714197ecde7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classimpala_1_1Statestore.html#aa2fb145d5973e7c5096b3a41b5b873d4">SubscriberMap</a> impala::Statestore::subscribers_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00355">355</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00606">DoSubscriberUpdate()</a>, <a class="el" href="statestore_8cc_source.html#l00556">GetMinSubscriberTopicVersion()</a>, <a class="el" href="statestore_8cc_source.html#l00335">OfferUpdate()</a>, <a class="el" href="statestore_8cc_source.html#l00352">RegisterSubscriber()</a>, <a class="el" href="statestore_8cc_source.html#l00307">SubscribersHandler()</a>, and <a class="el" href="statestore_8cc_source.html#l00714">UnregisterSubscriber()</a>.</p>

</div>
</div>
<a class="anchor" id="a84545877ccf8c2285ce33a64a68c34b9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::mutex impala::Statestore::subscribers_lock_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Protects access to subscribers_ and subscriber_uuid_generator_. Must be taken before topic_lock_. </p>

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00343">343</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00606">DoSubscriberUpdate()</a>, <a class="el" href="statestore_8cc_source.html#l00484">GatherTopicUpdates()</a>, <a class="el" href="statestore_8cc_source.html#l00335">OfferUpdate()</a>, <a class="el" href="statestore_8cc_source.html#l00352">RegisterSubscriber()</a>, <a class="el" href="statestore_8cc_source.html#l00307">SubscribersHandler()</a>, and <a class="el" href="statestore_8cc_source.html#l00265">TopicsHandler()</a>.</p>

</div>
</div>
<a class="anchor" id="a974f0500b5ff6e3a1dd5756539ceb1d0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::shared_ptr&lt;<a class="el" href="classStatestoreServiceIf.html">StatestoreServiceIf</a>&gt; impala::Statestore::thrift_iface_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Thrift API implementation which proxies requests onto this <a class="el" href="classimpala_1_1Statestore.html">Statestore</a>. </p>

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00408">408</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

<p>Referenced by <a class="el" href="statestore_8h_source.html#l00115">thrift_iface()</a>.</p>

</div>
</div>
<a class="anchor" id="aec2c7648de96ffa7bc49ac188510df59"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::mutex impala::Statestore::topic_lock_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Controls access to topics_. Cannot take subscribers_lock_ after acquiring this lock. </p>

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00254">254</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00484">GatherTopicUpdates()</a>, <a class="el" href="statestore_8cc_source.html#l00352">RegisterSubscriber()</a>, <a class="el" href="statestore_8cc_source.html#l00399">SendTopicUpdate()</a>, <a class="el" href="statestore_8cc_source.html#l00265">TopicsHandler()</a>, and <a class="el" href="statestore_8cc_source.html#l00714">UnregisterSubscriber()</a>.</p>

</div>
</div>
<a class="anchor" id="aaf97192502cea5d98512db2234003cf2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceimpala.html#aa5fe574b057692843a420853cf325bbe">IntGauge</a>* impala::Statestore::topic_size_metric_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00422">422</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00352">RegisterSubscriber()</a>, and <a class="el" href="statestore_8cc_source.html#l00211">Statestore()</a>.</p>

</div>
</div>
<a class="anchor" id="a217253fcf08452141617566fea00b7c5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classimpala_1_1StatsMetric.html">StatsMetric</a>&lt;double&gt;* impala::Statestore::topic_update_duration_metric_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Tracks the distribution of topic-update durations - precisely the time spent in calling the UpdateState() RPC which allows us to measure the network transmission cost as well as the subscriber-side processing time. </p>

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00427">427</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00399">SendTopicUpdate()</a>, and <a class="el" href="statestore_8cc_source.html#l00211">Statestore()</a>.</p>

</div>
</div>
<a class="anchor" id="a900beb10e6d07c001db91a8c21242351"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classimpala_1_1Statestore.html#a21ea7c1cd68b125380849b98eb2de389">TopicMap</a> impala::Statestore::topics_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00258">258</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00484">GatherTopicUpdates()</a>, <a class="el" href="statestore_8cc_source.html#l00352">RegisterSubscriber()</a>, <a class="el" href="statestore_8cc_source.html#l00399">SendTopicUpdate()</a>, <a class="el" href="statestore_8cc_source.html#l00265">TopicsHandler()</a>, and <a class="el" href="statestore_8cc_source.html#l00714">UnregisterSubscriber()</a>.</p>

</div>
</div>
<a class="anchor" id="a8a1567067c591f833904ba168d8d1e6b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::scoped_ptr&lt;<a class="el" href="classimpala_1_1ClientCache.html">ClientCache</a>&lt;StatestoreSubscriberClient&gt; &gt; impala::Statestore::update_state_client_cache_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Cache of subscriber clients used for UpdateState() RPCs. Only one client per subscriber should be used, but the cache helps with the client lifecycle on failure. </p>

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00399">399</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00399">SendTopicUpdate()</a>, <a class="el" href="statestore_8cc_source.html#l00211">Statestore()</a>, and <a class="el" href="statestore_8cc_source.html#l00714">UnregisterSubscriber()</a>.</p>

</div>
</div>
<a class="anchor" id="a48e3c83af13b7c3734c03222318511a6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceimpala.html#aa5fe574b057692843a420853cf325bbe">IntGauge</a>* impala::Statestore::value_size_metric_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="statestore_8h_source.html#l00421">421</a> of file <a class="el" href="statestore_8h_source.html">statestore.h</a>.</p>

<p>Referenced by <a class="el" href="statestore_8cc_source.html#l00352">RegisterSubscriber()</a>, and <a class="el" href="statestore_8cc_source.html#l00211">Statestore()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>be/src/statestore/<a class="el" href="statestore_8h_source.html">statestore.h</a></li>
<li>be/src/statestore/<a class="el" href="statestore_8cc_source.html">statestore.cc</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceimpala.html">impala</a></li><li class="navelem"><a class="el" href="classimpala_1_1Statestore.html">Statestore</a></li>
    <li class="footer">Generated on Thu May 7 2015 16:10:50 for Impala by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
