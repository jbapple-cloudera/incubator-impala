<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Impala: be/src/runtime/buffered-tuple-stream.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Impala
   </div>
   <div id="projectbrief">Impalaistheopensource,nativeanalyticdatabaseforApacheHadoop.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('buffered-tuple-stream_8cc_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">buffered-tuple-stream.cc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="buffered-tuple-stream_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright 2013 Cloudera Inc.</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// you may not use this file except in compliance with the License.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// You may obtain a copy of the License at</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// See the License for the specific language governing permissions and</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// limitations under the License.</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="buffered-tuple-stream_8h.html">runtime/buffered-tuple-stream.h</a>&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;boost/bind.hpp&gt;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;gutil/strings/substitute.h&gt;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="descriptors_8h.html">runtime/descriptors.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="row-batch_8h.html">runtime/row-batch.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="tuple-row_8h.html">runtime/tuple-row.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="bit-util_8h.html">util/bit-util.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="debug-util_8h.html">util/debug-util.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="names_8h.html">common/names.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">using namespace </span>impala;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">using namespace </span>strings;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">// The first NUM_SMALL_BLOCKS of the tuple stream are made of blocks less than the</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">// IO size. These blocks never spill.</span></div>
<div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="buffered-tuple-stream_8cc.html#a8e7d39f14a29b6446722800442d8d7fe">   33</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> int64_t <a class="code" href="buffered-tuple-stream_8cc.html#a8e7d39f14a29b6446722800442d8d7fe">INITIAL_BLOCK_SIZES</a>[] =</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    { 64 * 1024, 512 * 1024 };</div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="buffered-tuple-stream_8cc.html#a2c16c11fb7f64ff4dbe4e078bfc5bea3">   35</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="buffered-tuple-stream_8cc.html#a2c16c11fb7f64ff4dbe4e078bfc5bea3">NUM_SMALL_BLOCKS</a> = <span class="keyword">sizeof</span>(<a class="code" href="buffered-tuple-stream_8cc.html#a8e7d39f14a29b6446722800442d8d7fe">INITIAL_BLOCK_SIZES</a>) / <span class="keyword">sizeof</span>(int64_t);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="structimpala_1_1BufferedTupleStream_1_1RowIdx.html#a431215848544ca0af04357ff722c5f80">   37</a></span>&#160;<span class="keywordtype">string</span> <a class="code" href="structimpala_1_1BufferedTupleStream_1_1RowIdx.html#a431215848544ca0af04357ff722c5f80">BufferedTupleStream::RowIdx::DebugString</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  stringstream ss;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  ss &lt;&lt; <span class="stringliteral">&quot;RowIdx block=&quot;</span> &lt;&lt; block() &lt;&lt; <span class="stringliteral">&quot; offset=&quot;</span> &lt;&lt; <a class="code" href="partitioning-throughput-test_8cc.html#ad172ecfd5c31c5df6282c2b4bc322bf7">offset</a>() &lt;&lt; <span class="stringliteral">&quot; idx=&quot;</span> &lt;&lt; <a class="code" href="namespacegen__ir__descriptions.html#a0d6572990c8dd576a55a21ff11d6deb7">idx</a>();</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="keywordflow">return</span> ss.str();</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;}</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="classimpala_1_1BufferedTupleStream.html#abe18798dd236710e215baec9902023bb">   43</a></span>&#160;<a class="code" href="classimpala_1_1BufferedTupleStream.html#abe18798dd236710e215baec9902023bb">BufferedTupleStream::BufferedTupleStream</a>(<a class="code" href="classimpala_1_1RuntimeState.html">RuntimeState</a>* state,</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keyword">const</span> <a class="code" href="classimpala_1_1RowDescriptor.html">RowDescriptor</a>&amp; <a class="code" href="namespaceimpala.html#aa98447566dd6700a2faaaaf3059f4d95">row_desc</a>, <a class="code" href="classimpala_1_1BufferedBlockMgr.html">BufferedBlockMgr</a>* block_mgr,</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <a class="code" href="structimpala_1_1BufferedBlockMgr_1_1Client.html">BufferedBlockMgr::Client</a>* client, <span class="keywordtype">bool</span> use_initial_small_buffers,</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordtype">bool</span> delete_on_read, <span class="keywordtype">bool</span> read_write)</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  : use_small_buffers_(use_initial_small_buffers),</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    delete_on_read_(delete_on_read),</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    read_write_(read_write),</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    state_(state),</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    desc_(row_desc),</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    nullable_tuple_(row_desc.IsAnyTupleNullable()),</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    block_mgr_(block_mgr),</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    block_mgr_client_(client),</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    total_byte_size_(0),</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    read_ptr_(NULL),</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    read_tuple_idx_(0),</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    read_bytes_(0),</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    rows_returned_(0),</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    read_block_idx_(-1),</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    write_block_(NULL),</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    num_pinned_(0),</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    num_small_blocks_(0),</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    closed_(false),</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    num_rows_(0),</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    pinned_(true),</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    pin_timer_(NULL),</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    unpin_timer_(NULL),</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    get_new_block_timer_(NULL) {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <a class="code" href="classimpala_1_1BufferedTupleStream.html#acfed70ae36697f861227e5f55c6a7d9a">null_indicators_read_block_</a> = <a class="code" href="classimpala_1_1BufferedTupleStream.html#ab0313f195d91db86e2d86eeeda553e7a">null_indicators_write_block_</a> = -1;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <a class="code" href="classimpala_1_1BufferedTupleStream.html#a7f864ab630476a8d77b5a4b51a81604b">read_block_</a> = <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.end();</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <a class="code" href="classimpala_1_1BufferedTupleStream.html#a2dcdf8dc3f624e131420e4f010d8fb83">fixed_tuple_row_size_</a> = 0;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classimpala_1_1BufferedTupleStream.html#aadb29f0e9d4e4693e1716158eee829ec">desc_</a>.<a class="code" href="classimpala_1_1RowDescriptor.html#a3d57439c68d08fe374c33370529a855c">tuple_descriptors</a>().size(); ++i) {</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keyword">const</span> <a class="code" href="classimpala_1_1TupleDescriptor.html">TupleDescriptor</a>* tuple_desc = <a class="code" href="classimpala_1_1BufferedTupleStream.html#aadb29f0e9d4e4693e1716158eee829ec">desc_</a>.<a class="code" href="classimpala_1_1RowDescriptor.html#a3d57439c68d08fe374c33370529a855c">tuple_descriptors</a>()[i];</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> tuple_byte_size = tuple_desc-&gt;<a class="code" href="classimpala_1_1TupleDescriptor.html#a153205d9bf39422c853b5bd5f54a9485">byte_size</a>();</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <a class="code" href="classimpala_1_1BufferedTupleStream.html#a2dcdf8dc3f624e131420e4f010d8fb83">fixed_tuple_row_size_</a> += tuple_byte_size;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordflow">if</span> (tuple_desc-&gt;<a class="code" href="classimpala_1_1TupleDescriptor.html#a3f0ffae3775bf65b21c0b74ab825d084">string_slots</a>().empty()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <a class="code" href="classimpala_1_1BufferedTupleStream.html#a08beb5c3c7bded04f1de51c3da10c89a">string_slots_</a>.push_back(make_pair(i, tuple_desc-&gt;<a class="code" href="classimpala_1_1TupleDescriptor.html#a3f0ffae3775bf65b21c0b74ab825d084">string_slots</a>()));</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  }</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;}</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">// Returns the number of pinned blocks in the list. Only called in DCHECKs to validate</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">// num_pinned_.</span></div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="buffered-tuple-stream_8cc.html#a37f1aacc6a0ce5c8d4962e2bbeaec604">   84</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="buffered-tuple-stream_8cc.html#a37f1aacc6a0ce5c8d4962e2bbeaec604">NumPinned</a>(<span class="keyword">const</span> list&lt;BufferedBlockMgr::Block*&gt;&amp; blocks) {</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordtype">int</span> num_pinned = 0;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="keywordflow">for</span> (list&lt;BufferedBlockMgr::Block*&gt;::const_iterator it = blocks.begin();</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      it != blocks.end(); ++it) {</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordflow">if</span> ((*it)-&gt;is_pinned() &amp;&amp; (*it)-&gt;is_max_size()) ++num_pinned;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  }</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="keywordflow">return</span> num_pinned;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;}</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="classimpala_1_1BufferedTupleStream.html#a4121e3bb85a9a0c2612930a7aed61807">   93</a></span>&#160;<span class="keywordtype">string</span> <a class="code" href="classimpala_1_1BufferedTupleStream.html#a4121e3bb85a9a0c2612930a7aed61807">BufferedTupleStream::DebugString</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  stringstream ss;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  ss &lt;&lt; <span class="stringliteral">&quot;BufferedTupleStream num_rows=&quot;</span> &lt;&lt; <a class="code" href="classimpala_1_1BufferedTupleStream.html#ae35acc9106a9bc881e8a1127cc57a198">num_rows_</a> &lt;&lt; <span class="stringliteral">&quot; rows_returned=&quot;</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;     &lt;&lt; <a class="code" href="classimpala_1_1BufferedTupleStream.html#ab6fc6d8b3e3aa42fcaba7f3821ed2c33">rows_returned_</a> &lt;&lt; <span class="stringliteral">&quot; pinned=&quot;</span> &lt;&lt; (<a class="code" href="classimpala_1_1BufferedTupleStream.html#a707b3fddb8c72b48232682dee77cb06c">pinned_</a> ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>)</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; delete_on_read=&quot;</span> &lt;&lt; (<a class="code" href="classimpala_1_1BufferedTupleStream.html#a2882935e6094afad5fc930f2a757e547">delete_on_read_</a> ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>)</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; closed=&quot;</span> &lt;&lt; (<a class="code" href="classimpala_1_1BufferedTupleStream.html#a2a42e34f0b5faaa053704b93287f1df7">closed_</a> ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>)</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; num_pinned=&quot;</span> &lt;&lt; <a class="code" href="classimpala_1_1BufferedTupleStream.html#a54c7376a284c281622eb888ae277d558">num_pinned_</a></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; write_block=&quot;</span> &lt;&lt; <a class="code" href="classimpala_1_1BufferedTupleStream.html#a1253dcec8226c94833f74bc80a2b90b3">write_block_</a> &lt;&lt; <span class="stringliteral">&quot; read_block_=&quot;</span>;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1BufferedTupleStream.html#a7f864ab630476a8d77b5a4b51a81604b">read_block_</a> == <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.end()) {</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    ss &lt;&lt; <span class="stringliteral">&quot;&lt;end&gt;&quot;</span>;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    ss &lt;&lt; *<a class="code" href="classimpala_1_1BufferedTupleStream.html#a7f864ab630476a8d77b5a4b51a81604b">read_block_</a>;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  }</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  ss &lt;&lt; <span class="stringliteral">&quot; blocks=[\n&quot;</span>;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keywordflow">for</span> (list&lt;BufferedBlockMgr::Block*&gt;::const_iterator it = <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.begin();</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      it != <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.end(); ++it) {</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    ss &lt;&lt; <span class="stringliteral">&quot;{&quot;</span> &lt;&lt; (*it)-&gt;DebugString() &lt;&lt; <span class="stringliteral">&quot;}&quot;</span>;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordflow">if</span> (*it != <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.back()) ss &lt;&lt; <span class="stringliteral">&quot;,\n&quot;</span>;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  }</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  ss &lt;&lt; <span class="stringliteral">&quot;]&quot;</span>;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="keywordflow">return</span> ss.str();</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;}</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div>
<div class="line"><a name="l00116"></a><span class="lineno"><a class="line" href="classimpala_1_1BufferedTupleStream.html#ae4e2e76ff44f09a358c6c36827da9f50">  116</a></span>&#160;<a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1BufferedTupleStream.html#ae4e2e76ff44f09a358c6c36827da9f50">BufferedTupleStream::Init</a>(<a class="code" href="classimpala_1_1RuntimeProfile.html">RuntimeProfile</a>* profile, <span class="keywordtype">bool</span> pinned) {</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="keywordflow">if</span> (profile != NULL) {</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <a class="code" href="classimpala_1_1BufferedTupleStream.html#a09839179a512779b0c1a584ba96be59f">pin_timer_</a> = <a class="code" href="runtime-profile_8h.html#a8841ca205b2a05d608e82d443bad3a77">ADD_TIMER</a>(profile, <span class="stringliteral">&quot;PinTime&quot;</span>);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <a class="code" href="classimpala_1_1BufferedTupleStream.html#a758fc2bf68fb5a11145b606a93122820">unpin_timer_</a> = <a class="code" href="runtime-profile_8h.html#a8841ca205b2a05d608e82d443bad3a77">ADD_TIMER</a>(profile, <span class="stringliteral">&quot;UnpinTime&quot;</span>);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <a class="code" href="classimpala_1_1BufferedTupleStream.html#a7265887dc92e2d30d36cd92de6dfcfe0">get_new_block_timer_</a> = <a class="code" href="runtime-profile_8h.html#a8841ca205b2a05d608e82d443bad3a77">ADD_TIMER</a>(profile, <span class="stringliteral">&quot;GetNewBlockTime&quot;</span>);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  }</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1BufferedTupleStream.html#a691dc8b7d5efbb60c41e7301dc5a63b6">block_mgr_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr.html#ac6e6d613d4ed039d310d789ead20e231">max_block_size</a>() &lt; <a class="code" href="buffered-tuple-stream_8cc.html#a8e7d39f14a29b6446722800442d8d7fe">INITIAL_BLOCK_SIZES</a>[0]) {</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <a class="code" href="classimpala_1_1BufferedTupleStream.html#a0c6479bc0cba32fa1f053c29200c473b">use_small_buffers_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  }</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keywordtype">bool</span> got_block = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#afe2947af8d8829e0aa56df12eb32da87">NewBlockForWrite</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a2dcdf8dc3f624e131420e4f010d8fb83">fixed_tuple_row_size_</a>, &amp;got_block));</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="keywordflow">if</span> (!got_block) <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1BufferedTupleStream.html#a691dc8b7d5efbb60c41e7301dc5a63b6">block_mgr_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr.html#a56f3200d738096167c3e6a50d077ced8">MemLimitTooLowError</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#ada77a4e348b105775fd52e8e39743998">block_mgr_client_</a>);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  DCHECK(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a1253dcec8226c94833f74bc80a2b90b3">write_block_</a> != NULL);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1BufferedTupleStream.html#adbe5ffb56ce04fb412628dfa8fa3ff84">read_write_</a>) <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a4f537ea0c46ce3dfc77a5b3bf58a07af">PrepareForRead</a>());</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="keywordflow">if</span> (!pinned) <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a9d2f211df83a684b2a644d2b8a179026">UnpinStream</a>());</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;}</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div>
<div class="line"><a name="l00136"></a><span class="lineno"><a class="line" href="classimpala_1_1BufferedTupleStream.html#a21cc752d4db27e53c163e155f5da61e9">  136</a></span>&#160;<a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1BufferedTupleStream.html#a21cc752d4db27e53c163e155f5da61e9">BufferedTupleStream::SwitchToIoBuffers</a>(<span class="keywordtype">bool</span>* got_buffer) {</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classimpala_1_1BufferedTupleStream.html#a0c6479bc0cba32fa1f053c29200c473b">use_small_buffers_</a>) {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    *got_buffer = (<a class="code" href="classimpala_1_1BufferedTupleStream.html#a1253dcec8226c94833f74bc80a2b90b3">write_block_</a> != NULL);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  }</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <a class="code" href="classimpala_1_1BufferedTupleStream.html#a0c6479bc0cba32fa1f053c29200c473b">use_small_buffers_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1BufferedTupleStream.html#afe2947af8d8829e0aa56df12eb32da87">NewBlockForWrite</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a691dc8b7d5efbb60c41e7301dc5a63b6">block_mgr_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr.html#ac6e6d613d4ed039d310d789ead20e231">max_block_size</a>(), got_buffer);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;}</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div>
<div class="line"><a name="l00145"></a><span class="lineno"><a class="line" href="classimpala_1_1BufferedTupleStream.html#a9cb6b2be78a2bff4d5dafd164c3dc0b7">  145</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classimpala_1_1BufferedTupleStream.html#a9cb6b2be78a2bff4d5dafd164c3dc0b7">BufferedTupleStream::Close</a>() {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <span class="keywordflow">for</span> (list&lt;BufferedBlockMgr::Block*&gt;::iterator it = <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.begin();</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      it != <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.end(); ++it) {</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    (*it)-&gt;Delete();</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  }</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.clear();</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <a class="code" href="classimpala_1_1BufferedTupleStream.html#a54c7376a284c281622eb888ae277d558">num_pinned_</a> = 0;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  DCHECK_EQ(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a54c7376a284c281622eb888ae277d558">num_pinned_</a>, <a class="code" href="buffered-tuple-stream_8cc.html#a37f1aacc6a0ce5c8d4962e2bbeaec604">NumPinned</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>));</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <a class="code" href="classimpala_1_1BufferedTupleStream.html#a2a42e34f0b5faaa053704b93287f1df7">closed_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;}</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div>
<div class="line"><a name="l00156"></a><span class="lineno"><a class="line" href="classimpala_1_1BufferedTupleStream.html#ac034f1be3983f354b5b7170e4e5afd62">  156</a></span>&#160;int64_t <a class="code" href="classimpala_1_1BufferedTupleStream.html#ac034f1be3983f354b5b7170e4e5afd62">BufferedTupleStream::bytes_in_mem</a>(<span class="keywordtype">bool</span> ignore_current)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  int64_t result = 0;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="keywordflow">for</span> (list&lt;BufferedBlockMgr::Block*&gt;::const_iterator it = <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.begin();</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      it != <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.end(); ++it) {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">if</span> (!(*it)-&gt;is_pinned()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">if</span> (!(*it)-&gt;is_max_size()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordflow">if</span> (*it == <a class="code" href="classimpala_1_1BufferedTupleStream.html#a1253dcec8226c94833f74bc80a2b90b3">write_block_</a> &amp;&amp; ignore_current) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    result += (*it)-&gt;buffer_len();</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;}</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div>
<div class="line"><a name="l00168"></a><span class="lineno"><a class="line" href="classimpala_1_1BufferedTupleStream.html#a5e3173eca7b0c50e2ef87c02947e69c8">  168</a></span>&#160;<a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1BufferedTupleStream.html#a5e3173eca7b0c50e2ef87c02947e69c8">BufferedTupleStream::UnpinBlock</a>(<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html">BufferedBlockMgr::Block</a>* block) {</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <a class="code" href="runtime-profile_8h.html#aaa9a2971c6368e3ddd3f5140a0295eb7">SCOPED_TIMER</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a758fc2bf68fb5a11145b606a93122820">unpin_timer_</a>);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  DCHECK(block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a678a5f46ff6c1f21cd6409c44fd8e52d">is_pinned</a>());</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keywordflow">if</span> (!block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#ac6eaa4369a88f027db9e0e484fd158e6">is_max_size</a>()) <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a03ad00fa7c792f4fc85ba5e573a30369">Unpin</a>());</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  --<a class="code" href="classimpala_1_1BufferedTupleStream.html#a54c7376a284c281622eb888ae277d558">num_pinned_</a>;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  DCHECK_EQ(num_pinned_, <a class="code" href="buffered-tuple-stream_8cc.html#a37f1aacc6a0ce5c8d4962e2bbeaec604">NumPinned</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>));</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;}</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div>
<div class="line"><a name="l00178"></a><span class="lineno"><a class="line" href="classimpala_1_1BufferedTupleStream.html#afe2947af8d8829e0aa56df12eb32da87">  178</a></span>&#160;<a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1BufferedTupleStream.html#afe2947af8d8829e0aa56df12eb32da87">BufferedTupleStream::NewBlockForWrite</a>(<span class="keywordtype">int</span> min_size, <span class="keywordtype">bool</span>* got_block) {</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  DCHECK(!<a class="code" href="classimpala_1_1BufferedTupleStream.html#a2a42e34f0b5faaa053704b93287f1df7">closed_</a>);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="keywordflow">if</span> (min_size &gt; <a class="code" href="classimpala_1_1BufferedTupleStream.html#a691dc8b7d5efbb60c41e7301dc5a63b6">block_mgr_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr.html#ac6e6d613d4ed039d310d789ead20e231">max_block_size</a>()) {</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html">Status</a>(Substitute(<span class="stringliteral">&quot;Cannot process row that is bigger than the IO size &quot;</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;          <span class="stringliteral">&quot;(row_size=$0). To run this query, increase the IO size (--read_size option).&quot;</span>,</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;          <a class="code" href="classimpala_1_1PrettyPrinter.html#a6e5f06a1ce274f747cc4f9928b797c5a">PrettyPrinter::Print</a>(min_size, TUnit::BYTES)));</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html">BufferedBlockMgr::Block</a>* unpin_block = <a class="code" href="classimpala_1_1BufferedTupleStream.html#a1253dcec8226c94833f74bc80a2b90b3">write_block_</a>;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1BufferedTupleStream.html#a1253dcec8226c94833f74bc80a2b90b3">write_block_</a> != NULL) {</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    DCHECK(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a1253dcec8226c94833f74bc80a2b90b3">write_block_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a678a5f46ff6c1f21cd6409c44fd8e52d">is_pinned</a>());</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1BufferedTupleStream.html#a707b3fddb8c72b48232682dee77cb06c">pinned_</a> || <a class="code" href="classimpala_1_1BufferedTupleStream.html#a1253dcec8226c94833f74bc80a2b90b3">write_block_</a> == *<a class="code" href="classimpala_1_1BufferedTupleStream.html#a7f864ab630476a8d77b5a4b51a81604b">read_block_</a> || !<a class="code" href="classimpala_1_1BufferedTupleStream.html#a1253dcec8226c94833f74bc80a2b90b3">write_block_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#ac6eaa4369a88f027db9e0e484fd158e6">is_max_size</a>()) {</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      <span class="comment">// In these cases, don&#39;t unpin the current write block.</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      unpin_block = NULL;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    }</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  }</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  int64_t block_len = <a class="code" href="classimpala_1_1BufferedTupleStream.html#a691dc8b7d5efbb60c41e7301dc5a63b6">block_mgr_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr.html#ac6e6d613d4ed039d310d789ead20e231">max_block_size</a>();</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1BufferedTupleStream.html#a0c6479bc0cba32fa1f053c29200c473b">use_small_buffers_</a>) {</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.size() &lt; <a class="code" href="buffered-tuple-stream_8cc.html#a2c16c11fb7f64ff4dbe4e078bfc5bea3">NUM_SMALL_BLOCKS</a>) {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      block_len = min(block_len, <a class="code" href="buffered-tuple-stream_8cc.html#a8e7d39f14a29b6446722800442d8d7fe">INITIAL_BLOCK_SIZES</a>[<a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.size()]);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      <span class="keywordflow">if</span> (block_len &lt; min_size) block_len = <a class="code" href="classimpala_1_1BufferedTupleStream.html#a691dc8b7d5efbb60c41e7301dc5a63b6">block_mgr_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr.html#ac6e6d613d4ed039d310d789ead20e231">max_block_size</a>();</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    }</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">if</span> (block_len == <a class="code" href="classimpala_1_1BufferedTupleStream.html#a691dc8b7d5efbb60c41e7301dc5a63b6">block_mgr_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr.html#ac6e6d613d4ed039d310d789ead20e231">max_block_size</a>()) {</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="comment">// Cannot switch to non small buffers automatically. Don&#39;t get a buffer.</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      *got_block = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    }</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  }</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html">BufferedBlockMgr::Block</a>* new_block = NULL;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <a class="code" href="runtime-profile_8h.html#aaa9a2971c6368e3ddd3f5140a0295eb7">SCOPED_TIMER</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a7265887dc92e2d30d36cd92de6dfcfe0">get_new_block_timer_</a>);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a691dc8b7d5efbb60c41e7301dc5a63b6">block_mgr_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr.html#ac4ddea92960294d8f764c2974fe273f9">GetNewBlock</a>(</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <a class="code" href="classimpala_1_1BufferedTupleStream.html#ada77a4e348b105775fd52e8e39743998">block_mgr_client_</a>, unpin_block, &amp;new_block, block_len));</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  }</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  *got_block = (new_block != NULL);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="keywordflow">if</span> (!*got_block) {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    DCHECK(unpin_block == NULL);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  }</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="keywordflow">if</span> (unpin_block != NULL) {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    DCHECK(unpin_block == <a class="code" href="classimpala_1_1BufferedTupleStream.html#a1253dcec8226c94833f74bc80a2b90b3">write_block_</a>);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    DCHECK(!<a class="code" href="classimpala_1_1BufferedTupleStream.html#a1253dcec8226c94833f74bc80a2b90b3">write_block_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a678a5f46ff6c1f21cd6409c44fd8e52d">is_pinned</a>());</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    --<a class="code" href="classimpala_1_1BufferedTupleStream.html#a54c7376a284c281622eb888ae277d558">num_pinned_</a>;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    DCHECK_EQ(num_pinned_, <a class="code" href="buffered-tuple-stream_8cc.html#a37f1aacc6a0ce5c8d4962e2bbeaec604">NumPinned</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>));</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  }</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="comment">// Compute and allocate the block header with the null indicators</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <a class="code" href="classimpala_1_1BufferedTupleStream.html#ab0313f195d91db86e2d86eeeda553e7a">null_indicators_write_block_</a> = <a class="code" href="classimpala_1_1BufferedTupleStream.html#a456ca7b067874e762d10212703de1498">ComputeNumNullIndicatorBytes</a>(block_len);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  new_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#ae9e943bc0fae320e955500d0cd74a293">Allocate</a>&lt;uint8_t&gt;(<a class="code" href="classimpala_1_1BufferedTupleStream.html#ab0313f195d91db86e2d86eeeda553e7a">null_indicators_write_block_</a>);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <a class="code" href="classimpala_1_1BufferedTupleStream.html#a85fea074aae6b4f949280df51ccb233c">write_tuple_idx_</a> = 0;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.push_back(new_block);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <a class="code" href="classimpala_1_1BufferedTupleStream.html#a1b9da094a3d35db33e21cd581e4c762d">block_start_idx_</a>.push_back(new_block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a3beba257e3649515dd06d31a42667d5e">buffer</a>());</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <a class="code" href="classimpala_1_1BufferedTupleStream.html#a1253dcec8226c94833f74bc80a2b90b3">write_block_</a> = new_block;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  DCHECK(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a1253dcec8226c94833f74bc80a2b90b3">write_block_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a678a5f46ff6c1f21cd6409c44fd8e52d">is_pinned</a>());</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  DCHECK_EQ(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a1253dcec8226c94833f74bc80a2b90b3">write_block_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a0f1e51ff5ab49e2114c837398671b071">num_rows</a>(), 0);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1BufferedTupleStream.html#a1253dcec8226c94833f74bc80a2b90b3">write_block_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#ac6eaa4369a88f027db9e0e484fd158e6">is_max_size</a>()) {</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    ++<a class="code" href="classimpala_1_1BufferedTupleStream.html#a54c7376a284c281622eb888ae277d558">num_pinned_</a>;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    DCHECK_EQ(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a54c7376a284c281622eb888ae277d558">num_pinned_</a>, <a class="code" href="buffered-tuple-stream_8cc.html#a37f1aacc6a0ce5c8d4962e2bbeaec604">NumPinned</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>));</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    ++<a class="code" href="classimpala_1_1BufferedTupleStream.html#a115418648d4c9755e7dbd0cfa2c0b9f0">num_small_blocks_</a>;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  }</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <a class="code" href="classimpala_1_1BufferedTupleStream.html#ad905a907a64f8cd48cfebac638200c99">total_byte_size_</a> += block_len;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;}</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div>
<div class="line"><a name="l00248"></a><span class="lineno"><a class="line" href="classimpala_1_1BufferedTupleStream.html#a4f0d29df7e0a357db35ad63230833d5d">  248</a></span>&#160;<a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1BufferedTupleStream.html#a4f0d29df7e0a357db35ad63230833d5d">BufferedTupleStream::NextBlockForRead</a>() {</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  DCHECK(!<a class="code" href="classimpala_1_1BufferedTupleStream.html#a2a42e34f0b5faaa053704b93287f1df7">closed_</a>);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  DCHECK(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a7f864ab630476a8d77b5a4b51a81604b">read_block_</a> != <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.end());</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  DCHECK_EQ(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a54c7376a284c281622eb888ae277d558">num_pinned_</a>, <a class="code" href="buffered-tuple-stream_8cc.html#a37f1aacc6a0ce5c8d4962e2bbeaec604">NumPinned</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>)) &lt;&lt; <a class="code" href="classimpala_1_1BufferedTupleStream.html#a707b3fddb8c72b48232682dee77cb06c">pinned_</a>;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="comment">// If non-NULL, this will be the current block if we are going to free it while</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="comment">// grabbing the next block. This will stay NULL if we don&#39;t want to free the</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="comment">// current block.</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html">BufferedBlockMgr::Block</a>* block_to_free =</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      (!pinned_ || <a class="code" href="classimpala_1_1BufferedTupleStream.html#a2882935e6094afad5fc930f2a757e547">delete_on_read_</a>) ? *<a class="code" href="classimpala_1_1BufferedTupleStream.html#a7f864ab630476a8d77b5a4b51a81604b">read_block_</a> : NULL;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1BufferedTupleStream.html#a2882935e6094afad5fc930f2a757e547">delete_on_read_</a>) {</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="comment">// TODO: this is weird. We are deleting even if it is pinned. The analytic</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="comment">// eval node needs this.</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    DCHECK(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a7f864ab630476a8d77b5a4b51a81604b">read_block_</a> == <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.begin());</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    DCHECK(*<a class="code" href="classimpala_1_1BufferedTupleStream.html#a7f864ab630476a8d77b5a4b51a81604b">read_block_</a> != <a class="code" href="classimpala_1_1BufferedTupleStream.html#a1253dcec8226c94833f74bc80a2b90b3">write_block_</a>);</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.pop_front();</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <a class="code" href="classimpala_1_1BufferedTupleStream.html#a7f864ab630476a8d77b5a4b51a81604b">read_block_</a> = <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.begin();</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <a class="code" href="classimpala_1_1BufferedTupleStream.html#a79f040358dacbbab993af134f709ca0a">read_block_idx_</a> = 0;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">if</span> (block_to_free != NULL &amp;&amp; !block_to_free-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#ac6eaa4369a88f027db9e0e484fd158e6">is_max_size</a>()) {</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(block_to_free-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a98ac414f60e71a25c45ec2526c5bcf87">Delete</a>());</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      block_to_free = NULL;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      DCHECK_EQ(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a54c7376a284c281622eb888ae277d558">num_pinned_</a>, <a class="code" href="buffered-tuple-stream_8cc.html#a37f1aacc6a0ce5c8d4962e2bbeaec604">NumPinned</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>)) &lt;&lt; <a class="code" href="classimpala_1_1BufferedTupleStream.html#a4121e3bb85a9a0c2612930a7aed61807">DebugString</a>();</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    }</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    ++<a class="code" href="classimpala_1_1BufferedTupleStream.html#a7f864ab630476a8d77b5a4b51a81604b">read_block_</a>;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    ++<a class="code" href="classimpala_1_1BufferedTupleStream.html#a79f040358dacbbab993af134f709ca0a">read_block_idx_</a>;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">if</span> (block_to_free != NULL &amp;&amp; !block_to_free-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#ac6eaa4369a88f027db9e0e484fd158e6">is_max_size</a>()) block_to_free = NULL;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  }</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <a class="code" href="classimpala_1_1BufferedTupleStream.html#adb1ca6bf40ac1b240a0c50923e4d7f24">read_ptr_</a> = NULL;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <a class="code" href="classimpala_1_1BufferedTupleStream.html#a68aaaeaae3c217e698ce2ca6097d0e43">read_tuple_idx_</a> = 0;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <a class="code" href="classimpala_1_1BufferedTupleStream.html#aa2229061216f10cfa13936bb38d88cd0">read_bytes_</a> = 0;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="keywordtype">bool</span> pinned = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1BufferedTupleStream.html#a7f864ab630476a8d77b5a4b51a81604b">read_block_</a> == <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.end() || (*read_block_)-&gt;is_pinned()) {</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="comment">// End of the blocks or already pinned, just handle block_to_free</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">if</span> (block_to_free != NULL) {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <a class="code" href="runtime-profile_8h.html#aaa9a2971c6368e3ddd3f5140a0295eb7">SCOPED_TIMER</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a758fc2bf68fb5a11145b606a93122820">unpin_timer_</a>);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1BufferedTupleStream.html#a2882935e6094afad5fc930f2a757e547">delete_on_read_</a>) {</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(block_to_free-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a98ac414f60e71a25c45ec2526c5bcf87">Delete</a>());</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        --<a class="code" href="classimpala_1_1BufferedTupleStream.html#a54c7376a284c281622eb888ae277d558">num_pinned_</a>;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a5e3173eca7b0c50e2ef87c02947e69c8">UnpinBlock</a>(block_to_free));</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      }</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    }</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="comment">// Call into the block mgr to atomically unpin/delete the old block and pin the</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="comment">// new block.</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <a class="code" href="runtime-profile_8h.html#aaa9a2971c6368e3ddd3f5140a0295eb7">SCOPED_TIMER</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a09839179a512779b0c1a584ba96be59f">pin_timer_</a>);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>((*read_block_)-&gt;Pin(&amp;pinned, block_to_free, !<a class="code" href="classimpala_1_1BufferedTupleStream.html#a2882935e6094afad5fc930f2a757e547">delete_on_read_</a>));</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordflow">if</span> (!pinned) {</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      DCHECK(block_to_free == NULL) &lt;&lt; <span class="stringliteral">&quot;Should have been able to pin.&quot;</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;          &lt;&lt; endl &lt;&lt; <a class="code" href="classimpala_1_1BufferedTupleStream.html#a691dc8b7d5efbb60c41e7301dc5a63b6">block_mgr_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr.html#a1dba9cde4a03d0d395bcb59345db7248">DebugString</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#ada77a4e348b105775fd52e8e39743998">block_mgr_client_</a>);;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    }</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordflow">if</span> (block_to_free == NULL &amp;&amp; pinned) ++<a class="code" href="classimpala_1_1BufferedTupleStream.html#a54c7376a284c281622eb888ae277d558">num_pinned_</a>;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  }</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1BufferedTupleStream.html#a7f864ab630476a8d77b5a4b51a81604b">read_block_</a> != <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.end() &amp;&amp; (*read_block_)-&gt;is_pinned()) {</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <a class="code" href="classimpala_1_1BufferedTupleStream.html#acfed70ae36697f861227e5f55c6a7d9a">null_indicators_read_block_</a> =</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <a class="code" href="classimpala_1_1BufferedTupleStream.html#a456ca7b067874e762d10212703de1498">ComputeNumNullIndicatorBytes</a>((*read_block_)-&gt;buffer_len());</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <a class="code" href="classimpala_1_1BufferedTupleStream.html#adb1ca6bf40ac1b240a0c50923e4d7f24">read_ptr_</a> = (*read_block_)-&gt;buffer() + <a class="code" href="classimpala_1_1BufferedTupleStream.html#acfed70ae36697f861227e5f55c6a7d9a">null_indicators_read_block_</a>;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  }</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  DCHECK_EQ(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a54c7376a284c281622eb888ae277d558">num_pinned_</a>, <a class="code" href="buffered-tuple-stream_8cc.html#a37f1aacc6a0ce5c8d4962e2bbeaec604">NumPinned</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>)) &lt;&lt; <a class="code" href="classimpala_1_1BufferedTupleStream.html#a4121e3bb85a9a0c2612930a7aed61807">DebugString</a>();</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;}</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div>
<div class="line"><a name="l00314"></a><span class="lineno"><a class="line" href="classimpala_1_1BufferedTupleStream.html#a4f537ea0c46ce3dfc77a5b3bf58a07af">  314</a></span>&#160;<a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1BufferedTupleStream.html#a4f537ea0c46ce3dfc77a5b3bf58a07af">BufferedTupleStream::PrepareForRead</a>(<span class="keywordtype">bool</span>* got_buffer) {</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  DCHECK(!<a class="code" href="classimpala_1_1BufferedTupleStream.html#a2a42e34f0b5faaa053704b93287f1df7">closed_</a>);</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.empty()) <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classimpala_1_1BufferedTupleStream.html#adbe5ffb56ce04fb412628dfa8fa3ff84">read_write_</a> &amp;&amp; <a class="code" href="classimpala_1_1BufferedTupleStream.html#a1253dcec8226c94833f74bc80a2b90b3">write_block_</a> != NULL) {</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    DCHECK(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a1253dcec8226c94833f74bc80a2b90b3">write_block_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a678a5f46ff6c1f21cd6409c44fd8e52d">is_pinned</a>());</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classimpala_1_1BufferedTupleStream.html#a707b3fddb8c72b48232682dee77cb06c">pinned_</a> &amp;&amp; <a class="code" href="classimpala_1_1BufferedTupleStream.html#a1253dcec8226c94833f74bc80a2b90b3">write_block_</a> != <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.front()) {</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a5e3173eca7b0c50e2ef87c02947e69c8">UnpinBlock</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a1253dcec8226c94833f74bc80a2b90b3">write_block_</a>));</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    }</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <a class="code" href="classimpala_1_1BufferedTupleStream.html#a1253dcec8226c94833f74bc80a2b90b3">write_block_</a> = NULL;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  }</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="comment">// Walk the blocks and pin the first non-io sized block.</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="keywordflow">for</span> (list&lt;BufferedBlockMgr::Block*&gt;::iterator it = <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.begin();</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      it != <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.end(); ++it) {</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordflow">if</span> (!(*it)-&gt;is_pinned()) {</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      <a class="code" href="runtime-profile_8h.html#aaa9a2971c6368e3ddd3f5140a0295eb7">SCOPED_TIMER</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a09839179a512779b0c1a584ba96be59f">pin_timer_</a>);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      <span class="keywordtype">bool</span> current_pinned;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>((*it)-&gt;Pin(&amp;current_pinned));</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <span class="keywordflow">if</span> (!current_pinned) {</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        DCHECK(got_buffer != NULL) &lt;&lt; <span class="stringliteral">&quot;Should have reserved enough blocks&quot;</span>;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        *got_buffer = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      }</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      ++<a class="code" href="classimpala_1_1BufferedTupleStream.html#a54c7376a284c281622eb888ae277d558">num_pinned_</a>;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      DCHECK_EQ(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a54c7376a284c281622eb888ae277d558">num_pinned_</a>, <a class="code" href="buffered-tuple-stream_8cc.html#a37f1aacc6a0ce5c8d4962e2bbeaec604">NumPinned</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>));</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    }</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordflow">if</span> ((*it)-&gt;is_max_size()) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  }</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <a class="code" href="classimpala_1_1BufferedTupleStream.html#a7f864ab630476a8d77b5a4b51a81604b">read_block_</a> = <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.begin();</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  DCHECK(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a7f864ab630476a8d77b5a4b51a81604b">read_block_</a> != <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.end());</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <a class="code" href="classimpala_1_1BufferedTupleStream.html#acfed70ae36697f861227e5f55c6a7d9a">null_indicators_read_block_</a> =</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      <a class="code" href="classimpala_1_1BufferedTupleStream.html#a456ca7b067874e762d10212703de1498">ComputeNumNullIndicatorBytes</a>((*read_block_)-&gt;buffer_len());</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <a class="code" href="classimpala_1_1BufferedTupleStream.html#adb1ca6bf40ac1b240a0c50923e4d7f24">read_ptr_</a> = (*read_block_)-&gt;buffer() + <a class="code" href="classimpala_1_1BufferedTupleStream.html#acfed70ae36697f861227e5f55c6a7d9a">null_indicators_read_block_</a>;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <a class="code" href="classimpala_1_1BufferedTupleStream.html#a68aaaeaae3c217e698ce2ca6097d0e43">read_tuple_idx_</a> = 0;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <a class="code" href="classimpala_1_1BufferedTupleStream.html#aa2229061216f10cfa13936bb38d88cd0">read_bytes_</a> = 0;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <a class="code" href="classimpala_1_1BufferedTupleStream.html#ab6fc6d8b3e3aa42fcaba7f3821ed2c33">rows_returned_</a> = 0;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <a class="code" href="classimpala_1_1BufferedTupleStream.html#a79f040358dacbbab993af134f709ca0a">read_block_idx_</a> = 0;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="keywordflow">if</span> (got_buffer != NULL) *got_buffer = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;}</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div>
<div class="line"><a name="l00357"></a><span class="lineno"><a class="line" href="classimpala_1_1BufferedTupleStream.html#a066d00bdf6f36be1f08bc8a6d64154ac">  357</a></span>&#160;<a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1BufferedTupleStream.html#a066d00bdf6f36be1f08bc8a6d64154ac">BufferedTupleStream::PinStream</a>(<span class="keywordtype">bool</span> already_reserved, <span class="keywordtype">bool</span>* pinned) {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  DCHECK(!<a class="code" href="classimpala_1_1BufferedTupleStream.html#a2a42e34f0b5faaa053704b93287f1df7">closed_</a>);</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  DCHECK_NOTNULL(pinned);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="keywordflow">if</span> (!already_reserved) {</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="comment">// If we can&#39;t get all the blocks, don&#39;t try at all.</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classimpala_1_1BufferedTupleStream.html#a691dc8b7d5efbb60c41e7301dc5a63b6">block_mgr_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr.html#aa9b3d1904de97e5829b8d8fe880ba506">TryAcquireTmpReservation</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#ada77a4e348b105775fd52e8e39743998">block_mgr_client_</a>, <a class="code" href="classimpala_1_1BufferedTupleStream.html#ad2aeaf7b3790a34697dd682544ae9af7">blocks_unpinned</a>())) {</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      *pinned = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    }</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  }</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <span class="keywordflow">for</span> (list&lt;BufferedBlockMgr::Block*&gt;::iterator it = <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.begin();</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      it != <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.end(); ++it) {</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="keywordflow">if</span> ((*it)-&gt;is_pinned()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      <a class="code" href="runtime-profile_8h.html#aaa9a2971c6368e3ddd3f5140a0295eb7">SCOPED_TIMER</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a09839179a512779b0c1a584ba96be59f">pin_timer_</a>);</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>((*it)-&gt;Pin(pinned));</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    }</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <a class="code" href="logging_8h.html#a916e38366cee7c32fd5fae7e2ee5e4a9">VLOG_QUERY</a> &lt;&lt; <span class="stringliteral">&quot;Should have been reserved.&quot;</span> &lt;&lt; endl</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;               &lt;&lt; <a class="code" href="classimpala_1_1BufferedTupleStream.html#a691dc8b7d5efbb60c41e7301dc5a63b6">block_mgr_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr.html#a1dba9cde4a03d0d395bcb59345db7248">DebugString</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#ada77a4e348b105775fd52e8e39743998">block_mgr_client_</a>);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="keywordflow">if</span> (!*pinned) <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    ++<a class="code" href="classimpala_1_1BufferedTupleStream.html#a54c7376a284c281622eb888ae277d558">num_pinned_</a>;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    DCHECK_EQ(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a54c7376a284c281622eb888ae277d558">num_pinned_</a>, <a class="code" href="buffered-tuple-stream_8cc.html#a37f1aacc6a0ce5c8d4962e2bbeaec604">NumPinned</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>));</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  }</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classimpala_1_1BufferedTupleStream.html#a2882935e6094afad5fc930f2a757e547">delete_on_read_</a>) {</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="comment">// Populate block_start_idx_ on pin.</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    DCHECK_EQ(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a1b9da094a3d35db33e21cd581e4c762d">block_start_idx_</a>.size(), <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.size());</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <a class="code" href="classimpala_1_1BufferedTupleStream.html#a1b9da094a3d35db33e21cd581e4c762d">block_start_idx_</a>.clear();</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keywordflow">for</span> (list&lt;BufferedBlockMgr::Block*&gt;::iterator it = <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.begin();</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        it != <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.end(); ++it) {</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      <a class="code" href="classimpala_1_1BufferedTupleStream.html#a1b9da094a3d35db33e21cd581e4c762d">block_start_idx_</a>.push_back((*it)-&gt;buffer());</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    }</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  }</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  *pinned = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <a class="code" href="classimpala_1_1BufferedTupleStream.html#a707b3fddb8c72b48232682dee77cb06c">pinned_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;}</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div>
<div class="line"><a name="l00396"></a><span class="lineno"><a class="line" href="classimpala_1_1BufferedTupleStream.html#a9d2f211df83a684b2a644d2b8a179026">  396</a></span>&#160;<a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1BufferedTupleStream.html#a9d2f211df83a684b2a644d2b8a179026">BufferedTupleStream::UnpinStream</a>(<span class="keywordtype">bool</span> all) {</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  DCHECK(!<a class="code" href="classimpala_1_1BufferedTupleStream.html#a2a42e34f0b5faaa053704b93287f1df7">closed_</a>);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <a class="code" href="runtime-profile_8h.html#aaa9a2971c6368e3ddd3f5140a0295eb7">SCOPED_TIMER</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a758fc2bf68fb5a11145b606a93122820">unpin_timer_</a>);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  BOOST_FOREACH(<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html">BufferedBlockMgr::Block</a>* block, <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>) {</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordflow">if</span> (!block-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a678a5f46ff6c1f21cd6409c44fd8e52d">is_pinned</a>()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordflow">if</span> (!all &amp;&amp; (block == <a class="code" href="classimpala_1_1BufferedTupleStream.html#a1253dcec8226c94833f74bc80a2b90b3">write_block_</a> || (<a class="code" href="classimpala_1_1BufferedTupleStream.html#adbe5ffb56ce04fb412628dfa8fa3ff84">read_write_</a> &amp;&amp; block == *<a class="code" href="classimpala_1_1BufferedTupleStream.html#a7f864ab630476a8d77b5a4b51a81604b">read_block_</a>))) {</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    }</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a5e3173eca7b0c50e2ef87c02947e69c8">UnpinBlock</a>(block));</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  }</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <span class="keywordflow">if</span> (all) {</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <a class="code" href="classimpala_1_1BufferedTupleStream.html#a7f864ab630476a8d77b5a4b51a81604b">read_block_</a> = <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.end();</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <a class="code" href="classimpala_1_1BufferedTupleStream.html#a1253dcec8226c94833f74bc80a2b90b3">write_block_</a> = NULL;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  }</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <a class="code" href="classimpala_1_1BufferedTupleStream.html#a707b3fddb8c72b48232682dee77cb06c">pinned_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;}</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div>
<div class="line"><a name="l00415"></a><span class="lineno"><a class="line" href="classimpala_1_1BufferedTupleStream.html#a456ca7b067874e762d10212703de1498">  415</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classimpala_1_1BufferedTupleStream.html#a456ca7b067874e762d10212703de1498">BufferedTupleStream::ComputeNumNullIndicatorBytes</a>(<span class="keywordtype">int</span> block_size)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1BufferedTupleStream.html#a862e2da773f1d3ba0114df6a6fbc7e0a">nullable_tuple_</a>) {</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="comment">// We assume that all rows will use their max size, so we may be underutilizing the</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="comment">// space, i.e. we may have some unused space in case of rows with NULL tuples.</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keyword">const</span> uint32_t tuples_per_row = <a class="code" href="classimpala_1_1BufferedTupleStream.html#aadb29f0e9d4e4693e1716158eee829ec">desc_</a>.<a class="code" href="classimpala_1_1RowDescriptor.html#a3d57439c68d08fe374c33370529a855c">tuple_descriptors</a>().size();</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="keyword">const</span> uint32_t min_row_size_in_bits = 8 * <a class="code" href="classimpala_1_1BufferedTupleStream.html#a2dcdf8dc3f624e131420e4f010d8fb83">fixed_tuple_row_size_</a> + tuples_per_row;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keyword">const</span> uint32_t block_size_in_bits = 8 * block_size;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="keyword">const</span> uint32_t max_num_rows = block_size_in_bits / min_row_size_in_bits;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="keywordflow">return</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        <a class="code" href="classimpala_1_1BitUtil.html#adea2063ccbcb946cd552d2a3050b7f33">BitUtil::RoundUpNumi64</a>(max_num_rows * tuples_per_row) * 8;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="comment">// If there are no nullable tuples then no need to waste space for null indicators.</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  }</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;}</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div>
<div class="line"><a name="l00431"></a><span class="lineno"><a class="line" href="classimpala_1_1BufferedTupleStream.html#acff79f0ded3d6752e2d28c9399c6d0b1">  431</a></span>&#160;<a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1BufferedTupleStream.html#acff79f0ded3d6752e2d28c9399c6d0b1">BufferedTupleStream::GetRows</a>(scoped_ptr&lt;RowBatch&gt;* batch, <span class="keywordtype">bool</span>* got_rows) {</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a066d00bdf6f36be1f08bc8a6d64154ac">PinStream</a>(<span class="keyword">false</span>, got_rows));</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="keywordflow">if</span> (!*got_rows) <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a4f537ea0c46ce3dfc77a5b3bf58a07af">PrepareForRead</a>());</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  batch-&gt;reset(</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      <span class="keyword">new</span> <a class="code" href="classimpala_1_1RowBatch.html">RowBatch</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#aadb29f0e9d4e4693e1716158eee829ec">desc_</a>, <a class="code" href="classimpala_1_1BufferedTupleStream.html#af5796ba9a36c8485227b810b343aec47">num_rows</a>(), <a class="code" href="classimpala_1_1BufferedTupleStream.html#a691dc8b7d5efbb60c41e7301dc5a63b6">block_mgr_</a>-&gt;<a class="code" href="classimpala_1_1BufferedBlockMgr.html#a6d133271046a0b51c118ee115faca19a">get_tracker</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#ada77a4e348b105775fd52e8e39743998">block_mgr_client_</a>)));</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="keywordtype">bool</span> eos = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  <span class="comment">// Loop until GetNext fills the entire batch. Each call can stop at block</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  <span class="comment">// boundaries. We generally want it to stop, so that blocks can be freed</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <span class="comment">// as we read. It is safe in this case because we pin the entire stream.</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  <span class="keywordflow">while</span> (!eos) {</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a5277d4ff9fdeb7b31bdf4d520739582d">GetNext</a>(batch-&gt;get(), &amp;eos));</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;}</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div>
<div class="line"><a name="l00447"></a><span class="lineno"><a class="line" href="classimpala_1_1BufferedTupleStream.html#a5277d4ff9fdeb7b31bdf4d520739582d">  447</a></span>&#160;<a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1BufferedTupleStream.html#a5277d4ff9fdeb7b31bdf4d520739582d">BufferedTupleStream::GetNext</a>(<a class="code" href="classimpala_1_1RowBatch.html">RowBatch</a>* batch, <span class="keywordtype">bool</span>* eos,</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    vector&lt;RowIdx&gt;* indices) {</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1BufferedTupleStream.html#a862e2da773f1d3ba0114df6a6fbc7e0a">nullable_tuple_</a>) {</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">return</span> GetNextInternal&lt;true&gt;(batch, eos, indices);</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordflow">return</span> GetNextInternal&lt;false&gt;(batch, eos, indices);</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  }</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;}</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="keyword">template</span> &lt;<span class="keywordtype">bool</span> HasNullableTuple&gt;</div>
<div class="line"><a name="l00457"></a><span class="lineno"><a class="line" href="classimpala_1_1BufferedTupleStream.html#af4c3af5c319860bc91e712d387fcbc4a">  457</a></span>&#160;<a class="code" href="classimpala_1_1Status.html">Status</a> <a class="code" href="classimpala_1_1BufferedTupleStream.html#a266d30769c4ddb37c15112c6f0dc9168">BufferedTupleStream::GetNextInternal</a>(<a class="code" href="classimpala_1_1RowBatch.html">RowBatch</a>* batch, <span class="keywordtype">bool</span>* eos,</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    vector&lt;RowIdx&gt;* indices) {</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  DCHECK(!<a class="code" href="classimpala_1_1BufferedTupleStream.html#a2a42e34f0b5faaa053704b93287f1df7">closed_</a>);</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  DCHECK(batch-&gt;<a class="code" href="classimpala_1_1RowBatch.html#a1879b7b9b72142d7a56d4846ad307bd9">row_desc</a>().<a class="code" href="classimpala_1_1RowDescriptor.html#a4463849ca0e85e78f7d1a9554a1594fe">Equals</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#aadb29f0e9d4e4693e1716158eee829ec">desc_</a>));</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  *eos = (<a class="code" href="classimpala_1_1BufferedTupleStream.html#ab6fc6d8b3e3aa42fcaba7f3821ed2c33">rows_returned_</a> == <a class="code" href="classimpala_1_1BufferedTupleStream.html#ae35acc9106a9bc881e8a1127cc57a198">num_rows_</a>);</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="keywordflow">if</span> (*eos) <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  DCHECK_GE(<a class="code" href="classimpala_1_1BufferedTupleStream.html#acfed70ae36697f861227e5f55c6a7d9a">null_indicators_read_block_</a>, 0);</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="keyword">const</span> <a class="code" href="classuint64__t.html">uint64_t</a> tuples_per_row = <a class="code" href="classimpala_1_1BufferedTupleStream.html#aadb29f0e9d4e4693e1716158eee829ec">desc_</a>.<a class="code" href="classimpala_1_1RowDescriptor.html#a3d57439c68d08fe374c33370529a855c">tuple_descriptors</a>().size();</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  DCHECK_LE(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a68aaaeaae3c217e698ce2ca6097d0e43">read_tuple_idx_</a> / tuples_per_row, (*read_block_)-&gt;num_rows());</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  DCHECK_EQ(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a68aaaeaae3c217e698ce2ca6097d0e43">read_tuple_idx_</a> % tuples_per_row, 0);</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="keywordtype">int</span> rows_returned_curr_block = <a class="code" href="classimpala_1_1BufferedTupleStream.html#a68aaaeaae3c217e698ce2ca6097d0e43">read_tuple_idx_</a> / tuples_per_row;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  int64_t data_len = (*read_block_)-&gt;valid_data_len() - <a class="code" href="classimpala_1_1BufferedTupleStream.html#acfed70ae36697f861227e5f55c6a7d9a">null_indicators_read_block_</a>;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="compiler-util_8h.html#a9acc330d508b9a3b775cfdf7ce405e7d">UNLIKELY</a>(rows_returned_curr_block == (*read_block_)-&gt;num_rows())) {</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="comment">// Get the next block in the stream. We need to do this at the beginning of</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="comment">// the GetNext() call to ensure the buffer management semantics. NextBlockForRead()</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="comment">// will recycle the memory for the rows returned from the *previous* call to</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="comment">// GetNext().</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <a class="code" href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a4f0d29df7e0a357db35ad63230833d5d">NextBlockForRead</a>());</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    DCHECK(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a7f864ab630476a8d77b5a4b51a81604b">read_block_</a> != <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.end()) &lt;&lt; <a class="code" href="classimpala_1_1BufferedTupleStream.html#a4121e3bb85a9a0c2612930a7aed61807">DebugString</a>();</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    DCHECK_GE(<a class="code" href="classimpala_1_1BufferedTupleStream.html#acfed70ae36697f861227e5f55c6a7d9a">null_indicators_read_block_</a>, 0);</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    data_len = (*read_block_)-&gt;valid_data_len() - <a class="code" href="classimpala_1_1BufferedTupleStream.html#acfed70ae36697f861227e5f55c6a7d9a">null_indicators_read_block_</a>;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    rows_returned_curr_block = 0;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  }</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  DCHECK(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a7f864ab630476a8d77b5a4b51a81604b">read_block_</a> != <a class="code" href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">blocks_</a>.end());</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  DCHECK((*read_block_)-&gt;is_pinned()) &lt;&lt; <a class="code" href="classimpala_1_1BufferedTupleStream.html#a4121e3bb85a9a0c2612930a7aed61807">DebugString</a>();</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  DCHECK(<a class="code" href="classimpala_1_1BufferedTupleStream.html#adb1ca6bf40ac1b240a0c50923e4d7f24">read_ptr_</a> != NULL);</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  int64_t rows_left = <a class="code" href="classimpala_1_1BufferedTupleStream.html#ae35acc9106a9bc881e8a1127cc57a198">num_rows_</a> - <a class="code" href="classimpala_1_1BufferedTupleStream.html#ab6fc6d8b3e3aa42fcaba7f3821ed2c33">rows_returned_</a>;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="keywordtype">int</span> rows_to_fill = std::min(</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      static_cast&lt;int64_t&gt;(batch-&gt;<a class="code" href="classimpala_1_1RowBatch.html#ab171442ddcb3a1c3aab36991dbb511bb">capacity</a>() - batch-&gt;<a class="code" href="classimpala_1_1RowBatch.html#ac695df3b85ee416b3d99844813ae813d">num_rows</a>()), rows_left);</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  DCHECK_GE(rows_to_fill, 1);</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  batch-&gt;<a class="code" href="classimpala_1_1RowBatch.html#a7acd4c5911cd2759f9dd4c207721d8ec">AddRows</a>(rows_to_fill);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  uint8_t* tuple_row_mem = <span class="keyword">reinterpret_cast&lt;</span>uint8_t*<span class="keyword">&gt;</span>(batch-&gt;<a class="code" href="classimpala_1_1RowBatch.html#a9320ed986b0717ef26d73d871f3b3a42">GetRow</a>(batch-&gt;<a class="code" href="classimpala_1_1RowBatch.html#ac695df3b85ee416b3d99844813ae813d">num_rows</a>()));</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <span class="comment">// Produce tuple rows from the current block and the corresponding position on the</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <span class="comment">// null tuple indicator.</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  vector&lt;RowIdx&gt; local_indices;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <span class="keywordflow">if</span> (indices == NULL) {</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="comment">// A hack so that we do not need to check whether &#39;indices&#39; is not null in the</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="comment">// tight loop.</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    indices = &amp;local_indices;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    DCHECK(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a3b47a81d368ad14edaf0256f2779189a">is_pinned</a>());</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    DCHECK(!<a class="code" href="classimpala_1_1BufferedTupleStream.html#a2882935e6094afad5fc930f2a757e547">delete_on_read_</a>);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    DCHECK_EQ(batch-&gt;<a class="code" href="classimpala_1_1RowBatch.html#ac695df3b85ee416b3d99844813ae813d">num_rows</a>(), 0);</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    indices-&gt;clear();</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  }</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  indices-&gt;reserve(rows_to_fill);</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <span class="keywordtype">int</span> i = 0;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  uint8_t* null_word = NULL;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  uint32_t null_pos = 0;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="comment">// Start reading from position read_tuple_idx_ in the block.</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <a class="code" href="classuint64__t.html">uint64_t</a> last_read_ptr = 0;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <a class="code" href="classuint64__t.html">uint64_t</a> last_read_row = <a class="code" href="classimpala_1_1BufferedTupleStream.html#a68aaaeaae3c217e698ce2ca6097d0e43">read_tuple_idx_</a> / tuples_per_row;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <span class="keywordflow">while</span> (i &lt; rows_to_fill) {</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="comment">// Check if current block is done.</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="compiler-util_8h.html#a9acc330d508b9a3b775cfdf7ce405e7d">UNLIKELY</a>(rows_returned_curr_block + i == (*read_block_)-&gt;num_rows())) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="comment">// Copy the row into the output batch.</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <a class="code" href="classimpala_1_1TupleRow.html">TupleRow</a>* row = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classimpala_1_1TupleRow.html">TupleRow</a>*<span class="keyword">&gt;</span>(tuple_row_mem);</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    last_read_ptr = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classuint64__t.html">uint64_t</a><span class="keyword">&gt;</span>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#adb1ca6bf40ac1b240a0c50923e4d7f24">read_ptr_</a>);</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    indices-&gt;push_back(<a class="code" href="structimpala_1_1BufferedTupleStream_1_1RowIdx.html">RowIdx</a>());</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    DCHECK_EQ(indices-&gt;size(), i + 1);</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    (*indices)[i].set(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a79f040358dacbbab993af134f709ca0a">read_block_idx_</a>, <a class="code" href="classimpala_1_1BufferedTupleStream.html#aa2229061216f10cfa13936bb38d88cd0">read_bytes_</a> + <a class="code" href="classimpala_1_1BufferedTupleStream.html#acfed70ae36697f861227e5f55c6a7d9a">null_indicators_read_block_</a>,</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                      last_read_row);</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="keywordflow">if</span> (HasNullableTuple) {</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; tuples_per_row; ++j) {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <span class="comment">// Stitch together the tuples from the block and the NULL ones.</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        null_word = (*read_block_)-&gt;buffer() + (<a class="code" href="classimpala_1_1BufferedTupleStream.html#a68aaaeaae3c217e698ce2ca6097d0e43">read_tuple_idx_</a> &gt;&gt; 3);</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        null_pos = <a class="code" href="classimpala_1_1BufferedTupleStream.html#a68aaaeaae3c217e698ce2ca6097d0e43">read_tuple_idx_</a> &amp; 7;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        ++<a class="code" href="classimpala_1_1BufferedTupleStream.html#a68aaaeaae3c217e698ce2ca6097d0e43">read_tuple_idx_</a>;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> is_not_null = ((*null_word &amp; (1 &lt;&lt; (7 - null_pos))) == 0);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        <span class="comment">// Copy tuple and advance read_ptr_. If it it is a NULL tuple, it calls SetTuple</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        <span class="comment">// with Tuple* being 0x0. To do that we multiply the current read_ptr_ with</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        <span class="comment">// false (0x0).</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        row-&gt;<a class="code" href="classimpala_1_1TupleRow.html#aaf1d69b97c90eec7da3d07bdc40f5665">SetTuple</a>(j, reinterpret_cast&lt;Tuple*&gt;(</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            reinterpret_cast&lt;uint64_t&gt;(<a class="code" href="classimpala_1_1BufferedTupleStream.html#adb1ca6bf40ac1b240a0c50923e4d7f24">read_ptr_</a>) * is_not_null));</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        <a class="code" href="classimpala_1_1BufferedTupleStream.html#adb1ca6bf40ac1b240a0c50923e4d7f24">read_ptr_</a> += <a class="code" href="classimpala_1_1BufferedTupleStream.html#aadb29f0e9d4e4693e1716158eee829ec">desc_</a>.<a class="code" href="classimpala_1_1RowDescriptor.html#a3d57439c68d08fe374c33370529a855c">tuple_descriptors</a>()[j]-&gt;byte_size() * is_not_null;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      }</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      <span class="keyword">const</span> <a class="code" href="classuint64__t.html">uint64_t</a> row_read_bytes =</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;          <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classuint64__t.html">uint64_t</a><span class="keyword">&gt;</span>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#adb1ca6bf40ac1b240a0c50923e4d7f24">read_ptr_</a>) - last_read_ptr;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      DCHECK_GE(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a2dcdf8dc3f624e131420e4f010d8fb83">fixed_tuple_row_size_</a>, row_read_bytes);</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      <a class="code" href="classimpala_1_1BufferedTupleStream.html#aa2229061216f10cfa13936bb38d88cd0">read_bytes_</a> += row_read_bytes;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      last_read_ptr = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classuint64__t.html">uint64_t</a><span class="keyword">&gt;</span>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#adb1ca6bf40ac1b240a0c50923e4d7f24">read_ptr_</a>);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="comment">// When we know that there are no nullable tuples we can safely copy them without</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      <span class="comment">// checking for nullability.</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; tuples_per_row; ++j) {</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        row-&gt;<a class="code" href="classimpala_1_1TupleRow.html#aaf1d69b97c90eec7da3d07bdc40f5665">SetTuple</a>(j, reinterpret_cast&lt;Tuple*&gt;(<a class="code" href="classimpala_1_1BufferedTupleStream.html#adb1ca6bf40ac1b240a0c50923e4d7f24">read_ptr_</a>));</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        <a class="code" href="classimpala_1_1BufferedTupleStream.html#adb1ca6bf40ac1b240a0c50923e4d7f24">read_ptr_</a> += <a class="code" href="classimpala_1_1BufferedTupleStream.html#aadb29f0e9d4e4693e1716158eee829ec">desc_</a>.<a class="code" href="classimpala_1_1RowDescriptor.html#a3d57439c68d08fe374c33370529a855c">tuple_descriptors</a>()[j]-&gt;byte_size();</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      }</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      <a class="code" href="classimpala_1_1BufferedTupleStream.html#aa2229061216f10cfa13936bb38d88cd0">read_bytes_</a> += <a class="code" href="classimpala_1_1BufferedTupleStream.html#a2dcdf8dc3f624e131420e4f010d8fb83">fixed_tuple_row_size_</a>;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      <a class="code" href="classimpala_1_1BufferedTupleStream.html#a68aaaeaae3c217e698ce2ca6097d0e43">read_tuple_idx_</a> += tuples_per_row;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    }</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    tuple_row_mem += <span class="keyword">sizeof</span>(<a class="code" href="classimpala_1_1Tuple.html">Tuple</a>*) * tuples_per_row;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="comment">// Update string slot ptrs.</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classimpala_1_1BufferedTupleStream.html#a08beb5c3c7bded04f1de51c3da10c89a">string_slots_</a>.size(); ++j) {</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      <a class="code" href="classimpala_1_1Tuple.html">Tuple</a>* tuple = row-&gt;<a class="code" href="classimpala_1_1TupleRow.html#aed3092e531291470b27fc48afa901600">GetTuple</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a08beb5c3c7bded04f1de51c3da10c89a">string_slots_</a>[j].first);</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      <span class="keywordflow">if</span> (HasNullableTuple &amp;&amp; tuple == NULL) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      DCHECK_NOTNULL(tuple);</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; <a class="code" href="classimpala_1_1BufferedTupleStream.html#a08beb5c3c7bded04f1de51c3da10c89a">string_slots_</a>[j].second.size(); ++k) {</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        <span class="keyword">const</span> <a class="code" href="classimpala_1_1SlotDescriptor.html">SlotDescriptor</a>* slot_desc = <a class="code" href="classimpala_1_1BufferedTupleStream.html#a08beb5c3c7bded04f1de51c3da10c89a">string_slots_</a>[j].second[k];</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <span class="keywordflow">if</span> (tuple-&gt;<a class="code" href="classimpala_1_1Tuple.html#ace4b7ea4cc159a2d2686e2a61c406413">IsNull</a>(slot_desc-&gt;<a class="code" href="classimpala_1_1SlotDescriptor.html#a1fe88c60d0d1fc04aa9569ee577d8cdd">null_indicator_offset</a>())) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        <a class="code" href="structimpala_1_1StringValue.html">StringValue</a>* sv = tuple-&gt;<a class="code" href="classimpala_1_1Tuple.html#ad0d1cf8a3eca6b49fe7bd4d337758f56">GetStringSlot</a>(slot_desc-&gt;<a class="code" href="classimpala_1_1SlotDescriptor.html#abd47b8777b6d94017e1e4dc6b8234fad">tuple_offset</a>());</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        DCHECK_LE(sv-&gt;<a class="code" href="structimpala_1_1StringValue.html#ab71e42890598d9b239cac64485db276d">len</a>, data_len - <a class="code" href="classimpala_1_1BufferedTupleStream.html#aa2229061216f10cfa13936bb38d88cd0">read_bytes_</a>);</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        sv-&gt;<a class="code" href="structimpala_1_1StringValue.html#a17f088f03fd1f7b017df20f58f71fe13">ptr</a> = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#adb1ca6bf40ac1b240a0c50923e4d7f24">read_ptr_</a>);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <a class="code" href="classimpala_1_1BufferedTupleStream.html#adb1ca6bf40ac1b240a0c50923e4d7f24">read_ptr_</a> += sv-&gt;<a class="code" href="structimpala_1_1StringValue.html#ab71e42890598d9b239cac64485db276d">len</a>;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        <a class="code" href="classimpala_1_1BufferedTupleStream.html#aa2229061216f10cfa13936bb38d88cd0">read_bytes_</a> += sv-&gt;<a class="code" href="structimpala_1_1StringValue.html#ab71e42890598d9b239cac64485db276d">len</a>;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      }</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    ++last_read_row;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    ++i;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  }</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  batch-&gt;<a class="code" href="classimpala_1_1RowBatch.html#a5c4883960d142b0ec5ebdd182da1c79b">CommitRows</a>(i);</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  rows_returned_ += i;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  *eos = (rows_returned_ == <a class="code" href="classimpala_1_1BufferedTupleStream.html#ae35acc9106a9bc881e8a1127cc57a198">num_rows_</a>);</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  <span class="keywordflow">if</span> ((!<a class="code" href="classimpala_1_1BufferedTupleStream.html#a707b3fddb8c72b48232682dee77cb06c">pinned_</a> || <a class="code" href="classimpala_1_1BufferedTupleStream.html#a2882935e6094afad5fc930f2a757e547">delete_on_read_</a>) &amp;&amp;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      rows_returned_curr_block + i == (*read_block_)-&gt;num_rows()) {</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="comment">// No more data in this block. Mark this batch as needing to return so</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="comment">// the caller can pass the rows up the operator tree.</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    batch-&gt;<a class="code" href="classimpala_1_1RowBatch.html#a50bef2f2a7162d478aafef2dfd508e84">MarkNeedToReturn</a>();</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  }</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  DCHECK_EQ(indices-&gt;size(), i);</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">Status::OK</a>;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;}</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment">// TODO: Move this somewhere in general. We don&#39;t want this function inlined</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment">// for the buffered tuple stream case though.</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">// TODO: In case of null-able tuples we ignore the space we could have saved from the</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment">// null tuples of this row.</span></div>
<div class="line"><a name="l00595"></a><span class="lineno"><a class="line" href="classimpala_1_1BufferedTupleStream.html#ab2947eeec41d97443113b05585273683">  595</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classimpala_1_1BufferedTupleStream.html#ab2947eeec41d97443113b05585273683">BufferedTupleStream::ComputeRowSize</a>(<a class="code" href="classimpala_1_1TupleRow.html">TupleRow</a>* row)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  <span class="keywordtype">int</span> size = <a class="code" href="classimpala_1_1BufferedTupleStream.html#a2dcdf8dc3f624e131420e4f010d8fb83">fixed_tuple_row_size_</a>;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classimpala_1_1BufferedTupleStream.html#a08beb5c3c7bded04f1de51c3da10c89a">string_slots_</a>.size(); ++i) {</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <a class="code" href="classimpala_1_1Tuple.html">Tuple</a>* tuple = row-&gt;<a class="code" href="classimpala_1_1TupleRow.html#aed3092e531291470b27fc48afa901600">GetTuple</a>(<a class="code" href="classimpala_1_1BufferedTupleStream.html#a08beb5c3c7bded04f1de51c3da10c89a">string_slots_</a>[i].first);</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classimpala_1_1BufferedTupleStream.html#a862e2da773f1d3ba0114df6a6fbc7e0a">nullable_tuple_</a> &amp;&amp; tuple == NULL) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    DCHECK_NOTNULL(tuple);</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classimpala_1_1BufferedTupleStream.html#a08beb5c3c7bded04f1de51c3da10c89a">string_slots_</a>[i].second.size(); ++j) {</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      <span class="keyword">const</span> <a class="code" href="classimpala_1_1SlotDescriptor.html">SlotDescriptor</a>* slot_desc = <a class="code" href="classimpala_1_1BufferedTupleStream.html#a08beb5c3c7bded04f1de51c3da10c89a">string_slots_</a>[i].second[j];</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      <span class="keywordflow">if</span> (tuple-&gt;<a class="code" href="classimpala_1_1Tuple.html#ace4b7ea4cc159a2d2686e2a61c406413">IsNull</a>(slot_desc-&gt;<a class="code" href="classimpala_1_1SlotDescriptor.html#a1fe88c60d0d1fc04aa9569ee577d8cdd">null_indicator_offset</a>())) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      <a class="code" href="structimpala_1_1StringValue.html">StringValue</a>* sv = tuple-&gt;<a class="code" href="classimpala_1_1Tuple.html#ad0d1cf8a3eca6b49fe7bd4d337758f56">GetStringSlot</a>(slot_desc-&gt;<a class="code" href="classimpala_1_1SlotDescriptor.html#abd47b8777b6d94017e1e4dc6b8234fad">tuple_offset</a>());</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      size += sv-&gt;<a class="code" href="structimpala_1_1StringValue.html#ab71e42890598d9b239cac64485db276d">len</a>;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    }</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  }</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <span class="keywordflow">return</span> size;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;}</div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_1_1Block_html_a0f1e51ff5ab49e2114c837398671b071"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a0f1e51ff5ab49e2114c837398671b071">impala::BufferedBlockMgr::Block::num_rows</a></div><div class="ttdeci">int num_rows() const </div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8h_source.html#l00157">buffered-block-mgr.h:157</a></div></div>
<div class="ttc" id="row-batch_8h_html"><div class="ttname"><a href="row-batch_8h.html">row-batch.h</a></div></div>
<div class="ttc" id="classimpala_1_1TupleDescriptor_html"><div class="ttname"><a href="classimpala_1_1TupleDescriptor.html">impala::TupleDescriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="descriptors_8h_source.html#l00298">descriptors.h:298</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a54c7376a284c281622eb888ae277d558"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a54c7376a284c281622eb888ae277d558">impala::BufferedTupleStream::num_pinned_</a></div><div class="ttdeci">int num_pinned_</div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00330">buffered-tuple-stream.h:330</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_adb1ca6bf40ac1b240a0c50923e4d7f24"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#adb1ca6bf40ac1b240a0c50923e4d7f24">impala::BufferedTupleStream::read_ptr_</a></div><div class="ttdeci">uint8_t * read_ptr_</div><div class="ttdoc">Current ptr offset in read_block_&#39;s buffer. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00307">buffered-tuple-stream.h:307</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_acfed70ae36697f861227e5f55c6a7d9a"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#acfed70ae36697f861227e5f55c6a7d9a">impala::BufferedTupleStream::null_indicators_read_block_</a></div><div class="ttdeci">uint32_t null_indicators_read_block_</div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00281">buffered-tuple-stream.h:281</a></div></div>
<div class="ttc" id="classimpala_1_1RowBatch_html_ac695df3b85ee416b3d99844813ae813d"><div class="ttname"><a href="classimpala_1_1RowBatch.html#ac695df3b85ee416b3d99844813ae813d">impala::RowBatch::num_rows</a></div><div class="ttdeci">int num_rows() const </div><div class="ttdef"><b>Definition:</b> <a href="row-batch_8h_source.html#l00215">row-batch.h:215</a></div></div>
<div class="ttc" id="classimpala_1_1RowBatch_html_a7acd4c5911cd2759f9dd4c207721d8ec"><div class="ttname"><a href="classimpala_1_1RowBatch.html#a7acd4c5911cd2759f9dd4c207721d8ec">impala::RowBatch::AddRows</a></div><div class="ttdeci">int AddRows(int n)</div><div class="ttdef"><b>Definition:</b> <a href="row-batch_8h_source.html#l00094">row-batch.h:94</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_ad905a907a64f8cd48cfebac638200c99"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#ad905a907a64f8cd48cfebac638200c99">impala::BufferedTupleStream::total_byte_size_</a></div><div class="ttdeci">int64_t total_byte_size_</div><div class="ttdoc">Total size of blocks_, including small blocks. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00295">buffered-tuple-stream.h:295</a></div></div>
<div class="ttc" id="structimpala_1_1StringValue_html"><div class="ttname"><a href="structimpala_1_1StringValue.html">impala::StringValue</a></div><div class="ttdef"><b>Definition:</b> <a href="string-value_8h_source.html#l00033">string-value.h:33</a></div></div>
<div class="ttc" id="classimpala_1_1TupleRow_html_aed3092e531291470b27fc48afa901600"><div class="ttname"><a href="classimpala_1_1TupleRow.html#aed3092e531291470b27fc48afa901600">impala::TupleRow::GetTuple</a></div><div class="ttdeci">Tuple * GetTuple(int tuple_idx)</div><div class="ttdef"><b>Definition:</b> <a href="tuple-row_8h_source.html#l00030">tuple-row.h:30</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a9cb6b2be78a2bff4d5dafd164c3dc0b7"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a9cb6b2be78a2bff4d5dafd164c3dc0b7">impala::BufferedTupleStream::Close</a></div><div class="ttdeci">void Close()</div><div class="ttdoc">Must be called once at the end to cleanup all resources. Idempotent. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8cc_source.html#l00145">buffered-tuple-stream.cc:145</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a1b9da094a3d35db33e21cd581e4c762d"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a1b9da094a3d35db33e21cd581e4c762d">impala::BufferedTupleStream::block_start_idx_</a></div><div class="ttdeci">std::vector&lt; uint8_t * &gt; block_start_idx_</div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00304">buffered-tuple-stream.h:304</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a7f864ab630476a8d77b5a4b51a81604b"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a7f864ab630476a8d77b5a4b51a81604b">impala::BufferedTupleStream::read_block_</a></div><div class="ttdeci">std::list&lt; BufferedBlockMgr::Block * &gt;::iterator read_block_</div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00299">buffered-tuple-stream.h:299</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_html_a56f3200d738096167c3e6a50d077ced8"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr.html#a56f3200d738096167c3e6a50d077ced8">impala::BufferedBlockMgr::MemLimitTooLowError</a></div><div class="ttdeci">Status MemLimitTooLowError(Client *client)</div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8cc_source.html#l00369">buffered-block-mgr.cc:369</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_html"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr.html">impala::BufferedBlockMgr</a></div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8h_source.html#l00092">buffered-block-mgr.h:92</a></div></div>
<div class="ttc" id="structimpala_1_1BufferedTupleStream_1_1RowIdx_html_a431215848544ca0af04357ff722c5f80"><div class="ttname"><a href="structimpala_1_1BufferedTupleStream_1_1RowIdx.html#a431215848544ca0af04357ff722c5f80">impala::BufferedTupleStream::RowIdx::DebugString</a></div><div class="ttdeci">std::string DebugString() const </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8cc_source.html#l00037">buffered-tuple-stream.cc:37</a></div></div>
<div class="ttc" id="classimpala_1_1Tuple_html"><div class="ttname"><a href="classimpala_1_1Tuple.html">impala::Tuple</a></div><div class="ttdoc">A tuple with 0 materialised slots is represented as NULL. </div><div class="ttdef"><b>Definition:</b> <a href="tuple_8h_source.html#l00048">tuple.h:48</a></div></div>
<div class="ttc" id="structimpala_1_1StringValue_html_ab71e42890598d9b239cac64485db276d"><div class="ttname"><a href="structimpala_1_1StringValue.html#ab71e42890598d9b239cac64485db276d">impala::StringValue::len</a></div><div class="ttdeci">int len</div><div class="ttdef"><b>Definition:</b> <a href="string-value_8h_source.html#l00038">string-value.h:38</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_1_1Block_html_ae9e943bc0fae320e955500d0cd74a293"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr_1_1Block.html#ae9e943bc0fae320e955500d0cd74a293">impala::BufferedBlockMgr::Block::Allocate</a></div><div class="ttdeci">T * Allocate(int size)</div><div class="ttdoc">Allocates the specified number of bytes from this block. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8h_source.html#l00160">buffered-block-mgr.h:160</a></div></div>
<div class="ttc" id="classimpala_1_1RowBatch_html_a1879b7b9b72142d7a56d4846ad307bd9"><div class="ttname"><a href="classimpala_1_1RowBatch.html#a1879b7b9b72142d7a56d4846ad307bd9">impala::RowBatch::row_desc</a></div><div class="ttdeci">const RowDescriptor &amp; row_desc() const </div><div class="ttdef"><b>Definition:</b> <a href="row-batch_8h_source.html#l00218">row-batch.h:218</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_1_1Block_html_ac6eaa4369a88f027db9e0e484fd158e6"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr_1_1Block.html#ac6eaa4369a88f027db9e0e484fd158e6">impala::BufferedBlockMgr::Block::is_max_size</a></div><div class="ttdeci">bool is_max_size() const </div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8h_source.html#l00198">buffered-block-mgr.h:198</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_html_a6d133271046a0b51c118ee115faca19a"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr.html#a6d133271046a0b51c118ee115faca19a">impala::BufferedBlockMgr::get_tracker</a></div><div class="ttdeci">MemTracker * get_tracker(Client *client) const </div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8cc_source.html#l00522">buffered-block-mgr.cc:522</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a066d00bdf6f36be1f08bc8a6d64154ac"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a066d00bdf6f36be1f08bc8a6d64154ac">impala::BufferedTupleStream::PinStream</a></div><div class="ttdeci">Status PinStream(bool already_reserved, bool *pinned)</div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8cc_source.html#l00357">buffered-tuple-stream.cc:357</a></div></div>
<div class="ttc" id="status_8h_html_a85f7d0e774e15eb35b74f53264305e16"><div class="ttname"><a href="status_8h.html#a85f7d0e774e15eb35b74f53264305e16">RETURN_IF_ERROR</a></div><div class="ttdeci">#define RETURN_IF_ERROR(stmt)</div><div class="ttdoc">some generally useful macros </div><div class="ttdef"><b>Definition:</b> <a href="status_8h_source.html#l00242">status.h:242</a></div></div>
<div class="ttc" id="buffered-tuple-stream_8h_html"><div class="ttname"><a href="buffered-tuple-stream_8h.html">buffered-tuple-stream.h</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a266d30769c4ddb37c15112c6f0dc9168"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a266d30769c4ddb37c15112c6f0dc9168">impala::BufferedTupleStream::GetNextInternal</a></div><div class="ttdeci">Status GetNextInternal(RowBatch *batch, bool *eos, std::vector&lt; RowIdx &gt; *indices)</div><div class="ttdoc">Templated GetNext implementation. </div></div>
<div class="ttc" id="classimpala_1_1RowBatch_html_a9320ed986b0717ef26d73d871f3b3a42"><div class="ttname"><a href="classimpala_1_1RowBatch.html#a9320ed986b0717ef26d73d871f3b3a42">impala::RowBatch::GetRow</a></div><div class="ttdeci">TupleRow * GetRow(int row_idx)</div><div class="ttdef"><b>Definition:</b> <a href="row-batch_8h_source.html#l00140">row-batch.h:140</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_html_ac4ddea92960294d8f764c2974fe273f9"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr.html#ac4ddea92960294d8f764c2974fe273f9">impala::BufferedBlockMgr::GetNewBlock</a></div><div class="ttdeci">Status GetNewBlock(Client *client, Block *unpin_block, Block **block, int64_t len=-1)</div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8cc_source.html#l00382">buffered-block-mgr.cc:382</a></div></div>
<div class="ttc" id="runtime-profile_8h_html_a8841ca205b2a05d608e82d443bad3a77"><div class="ttname"><a href="runtime-profile_8h.html#a8841ca205b2a05d608e82d443bad3a77">ADD_TIMER</a></div><div class="ttdeci">#define ADD_TIMER(profile, name)</div><div class="ttdef"><b>Definition:</b> <a href="runtime-profile_8h_source.html#l00050">runtime-profile.h:50</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a758fc2bf68fb5a11145b606a93122820"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a758fc2bf68fb5a11145b606a93122820">impala::BufferedTupleStream::unpin_timer_</a></div><div class="ttdeci">RuntimeProfile::Counter * unpin_timer_</div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00349">buffered-tuple-stream.h:349</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_html_ac6e6d613d4ed039d310d789ead20e231"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr.html#ac6e6d613d4ed039d310d789ead20e231">impala::BufferedBlockMgr::max_block_size</a></div><div class="ttdeci">int64_t max_block_size() const </div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8h_source.html#l00386">buffered-block-mgr.h:386</a></div></div>
<div class="ttc" id="structimpala_1_1BufferedBlockMgr_1_1Client_html"><div class="ttname"><a href="structimpala_1_1BufferedBlockMgr_1_1Client.html">impala::BufferedBlockMgr::Client</a></div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8cc_source.html#l00045">buffered-block-mgr.cc:45</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_abe18798dd236710e215baec9902023bb"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#abe18798dd236710e215baec9902023bb">impala::BufferedTupleStream::BufferedTupleStream</a></div><div class="ttdeci">BufferedTupleStream(RuntimeState *state, const RowDescriptor &amp;row_desc, BufferedBlockMgr *block_mgr, BufferedBlockMgr::Client *client, bool use_initial_small_buffers=true, bool delete_on_read=false, bool read_write=false)</div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8cc_source.html#l00043">buffered-tuple-stream.cc:43</a></div></div>
<div class="ttc" id="classimpala_1_1RowDescriptor_html"><div class="ttname"><a href="classimpala_1_1RowDescriptor.html">impala::RowDescriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="descriptors_8h_source.html#l00373">descriptors.h:373</a></div></div>
<div class="ttc" id="classimpala_1_1TupleDescriptor_html_a153205d9bf39422c853b5bd5f54a9485"><div class="ttname"><a href="classimpala_1_1TupleDescriptor.html#a153205d9bf39422c853b5bd5f54a9485">impala::TupleDescriptor::byte_size</a></div><div class="ttdeci">int byte_size() const </div><div class="ttdef"><b>Definition:</b> <a href="descriptors_8h_source.html#l00300">descriptors.h:300</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a2dcdf8dc3f624e131420e4f010d8fb83"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a2dcdf8dc3f624e131420e4f010d8fb83">impala::BufferedTupleStream::fixed_tuple_row_size_</a></div><div class="ttdeci">int fixed_tuple_row_size_</div><div class="ttdoc">Sum of the fixed length portion of all the tuples in desc_. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00274">buffered-tuple-stream.h:274</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a2a42e34f0b5faaa053704b93287f1df7"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a2a42e34f0b5faaa053704b93287f1df7">impala::BufferedTupleStream::closed_</a></div><div class="ttdeci">bool closed_</div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00335">buffered-tuple-stream.h:335</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a4f0d29df7e0a357db35ad63230833d5d"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a4f0d29df7e0a357db35ad63230833d5d">impala::BufferedTupleStream::NextBlockForRead</a></div><div class="ttdeci">Status NextBlockForRead()</div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8cc_source.html#l00248">buffered-tuple-stream.cc:248</a></div></div>
<div class="ttc" id="classimpala_1_1SlotDescriptor_html"><div class="ttname"><a href="classimpala_1_1SlotDescriptor.html">impala::SlotDescriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="descriptors_8h_source.html#l00075">descriptors.h:75</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a08beb5c3c7bded04f1de51c3da10c89a"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a08beb5c3c7bded04f1de51c3da10c89a">impala::BufferedTupleStream::string_slots_</a></div><div class="ttdeci">std::vector&lt; std::pair&lt; int, std::vector&lt; SlotDescriptor * &gt; &gt; &gt; string_slots_</div><div class="ttdoc">Vector of all the strings slots grouped by tuple_idx. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00285">buffered-tuple-stream.h:285</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_aadb29f0e9d4e4693e1716158eee829ec"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#aadb29f0e9d4e4693e1716158eee829ec">impala::BufferedTupleStream::desc_</a></div><div class="ttdeci">const RowDescriptor &amp; desc_</div><div class="ttdoc">Description of rows stored in the stream. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00268">buffered-tuple-stream.h:268</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a0c6479bc0cba32fa1f053c29200c473b"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a0c6479bc0cba32fa1f053c29200c473b">impala::BufferedTupleStream::use_small_buffers_</a></div><div class="ttdeci">bool use_small_buffers_</div><div class="ttdoc">If true, this stream is still using small buffers. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00254">buffered-tuple-stream.h:254</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_adbe5ffb56ce04fb412628dfa8fa3ff84"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#adbe5ffb56ce04fb412628dfa8fa3ff84">impala::BufferedTupleStream::read_write_</a></div><div class="ttdeci">const bool read_write_</div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00262">buffered-tuple-stream.h:262</a></div></div>
<div class="ttc" id="classimpala_1_1TupleRow_html"><div class="ttname"><a href="classimpala_1_1TupleRow.html">impala::TupleRow</a></div><div class="ttdef"><b>Definition:</b> <a href="tuple-row_8h_source.html#l00028">tuple-row.h:28</a></div></div>
<div class="ttc" id="classimpala_1_1SlotDescriptor_html_a1fe88c60d0d1fc04aa9569ee577d8cdd"><div class="ttname"><a href="classimpala_1_1SlotDescriptor.html#a1fe88c60d0d1fc04aa9569ee577d8cdd">impala::SlotDescriptor::null_indicator_offset</a></div><div class="ttdeci">const NullIndicatorOffset &amp; null_indicator_offset() const </div><div class="ttdef"><b>Definition:</b> <a href="descriptors_8h_source.html#l00089">descriptors.h:89</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_1_1Block_html_a678a5f46ff6c1f21cd6409c44fd8e52d"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a678a5f46ff6c1f21cd6409c44fd8e52d">impala::BufferedBlockMgr::Block::is_pinned</a></div><div class="ttdeci">bool is_pinned() const </div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8h_source.html#l00203">buffered-block-mgr.h:203</a></div></div>
<div class="ttc" id="runtime-profile_8h_html_aaa9a2971c6368e3ddd3f5140a0295eb7"><div class="ttname"><a href="runtime-profile_8h.html#aaa9a2971c6368e3ddd3f5140a0295eb7">SCOPED_TIMER</a></div><div class="ttdeci">#define SCOPED_TIMER(c)</div><div class="ttdef"><b>Definition:</b> <a href="runtime-profile_8h_source.html#l00053">runtime-profile.h:53</a></div></div>
<div class="ttc" id="classimpala_1_1PrettyPrinter_html_a6e5f06a1ce274f747cc4f9928b797c5a"><div class="ttname"><a href="classimpala_1_1PrettyPrinter.html#a6e5f06a1ce274f747cc4f9928b797c5a">impala::PrettyPrinter::Print</a></div><div class="ttdeci">static std::string Print(bool value, TUnit::type ignored, bool verbose=false)</div><div class="ttdef"><b>Definition:</b> <a href="pretty-printer_8h_source.html#l00033">pretty-printer.h:33</a></div></div>
<div class="ttc" id="classimpala_1_1Tuple_html_ace4b7ea4cc159a2d2686e2a61c406413"><div class="ttname"><a href="classimpala_1_1Tuple.html#ace4b7ea4cc159a2d2686e2a61c406413">impala::Tuple::IsNull</a></div><div class="ttdeci">bool IsNull(const NullIndicatorOffset &amp;offset) const </div><div class="ttdef"><b>Definition:</b> <a href="tuple_8h_source.html#l00112">tuple.h:112</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_1_1Block_html"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr_1_1Block.html">impala::BufferedBlockMgr::Block</a></div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8h_source.html#l00136">buffered-block-mgr.h:136</a></div></div>
<div class="ttc" id="classimpala_1_1TupleDescriptor_html_a3f0ffae3775bf65b21c0b74ab825d084"><div class="ttname"><a href="classimpala_1_1TupleDescriptor.html#a3f0ffae3775bf65b21c0b74ab825d084">impala::TupleDescriptor::string_slots</a></div><div class="ttdeci">const std::vector&lt; SlotDescriptor * &gt; &amp; string_slots() const </div><div class="ttdef"><b>Definition:</b> <a href="descriptors_8h_source.html#l00303">descriptors.h:303</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a79f040358dacbbab993af134f709ca0a"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a79f040358dacbbab993af134f709ca0a">impala::BufferedTupleStream::read_block_idx_</a></div><div class="ttdeci">int read_block_idx_</div><div class="ttdoc">The block index of the current read block. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00322">buffered-tuple-stream.h:322</a></div></div>
<div class="ttc" id="classimpala_1_1Status_html"><div class="ttname"><a href="classimpala_1_1Status.html">impala::Status</a></div><div class="ttdef"><b>Definition:</b> <a href="status_8h_source.html#l00081">status.h:81</a></div></div>
<div class="ttc" id="logging_8h_html_a916e38366cee7c32fd5fae7e2ee5e4a9"><div class="ttname"><a href="logging_8h.html#a916e38366cee7c32fd5fae7e2ee5e4a9">VLOG_QUERY</a></div><div class="ttdeci">#define VLOG_QUERY</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00057">logging.h:57</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_ad2aeaf7b3790a34697dd682544ae9af7"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#ad2aeaf7b3790a34697dd682544ae9af7">impala::BufferedTupleStream::blocks_unpinned</a></div><div class="ttdeci">int blocks_unpinned() const </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00245">buffered-tuple-stream.h:245</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a85fea074aae6b4f949280df51ccb233c"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a85fea074aae6b4f949280df51ccb233c">impala::BufferedTupleStream::write_tuple_idx_</a></div><div class="ttdeci">uint32_t write_tuple_idx_</div><div class="ttdoc">Current idx of the tuple written at the write_block_ buffer. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00313">buffered-tuple-stream.h:313</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a456ca7b067874e762d10212703de1498"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a456ca7b067874e762d10212703de1498">impala::BufferedTupleStream::ComputeNumNullIndicatorBytes</a></div><div class="ttdeci">int ComputeNumNullIndicatorBytes(int block_size) const </div><div class="ttdoc">Computes the number of bytes needed for null indicators for a block of &#39;block_size&#39;. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8cc_source.html#l00415">buffered-tuple-stream.cc:415</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_ada77a4e348b105775fd52e8e39743998"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#ada77a4e348b105775fd52e8e39743998">impala::BufferedTupleStream::block_mgr_client_</a></div><div class="ttdeci">BufferedBlockMgr::Client * block_mgr_client_</div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00289">buffered-tuple-stream.h:289</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a68aaaeaae3c217e698ce2ca6097d0e43"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a68aaaeaae3c217e698ce2ca6097d0e43">impala::BufferedTupleStream::read_tuple_idx_</a></div><div class="ttdeci">uint32_t read_tuple_idx_</div><div class="ttdoc">Current idx of the tuple read from the read_block_ buffer. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00310">buffered-tuple-stream.h:310</a></div></div>
<div class="ttc" id="classimpala_1_1RuntimeState_html"><div class="ttname"><a href="classimpala_1_1RuntimeState.html">impala::RuntimeState</a></div><div class="ttdef"><b>Definition:</b> <a href="runtime-state_8h_source.html#l00069">runtime-state.h:69</a></div></div>
<div class="ttc" id="buffered-tuple-stream_8cc_html_a8e7d39f14a29b6446722800442d8d7fe"><div class="ttname"><a href="buffered-tuple-stream_8cc.html#a8e7d39f14a29b6446722800442d8d7fe">INITIAL_BLOCK_SIZES</a></div><div class="ttdeci">static const int64_t INITIAL_BLOCK_SIZES[]</div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8cc_source.html#l00033">buffered-tuple-stream.cc:33</a></div></div>
<div class="ttc" id="bit-util_8h_html"><div class="ttname"><a href="bit-util_8h.html">bit-util.h</a></div></div>
<div class="ttc" id="debug-util_8h_html"><div class="ttname"><a href="debug-util_8h.html">debug-util.h</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a2882935e6094afad5fc930f2a757e547"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a2882935e6094afad5fc930f2a757e547">impala::BufferedTupleStream::delete_on_read_</a></div><div class="ttdeci">const bool delete_on_read_</div><div class="ttdoc">If true, blocks are deleted after they are read. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00257">buffered-tuple-stream.h:257</a></div></div>
<div class="ttc" id="classimpala_1_1RowDescriptor_html_a4463849ca0e85e78f7d1a9554a1594fe"><div class="ttname"><a href="classimpala_1_1RowDescriptor.html#a4463849ca0e85e78f7d1a9554a1594fe">impala::RowDescriptor::Equals</a></div><div class="ttdeci">bool Equals(const RowDescriptor &amp;other_desc) const </div><div class="ttdoc">Return true if the tuple ids of this descriptor match tuple ids of other desc. </div><div class="ttdef"><b>Definition:</b> <a href="descriptors_8cc_source.html#l00361">descriptors.cc:361</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a862e2da773f1d3ba0114df6a6fbc7e0a"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a862e2da773f1d3ba0114df6a6fbc7e0a">impala::BufferedTupleStream::nullable_tuple_</a></div><div class="ttdeci">const bool nullable_tuple_</div><div class="ttdoc">Whether any tuple in the rows is nullable. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00271">buffered-tuple-stream.h:271</a></div></div>
<div class="ttc" id="classuint64__t_html"><div class="ttname"><a href="classuint64__t.html">uint64_t</a></div></div>
<div class="ttc" id="classimpala_1_1RowBatch_html_a50bef2f2a7162d478aafef2dfd508e84"><div class="ttname"><a href="classimpala_1_1RowBatch.html#a50bef2f2a7162d478aafef2dfd508e84">impala::RowBatch::MarkNeedToReturn</a></div><div class="ttdeci">void MarkNeedToReturn()</div><div class="ttdef"><b>Definition:</b> <a href="row-batch_8h_source.html#l00167">row-batch.h:167</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a1253dcec8226c94833f74bc80a2b90b3"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a1253dcec8226c94833f74bc80a2b90b3">impala::BufferedTupleStream::write_block_</a></div><div class="ttdeci">BufferedBlockMgr::Block * write_block_</div><div class="ttdoc">The current block for writing. NULL if there is no available block to write to. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00325">buffered-tuple-stream.h:325</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_1_1Block_html_a98ac414f60e71a25c45ec2526c5bcf87"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a98ac414f60e71a25c45ec2526c5bcf87">impala::BufferedBlockMgr::Block::Delete</a></div><div class="ttdeci">Status Delete()</div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8cc_source.html#l00130">buffered-block-mgr.cc:130</a></div></div>
<div class="ttc" id="classimpala_1_1RowBatch_html"><div class="ttname"><a href="classimpala_1_1RowBatch.html">impala::RowBatch</a></div><div class="ttdef"><b>Definition:</b> <a href="row-batch_8h_source.html#l00066">row-batch.h:66</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_acff79f0ded3d6752e2d28c9399c6d0b1"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#acff79f0ded3d6752e2d28c9399c6d0b1">impala::BufferedTupleStream::GetRows</a></div><div class="ttdeci">Status GetRows(boost::scoped_ptr&lt; RowBatch &gt; *batch, bool *got_rows)</div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8cc_source.html#l00431">buffered-tuple-stream.cc:431</a></div></div>
<div class="ttc" id="namespaceimpala_html_aa98447566dd6700a2faaaaf3059f4d95"><div class="ttname"><a href="namespaceimpala.html#aa98447566dd6700a2faaaaf3059f4d95">impala::row_desc</a></div><div class="ttdeci">const RowDescriptor &amp; row_desc() const </div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_html_aa9b3d1904de97e5829b8d8fe880ba506"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr.html#aa9b3d1904de97e5829b8d8fe880ba506">impala::BufferedBlockMgr::TryAcquireTmpReservation</a></div><div class="ttdeci">bool TryAcquireTmpReservation(Client *client, int num_buffers)</div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8cc_source.html#l00257">buffered-block-mgr.cc:257</a></div></div>
<div class="ttc" id="structimpala_1_1StringValue_html_a17f088f03fd1f7b017df20f58f71fe13"><div class="ttname"><a href="structimpala_1_1StringValue.html#a17f088f03fd1f7b017df20f58f71fe13">impala::StringValue::ptr</a></div><div class="ttdeci">char * ptr</div><div class="ttdef"><b>Definition:</b> <a href="string-value_8h_source.html#l00037">string-value.h:37</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a707b3fddb8c72b48232682dee77cb06c"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a707b3fddb8c72b48232682dee77cb06c">impala::BufferedTupleStream::pinned_</a></div><div class="ttdeci">bool pinned_</div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00345">buffered-tuple-stream.h:345</a></div></div>
<div class="ttc" id="classimpala_1_1RowDescriptor_html_a3d57439c68d08fe374c33370529a855c"><div class="ttname"><a href="classimpala_1_1RowDescriptor.html#a3d57439c68d08fe374c33370529a855c">impala::RowDescriptor::tuple_descriptors</a></div><div class="ttdeci">const std::vector&lt; TupleDescriptor * &gt; &amp; tuple_descriptors() const </div><div class="ttdoc">Return descriptors for all tuples in this row, in order of appearance. </div><div class="ttdef"><b>Definition:</b> <a href="descriptors_8h_source.html#l00412">descriptors.h:412</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a5e3173eca7b0c50e2ef87c02947e69c8"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a5e3173eca7b0c50e2ef87c02947e69c8">impala::BufferedTupleStream::UnpinBlock</a></div><div class="ttdeci">Status UnpinBlock(BufferedBlockMgr::Block *block)</div><div class="ttdoc">Unpins block if it is an io sized block and updates tracking stats. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8cc_source.html#l00168">buffered-tuple-stream.cc:168</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a691dc8b7d5efbb60c41e7301dc5a63b6"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a691dc8b7d5efbb60c41e7301dc5a63b6">impala::BufferedTupleStream::block_mgr_</a></div><div class="ttdeci">BufferedBlockMgr * block_mgr_</div><div class="ttdoc">Block manager and client used to allocate, pin and release blocks. Not owned. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00288">buffered-tuple-stream.h:288</a></div></div>
<div class="ttc" id="classimpala_1_1RuntimeProfile_html"><div class="ttname"><a href="classimpala_1_1RuntimeProfile.html">impala::RuntimeProfile</a></div><div class="ttdef"><b>Definition:</b> <a href="runtime-profile_8h_source.html#l00083">runtime-profile.h:83</a></div></div>
<div class="ttc" id="classimpala_1_1TupleRow_html_aaf1d69b97c90eec7da3d07bdc40f5665"><div class="ttname"><a href="classimpala_1_1TupleRow.html#aaf1d69b97c90eec7da3d07bdc40f5665">impala::TupleRow::SetTuple</a></div><div class="ttdeci">void SetTuple(int tuple_idx, Tuple *tuple)</div><div class="ttdef"><b>Definition:</b> <a href="tuple-row_8h_source.html#l00034">tuple-row.h:34</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a09839179a512779b0c1a584ba96be59f"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a09839179a512779b0c1a584ba96be59f">impala::BufferedTupleStream::pin_timer_</a></div><div class="ttdeci">RuntimeProfile::Counter * pin_timer_</div><div class="ttdoc">Counters added by this object to the parent runtime profile. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00348">buffered-tuple-stream.h:348</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_ab0313f195d91db86e2d86eeeda553e7a"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#ab0313f195d91db86e2d86eeeda553e7a">impala::BufferedTupleStream::null_indicators_write_block_</a></div><div class="ttdeci">uint32_t null_indicators_write_block_</div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00282">buffered-tuple-stream.h:282</a></div></div>
<div class="ttc" id="classimpala_1_1RowBatch_html_ab171442ddcb3a1c3aab36991dbb511bb"><div class="ttname"><a href="classimpala_1_1RowBatch.html#ab171442ddcb3a1c3aab36991dbb511bb">impala::RowBatch::capacity</a></div><div class="ttdeci">int capacity() const </div><div class="ttdef"><b>Definition:</b> <a href="row-batch_8h_source.html#l00216">row-batch.h:216</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_ae4e2e76ff44f09a358c6c36827da9f50"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#ae4e2e76ff44f09a358c6c36827da9f50">impala::BufferedTupleStream::Init</a></div><div class="ttdeci">Status Init(RuntimeProfile *profile=NULL, bool pinned=true)</div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8cc_source.html#l00116">buffered-tuple-stream.cc:116</a></div></div>
<div class="ttc" id="compiler-util_8h_html_a9acc330d508b9a3b775cfdf7ce405e7d"><div class="ttname"><a href="compiler-util_8h.html#a9acc330d508b9a3b775cfdf7ce405e7d">UNLIKELY</a></div><div class="ttdeci">#define UNLIKELY(expr)</div><div class="ttdef"><b>Definition:</b> <a href="compiler-util_8h_source.html#l00033">compiler-util.h:33</a></div></div>
<div class="ttc" id="classimpala_1_1Tuple_html_ad0d1cf8a3eca6b49fe7bd4d337758f56"><div class="ttname"><a href="classimpala_1_1Tuple.html#ad0d1cf8a3eca6b49fe7bd4d337758f56">impala::Tuple::GetStringSlot</a></div><div class="ttdeci">StringValue * GetStringSlot(int offset)</div><div class="ttdef"><b>Definition:</b> <a href="tuple_8h_source.html#l00128">tuple.h:128</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a4121e3bb85a9a0c2612930a7aed61807"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a4121e3bb85a9a0c2612930a7aed61807">impala::BufferedTupleStream::DebugString</a></div><div class="ttdeci">std::string DebugString() const </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8cc_source.html#l00093">buffered-tuple-stream.cc:93</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a4f537ea0c46ce3dfc77a5b3bf58a07af"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a4f537ea0c46ce3dfc77a5b3bf58a07af">impala::BufferedTupleStream::PrepareForRead</a></div><div class="ttdeci">Status PrepareForRead(bool *got_buffer=NULL)</div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8cc_source.html#l00314">buffered-tuple-stream.cc:314</a></div></div>
<div class="ttc" id="classimpala_1_1Status_html_a580565665ea944eb64f3f495b1bee1e0"><div class="ttname"><a href="classimpala_1_1Status.html#a580565665ea944eb64f3f495b1bee1e0">impala::Status::OK</a></div><div class="ttdeci">static const Status OK</div><div class="ttdef"><b>Definition:</b> <a href="status_8h_source.html#l00087">status.h:87</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a3b47a81d368ad14edaf0256f2779189a"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a3b47a81d368ad14edaf0256f2779189a">impala::BufferedTupleStream::is_pinned</a></div><div class="ttdeci">bool is_pinned() const </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00243">buffered-tuple-stream.h:243</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_aa2229061216f10cfa13936bb38d88cd0"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#aa2229061216f10cfa13936bb38d88cd0">impala::BufferedTupleStream::read_bytes_</a></div><div class="ttdeci">int64_t read_bytes_</div><div class="ttdoc">Bytes read in read_block_. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00316">buffered-tuple-stream.h:316</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_acee73ea9a28e990c2dd08d7720ebb209"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#acee73ea9a28e990c2dd08d7720ebb209">impala::BufferedTupleStream::blocks_</a></div><div class="ttdeci">std::list&lt; BufferedBlockMgr::Block * &gt; blocks_</div><div class="ttdoc">List of blocks in the stream. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00292">buffered-tuple-stream.h:292</a></div></div>
<div class="ttc" id="partitioning-throughput-test_8cc_html_ad172ecfd5c31c5df6282c2b4bc322bf7"><div class="ttname"><a href="partitioning-throughput-test_8cc.html#ad172ecfd5c31c5df6282c2b4bc322bf7">offset</a></div><div class="ttdeci">uint8_t offset[7 *64-sizeof(uint64_t)]</div><div class="ttdef"><b>Definition:</b> <a href="partitioning-throughput-test_8cc_source.html#l00037">partitioning-throughput-test.cc:37</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_af5796ba9a36c8485227b810b343aec47"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#af5796ba9a36c8485227b810b343aec47">impala::BufferedTupleStream::num_rows</a></div><div class="ttdeci">int64_t num_rows() const </div><div class="ttdoc">Number of rows in the stream. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00231">buffered-tuple-stream.h:231</a></div></div>
<div class="ttc" id="classimpala_1_1SlotDescriptor_html_abd47b8777b6d94017e1e4dc6b8234fad"><div class="ttname"><a href="classimpala_1_1SlotDescriptor.html#abd47b8777b6d94017e1e4dc6b8234fad">impala::SlotDescriptor::tuple_offset</a></div><div class="ttdeci">int tuple_offset() const </div><div class="ttdef"><b>Definition:</b> <a href="descriptors_8h_source.html#l00088">descriptors.h:88</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_afe2947af8d8829e0aa56df12eb32da87"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#afe2947af8d8829e0aa56df12eb32da87">impala::BufferedTupleStream::NewBlockForWrite</a></div><div class="ttdeci">Status NewBlockForWrite(int min_size, bool *got_block)</div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8cc_source.html#l00178">buffered-tuple-stream.cc:178</a></div></div>
<div class="ttc" id="names_8h_html"><div class="ttname"><a href="names_8h.html">names.h</a></div></div>
<div class="ttc" id="tuple-row_8h_html"><div class="ttname"><a href="tuple-row_8h.html">tuple-row.h</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_html_a1dba9cde4a03d0d395bcb59345db7248"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr.html#a1dba9cde4a03d0d395bcb59345db7248">impala::BufferedBlockMgr::DebugString</a></div><div class="ttdeci">std::string DebugString(Client *client=NULL)</div><div class="ttdoc">Dumps block mgr state. Grabs lock. If client is not NULL, also dumps its state. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8cc_source.html#l01082">buffered-block-mgr.cc:1082</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_1_1Block_html_a3beba257e3649515dd06d31a42667d5e"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a3beba257e3649515dd06d31a42667d5e">impala::BufferedBlockMgr::Block::buffer</a></div><div class="ttdeci">uint8_t * buffer() const </div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8h_source.html#l00181">buffered-block-mgr.h:181</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a7265887dc92e2d30d36cd92de6dfcfe0"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a7265887dc92e2d30d36cd92de6dfcfe0">impala::BufferedTupleStream::get_new_block_timer_</a></div><div class="ttdeci">RuntimeProfile::Counter * get_new_block_timer_</div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00350">buffered-tuple-stream.h:350</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a9d2f211df83a684b2a644d2b8a179026"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a9d2f211df83a684b2a644d2b8a179026">impala::BufferedTupleStream::UnpinStream</a></div><div class="ttdeci">Status UnpinStream(bool all=false)</div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8cc_source.html#l00396">buffered-tuple-stream.cc:396</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a21cc752d4db27e53c163e155f5da61e9"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a21cc752d4db27e53c163e155f5da61e9">impala::BufferedTupleStream::SwitchToIoBuffers</a></div><div class="ttdeci">Status SwitchToIoBuffers(bool *got_buffer)</div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8cc_source.html#l00136">buffered-tuple-stream.cc:136</a></div></div>
<div class="ttc" id="buffered-tuple-stream_8cc_html_a2c16c11fb7f64ff4dbe4e078bfc5bea3"><div class="ttname"><a href="buffered-tuple-stream_8cc.html#a2c16c11fb7f64ff4dbe4e078bfc5bea3">NUM_SMALL_BLOCKS</a></div><div class="ttdeci">static const int NUM_SMALL_BLOCKS</div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8cc_source.html#l00035">buffered-tuple-stream.cc:35</a></div></div>
<div class="ttc" id="namespacegen__ir__descriptions_html_a0d6572990c8dd576a55a21ff11d6deb7"><div class="ttname"><a href="namespacegen__ir__descriptions.html#a0d6572990c8dd576a55a21ff11d6deb7">gen_ir_descriptions.idx</a></div><div class="ttdeci">int idx</div><div class="ttdef"><b>Definition:</b> <a href="gen__ir__descriptions_8py_source.html#l00215">gen_ir_descriptions.py:215</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedBlockMgr_1_1Block_html_a03ad00fa7c792f4fc85ba5e573a30369"><div class="ttname"><a href="classimpala_1_1BufferedBlockMgr_1_1Block.html#a03ad00fa7c792f4fc85ba5e573a30369">impala::BufferedBlockMgr::Block::Unpin</a></div><div class="ttdeci">Status Unpin()</div><div class="ttdef"><b>Definition:</b> <a href="buffered-block-mgr_8cc_source.html#l00126">buffered-block-mgr.cc:126</a></div></div>
<div class="ttc" id="buffered-tuple-stream_8cc_html_a37f1aacc6a0ce5c8d4962e2bbeaec604"><div class="ttname"><a href="buffered-tuple-stream_8cc.html#a37f1aacc6a0ce5c8d4962e2bbeaec604">NumPinned</a></div><div class="ttdeci">int NumPinned(const list&lt; BufferedBlockMgr::Block * &gt; &amp;blocks)</div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8cc_source.html#l00084">buffered-tuple-stream.cc:84</a></div></div>
<div class="ttc" id="structimpala_1_1BufferedTupleStream_1_1RowIdx_html"><div class="ttname"><a href="structimpala_1_1BufferedTupleStream_1_1RowIdx.html">impala::BufferedTupleStream::RowIdx</a></div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00121">buffered-tuple-stream.h:121</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a115418648d4c9755e7dbd0cfa2c0b9f0"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a115418648d4c9755e7dbd0cfa2c0b9f0">impala::BufferedTupleStream::num_small_blocks_</a></div><div class="ttdeci">int num_small_blocks_</div><div class="ttdoc">The total number of small blocks in blocks_;. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00333">buffered-tuple-stream.h:333</a></div></div>
<div class="ttc" id="classimpala_1_1BitUtil_html_adea2063ccbcb946cd552d2a3050b7f33"><div class="ttname"><a href="classimpala_1_1BitUtil.html#adea2063ccbcb946cd552d2a3050b7f33">impala::BitUtil::RoundUpNumi64</a></div><div class="ttdeci">static uint32_t RoundUpNumi64(uint32_t bits)</div><div class="ttdoc">Returns the rounded up to 64 multiple. Used for conversions of bits to i64. </div><div class="ttdef"><b>Definition:</b> <a href="bit-util_8h_source.html#l00097">bit-util.h:97</a></div></div>
<div class="ttc" id="descriptors_8h_html"><div class="ttname"><a href="descriptors_8h.html">descriptors.h</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_ae35acc9106a9bc881e8a1127cc57a198"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#ae35acc9106a9bc881e8a1127cc57a198">impala::BufferedTupleStream::num_rows_</a></div><div class="ttdeci">int64_t num_rows_</div><div class="ttdoc">Number of rows stored in the stream. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00339">buffered-tuple-stream.h:339</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_a5277d4ff9fdeb7b31bdf4d520739582d"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#a5277d4ff9fdeb7b31bdf4d520739582d">impala::BufferedTupleStream::GetNext</a></div><div class="ttdeci">Status GetNext(RowBatch *batch, bool *eos, std::vector&lt; RowIdx &gt; *indices=NULL)</div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8cc_source.html#l00447">buffered-tuple-stream.cc:447</a></div></div>
<div class="ttc" id="classimpala_1_1RowBatch_html_a5c4883960d142b0ec5ebdd182da1c79b"><div class="ttname"><a href="classimpala_1_1RowBatch.html#a5c4883960d142b0ec5ebdd182da1c79b">impala::RowBatch::CommitRows</a></div><div class="ttdeci">void CommitRows(int n)</div><div class="ttdef"><b>Definition:</b> <a href="row-batch_8h_source.html#l00102">row-batch.h:102</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_ab2947eeec41d97443113b05585273683"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#ab2947eeec41d97443113b05585273683">impala::BufferedTupleStream::ComputeRowSize</a></div><div class="ttdeci">int ComputeRowSize(TupleRow *row) const </div><div class="ttdoc">Returns the byte size of this row when encoded in a block. </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8cc_source.html#l00595">buffered-tuple-stream.cc:595</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_ab6fc6d8b3e3aa42fcaba7f3821ed2c33"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#ab6fc6d8b3e3aa42fcaba7f3821ed2c33">impala::BufferedTupleStream::rows_returned_</a></div><div class="ttdeci">int64_t rows_returned_</div><div class="ttdoc">Number of rows returned to the caller from GetNext(). </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8h_source.html#l00319">buffered-tuple-stream.h:319</a></div></div>
<div class="ttc" id="classimpala_1_1BufferedTupleStream_html_ac034f1be3983f354b5b7170e4e5afd62"><div class="ttname"><a href="classimpala_1_1BufferedTupleStream.html#ac034f1be3983f354b5b7170e4e5afd62">impala::BufferedTupleStream::bytes_in_mem</a></div><div class="ttdeci">int64_t bytes_in_mem(bool ignore_current) const </div><div class="ttdef"><b>Definition:</b> <a href="buffered-tuple-stream_8cc_source.html#l00156">buffered-tuple-stream.cc:156</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_e5d120be6b5e8a44336cbfd013b25604.html">be</a></li><li class="navelem"><a class="el" href="dir_68cf7cafb51a962d5bc4848b83cab0de.html">src</a></li><li class="navelem"><a class="el" href="dir_1ef28ab5153adb64262182d038c65543.html">runtime</a></li><li class="navelem"><a class="el" href="buffered-tuple-stream_8cc.html">buffered-tuple-stream.cc</a></li>
    <li class="footer">Generated on Thu May 7 2015 16:10:36 for Impala by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
